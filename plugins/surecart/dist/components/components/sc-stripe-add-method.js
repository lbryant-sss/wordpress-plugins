import{proxyCustomElement,HTMLElement,h}from"@stencil/core/internal/client";import{p as pure}from"./pure.js";import{a as apiFetch}from"./fetch.js";import{d as defineCustomElement$7}from"./sc-alert2.js";import{d as defineCustomElement$6}from"./sc-button2.js";import{d as defineCustomElement$5}from"./sc-form2.js";import{d as defineCustomElement$4}from"./sc-icon2.js";import{d as defineCustomElement$3}from"./sc-skeleton2.js";import{d as defineCustomElement$2}from"./sc-spinner2.js";import{a as addQueryArgs}from"./add-query-args.js";const scStripeAddMethodCss="sc-stripe-add-method{display:block}sc-stripe-add-method [hidden]{display:none}.loader{display:grid;height:128px;gap:2em}.loader__row{display:flex;align-items:flex-start;justify-content:space-between;gap:1em}.loader__details{display:grid;gap:0.5em}",ScStripeAddMethodStyle0=scStripeAddMethodCss,ScStripeAddMethod$1=proxyCustomElement(class extends HTMLElement{constructor(){super(),this.__registerHost(),this.liveMode=!0,this.customerId=void 0,this.successUrl=void 0,this.loading=void 0,this.loaded=void 0,this.error=void 0,this.paymentIntent=void 0}componentWillLoad(){this.createPaymentIntent()}async handlePaymentIntentCreate(){var e,t,s,o,r,n,i,d,a,c,l,m,u,p,h,f,y,b;if(!(null===(s=null===(t=null===(e=this.paymentIntent)||void 0===e?void 0:e.processor_data)||void 0===t?void 0:t.stripe)||void 0===s?void 0:s.publishable_key)||!(null===(n=null===(r=null===(o=this.paymentIntent)||void 0===o?void 0:o.processor_data)||void 0===r?void 0:r.stripe)||void 0===n?void 0:n.account_id))return;if(!this.stripe)try{this.stripe=await pure.loadStripe(null===(a=null===(d=null===(i=this.paymentIntent)||void 0===i?void 0:i.processor_data)||void 0===d?void 0:d.stripe)||void 0===a?void 0:a.publishable_key,{stripeAccount:null===(m=null===(l=null===(c=this.paymentIntent)||void 0===c?void 0:c.processor_data)||void 0===l?void 0:l.stripe)||void 0===m?void 0:m.account_id})}catch(e){return void(this.error=(null==e?void 0:e.message)||wp.i18n.__("Stripe could not be loaded","surecart"))}if(!(null===(h=null===(p=null===(u=this.paymentIntent)||void 0===u?void 0:u.processor_data)||void 0===p?void 0:p.stripe)||void 0===h?void 0:h.client_secret)||!this.container)return void console.warn("do not have client secret or container");const v=getComputedStyle(document.body);this.elements=this.stripe.elements({clientSecret:null===(b=null===(y=null===(f=this.paymentIntent)||void 0===f?void 0:f.processor_data)||void 0===y?void 0:y.stripe)||void 0===b?void 0:b.client_secret,appearance:{variables:{colorPrimary:v.getPropertyValue("--sc-color-primary-500"),colorText:v.getPropertyValue("--sc-input-label-color"),borderRadius:v.getPropertyValue("--sc-input-border-radius-medium"),colorBackground:v.getPropertyValue("--sc-input-background-color"),fontSizeBase:v.getPropertyValue("--sc-input-font-size-medium")},rules:{".Input":{border:v.getPropertyValue("--sc-input-border")},".Input::placeholder":{color:v.getPropertyValue("--sc-input-placeholder-color")}}}}),this.elements.create("payment",{wallets:{applePay:"never",googlePay:"never"}}).mount(".sc-payment-element-container"),this.element=this.elements.getElement("payment"),this.element.on("ready",(()=>this.loaded=!0))}async createPaymentIntent(){try{this.loading=!0,this.error="",this.paymentIntent=await apiFetch({method:"POST",path:"surecart/v1/payment_intents",data:{processor_type:"stripe",live_mode:this.liveMode,customer_id:this.customerId,refresh_status:!0}})}catch(e){this.error=(null==e?void 0:e.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.loading=!1}}async handleSubmit(e){var t;e.preventDefault(),this.loading=!0;try{const e=await this.stripe.confirmSetup({elements:this.elements,confirmParams:{return_url:addQueryArgs(this.successUrl,{payment_intent:null===(t=this.paymentIntent)||void 0===t?void 0:t.id})},redirect:"always"});if(null==e?void 0:e.error)throw this.error=e.error.message,e.error}catch(e){console.error(e),this.error=(null==e?void 0:e.message)||wp.i18n.__("Something went wrong","surecart"),this.loading=!1}}render(){return h("sc-form",{key:"54fe33834ede7f9d3ea2f8cb41cd3d8595821ea8",onScFormSubmit:e=>this.handleSubmit(e)},this.error&&h("sc-alert",{key:"6b9bc4ee97b5eab50a70ab95f706a2e53c3f0cfc",open:!!this.error,type:"danger"},h("span",{key:"d9509b2d19204d498db2b9eeb63200868cdb50b7",slot:"title"},wp.i18n.__("Error","surecart")),this.error),h("div",{key:"55cfbafe4e156256ebccc5351b5e2e9e02af9117",class:"loader",hidden:this.loaded},h("div",{key:"853e37d6f0ada7fee054629e8af8c14a99e01c34",class:"loader__row"},h("div",{key:"cb31ddb7767c79fe46649a8f6686e4a48b722618",style:{width:"50%"}},h("sc-skeleton",{key:"35803e48724967ad40fbac797577a8d3daab1232",style:{width:"50%",marginBottom:"0.5em"}}),h("sc-skeleton",{key:"8d9aea78f5af38bd381fc504626c1c3db3e21863"})),h("div",{key:"42b4b653e7bb267ca7cb62b3394dd2ecb1aa2d68",style:{flex:"1"}},h("sc-skeleton",{key:"39315ec3f1cddada8219d145c8f024f8a71aa8d6",style:{width:"50%",marginBottom:"0.5em"}}),h("sc-skeleton",{key:"931c0aea4f0e56c15c1756658cac6cfd27632a1b"})),h("div",{key:"0667bf81f754b4f0ade39a08b14eea6a781108cb",style:{flex:"1"}},h("sc-skeleton",{key:"98142daac7f965ff2232c10331cdb7245915379b",style:{width:"50%",marginBottom:"0.5em"}}),h("sc-skeleton",{key:"b130bdb0e7faa91cbeca06adf0108b2253f2109c"}))),h("div",{key:"b638ed0830197b2c78f390052b9cc31f87fe8a50",class:"loader__details"},h("sc-skeleton",{key:"52574c8c5df828598d1c190e05253bfa6cfed425",style:{height:"1rem"}}),h("sc-skeleton",{key:"70da8fdbdf67ff0be0f139a8d036f99474e3acf0",style:{height:"1rem",width:"30%"}}))),h("div",{key:"ff57fe49a812bf71ebcef7fe9419adc8a201dd49",hidden:!this.loaded,class:"sc-payment-element-container",ref:e=>this.container=e}),h("sc-button",{key:"09e1a0693a7fe8325ad039eb3d3b254ae20263c5",type:"primary",submit:!0,full:!0,loading:this.loading},wp.i18n.__("Save Payment Method","surecart")))}static get watchers(){return{paymentIntent:["handlePaymentIntentCreate"]}}static get style(){return ScStripeAddMethodStyle0}},[0,"sc-stripe-add-method",{liveMode:[4,"live-mode"],customerId:[1,"customer-id"],successUrl:[1,"success-url"],loading:[32],loaded:[32],error:[32],paymentIntent:[32]},void 0,{paymentIntent:["handlePaymentIntentCreate"]}]);function defineCustomElement$1(){"undefined"!=typeof customElements&&["sc-stripe-add-method","sc-alert","sc-button","sc-form","sc-icon","sc-skeleton","sc-spinner"].forEach((e=>{switch(e){case"sc-stripe-add-method":customElements.get(e)||customElements.define(e,ScStripeAddMethod$1);break;case"sc-alert":customElements.get(e)||defineCustomElement$7();break;case"sc-button":customElements.get(e)||defineCustomElement$6();break;case"sc-form":customElements.get(e)||defineCustomElement$5();break;case"sc-icon":customElements.get(e)||defineCustomElement$4();break;case"sc-skeleton":customElements.get(e)||defineCustomElement$3();break;case"sc-spinner":customElements.get(e)||defineCustomElement$2()}}))}const ScStripeAddMethod=ScStripeAddMethod$1,defineCustomElement=defineCustomElement$1;export{ScStripeAddMethod,defineCustomElement};