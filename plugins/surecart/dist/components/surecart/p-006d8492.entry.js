import{r as i,c as t,h as n,F as e,H as r}from"./p-e97fde0a.js";import{o}from"./p-393cb717.js";import{i as s}from"./p-c0a8ca8d.js";import{i as c}from"./p-4df6e0c5.js";import{a as u}from"./p-dd3464cd.js";import{a}from"./p-401e165e.js";import"./p-3f6362a4.js";import"./p-d3366af3.js";function h(i,t){for(var n=0;n<t.length;n++){var e=t[n];e.enumerable=e.enumerable||false;e.configurable=true;if("value"in e)e.writable=true;Object.defineProperty(i,e.key,e)}}function d(i,t,n){if(t)h(i.prototype,t);if(n)h(i,n);return i}function l(){l=Object.assign||function(i){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var e in n){if(Object.prototype.hasOwnProperty.call(n,e)){i[e]=n[e]}}}return i};return l.apply(this,arguments)}function v(i,t){i.prototype=Object.create(t.prototype);i.prototype.constructor=i;i.__proto__=t}function f(i){return!!(i&&typeof i.hasOwnProperty==="function"&&(i.hasOwnProperty("__ownerID")||i._map&&i._map.hasOwnProperty("__ownerID")))}function p(i,t,n){return Object.keys(i).reduce((function(t,e){var r=""+e;if(t.has(r)){return t.set(r,n(t.get(r),i[r]))}else{return t}}),t)}var m=function i(t){return function(i){return f(i)?i.get(t):i[t]}};var w=function(){function i(i,t,n){if(t===void 0){t={}}if(n===void 0){n={}}if(!i||typeof i!=="string"){throw new Error("Expected a string key for Entity, but found "+i+".")}var e=n,r=e.idAttribute,o=r===void 0?"id":r,s=e.mergeStrategy,c=s===void 0?function(i,t){return l({},i,t)}:s,u=e.processStrategy,a=u===void 0?function(i){return l({},i)}:u,h=e.fallbackStrategy,d=h===void 0?function(i,t){return undefined}:h;this._key=i;this._getId=typeof o==="function"?o:m(o);this._idAttribute=o;this._mergeStrategy=c;this._processStrategy=a;this._fallbackStrategy=d;this.define(t)}var t=i.prototype;t.define=function i(t){this.schema=Object.keys(t).reduce((function(i,n){var e;var r=t[n];return l({},i,(e={},e[n]=r,e))}),this.schema||{})};t.getId=function i(t,n,e){return this._getId(t,n,e)};t.merge=function i(t,n){return this._mergeStrategy(t,n)};t.fallback=function i(t,n){return this._fallbackStrategy(t,n)};t.normalize=function i(t,n,e,r,o,s){var c=this;var u=this.getId(t,n,e);var a=this.key;if(!(a in s)){s[a]={}}if(!(u in s[a])){s[a][u]=[]}if(s[a][u].some((function(i){return i===t}))){return u}s[a][u].push(t);var h=this._processStrategy(t,n,e);Object.keys(this.schema).forEach((function(i){if(h.hasOwnProperty(i)&&typeof h[i]==="object"){var n=c.schema[i];var e=typeof n==="function"?n(t):n;h[i]=r(h[i],h,i,e,o,s)}}));o(this,h,t,n,e);return u};t.denormalize=function i(t,n){var e=this;if(f(t)){return p(this.schema,t,n)}Object.keys(this.schema).forEach((function(i){if(t.hasOwnProperty(i)){var r=e.schema[i];t[i]=n(t[i],r)}}));return t};d(i,[{key:"key",get:function i(){return this._key}},{key:"idAttribute",get:function i(){return this._idAttribute}}]);return i}();var g=function(){function i(i,t){if(t){this._schemaAttribute=typeof t==="string"?function(i){return i[t]}:t}this.define(i)}var t=i.prototype;t.define=function i(t){this.schema=t};t.getSchemaAttribute=function i(t,n,e){return!this.isSingleSchema&&this._schemaAttribute(t,n,e)};t.inferSchema=function i(t,n,e){if(this.isSingleSchema){return this.schema}var r=this.getSchemaAttribute(t,n,e);return this.schema[r]};t.normalizeValue=function i(t,n,e,r,o,s){var c=this.inferSchema(t,n,e);if(!c){return t}var u=r(t,n,e,c,o,s);return this.isSingleSchema||u===undefined||u===null?u:{id:u,schema:this.getSchemaAttribute(t,n,e)}};t.denormalizeValue=function i(t,n){var e=f(t)?t.get("schema"):t.schema;if(!this.isSingleSchema&&!e){return t}var r=this.isSingleSchema?undefined:f(t)?t.get("id"):t.id;var o=this.isSingleSchema?this.schema:this.schema[e];return n(r||t,o)};d(i,[{key:"isSingleSchema",get:function i(){return!this._schemaAttribute}}]);return i}();var b=function(i){v(t,i);function t(t,n){if(!n){throw new Error('Expected option "schemaAttribute" not found on UnionSchema.')}return i.call(this,t,n)||this}var n=t.prototype;n.normalize=function i(t,n,e,r,o,s){return this.normalizeValue(t,n,e,r,o,s)};n.denormalize=function i(t,n){return this.denormalizeValue(t,n)};return t}(g);var y=function(i){v(t,i);function t(){return i.apply(this,arguments)||this}var n=t.prototype;n.normalize=function i(t,n,e,r,o,s){var c=this;return Object.keys(t).reduce((function(i,n,e){var u;var a=t[n];return a!==undefined&&a!==null?l({},i,(u={},u[n]=c.normalizeValue(a,t,n,r,o,s),u)):i}),{})};n.denormalize=function i(t,n){var e=this;return Object.keys(t).reduce((function(i,r){var o;var s=t[r];return l({},i,(o={},o[r]=e.denormalizeValue(s,n),o))}),{})};return t}(g);var _=function i(t){var n=Array.isArray(t);if(n&&t.length>1){throw new Error("Expected schema definition to be a single schema, but found "+t.length+".")}return t[0]};var x=function i(t){return Array.isArray(t)?t:Object.keys(t).map((function(i){return t[i]}))};var j=function i(t,n,e,r,o,s,c){t=_(t);var u=x(n);return u.map((function(i,n){return o(i,e,r,t,s,c)}))};var O=function(i){v(t,i);function t(){return i.apply(this,arguments)||this}var n=t.prototype;n.normalize=function i(t,n,e,r,o,s){var c=this;var u=x(t);return u.map((function(i,t){return c.normalizeValue(i,n,e,r,o,s)})).filter((function(i){return i!==undefined&&i!==null}))};n.denormalize=function i(t,n){var e=this;return t&&t.map?t.map((function(i){return e.denormalizeValue(i,n)})):t};return t}(g);var k=function i(t,n,e,r,o,s,c){var u=l({},n);Object.keys(t).forEach((function(i){var e=t[i];var r=typeof e==="function"?e(n):e;var a=o(n[i],n,i,r,s,c);if(a===undefined||a===null){delete u[i]}else{u[i]=a}}));return u};var C=function i(t,n,e){if(f(n)){return p(t,n,e)}var r=l({},n);Object.keys(t).forEach((function(i){if(r[i]!=null){r[i]=e(r[i],t[i])}}));return r};var E=function(){function i(i){this.define(i)}var t=i.prototype;t.define=function i(t){this.schema=Object.keys(t).reduce((function(i,n){var e;var r=t[n];return l({},i,(e={},e[n]=r,e))}),this.schema||{})};t.normalize=function i(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++){n[e]=arguments[e]}return k.apply(void 0,[this.schema].concat(n))};t.denormalize=function i(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++){n[e]=arguments[e]}return C.apply(void 0,[this.schema].concat(n))};return i}();var A=function i(t,n,e,r,o,s){if(typeof t!=="object"||!t){return t}if(typeof r==="object"&&(!r.normalize||typeof r.normalize!=="function")){var c=Array.isArray(r)?j:k;return c(r,t,n,e,i,o,s)}return r.normalize(t,n,e,i,o,s)};var z=function i(t){return function(i,n,e,r,o){var s=i.key;var c=i.getId(e,r,o);if(!(s in t)){t[s]={}}var u=t[s][c];if(u){t[s][c]=i.merge(u,n)}else{t[s][c]=n}}};var P={Array:O,Entity:w,Object:E,Union:b,Values:y};var I=function i(t,n){if(!t||typeof t!=="object"){throw new Error('Unexpected input given to normalize. Expected type to be "object", found "'+(t===null?"null":typeof t)+'".')}var e={};var r=z(e);var o={};var s=A(t,t,null,n,r,o);return{entities:e,result:s}};const S={integration:new P.Entity("integration"),account:new P.Entity("account"),price:new P.Entity("price"),product:new P.Entity("product"),product_group:new P.Entity("product_group"),purchase:new P.Entity("purchase"),payment_method:new P.Entity("payment_method"),card:new P.Entity("card"),invoice:new P.Entity("invoice"),current_period:new P.Entity("current_period"),refund:new P.Entity("refund"),dispute:new P.Entity("dispute"),charge:new P.Entity("charge"),coupon:new P.Entity("coupon"),promotion:new P.Entity("promotion"),order:new P.Entity("order"),customer:new P.Entity("customer"),subscription:new P.Entity("subscription"),product_group:new P.Entity("product_group")};const{price:L,product:U,purchase:D,payment_method:H,card:F,invoice:T,refund:W,charge:q,coupon:R,promotion:V,order:B,integration:G,customer:J,product_group:K,subscription:M}=S;U.define({prices:{data:[L]},product_group:K});L.define({product:U});T.define({purchases:{data:[D]},charge:q,customer:J,subscription:M});B.define({purchases:{data:[D]},charge:q,customer:J,subscription:M});q.define({order:B,invoice:T});M.define({current_period:T,purchase:D,price:L,payment_method:H,order:B,customer:J});W.define({charge:q,customer:J});D.define({order:B,product:U,subscription:M});H.define({card:F});R.define({promotions:{data:[V]}});K.define({});G.define({});const N=i=>{if(S?.[i?.[0]?.object]){return I(i,[S[i?.[0]?.object]])}return{}};const Q=async({ids:i,archived:t=false})=>{const n=await u({path:a("surecart/v1/prices/",{ids:i,archived:t,expand:["product"]})});return X(n)};const X=i=>{const{entities:t}=N(i);return{prices:t===null||t===void 0?void 0:t.price,products:t===null||t===void 0?void 0:t.product}};const Y=":host {\n  display: block;\n  min-width: 0;\n  width: 100%;\n}\n\nsc-choice-container {\n  container-type: inline-size;\n}\n\n.price-choice {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  line-height: var(--sc-line-height-dense);\n  gap: var(--sc-spacing-small);\n}\n.price-choice__name {\n  color: var(--sc-price-choice-name-color, var(--sc-input-label-color));\n  font-size: var(--sc-price-choice-name-size, var(--sc-input-label-font-size-medium));\n  font-weight: var(--sc-price-choice-name-font-weight, var(--sc-font-weight-bold));\n  text-transform: var(--sc-price-choice-text-transform, var(--sc-input-label-text-transform, none));\n  display: -webkit-box;\n  display: -moz-box;\n  -webkit-box-orient: vertical;\n  -moz-box-orient: vertical;\n  -webkit-line-clamp: 3;\n  -moz-box-lines: 3;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.price-choice__description {\n  color: var(--sc-input-help-text-color);\n}\n.price-choice > *:not(:first-child):last-child {\n  text-align: right;\n}\n.price-choice__details {\n  flex: 1 0 50%;\n  display: grid;\n  gap: var(--sc-spacing-xxx-small);\n}\n.price-choice__trial, .price-choice__setup-fee, .price-choice__price {\n  font-size: var(--sc-font-size-small);\n  color: var(--sc-input-help-text-color);\n}\n.price-choice__price {\n  color: var(--sc-input-label-color);\n  font-weight: var(--sc-price-choice-price-font-weight, var(--sc-font-weight-normal));\n}\n\n@container (max-width: 325px) {\n  .price-choice {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: var(--sc-spacing-xx-small);\n  }\n  .price-choice > *:not(:first-child):last-child {\n    text-align: initial;\n  }\n}";const Z=Y;const $=class{constructor(n){i(this,n);this.scUpdateLineItem=t(this,"scUpdateLineItem",7);this.scRemoveLineItem=t(this,"scRemoveLineItem",7);this.scAddEntities=t(this,"scAddEntities",7);this.priceId=undefined;this.price=undefined;this.product=undefined;this.loading=false;this.label=undefined;this.showLabel=true;this.showPrice=true;this.showControl=true;this.description=undefined;this.prices={};this.products={};this.order=undefined;this.quantity=1;this.type=undefined;this.checked=false;this.error=undefined;this.isAdHoc=undefined;this.blank=false;this.errorMessage=undefined;this.adHocErrorMessage=undefined}handlePriceIdChage(){var i;if(this.price&&((i=this.price)===null||i===void 0?void 0:i.id)===this.priceId)return;this.fetchPriceWithProduct()}handlePricesChange(){var i,t,n;if(!Object.keys(this.prices||{}).length||!Object.keys(this.products||{}).length)return;this.price=(i=this===null||this===void 0?void 0:this.prices)===null||i===void 0?void 0:i[this.priceId];this.product=(t=this===null||this===void 0?void 0:this.products)===null||t===void 0?void 0:t[(n=this===null||this===void 0?void 0:this.price)===null||n===void 0?void 0:n.product]}handlePriseChange(){var i;this.isAdHoc=(i=this===null||this===void 0?void 0:this.price)===null||i===void 0?void 0:i.ad_hoc}handleErrorsChange(){var i;const t=(((i=this===null||this===void 0?void 0:this.error)===null||i===void 0?void 0:i.additional_errors)||[]).find((i=>{var t;return((t=i===null||i===void 0?void 0:i.data)===null||t===void 0?void 0:t.attribute)==="line_items.ad_hoc_amount"}));this.adHocErrorMessage=(t===null||t===void 0?void 0:t.message)?t===null||t===void 0?void 0:t.message:""}handleCheckedChange(){var i;if(((i=this.price)===null||i===void 0?void 0:i.ad_hoc)&&this.choice.checked){setTimeout((()=>{this.adHocInput.triggerFocus()}),50);return}}componentWillLoad(){if(!this.price){this.fetchPriceWithProduct()}}async fetchPriceWithProduct(){if(!this.priceId)return;try{this.loading=true;const{products:i,prices:t}=await Q({archived:false,ids:[this.priceId]});this.scAddEntities.emit({prices:t,products:i})}catch(i){}finally{this.loading=false}}isInOrder(){return s(this.price,this.order)}isChecked(){return this.isInOrder()}onChangeAdHoc(i){this.scUpdateLineItem.emit({price_id:this.priceId,quantity:this.quantity,ad_hoc_amount:i.target.value})}getLineItem(){var i,t;return(((t=(i=this.order)===null||i===void 0?void 0:i.line_items)===null||t===void 0?void 0:t.data)||[]).find((i=>i.price.id===this.priceId))}showAdHoc(){var i,t;if(!((i=this.price)===null||i===void 0?void 0:i.ad_hoc)){return false}if(this.isInOrder()){return true}return(t=this===null||this===void 0?void 0:this.choice)===null||t===void 0?void 0:t.checked}renderEmpty(){var i;if((i=window===null||window===void 0?void 0:window.wp)===null||i===void 0?void 0:i.blocks){return n("sc-alert",{type:"danger",open:true,style:{margin:"0px"}},wp.i18n.__("This product has been archived.","surecart"))}return n(r,{style:{display:"none"}})}renderPrice(){var i;return n(e,null,(i=this.price)===null||i===void 0?void 0:i.display_amount,c(this.price,{showOnce:true,abbreviate:true,labels:{interval:"/",period:wp.i18n.__("for","surecart")}}))}render(){var i,t,r,o,s,u,a,h,d,l,v;if(this.loading){return n("sc-choice-container",{showControl:this.showControl,name:"loading",disabled:true},n("div",{class:"price-choice"},n("sc-skeleton",{style:{width:"60px",display:"inline-block"}}),n("sc-skeleton",{style:{width:"80px",display:"inline-block"}})))}if(!((i=this===null||this===void 0?void 0:this.price)===null||i===void 0?void 0:i.id)||((t=this.price)===null||t===void 0?void 0:t.archived))return this.renderEmpty();if((r=this.product)===null||r===void 0?void 0:r.archived){return this.renderEmpty()}return n("sc-choice-container",{ref:i=>this.choice=i,value:this.priceId,type:this.type,showControl:this.showControl,checked:this.isChecked()},n("div",{class:"price-choice"},this.showLabel&&n("div",{class:"price-choice__title"},n("div",{class:"price-choice__name"},this.label||((o=this===null||this===void 0?void 0:this.price)===null||o===void 0?void 0:o.name)||((s=this===null||this===void 0?void 0:this.product)===null||s===void 0?void 0:s.name)),!!this.description&&n("div",{class:"price-choice__description"},this.description)),this.showPrice&&n("div",{class:"price-choice__details"},n("div",{class:"price-choice__price"},((u=this.price)===null||u===void 0?void 0:u.ad_hoc)?wp.i18n.__("Custom Amount","surecart"):n(e,null,(a=this.price)===null||a===void 0?void 0:a.display_amount,c(this.price,{showOnce:true,abbreviate:true,labels:{interval:"/",period:wp.i18n.__("for","surecart")}}))),!!this.price.trial_duration_days&&n("div",{class:"price-choice__trial"},wp.i18n.sprintf(wp.i18n._n("Starting in %s day","Starting in %s days",this.price.trial_duration_days,"surecart"),this.price.trial_duration_days)),!!this.price.setup_fee_enabled&&((h=this.price)===null||h===void 0?void 0:h.setup_fee_amount)&&n("div",{class:"price-choice__setup-fee"},(d=this.price)===null||d===void 0?void 0:d.setup_fee_display_amount," ",((l=this.price)===null||l===void 0?void 0:l.setup_fee_name)||(((v=this.price)===null||v===void 0?void 0:v.setup_fee_amount)<0?wp.i18n.__("Discount","surecart"):wp.i18n.__("Setup Fee","surecart"))))))}static get watchers(){return{priceId:["handlePriceIdChage"],prices:["handlePricesChange"],products:["handlePricesChange"],price:["handlePriseChange"],error:["handleErrorsChange"],checked:["handleCheckedChange"]}}};o($,["prices","products","order","error"],false);$.style=Z;export{$ as sc_price_choice};
//# sourceMappingURL=p-006d8492.entry.js.map