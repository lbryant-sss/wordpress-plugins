{"version":3,"names":["submitCartForm","async","productId","productState","state","_a","selectedPrice","id","_b","ad_hoc","adHocAmount","undefined","setProduct","busy","addCheckoutLineItem","price","_c","quantity","Math","max","_d","_e","ad_hoc_amount","variant","_f","selectedVariant","note","toggleCart","dialog","e","console","error","getProductBuyLink","url","query","addQueryArgs","line_items","_g","getAdditionalErrorMessages","additional_errors","map","message","getTopLevelError","code","length"],"sources":["src/store/product/mutations.ts","src/functions/error.ts"],"sourcesContent":["import state from './store';\nimport { toggleCart } from '@store/ui';\nimport { addQueryArgs } from '@wordpress/url';\nimport { setProduct } from './setters';\nimport { addCheckoutLineItem } from '@store/checkout/mutations';\n\nexport const submitCartForm = async (productId: string) => {\n  const productState = state[productId];\n  if (!productState) return;\n  if (!productState.selectedPrice?.id) return;\n  if (productState.selectedPrice?.ad_hoc && (null === productState.adHocAmount || undefined === productState.adHocAmount)) return;\n\n  try {\n    setProduct(productId, { busy: true });\n    await addCheckoutLineItem({\n      price: productState.selectedPrice?.id,\n      quantity: Math.max(productState.selectedPrice?.ad_hoc ? 1 : productState.quantity, 1),\n      ...(productState.selectedPrice?.ad_hoc ? { ad_hoc_amount: productState.adHocAmount } : {}),\n      variant: productState.selectedVariant?.id,\n      ...(productState.note ? { note: productState.note } : {}),\n    });\n    toggleCart(true);\n    setProduct(productId, { dialog: null });\n  } catch (e) {\n    console.error(e);\n    state.error = e;\n    throw e; // Re-throw the caught error\n  } finally {\n    setProduct(productId, { busy: false });\n  }\n};\n\n/**\n * Get the product buy link.\n */\nexport const getProductBuyLink = (productId: string, url: string, query = {}) => {\n  const productState = state[productId];\n\n  if (!productState) return;\n  if (!productState.selectedPrice?.id) return;\n  if (productState.selectedPrice?.ad_hoc && !productState.adHocAmount && 0 !== productState.adHocAmount) return;\n\n  return addQueryArgs(url, {\n    line_items: [\n      {\n        price: productState.selectedPrice?.id,\n        quantity: Math.max(productState.selectedPrice?.ad_hoc ? 1 : productState.quantity, 1),\n        ...(productState.selectedPrice?.ad_hoc ? { ad_hoc_amount: productState.adHocAmount } : {}),\n        ...(productState.selectedVariant?.id ? { variant: productState.selectedVariant?.id } : {}),\n        ...(productState.note ? { note: productState.note } : {}),\n      },\n    ],\n    ...query,\n  });\n};\n","import { ScNoticeStore } from '../types';\n\n/**\n * Get any additional error messages.\n */\nexport const getAdditionalErrorMessages = error => (error?.additional_errors || []).map(error => error.message);\n\n/**\n * Get the top level error\n */\nexport const getTopLevelError = (error: ScNoticeStore) => {\n  // checkout invalid is not friendly.\n  if (error?.code === 'checkout.invalid' && getAdditionalErrorMessages(error)?.length) {\n    return '';\n  }\n  return error?.message;\n};\n"],"mappings":"6JAMaA,EAAiBC,MAAOC,I,gBACnC,MAAMC,EAAeC,EAAMF,GAC3B,IAAKC,EAAc,OACnB,MAAKE,EAAAF,EAAaG,iBAAa,MAAAD,SAAA,SAAAA,EAAEE,IAAI,OACrC,KAAIC,EAAAL,EAAaG,iBAAa,MAAAE,SAAA,SAAAA,EAAEC,UAAW,OAASN,EAAaO,aAAeC,YAAcR,EAAaO,aAAc,OAEzH,IACEE,EAAWV,EAAW,CAAEW,KAAM,aACxBC,EAAoB,CACxBC,OAAOC,EAAAb,EAAaG,iBAAa,MAAAU,SAAA,SAAAA,EAAET,GACnCU,SAAUC,KAAKC,MAAIC,EAAAjB,EAAaG,iBAAa,MAAAc,SAAA,SAAAA,EAAEX,QAAS,EAAIN,EAAac,SAAU,QAC/EI,EAAAlB,EAAaG,iBAAa,MAAAe,SAAA,SAAAA,EAAEZ,QAAS,CAAEa,cAAenB,EAAaO,aAAgB,GACvFa,SAASC,EAAArB,EAAasB,mBAAe,MAAAD,SAAA,SAAAA,EAAEjB,MACnCJ,EAAauB,KAAO,CAAEA,KAAMvB,EAAauB,MAAS,KAExDC,EAAW,MACXf,EAAWV,EAAW,CAAE0B,OAAQ,M,CAChC,MAAOC,GACPC,QAAQC,MAAMF,GACdzB,EAAM2B,MAAQF,EACd,MAAMA,C,SAENjB,EAAWV,EAAW,CAAEW,KAAM,O,SAOrBmB,EAAoB,CAAC9B,EAAmB+B,EAAaC,EAAQ,M,kBACxE,MAAM/B,EAAeC,EAAMF,GAE3B,IAAKC,EAAc,OACnB,MAAKE,EAAAF,EAAaG,iBAAa,MAAAD,SAAA,SAAAA,EAAEE,IAAI,OACrC,KAAIC,EAAAL,EAAaG,iBAAa,MAAAE,SAAA,SAAAA,EAAEC,UAAWN,EAAaO,aAAe,IAAMP,EAAaO,YAAa,OAEvG,OAAOyB,EAAaF,EAAK,CACvBG,WAAY,CACV,CACErB,OAAOC,EAAAb,EAAaG,iBAAa,MAAAU,SAAA,SAAAA,EAAET,GACnCU,SAAUC,KAAKC,MAAIC,EAAAjB,EAAaG,iBAAa,MAAAc,SAAA,SAAAA,EAAEX,QAAS,EAAIN,EAAac,SAAU,QAC/EI,EAAAlB,EAAaG,iBAAa,MAAAe,SAAA,SAAAA,EAAEZ,QAAS,CAAEa,cAAenB,EAAaO,aAAgB,QACnFc,EAAArB,EAAasB,mBAAe,MAAAD,SAAA,SAAAA,EAAEjB,IAAK,CAAEgB,SAASc,EAAAlC,EAAasB,mBAAe,MAAAY,SAAA,SAAAA,EAAE9B,IAAO,MACnFJ,EAAauB,KAAO,CAAEA,KAAMvB,EAAauB,MAAS,QAGvDQ,GACH,E,MChDSI,EAA6BP,KAAUA,IAAK,MAALA,SAAK,SAALA,EAAOQ,oBAAqB,IAAIC,KAAIT,GAASA,EAAMU,U,MAK1FC,EAAoBX,I,MAE/B,IAAIA,IAAK,MAALA,SAAK,SAALA,EAAOY,QAAS,sBAAsBtC,EAAAiC,EAA2BP,MAAM,MAAA1B,SAAA,SAAAA,EAAEuC,QAAQ,CACnF,MAAO,E,CAET,OAAOb,IAAK,MAALA,SAAK,SAALA,EAAOU,OAAO,S","ignoreList":[]}