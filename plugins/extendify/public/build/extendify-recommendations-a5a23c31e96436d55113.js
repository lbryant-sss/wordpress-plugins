"use strict";(globalThis.webpackChunkextendify=globalThis.webpackChunkextendify||[]).push([[415],{2118:(e,t,n)=>{var i=n(9196),a=n(7701),r=n.n(a),l=n(9307),s=n(5736),o=n(6483),c=n(5609),d=n(2629),u=n(1984),g=n(7329),m=n(8184),p=n(6755),h=n(2200);const{products:x=[]}=window.extRecommendationsData,f=e=>e.isSearchPluginsLoading||e.isInstalledPluginsLoading,w=e=>e.isSearchPluginsError||e.isInstalledPluginsError,y=e=>{const t=new Map,{searchPlugins:n,installedPlugins:i,searchPluginsLimit:a}=e,r=i.filter((({status:e})=>"active"===e)),l=n.slice(0,a);return x.filter((e=>e.slots.includes("plugin-search"))).filter((e=>e.pluginSearchTriggerSlugs.some((n=>{const i=l.includes(n);return i&&t.set(e.slug,n),i})))).filter((e=>"plugin"!==e.ctaType||!i.find((({slug:t})=>t===e.ctaPluginSlug)))).filter((e=>e.pluginExclusions.every((e=>!r.find((({slug:t})=>t===e)))))).filter((e=>e.pluginDependencies.every((e=>i.find((({slug:t})=>t===e)))))).filter(Boolean).map((e=>({...e,title:e.pluginSearchCustomTitle||e.title,description:e.pluginSearchCustomDescription||e.description,ctaContent:e.pluginSearchCustomCtaContent||e.ctaContent,triggerContent:t.get(e.slug),triggerType:"plugin-slug"}))).sort(((e,t)=>l.indexOf(e.triggerContent)-l.indexOf(t.triggerContent)))},E=e=>y(e).slice(0,e.recommendationsLimit),P=e=>{if(!e||!e.querySelectorAll)return[];const t=e.querySelectorAll(".plugin-card").values().map((e=>{const t=e.getAttribute("class"),n=t.match(/^plugin-card plugin-card-([\w-]*)$/)?.[1];return n})).filter(Boolean);return Array.from(t)};var v=n(4069),b=n(270),S=n(782);const k=(e,t)=>({query:null,searchPlugins:[],installedPlugins:[],searchPluginsLimit:6,recommendationsLimit:2,isSearchPluginsLoading:!1,isSearchPluginsError:!1,isInstalledPluginsLoading:!1,isInstalledPluginsError:!1,initialize:()=>{t().startListeningToAjax(),t().fetchInstalledPlugins()},startListeningToAjax:()=>{const t=new URLSearchParams(window.location.search).get("s");if(t){const n=document.getElementById("plugin-filter"),i=P(n);e({query:t,searchPlugins:i})}const n=new DOMParser;jQuery?.ajaxSetup({beforeSend:(t,i)=>{const a=new URLSearchParams(i.data),r=a.get("action"),l=a.get("s");"search-install-plugins"===r&&(i.success=t=>{if("string"==typeof t&&t?.startsWith("<!DOCTYPE html>")){const e=window.jQuery("#search-plugins"),t=e.val();return e.val(t.endsWith(" ")?t.trim():t+" "),void e.trigger("keyup")}try{const i=n.parseFromString(t?.data?.items||"","text/html"),a=P(i);e({searchPlugins:a,isSearchPluginsLoading:!1,isSearchPluginsError:!1})}catch(t){e({searchPlugins:[],isSearchPluginsLoading:!1,isSearchPluginsError:!0})}},i.error=()=>{e({searchPlugins:[],isSearchPluginsLoading:!1,isSearchPluginsError:!0})},e({query:l||null,searchPlugins:[],isSearchPluginsLoading:!!l,isSearchPluginsError:!1}))}})},fetchInstalledPlugins:async(n=!1)=>{if(!t().installedPlugins.length||n)try{e({isInstalledPluginsLoading:!0,isInstalledPluginsError:!1});const t=await(0,v.Yd)();e({installedPlugins:t?.map((e=>({slug:e.plugin.split("/")[0],status:e.status}))),isInstalledPluginsLoading:!1,isInstalledPluginsError:!1})}catch(t){e({installedPlugins:[],isInstalledPluginsLoading:!1,isInstalledPluginsError:!0})}}}),L=(()=>{const e=(0,b.Ue)((0,S.mW)(k,{name:"Extendify Plugin Search"}));return e.getState().initialize(),e})(),C=(e,t)=>Object.entries(e).filter((([e])=>t.includes(e))).reduce(((e,[t,n])=>({...e,[t]:n})),{}),{extSharedData:I,extRecommendationsData:N}=window,T=!(!N?.showPartnerBranding||!I?.partnerLogo),_={"plugin-search":L},D=Object.keys(_),j=({slot:e,event:t,product:n})=>{if(!t||!D.includes(e))return;const i=_[e].getState(),a=(e=>e.installedPlugins.map((e=>e.slug)))(i),r=(e=>e.installedPlugins.filter((e=>"active"===e.status)).map((e=>e.slug)))(i),l=y(i).map((e=>C(e,["slug","title","description","ctaContent","ctaType","triggerContent","triggerType"]))),s=l.find((e=>e.slug===n))?.slug,o={event:t,timestamp:(new Date).toISOString(),slot:e,recommendation:s,recommendations:l,recommendationsLimit:i.recommendationsLimit,query:decodeURIComponent(i.query),searchResults:i.searchPlugins,searchResultsLimit:i.searchPluginsLimit,installedPlugins:a,activePlugins:r,partnerBrandingEnabled:T,partnerId:I.partnerId,siteId:I.siteId,wpVersion:I.wpVersion,wpLocale:I.wpLanguage,extendifyVersion:I.version,devbuild:I.devbuild},c=new AbortController;window.setTimeout((()=>{c.abort()}),900),fetch(`${h.Ow}/api/v1/recommendations/activity`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-Extendify-Site-ID":I.siteId},signal:c.signal,body:JSON.stringify(o)}).catch((()=>null))};var B=n(5570),R=n(9016);const A=({slug:e,title:t,description:n,ctaContent:a,provider:r,image:o,ctaType:c,ctaPluginSlug:u,ctaExternalLink:g,ctaInternalLink:m,priceTag:p})=>((0,l.useEffect)((()=>{j({slot:"plugin-search",event:"view",product:e})}),[e]),(0,i.createElement)("div",{className:"flex flex-col rounded border border-gray-300","data-test":"extendify-recommendations-card"},(0,i.createElement)("div",{className:"row-auto grid flex-grow grid-cols-[2fr_3fr] grid-rows-[min-content_1fr] gap-x-5 gap-y-3 border-b border-b-gray-100 p-5 xs:grid-cols-[8rem_1fr]"},(0,i.createElement)("div",{className:"row-span-1 xs:row-span-2"},o&&("plugin"===c?(0,i.createElement)("a",{onClick:()=>j({slot:"plugin-search",event:"click-logo",product:e}),className:"thickbox open-plugin-details-modal block no-underline",href:`${window.extSharedData?.adminUrl}/plugin-install.php?tab=plugin-information&plugin=${u}&TB_iframe=true&width=600&height=550`},(0,i.createElement)("img",{className:"w-full xs:min-h-[8rem]",src:o,alt:t})):(0,i.createElement)("img",{className:"w-full xs:min-h-[8rem]",src:o,alt:t}))),(0,i.createElement)("div",{className:"flex flex-col justify-center xs:justify-start"},(0,i.createElement)("h3",{className:"m-0 text-lg leading-tight text-wp-theme-main"},"plugin"===c?(0,i.createElement)("a",{onClick:()=>j({slot:"plugin-search",event:"click-title",product:e}),className:"thickbox open-plugin-details-modal no-underline focus:shadow-none",href:`${window.extSharedData?.adminUrl}/plugin-install.php?tab=plugin-information&plugin=${u}&TB_iframe=true&width=600&height=550`},(0,d.decodeEntities)(t)):(0,d.decodeEntities)(t)),(0,i.createElement)("p",{className:"m-0 mt-1 text-xs"},(0,s.sprintf)(
// translators: %s is a name
(0,s._x)("By %s",'Preposition for "By Author Name"',"extendify-local"),r))),(0,i.createElement)("p",{className:"col-span-2 m-0 text-sm xs:col-span-1"},(0,d.decodeEntities)(n))),(0,i.createElement)("div",{className:"flex min-h-14 flex-shrink-0 flex-col items-center justify-center p-3 px-5 xxs:flex-row xxs:justify-end"},p&&(0,i.createElement)("p",{className:"m-0 mb-3 xxs:mb-0 xxs:mr-4",dangerouslySetInnerHTML:{__html:(0,d.decodeEntities)(p)}}),"plugin"===c&&(0,i.createElement)(O,{product:e,ctaContent:(0,d.decodeEntities)(a),ctaPluginSlug:u}),"external-link"===c&&(0,i.createElement)(q,{product:e,ctaContent:(0,d.decodeEntities)(a),ctaExternalLink:g}),"internal-link"===c&&(0,i.createElement)(U,{product:e,ctaContent:(0,d.decodeEntities)(a),ctaInternalLink:m})))),O=({product:e,ctaContent:t,ctaPluginSlug:n})=>{const[a,r]=(0,l.useState)("idle"),[o,d]=(0,l.useState)(null),p=(0,l.useCallback)((async()=>{j({slot:"plugin-search",event:"click-install",product:e});try{r("installing"),await Promise.all([(0,R.H_)((()=>(0,v.Tk)(n)),{maxAttempts:2}),(0,R._v)(1e3)])}catch(e){return d((0,s.__)("Failed to install the plugin","extendify-local")),void r("error")}const t=(({product:e,slot:t="plugin-search"})=>{const n=_[t].getState(),i=y(n).map((e=>C(e,["slug","title","description","ctaContent","ctaType","triggerContent","triggerType"])));return i.find((t=>t.slug===e))?.slug})({product:e});(0,B.mT)({slug:t||e,source:"search-recommendation-card"});try{r("activating"),await Promise.all([(0,R.H_)((()=>(0,v.bu)(n)),{maxAttempts:2}),(0,R._v)(1e3)])}catch(e){return d((0,s.__)("Failed to activate the plugin","extendify-local")),void r("error")}r("activated")}),[e,n]),h={idle:t,installing:(0,s._x)("Installing...","Plugin installation status","extendify-local"),activating:(0,s._x)("Activating...","Plugin activation status","extendify-local"),activated:(0,s._x)("Activated","Plugin activation status","extendify-local"),error:o};return"error"===a?(0,i.createElement)("p",{className:"m-0 flex items-center fill-wp-alert-red text-sm text-wp-alert-red"},(0,i.createElement)(u.Z,{icon:g.Z}),h[a]):"activated"===a?(0,i.createElement)("p",{className:"m-0 flex items-center fill-wp-alert-green text-sm text-wp-alert-green"},(0,i.createElement)(u.Z,{icon:m.Z}),h[a]):(0,i.createElement)(c.Button,{className:"h-auto min-w-24 whitespace-normal break-words rounded-sm bg-wp-theme-main px-3 align-middle text-sm text-design-text shadow-none hover:opacity-90 disabled:opacity-80",type:"button",variant:"secondary",size:"compact",disabled:"idle"!==a,isBusy:"idle"!==a,onClick:p},h[a])},q=({product:e,ctaContent:t,ctaExternalLink:n})=>{const a=(0,d.decodeEntities)(n).replace("{PARTNERID}",window.extSharedData?.partnerId);return(0,i.createElement)("a",{onClick:()=>j({slot:"plugin-search",event:"click-link-external",product:e}),href:a,target:"_blank",className:"relative flex min-h-8 min-w-24 cursor-pointer items-center justify-center whitespace-normal break-words rounded-sm bg-wp-theme-main fill-design-text py-[6px] pl-3 pr-9 text-center text-sm leading-tight text-design-text no-underline hover:opacity-90 focus:shadow-none"},t,(0,i.createElement)(u.Z,{className:"absolute right-3 h-5 w-5",icon:p.Z}))},U=({product:e,ctaContent:t,ctaInternalLink:n})=>(0,i.createElement)("a",{onClick:()=>j({slot:"plugin-search",event:"click-link-internal",product:e}),href:n,className:"relative flex min-h-8 min-w-24 cursor-pointer items-center justify-center whitespace-normal break-words rounded-sm bg-wp-theme-main fill-design-text px-3 py-[6px] text-center text-sm leading-tight text-design-text no-underline hover:opacity-90 focus:shadow-none"},t),$=({recommendations:e})=>(0,i.createElement)("div",{className:"grid grid-cols-1 gap-4 px-6 py-8 md:grid-cols-2 3xl:grid-cols-3 5xl:grid-cols-4","data-test":"extendify-recommendations-grid"},e.map((e=>["plugin","external-link","internal-link"].includes(e.ctaType)?(0,i.createElement)(A,{key:e.slug,...e}):null))),W=window.extRecommendationsData?.showPartnerBranding&&window.extSharedData?.partnerLogo,Z=()=>{const e=L((e=>e.query)),t=L(f),n=L(w),a=L((e=>e.recommendationsLimit)),r=L(E),c=L((e=>e.fetchInstalledPlugins));return(0,l.useEffect)((()=>{e&&!t&&j({slot:"plugin-search",event:"search"})}),[e,t]),(0,l.useEffect)((()=>{e&&c(!0)}),[e,c]),!e||!r?.length||t||n?null:(0,i.createElement)("div",{className:"my-8 flex w-full flex-col overflow-hidden rounded border border-gray-400 bg-white","data-test":"extendify-recommendations-banner"},(0,i.createElement)("div",{className:`flex h-14 border-b border-b-gray-200 ${W?"bg-banner-main":""} px-6 py-4`},W?(0,i.createElement)(i.Fragment,null,(0,i.createElement)("img",{className:"mr-3 h-full",src:window.extSharedData?.partnerLogo}),(0,i.createElement)("div",{className:"mr-3 border-l border-banner-text opacity-80"})):null,(0,i.createElement)("h2",{className:`m-0 flex h-full items-center ${W?"text-banner-text":""} `},(0,s.sprintf)(
// translators: %s: The search query term
(0,s.__)("Recommended Solutions for: %s","extendify-local"),(0,o.safeDecodeURIComponent)(e)))),(0,i.createElement)($,{recommendations:r.slice(0,a)}))};var F=n(5829);r()((()=>{const e=new URL(window.location.href),t=e.pathname.endsWith("plugin-install.php"),n=e.pathname.endsWith("post-new.php")&&"page"!==e.searchParams.get("post_type"),a=e.pathname.endsWith("post-new.php")&&"page"===e.searchParams.get("post_type");if((t||n||a)&&t){const e=document.getElementById("plugin-filter");if(e){const t="ext-recommendations-plugin-search";if(document.getElementById(t))return;const n=Object.assign(document.createElement("div"),{id:t,className:"extendify-recommendations"});return e.parentNode.insertBefore(n,e),(0,F.s)((0,i.createElement)(Z,null),n)}}}))},9196:e=>{e.exports=window.React},6989:e=>{e.exports=window.wp.apiFetch},5609:e=>{e.exports=window.wp.components},7701:e=>{e.exports=window.wp.domReady},9307:e=>{e.exports=window.wp.element},2629:e=>{e.exports=window.wp.htmlEntities},5736:e=>{e.exports=window.wp.i18n},444:e=>{e.exports=window.wp.primitives},6483:e=>{e.exports=window.wp.url}},e=>{e.O(0,[746,857],(()=>(2118,e(e.s=2118)))),e.O()}]);