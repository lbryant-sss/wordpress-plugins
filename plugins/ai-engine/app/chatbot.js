/*! For license information please see chatbot.js.LICENSE.txt */
(()=>{"use strict";var __webpack_modules__={469:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G:()=>ChatbotContextProvider,o:()=>useChatbotContext});var _app_chatbot_helpers__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(728),_app_chatbot_MwaiAPI__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(137),_app_helpers__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(678);const{useContext,createContext,useState,useMemo,useEffect,useCallback,useRef}=wp.element,rawAiName="AI: ",rawUserName="User: ",ChatbotContext=createContext(),useChatbotContext=()=>{const e=useContext(ChatbotContext);if(!e)throw new Error("useChatbotContext must be used within a ChatbotContextProvider");return e},ChatbotContextProvider=({children,...rest})=>{var _params$startSentence;const{params,system,theme,atts}=rest,{timeElapsed,startChrono,stopChrono}=(0,_app_chatbot_helpers__WEBPACK_IMPORTED_MODULE_0__.dh)(),shortcodeStyles=useMemo((()=>(null==theme?void 0:theme.settings)||{}),[theme]),[restNonce,setRestNonce]=useState(system.restNonce),[messages,setMessages]=useState([]),[shortcuts,setShortcuts]=useState([]),[blocks,setBlocks]=useState([]),[locked,setLocked]=useState(!1),[chatId,setChatId]=useState((0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.vx)()),[inputText,setInputText]=useState(""),[chatbotTriggered,setChatbotTriggered]=useState(!1),[showIconMessage,setShowIconMessage]=useState(!1),[uploadedFile,setUploadedFile]=useState({localFile:null,uploadedId:null,uploadedUrl:null,uploadProgress:null}),[windowed,setWindowed]=useState(!0),[open,setOpen]=useState(!1),[error,setError]=useState(null),[busy,setBusy]=useState(!1),[busyNonce,setBusyNonce]=useState(!1),[serverReply,setServerReply]=useState(),chatbotInputRef=useRef(),conversationRef=useRef(),hasFocusRef=useRef(!1),{isListening,setIsListening,speechRecognitionAvailable}=(0,_app_chatbot_helpers__WEBPACK_IMPORTED_MODULE_0__.Vw)((e=>{setInputText(e)})),stream=system.stream||!1,internalId=useMemo((()=>(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.vx)()),[]),botId=system.botId,customId=system.customId,userData=system.userData,sessionId=system.sessionId,contextId=system.contextId,pluginUrl=system.pluginUrl,restUrl=system.restUrl,debugMode=system.debugMode,virtualKeyboardFix=system.virtual_keyboard_fix,typewriter=(null==system?void 0:system.typewriter)??!1,speechRecognition=(null==system?void 0:system.speech_recognition)??!1,speechSynthesis=(null==system?void 0:system.speech_synthesis)??!1,startSentence=(0,_app_chatbot_helpers__WEBPACK_IMPORTED_MODULE_0__.Mc)((null===(_params$startSentence=params.startSentence)||void 0===_params$startSentence?void 0:_params$startSentence.trim())??"",userData),initialActions=system.actions||[],initialShortcuts=system.shortcuts||[],initialBlocks=system.blocks||[],isMobile=document.innerWidth<=768,processedParams=(0,_app_chatbot_helpers__WEBPACK_IMPORTED_MODULE_0__._$)(params,userData),{aiName,userName,guestName,aiAvatar,userAvatar,guestAvatar}=processedParams,{textSend,textClear,textInputMaxLength,textInputPlaceholder,textCompliance,window:isWindow,copyButton,headerSubtitle,fullscreen,localMemory:localMemoryParam,icon,iconText,iconTextDelay,iconAlt,iconPosition,iconBubble,imageUpload,fileUpload,fileSearch}=processedParams,isRealtime="realtime"===processedParams.mode,localMemory=localMemoryParam&&(!!customId||!!botId),localStorageKey=localMemory?`mwai-chat-${customId||botId}`:null,{cssVariables,iconUrl,aiAvatarUrl,userAvatarUrl,guestAvatarUrl}=useMemo((()=>{const e=e=>e?(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.Ve)(e)||(0,_app_chatbot_helpers__WEBPACK_IMPORTED_MODULE_0__.mv)(e)?e:`${pluginUrl}/images/${e}`:null,t=icon?e(icon):`${pluginUrl}/images/chat-traditional-1.svg`,a=e(processedParams.aiAvatarUrl),n=e(processedParams.userAvatarUrl),s=e(processedParams.guestAvatarUrl);return{cssVariables:Object.keys(shortcodeStyles).reduce(((e,t)=>(e[`--mwai-${t}`]=shortcodeStyles[t],e)),{}),iconUrl:t,aiAvatarUrl:a,userAvatarUrl:n,guestAvatarUrl:s}}),[icon,pluginUrl,shortcodeStyles,processedParams]),[draggingType,setDraggingType]=useState(!1),[isBlocked,setIsBlocked]=useState(!1),uploadIconPosition=useMemo((()=>"timeless"===(null==theme?void 0:theme.themeId)?"mwai-tools":"mwai-input"),[null==theme?void 0:theme.themeId]),submitButtonConf=useMemo((()=>({text:textSend,textSend,textClear,imageSend:"timeless"===(null==theme?void 0:theme.themeId)?pluginUrl+"/images/action-submit-blue.svg":null,imageClear:"timeless"===(null==theme?void 0:theme.themeId)?pluginUrl+"/images/action-clear-blue.svg":null})),[pluginUrl,textClear,textSend,null==theme?void 0:theme.themeId]),resetMessages=()=>{if(resetUploadedFile(),startSentence){const e=[{id:(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.vx)(),role:"assistant",content:startSentence,who:rawAiName,timestamp:(new Date).getTime()}];setMessages(e)}else setMessages([])},refreshRestNonce=useCallback((async(e=!1)=>{try{if(!e&&restNonce)return restNonce;setBusyNonce(!0);const t=await(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.ti)(`${restUrl}/mwai/v1/start_session`),a=await t.json();return setRestNonce(a.restNonce),a.restNonce}catch(e){console.error("Error while fetching the restNonce.",e)}finally{setBusyNonce(!1)}}),[restNonce,setRestNonce,restUrl]);useEffect((()=>{initialActions.length>0&&handleActions(initialActions),initialShortcuts.length>0&&handleShortcuts(initialShortcuts),initialBlocks.length>0&&handleBlocks(initialBlocks)}),[]),useEffect((()=>{chatbotTriggered&&!restNonce&&refreshRestNonce()}),[chatbotTriggered]),useEffect((()=>{inputText.length>0&&!chatbotTriggered&&setChatbotTriggered(!0)}),[chatbotTriggered,inputText]),useEffect((()=>{resetMessages()}),[startSentence]),useEffect((()=>{if(customId||botId){const e=_app_chatbot_MwaiAPI__WEBPACK_IMPORTED_MODULE_2__.HX.chatbots.findIndex((e=>e.internalId===internalId)),t={internalId,botId,chatId,customId,open:()=>{setTasks((e=>[...e,{action:"open"}]))},close:()=>{setTasks((e=>[...e,{action:"close"}]))},clear:e=>{const{chatId:t=null}=e||{};setTasks((e=>[...e,{action:"clear",data:{chatId:t}}]))},toggle:()=>{setTasks((e=>[...e,{action:"toggle"}]))},ask:(e,t=!1)=>{setTasks((a=>[...a,{action:"ask",data:{text:e,submit:t}}]))},lock:()=>{setLocked(!0)},unlock:()=>{setLocked(!1)},setShortcuts:e=>{setTasks((t=>[...t,{action:"setShortcuts",data:e}]))},setBlocks:e=>{setTasks((t=>[...t,{action:"setBlocks",data:e}]))},addBlock:e=>{setTasks((t=>[...t,{action:"addBlock",data:e}]))},removeBlockById:e=>{setTasks((t=>[...t,{action:"removeBlockById",data:e}]))},getBlocks:()=>blocks,setContext:({chatId:e,messages:t})=>{setTasks((a=>[...a,{action:"setContext",data:{chatId:e,messages:t}}]))}};-1!==e?_app_chatbot_MwaiAPI__WEBPACK_IMPORTED_MODULE_2__.HX.chatbots[e]=t:_app_chatbot_MwaiAPI__WEBPACK_IMPORTED_MODULE_2__.HX.chatbots.push(t)}}),[botId,chatId,customId,internalId]),useEffect((()=>{busy?startChrono():(!isMobile&&hasFocusRef.current&&chatbotInputRef.current.focusInput(),stopChrono())}),[busy,startChrono,stopChrono,isMobile]);const saveMessages=useCallback((e=>{localStorageKey&&localStorage.setItem(localStorageKey,(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.F1)({chatId,messages:e}))}),[localStorageKey,chatId]),resetError=()=>{setError(null)};useEffect((()=>{let e=[];if(localStorageKey&&(e=localStorage.getItem(localStorageKey),e))return e=JSON.parse(e),setMessages(e.messages),void setChatId(e.chatId);resetMessages()}),[botId]);const handleActions=useCallback(((actions,lastMessage)=>{actions=actions||[];let callsCount=0;for(const action of actions)if("function"===action.type){const data=action.data||{},{name=null,args=[]}=data,finalArgs=args?Object.values(args).map((e=>JSON.stringify(e))):[];try{debugMode&&console.log(`[CHATBOT] CALL ${name}(${finalArgs.join(", ")})`),eval(`${name}(${finalArgs.join(", ")})`),callsCount++}catch(e){console.error("Error while executing an action.",e)}}!lastMessage.content&&callsCount>0&&(lastMessage.content="*Done!*")}),[debugMode]),handleShortcuts=useCallback((e=>{setShortcuts(e||[])}),[]),handleBlocks=useCallback((e=>{setBlocks(e||[])}),[]);useEffect((()=>{if(!serverReply)return;setBusy(!1);const e=[...messages],t=e.length>0?e[e.length-1]:null;if(!serverReply.success)return"assistant"===t.role&&t.isQuerying&&e.pop(),e.pop(),e.push({id:(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.vx)(),role:"system",content:serverReply.message,who:rawAiName,timestamp:(new Date).getTime()}),setMessages(e),void saveMessages(e);if("assistant"===t.role&&t.isQuerying)t.content=(0,_app_chatbot_MwaiAPI__WEBPACK_IMPORTED_MODULE_2__.W5)("ai.reply",serverReply.reply,{chatId,botId}),serverReply.images&&(t.images=serverReply.images),t.timestamp=(new Date).getTime(),delete t.isQuerying,handleActions(null==serverReply?void 0:serverReply.actions,t),handleBlocks(null==serverReply?void 0:serverReply.blocks),handleShortcuts(null==serverReply?void 0:serverReply.shortcuts);else if("assistant"===t.role&&t.isStreaming)t.content=(0,_app_chatbot_MwaiAPI__WEBPACK_IMPORTED_MODULE_2__.W5)("ai.reply",serverReply.reply,{chatId,botId}),serverReply.images&&(t.images=serverReply.images),t.timestamp=(new Date).getTime(),delete t.isStreaming,handleActions(null==serverReply?void 0:serverReply.actions,t),handleBlocks(null==serverReply?void 0:serverReply.blocks),handleShortcuts(null==serverReply?void 0:serverReply.shortcuts);else{const t={id:(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.vx)(),role:"assistant",content:(0,_app_chatbot_MwaiAPI__WEBPACK_IMPORTED_MODULE_2__.W5)("ai.reply",serverReply.reply,{botId,chatId,customId}),who:rawAiName,timestamp:(new Date).getTime()};serverReply.images&&(t.images=serverReply.images),handleActions(null==serverReply?void 0:serverReply.actions,t),handleBlocks(null==serverReply?void 0:serverReply.blocks),handleShortcuts(null==serverReply?void 0:serverReply.shortcuts),e.push(t)}setMessages(e),saveMessages(e)}),[serverReply]);const onClear=useCallback((async({chatId:e=null}={})=>{e||(e=(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.vx)()),await setChatId(e),localStorageKey&&localStorage.removeItem(localStorageKey),resetMessages(),setInputText(""),setShortcuts([]),setBlocks([])}),[botId]),onStartRealtimeSession=useCallback((async()=>{const e={botId,customId,contextId,chatId},t=restNonce??await refreshRestNonce(),a=await(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.ti)(`${restUrl}/mwai-ui/v1/openai/realtime/start`,e,t);return await(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.Pn)(a)}),[botId,customId,contextId,chatId,restNonce,refreshRestNonce,restUrl]),onCommitStats=useCallback((async(e,t=null)=>{try{const a=restNonce??await refreshRestNonce(),n=await(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.ti)(`${restUrl}/mwai-ui/v1/openai/realtime/stats`,{botId,session:sessionId,refId:t||chatId,stats:e},a),s=await(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.Pn)(n);return{success:s.success,message:s.message}}catch(e){return console.error("Error while committing stats.",e),{success:!1,message:"An error occurred while committing the stats."}}}),[botId,restNonce,refreshRestNonce,restUrl,sessionId,chatId]),onCommitDiscussions=useCallback((async(e=[])=>{try{const t=restNonce??await refreshRestNonce(),a={botId,session:sessionId,chatId,messages:e??[]},n=await(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.ti)(`${restUrl}/mwai-ui/v1/openai/realtime/discussions`,a,t),s=await(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.Pn)(n);return{success:s.success,message:s.message}}catch(e){return console.error("Error while committing discussion.",e),{success:!1,message:"An error occurred while committing the discussion."}}}),[botId,chatId,restNonce,refreshRestNonce,restUrl,sessionId]),onRealtimeFunctionCallback=useCallback((async(functionId,functionType,functionName,functionTarget,args)=>{const body={functionId,functionType,functionName,functionTarget,arguments:args};if("js"!==functionTarget){const e=restNonce??await refreshRestNonce(),t=await(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.ti)(`${restUrl}/mwai-ui/v1/openai/realtime/call`,body,e),a=await(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.Pn)(t);return a}{const finalArgs=args?Object.values(args).map((e=>JSON.stringify(e))):[];try{return debugMode&&console.log(`[CHATBOT] CALL ${functionName}(${finalArgs.join(", ")})`),eval(`${functionName}(${finalArgs.join(", ")})`),{success:!0,message:"The function was executed",data:null}}catch(e){return console.error("Error while executing an action.",e),{success:!1,message:"An error occurred while executing the function.",data:null}}}return null}),[restNonce,refreshRestNonce,restUrl,debugMode]),onSubmit=useCallback((async e=>{var t;if(busy)return void console.error("AI Engine: There is already a query in progress.");"string"!=typeof e&&(e=inputText);const a=uploadedFile,n=null==uploadedFile?void 0:uploadedFile.uploadedUrl,s=null==uploadedFile||null===(t=uploadedFile.localFile)||void 0===t?void 0:t.type,r=!!s&&s.startsWith("image");let o=e;n&&(o=r?`![Uploaded Image](${n})\n${e}`:`[Uploaded File](${n})\n${e}`),setBusy(!0),setInputText(""),setShortcuts([]),setBlocks([]),resetUploadedFile();const i=[...messages,{id:(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.vx)(),role:"user",content:o,who:rawUserName,timestamp:(new Date).getTime()}];saveMessages(i);const l=(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.vx)(),c=[...i,{id:l,role:"assistant",content:null,who:rawAiName,timestamp:null,isQuerying:!stream,isStreaming:!!stream}];setMessages(c);const u={botId,customId,session:sessionId,chatId,contextId,messages,newMessage:e,newFileId:null==a?void 0:a.uploadedId,stream,...atts};try{debugMode&&console.log("[CHATBOT] OUT: ",u);const e=stream?e=>{setMessages((t=>{const a=[...t],n=a.length>0?a[a.length-1]:null;return n&&n.id===l&&(n.content=e,n.timestamp=(new Date).getTime()),a}))}:null,t=restNonce??await refreshRestNonce(),a=await(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.ti)(`${restUrl}/mwai-ui/v1/chats/submit`,u,t,stream),n=await(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.Pn)(a,e,debugMode?"CHATBOT":null);if(!n.success&&n.message){setError(n.message);const e=[...c];return e.pop(),e.pop(),setMessages(e),saveMessages(e),void setBusy(!1)}setServerReply(n)}catch(e){console.error("An error happened in the handling of the chatbot response.",{err:e}),setBusy(!1)}}),[busy,uploadedFile,messages,saveMessages,stream,botId,customId,sessionId,chatId,contextId,atts,inputText,debugMode,restNonce,refreshRestNonce,restUrl]),onSubmitAction=useCallback(((e=null)=>{const t=!(null==uploadedFile||!uploadedFile.uploadedId);hasFocusRef.current=document.activeElement===chatbotInputRef.current.currentElement(),e?onSubmit(e):(t||inputText.length>0)&&onSubmit(inputText)}),[inputText,onSubmit,null==uploadedFile?void 0:uploadedFile.uploadedId]),onFileUpload=async(e,t="N/A",a="N/A")=>{try{if(null===e)return void resetUploadedFile();const n={type:t,purpose:a},s=`${restUrl}/mwai-ui/v1/files/upload`,r=restNonce??await refreshRestNonce(),o=await(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.uE)(s,e,r,(t=>{setUploadedFile({localFile:e,uploadedId:null,uploadedUrl:null,uploadProgress:t})}),n);setUploadedFile({localFile:e,uploadedId:o.data.id,uploadedUrl:o.data.url,uploadProgress:null})}catch(e){console.error("onFileUpload Error",e),setError(e.message||"An unknown error occurred"),resetUploadedFile()}},onUploadFile=async e=>(error&&resetError(),onFileUpload(e)),resetUploadedFile=()=>{setUploadedFile({localFile:null,uploadedId:null,uploadedUrl:null,uploadProgress:null})},runTimer=useCallback((()=>{const e=setTimeout((()=>{setOpen((e=>(e||setShowIconMessage(!0),e)))}),1e3*iconTextDelay);return()=>clearTimeout(e)}),[iconText,iconTextDelay]);useEffect((()=>{if(iconText&&!iconTextDelay)setShowIconMessage(!0);else if(iconText&&iconTextDelay)return runTimer()}),[iconText]);const[tasks,setTasks]=useState([]),runTasks=useCallback((async()=>{if(tasks.length>0){const e=tasks[0];if("ask"===e.action){const{text:t,submit:a}=e.data;a?onSubmit(t):setInputText(t)}else if("toggle"===e.action)setOpen((e=>!e));else if("open"===e.action)setOpen(!0);else if("close"===e.action)setOpen(!1);else if("clear"===e.action){const{chatId:t}=e.data;onClear({chatId:t})}else if("setContext"===e.action){const{chatId:t,messages:a}=e.data;setChatId(t),setMessages(a)}else if("setShortcuts"===e.action){const t=e.data;handleShortcuts(t)}else if("setBlocks"===e.action){const t=e.data;handleBlocks(t)}else if("addBlock"===e.action){const t=e.data;setBlocks((e=>[...e,t]))}else if("removeBlockById"===e.action){const t=e.data;setBlocks((e=>e.filter((e=>e.id!==t))))}setTasks((e=>e.slice(1)))}}),[tasks,onClear,onSubmit,setChatId,setInputText,setMessages,setOpen,handleShortcuts,handleBlocks]);useEffect((()=>{runTasks()}),[runTasks]);const actions={setInputText,saveMessages,setMessages,resetMessages,resetError,onClear,onSubmit,onSubmitAction,onFileUpload,onUploadFile,setOpen,setWindowed,setShowIconMessage,setIsListening,setDraggingType,setIsBlocked,onStartRealtimeSession,onRealtimeFunctionCallback,onCommitStats,onCommitDiscussions},state={theme,botId,customId,userData,pluginUrl,inputText,messages,shortcuts,blocks,busy,error,setBusy,typewriter,speechRecognition,speechSynthesis,virtualKeyboardFix,localMemory,isRealtime,imageUpload,fileUpload,uploadedFile,fileSearch,textSend,textClear,textInputMaxLength,textInputPlaceholder,textCompliance,aiName,userName,guestName,aiAvatar,userAvatar,guestAvatar,aiAvatarUrl,userAvatarUrl,guestAvatarUrl,isWindow,copyButton,headerSubtitle,fullscreen,icon,iconText,iconAlt,iconPosition,iconBubble,cssVariables,iconUrl,chatbotInputRef,conversationRef,isMobile,open,locked,windowed,showIconMessage,timeElapsed,isListening,speechRecognitionAvailable,uploadIconPosition,submitButtonConf,draggingType,isBlocked,busyNonce};return React.createElement(ChatbotContext.Provider,{value:{state,actions}},children)}},137:(e,t,a)=>{a.d(t,{HX:()=>s,W5:()=>r});class n{constructor(){if("undefined"!=typeof window&&window.MwaiAPI)return window.MwaiAPI;this.chatbots=[],this.forms=[],this.filters={},this.actions={},"undefined"!=typeof window&&(window.MwaiAPI=this)}getChatbot(e=null){return e?this.chatbots.find((t=>t.botId===e||t.customId===e)):this.chatbots[0]}getForm(e=null){return e?this.forms.find((t=>t.formId===e)):this.forms[0]}addFilter(e,t,a=10){this.filters[e]||(this.filters[e]=[]),this.filters[e].push({callback:t,priority:a}),this.filters[e].sort(((e,t)=>e.priority-t.priority))}applyFilters(e,t,...a){return this.filters[e]?this.filters[e].reduce(((e,t)=>t.callback(e,...a)),t):t}addAction(e,t,a=10){this.actions[e]||(this.actions[e]=[]),this.actions[e].push({callback:t,priority:a}),this.actions[e].sort(((e,t)=>e.priority-t.priority))}doAction(e,...t){this.actions[e]&&this.actions[e].forEach((e=>{e.callback(...t)}))}}const s=(()=>{if("undefined"!=typeof window&&window.MwaiAPI)return window.MwaiAPI;const e=new n;return"undefined"!=typeof window&&(window.MwaiAPI=e),e})(),r=(e,t,...a)=>s.applyFilters(e,t,...a)},728:(e,t,a)=>{a.d(t,{tm:()=>u,bE:()=>f,Mc:()=>h,mv:()=>m,_$:()=>g,dh:()=>p,gR:()=>d,Vw:()=>_,kW:()=>b});const n=(0,a(407).A)("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},s.apply(this,arguments)}const{useState:r,useMemo:o,useEffect:i,useRef:l,useCallback:c}=wp.element,u=({active:e,disabled:t,...a})=>React.createElement("div",s({active:e?"true":"false",disabled:t},a),React.createElement(n,{size:"24"})),d=()=>o((()=>(e,t)=>(Array.isArray(e)||(e=[e]),t&&Object.entries(t).forEach((([t,a])=>{a&&e.push(t)})),e.join(" "))),[]);function m(e){return!(!e||"string"!=typeof e)&&0===e.indexOf("http")}function p(){const[e,t]=r(null),a=l(null);return i((()=>()=>{clearInterval(a.current)}),[]),{timeElapsed:e,startChrono:function(){if(null!==a.current)return;const e=Date.now();a.current=setInterval((()=>{const a=Math.floor((Date.now()-e)/1e3);var n;t((n=a,`${Math.floor(n/60)}:${(n%60).toString().padStart(2,"0")}`))}),500)},stopChrono:function(){clearInterval(a.current),a.current=null,t(null)}}}const h=(e,t)=>"string"==typeof e&&t?(Object.entries(t).forEach((([t,a])=>{e=e.replace(new RegExp(`{${t}}`,"g"),a)})),e):e,g=(e,t=[])=>{var a,n,s,r,o,i,l,c,u,d,m,p,g,_,f;const b=(null===(a=e.guestName)||void 0===a?void 0:a.trim())??"",y=(null===(n=e.textSend)||void 0===n?void 0:n.trim())??"",v=(null===(s=e.textClear)||void 0===s?void 0:s.trim())??"",w=parseInt(e.textInputMaxLength),R=(null===(r=e.textInputPlaceholder)||void 0===r?void 0:r.trim())??"";let E=(null===(o=e.textCompliance)||void 0===o?void 0:o.trim())??"",C="";const x=Boolean(e.window),k=Boolean(e.copyButton),I=Boolean(e.fullscreen),S=(null===(i=e.icon)||void 0===i?void 0:i.trim())??"";let M=(null===(l=e.iconText)||void 0===l?void 0:l.trim())??"";const A=parseInt(e.iconTextDelay||1),T=(null===(c=e.iconAlt)||void 0===c?void 0:c.trim())??"",U=(null===(u=e.iconPosition)||void 0===u?void 0:u.trim())??"",N=Boolean(e.iconBubble),D=(null===(d=e.aiName)||void 0===d?void 0:d.trim())??"",L=(null===(m=e.userName)||void 0===m?void 0:m.trim())??"",P=Boolean(null==e?void 0:e.aiAvatar),O=Boolean(null==e?void 0:e.userAvatar),B=Boolean(null==e?void 0:e.guestAvatar),F=P?(null==e||null===(p=e.aiAvatarUrl)||void 0===p?void 0:p.trim())??"":null,$=O?(null==e||null===(g=e.userAvatarUrl)||void 0===g?void 0:g.trim())??"":null,z=B?(null==e||null===(_=e.guestAvatarUrl)||void 0===_?void 0:_.trim())??"":null,j=Boolean(e.localMemory),W=Boolean(e.imageUpload),H=Boolean(e.fileUpload),V=Boolean(e.fileSearch),K=(null===(f=e.mode)||void 0===f?void 0:f.trim())??"chat";var q;return C=null===e.headerSubtitle||void 0===e.headerSubtitle?"Discuss with":(null===(q=e.headerSubtitle)||void 0===q?void 0:q.trim())??"",t&&(E=h(E,t),M=h(M,t)),{textSend:y,textClear:v,textInputMaxLength:w,textInputPlaceholder:R,textCompliance:E,mode:K,window:x,copyButton:k,fullscreen:I,localMemory:j,imageUpload:W,fileUpload:H,fileSearch:V,icon:S,iconText:M,iconTextDelay:A,iconAlt:T,iconPosition:U,iconBubble:N,headerSubtitle:C,aiName:D,userName:L,guestName:b,aiAvatar:P,userAvatar:O,guestAvatar:B,aiAvatarUrl:F,userAvatarUrl:$,guestAvatarUrl:z}},_=e=>{const[t,a]=r(!1),[n,s]=r(!1);return i((()=>{"undefined"!=typeof window&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window)&&s(!0)}),[]),i((()=>{if(!n)return;const s=new(window.SpeechRecognition||window.webkitSpeechRecognition);let r=null;return navigator.userAgent.toLowerCase().indexOf("android")>-1?(s.interimResults=!1,s.continuous=!1,r=t=>{const n=Array.from(t.results).filter((e=>e.isFinal)).map((e=>e[0].transcript)).join("");e(n),a(!1)}):(s.interimResults=!0,s.continuous=!0,r=t=>{const a=Array.from(t.results).map((e=>e[0])).map((e=>e.transcript)).join("");e(a)}),t?(s.addEventListener("result",r),s.start()):(s.removeEventListener("result",r),s.abort()),()=>{s.abort()}}),[t,n]),{isListening:t,setIsListening:a,speechRecognitionAvailable:n}},f=({if:e,className:t,disableTransition:a=!1,children:n,...o})=>{const[l,c]=r(!1),[u,d]=r("mwai-transition");return i((()=>{a?c(e):e?(c(!0),setTimeout((()=>{d("mwai-transition mwai-transition-visible")}),150)):d("mwai-transition")}),[e,a]),l?React.createElement("div",s({className:`${t} ${a?"":u}`,onTransitionEnd:()=>{"mwai-transition"!==u||a||c(!1)}},o),n):null},b=()=>{const[e,t]=r(window.visualViewport.height),a=o((()=>/Android/.test(navigator.userAgent)),[]),n=o((()=>/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream),[]),s=l(window.visualViewport),u=c((()=>{t(s.current.height)}),[]);return i((()=>{const e=s.current;return e.addEventListener("resize",u),n?(window.addEventListener("resize",u),document.addEventListener("focusin",u)):e.addEventListener("scroll",u),()=>{e.removeEventListener("resize",u),n?(window.removeEventListener("resize",u),document.removeEventListener("focusin",u)):e.removeEventListener("scroll",u)}}),[u,n]),{viewportHeight:e,isIOS:n,isAndroid:a}}},678:(e,t,a)=>{a.d(t,{F1:()=>o,Pn:()=>i,Ve:()=>p,rn:()=>d,ti:()=>l,uE:()=>c,vx:()=>u});const{useMemo:n,useEffect:s,useState:r}=wp.element;function o(e,t=null,a=!0){const n=[];return JSON.stringify(e,((e,t)=>{if("object"==typeof t&&null!==t){if(n.includes(t)){if(!a)throw console.warn("Circular reference found.",{key:e,value:t,cache:n,cacheIndex:n.indexOf(t)}),new Error("Circular reference found. Cancelled.");return}n.push(t)}return t}),t)}async function i(e,t,a=null){if(!t)try{const t=await e.json();return a&&console.log(`[${a}] IN: `,t),t}catch(e){return console.error("Could not parse the regular response.",{err:e,data}),{success:!1,message:"Could not parse the regular response."}}const n=e.body.getReader(),s=new TextDecoder("utf-8");let r="",o="";for(;;){const{value:e,done:i}=await n.read();if(r+=s.decode(e,{stream:!0}),i)break;const l=r.split("\n");for(let e=0;e<l.length-1;e++){if(0!==l[e].indexOf("data: "))continue;const n=JSON.parse(l[e].replace("data: ",""));if("live"===n.type)a&&console.log(`[${a} STREAM] LIVE: `,n),o+=n.data,t&&t(o,n.data);else if("error"===n.type)try{return a&&console.error(`[${a} STREAM] ERROR: `,n.data),{success:!1,message:n.data}}catch(e){return console.error("Could not parse the 'error' stream.",{err:e,data:n}),{success:!1,message:"Could not parse the 'error' stream."}}else if("end"===n.type)try{const e=JSON.parse(n.data);return a&&console.log(`[${a} STREAM] END: `,e),e}catch(e){return console.error("Could not parse the 'end' stream.",{err:e,data:n}),{success:!1,message:"Could not parse the 'end' stream."}}}r=l[l.length-1]}try{const e=JSON.parse(r);return a&&console.log(`[${a} STREAM] IN: `,e),e}catch(e){return console.error("Could not parse the buffer.",{err:e,buffer:r}),{success:!1,message:"Could not parse the buffer."}}}async function l(e,t,a,n){const s={"Content-Type":"application/json"};return a&&(s["X-WP-Nonce"]=a),n&&(s.Accept="text/event-stream"),await fetch(`${e}`,{method:"POST",headers:s,body:o(t)})}async function c(e,t,a,n,s={}){return new Promise(((r,o)=>{const i=new FormData;i.append("file",t);for(const[e,t]of Object.entries(s))i.append(e,t);const l=new XMLHttpRequest;l.open("POST",e,!0),a&&l.setRequestHeader("X-WP-Nonce",a),l.upload.onprogress=function(e){if(e.lengthComputable&&n){const t=e.loaded/e.total*100;n(t)}},l.onload=function(){if(l.status>=200&&l.status<300)try{const e=JSON.parse(l.responseText);r(e)}catch(e){o({status:l.status,statusText:l.statusText,error:"The server response is not valid JSON"})}else{try{const e=JSON.parse(l.responseText);return void o({status:l.status,message:e.message})}catch(e){}o({status:l.status,statusText:l.statusText})}},l.onerror=function(){o({status:l.status,statusText:l.statusText})},l.send(i)}))}function u(){return Math.random().toString(36).substring(2)}const d=()=>{const[e,t]=r(!0);s((()=>{const e=setTimeout((()=>{const e=setInterval((()=>{t((e=>!e))}),500);return()=>clearInterval(e)}),200);return()=>clearTimeout(e)}),[]);const a={opacity:e?1:0,width:"1px",height:"1em",borderLeft:"8px solid",marginLeft:"2px"};return React.createElement("span",{style:a})},m=/([\u2700-\u27BF]|[\uE000-\uF8FF]|[\uD800-\uDFFF]|[\uFE00-\uFE0F]|[\u1F100-\u1F1FF]|[\u1F200-\u1F2FF]|[\u1F300-\u1F5FF]|[\u1F600-\u1F64F]|[\u1F680-\u1F6FF]|[\u1F700-\u1F77F]|[\u1F780-\u1F7FF]|[\u1F800-\u1F8FF]|[\u1F900-\u1F9FF]|[\u1FA00-\u1FA6F])/;function p(e){return e&&2===e.length&&m.test(e)}},407:(e,t,a)=>{a.d(t,{A:()=>i});var n=a(594);const s=(...e)=>e.filter(((e,t,a)=>Boolean(e)&&""!==e.trim()&&a.indexOf(e)===t)).join(" ").trim();var r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const o=(0,n.forwardRef)((({color:e="currentColor",size:t=24,strokeWidth:a=2,absoluteStrokeWidth:o,className:i="",children:l,iconNode:c,...u},d)=>(0,n.createElement)("svg",{ref:d,...r,width:t,height:t,stroke:e,strokeWidth:o?24*Number(a)/Number(t):a,className:s("lucide",i),...u},[...c.map((([e,t])=>(0,n.createElement)(e,t))),...Array.isArray(l)?l:[l]]))),i=(e,t)=>{const a=(0,n.forwardRef)((({className:a,...r},i)=>{return(0,n.createElement)(o,{ref:i,iconNode:t,className:s(`lucide-${l=e,l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,a),...r});var l}));return a.displayName=`${e}`,a}},594:e=>{e.exports=React}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var a=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](a,a.exports,__webpack_require__),a.exports}__webpack_require__.d=(e,t)=>{for(var a in t)__webpack_require__.o(t,a)&&!__webpack_require__.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={},ChatbotContext=__webpack_require__(469),external_React_=__webpack_require__(594);function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},t.apply(this,arguments)}const n=["children","options"],r={blockQuote:"0",breakLine:"1",breakThematic:"2",codeBlock:"3",codeFenced:"4",codeInline:"5",footnote:"6",footnoteReference:"7",gfmTask:"8",heading:"9",headingSetext:"10",htmlBlock:"11",htmlComment:"12",htmlSelfClosing:"13",image:"14",link:"15",linkAngleBraceStyleDetector:"16",linkBareUrlDetector:"17",linkMailtoDetector:"18",newlineCoalescer:"19",orderedList:"20",paragraph:"21",ref:"22",refImage:"23",refLink:"24",table:"25",tableSeparator:"26",text:"27",textBolded:"28",textEmphasized:"29",textEscaped:"30",textMarked:"31",textStrikethroughed:"32",unorderedList:"33"};var i,e;e=i||(i={}),e[e.MAX=0]="MAX",e[e.HIGH=1]="HIGH",e[e.MED=2]="MED",e[e.LOW=3]="LOW",e[e.MIN=4]="MIN";const l=["allowFullScreen","allowTransparency","autoComplete","autoFocus","autoPlay","cellPadding","cellSpacing","charSet","className","classId","colSpan","contentEditable","contextMenu","crossOrigin","encType","formAction","formEncType","formMethod","formNoValidate","formTarget","frameBorder","hrefLang","inputMode","keyParams","keyType","marginHeight","marginWidth","maxLength","mediaGroup","minLength","noValidate","radioGroup","readOnly","rowSpan","spellCheck","srcDoc","srcLang","srcSet","tabIndex","useMap"].reduce(((e,t)=>(e[t.toLowerCase()]=t,e)),{for:"htmlFor"}),a={amp:"&",apos:"'",gt:">",lt:"<",nbsp:" ",quot:"“"},o=["style","script"],c=/([-A-Z0-9_:]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|(?:\{((?:\\.|{[^}]*?}|[^}])*)\})))?/gi,s=/mailto:/i,d=/\n{2,}$/,u=/^(\s*>[\s\S]*?)(?=\n{2,})/,p=/^ *> ?/gm,f=/^ {2,}\n/,h=/^(?:( *[-*_])){3,} *(?:\n *)+\n/,m=/^\s*(`{3,}|~{3,}) *(\S+)?([^\n]*?)?\n([\s\S]+?)\s*\1 *(?:\n *)*\n?/,g=/^(?: {4}[^\n]+\n*)+(?:\n *)+\n?/,y=/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,k=/^(?:\n *)*\n/,x=/\r\n?/g,b=/^\[\^([^\]]+)](:(.*)((\n+ {4,}.*)|(\n(?!\[\^).+))*)/,v=/^\[\^([^\]]+)]/,S=/\f/g,E=/^---[ \t]*\n(.|\n)*\n---[ \t]*\n/,$=/^\s*?\[(x|\s)\]/,w=/^ *(#{1,6}) *([^\n]+?)(?: +#*)?(?:\n *)*(?:\n|$)/,C=/^ *(#{1,6}) +([^\n]+?)(?: +#*)?(?:\n *)*(?:\n|$)/,z=/^([^\n]+)\n *(=|-){3,} *(?:\n *)+\n/,L=/^ *(?!<[a-z][^ >/]* ?\/>)<([a-z][^ >/]*) ?((?:[^>]*[^/])?)>\n?(\s*(?:<\1[^>]*?>[\s\S]*?<\/\1>|(?!<\1\b)[\s\S])*?)<\/\1>(?!<\/\1>)\n*/i,A=/&([a-z0-9]+|#[0-9]{1,6}|#x[0-9a-fA-F]{1,6});/gi,T=/^<!--[\s\S]*?(?:-->)/,O=/^(data|aria|x)-[a-z_][a-z\d_.-]*$/,B=/^ *<([a-z][a-z0-9:]*)(?:\s+((?:<.*?>|[^>])*))?\/?>(?!<\/\1>)(\s*\n)?/i,M=/^\{.*\}$/,R=/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,I=/^<([^ >]+@[^ >]+)>/,U=/^<([^ >]+:\/[^ >]+)>/,D=/-([a-z])?/gi,j=/^(.*\|.*)\n(?: *(\|? *[-:]+ *\|[-| :]*)\n((?:.*\|.*\n)*))?\n?/,N=/^\[([^\]]*)\]:\s+<?([^\s>]+)>?\s*("([^"]*)")?/,H=/^!\[([^\]]*)\] ?\[([^\]]*)\]/,F=/^\[([^\]]*)\] ?\[([^\]]*)\]/,P=/(\[|\])/g,_=/(\n|^[-*]\s|^#|^ {2,}|^-{2,}|^>\s)/,W=/\t/g,G=/(^ *\||\| *$)/g,Z=/^ *:-+: *$/,q=/^ *:-+ *$/,Q=/^ *-+: *$/,V="((?:\\[.*?\\][([].*?[)\\]]|<.*?>(?:.*?<.*?>)?|`.*?`|~~.*?~~|==.*?==|.|\\n)*?)",X=new RegExp(`^([*_])\\1${V}\\1\\1(?!\\1)`),J=new RegExp(`^([*_])${V}\\1(?!\\1|\\w)`),K=new RegExp(`^==${V}==`),Y=new RegExp(`^~~${V}~~`),ee=/^\\([^0-9A-Za-z\s])/,te=/^[\s\S]+?(?=[^0-9A-Z\s\u00c0-\uffff&#;.()'"]|\d+\.|\n\n| {2,}\n|\w+:\S|$)/i,ne=/^\n+/,re=/^([ \t]*)/,ie=/\\([^\\])/g,le=/ *\n+$/,ae=/(?:^|\n)( *)$/,oe="(?:\\d+\\.)",ce="(?:[*+-])";function se(e){return"( *)("+(1===e?oe:ce)+") +"}const de=se(1),ue=se(2);function pe(e){return new RegExp("^"+(1===e?de:ue))}const fe=pe(1),he=pe(2);function me(e){return new RegExp("^"+(1===e?de:ue)+"[^\\n]*(?:\\n(?!\\1"+(1===e?oe:ce)+" )[^\\n]*)*(\\n|$)","gm")}const ge=me(1),ye=me(2);function ke(e){const t=1===e?oe:ce;return new RegExp("^( *)("+t+") [\\s\\S]+?(?:\\n{2,}(?! )(?!\\1"+t+" (?!"+t+" ))\\n*|\\s*\\n*$)")}const xe=ke(1),be=ke(2);function ve(e,t){const a=1===t,n=a?xe:be,s=a?ge:ye,o=a?fe:he;return{match(e,t,a){const s=ae.exec(a);return s&&(t.list||!t.inline&&!t.simple)?n.exec(e=s[1]+e):null},order:1,parse(e,t,n){const r=a?+e[2]:void 0,i=e[0].replace(d,"\n").match(s);let l=!1;return{items:i.map((function(e,a){const s=o.exec(e)[0].length,r=new RegExp("^ {1,"+s+"}","gm"),c=e.replace(r,"").replace(o,""),u=a===i.length-1,d=-1!==c.indexOf("\n\n")||u&&l;l=d;const m=n.inline,p=n.list;let h;n.list=!0,d?(n.inline=!1,h=c.replace(le,"\n\n")):(n.inline=!0,h=c.replace(le,""));const g=t(h,n);return n.inline=m,n.list=p,g})),ordered:a,start:r}},render:(t,a,n)=>e(t.ordered?"ol":"ul",{key:n.key,start:t.type===r.orderedList?t.start:void 0},t.items.map((function(t,s){return e("li",{key:s},a(t,n))})))}}const Se=new RegExp("^\\[((?:\\[[^\\]]*\\]|[^\\[\\]]|\\](?=[^\\[]*\\]))*)\\]\\(\\s*<?((?:\\([^)]*\\)|[^\\s\\\\]|\\\\.)*?)>?(?:\\s+['\"]([\\s\\S]*?)['\"])?\\s*\\)"),Ee=/^!\[(.*?)\]\( *((?:\([^)]*\)|[^() ])*) *"?([^)"]*)?"?\)/,$e=[u,m,g,w,z,C,T,j,ge,xe,ye,be],we=[...$e,/^[^\n]+(?:  \n|\n{2,})/,L,B];function Ce(e){return e.replace(/[ÀÁÂÃÄÅàáâãäåæÆ]/g,"a").replace(/[çÇ]/g,"c").replace(/[ðÐ]/g,"d").replace(/[ÈÉÊËéèêë]/g,"e").replace(/[ÏïÎîÍíÌì]/g,"i").replace(/[Ññ]/g,"n").replace(/[øØœŒÕõÔôÓóÒò]/g,"o").replace(/[ÜüÛûÚúÙù]/g,"u").replace(/[ŸÿÝý]/g,"y").replace(/[^a-z0-9- ]/gi,"").replace(/ /gi,"-").toLowerCase()}function ze(e){return Q.test(e)?"right":Z.test(e)?"center":q.test(e)?"left":null}function Le(e,t,a,n){const s=a.inTable;a.inTable=!0;let o=e.trim().split(/( *(?:`[^`]*`|<.*?>.*?<\/.*?>(?!<\/.*?>)|\\\||\|) *)/).reduce(((e,s)=>("|"===s.trim()?e.push(n?{type:r.tableSeparator}:{type:r.text,text:s}):""!==s&&e.push.apply(e,t(s,a)),e)),[]);a.inTable=s;let i=[[]];return o.forEach((function(e,t){e.type===r.tableSeparator?0!==t&&t!==o.length-1&&i.push([]):(e.type!==r.text||null!=o[t+1]&&o[t+1].type!==r.tableSeparator||(e.text=e.text.trimEnd()),i[i.length-1].push(e))})),i}function Ae(e,t,a){a.inline=!0;const n=e[2]?e[2].replace(G,"").split("|").map(ze):[],s=e[3]?function(e,t,a){return e.trim().split("\n").map((function(e){return Le(e,t,a,!0)}))}(e[3],t,a):[],o=Le(e[1],t,a,!!s.length);return a.inline=!1,s.length?{align:n,cells:s,header:o,type:r.table}:{children:o,type:r.paragraph}}function Te(e,t){return null==e.align[t]?{}:{textAlign:e.align[t]}}function Oe(e){return function(t,a){return a.inline?e.exec(t):null}}function Be(e){return function(t,a){return a.inline||a.simple?e.exec(t):null}}function Me(e){return function(t,a){return a.inline||a.simple?null:e.exec(t)}}function Re(e){return function(t){return e.exec(t)}}function Ie(e,t,a){if(t.inline||t.simple)return null;if(a&&!a.endsWith("\n"))return null;let n="";e.split("\n").every((e=>!$e.some((t=>t.test(e)))&&(n+=e+"\n",e.trim())));const s=n.trimEnd();return""==s?null:[n,s]}function Ue(e){try{if(decodeURIComponent(e).replace(/[^A-Za-z0-9/:]/g,"").match(/^\s*(javascript|vbscript|data(?!:image)):/i))return null}catch(e){return null}return e}function De(e){return e.replace(ie,"$1")}function je(e,t,a){const n=a.inline||!1,s=a.simple||!1;a.inline=!0,a.simple=!0;const r=e(t,a);return a.inline=n,a.simple=s,r}function Ne(e,t,a){const n=a.inline||!1,s=a.simple||!1;a.inline=!1,a.simple=!0;const r=e(t,a);return a.inline=n,a.simple=s,r}function He(e,t,a){const n=a.inline||!1;a.inline=!1;const s=e(t,a);return a.inline=n,s}const Fe=(e,t,a)=>({children:je(t,e[1],a)});function Pe(){return{}}function _e(){return null}function We(...e){return e.filter(Boolean).join(" ")}function Ge(e,t,a){let n=e;const s=t.split(".");for(;s.length&&(n=n[s[0]],void 0!==n);)s.shift();return n||a}function Ze(e="",n={}){function i(e,a,...s){const r=Ge(n.overrides,`${e}.props`,{});return n.createElement(function(e,t){const a=Ge(t,e);return a?"function"==typeof a||"object"==typeof a&&"render"in a?a:Ge(t,`${e}.component`,e):e}(e,n.overrides),t({},a,r,{className:We(null==a?void 0:a.className,r.className)||void 0}),...s)}function d(e){e=e.replace(E,"");let t=!1;n.forceInline?t=!0:n.forceBlock||(t=!1===_.test(e));const a=ae(Q(t?e:`${e.trimEnd().replace(ne,"")}\n\n`,{inline:t}));for(;"string"==typeof a[a.length-1]&&!a[a.length-1].trim();)a.pop();if(null===n.wrapper)return a;const s=n.wrapper||(t?"span":"div");let r;if(a.length>1||n.forceWrapper)r=a;else{if(1===a.length)return r=a[0],"string"==typeof r?i("span",{key:"outer"},r):r;r=null}return external_React_.createElement(s,{key:"outer"},r)}function V(e,t){const a=t.match(c);return a?a.reduce((function(t,a,s){const r=a.indexOf("=");if(-1!==r){const o=function(e){return-1!==e.indexOf("-")&&null===e.match(O)&&(e=e.replace(D,(function(e,t){return t.toUpperCase()}))),e}(a.slice(0,r)).trim(),i=function(e){const t=e[0];return('"'===t||"'"===t)&&e.length>=2&&e[e.length-1]===t?e.slice(1,-1):e}(a.slice(r+1).trim()),c=l[o]||o,u=t[c]=function(e,t,a,n){return"style"===t?a.split(/;\s?/).reduce((function(e,t){const a=t.slice(0,t.indexOf(":"));return e[a.trim().replace(/(-[a-z])/g,(e=>e[1].toUpperCase()))]=t.slice(a.length+1).trim(),e}),{}):"href"===t||"src"===t?n(a,e,t):(a.match(M)&&(a=a.slice(1,a.length-1)),"true"===a||"false"!==a&&a)}(e,o,i,n.sanitizer);"string"==typeof u&&(L.test(u)||B.test(u))&&(t[c]=external_React_.cloneElement(d(u.trim()),{key:s}))}else"style"!==a&&(t[l[a]||a]=!0);return t}),{}):null}n.overrides=n.overrides||{},n.sanitizer=n.sanitizer||Ue,n.slugify=n.slugify||Ce,n.namedCodesToUnicode=n.namedCodesToUnicode?t({},a,n.namedCodesToUnicode):a,n.createElement=n.createElement||external_React_.createElement;const q=[],G={},Z={[r.blockQuote]:{match:Me(u),order:1,parse:(e,t,a)=>({children:t(e[0].replace(p,""),a)}),render:(e,t,a)=>i("blockquote",{key:a.key},t(e.children,a))},[r.breakLine]:{match:Re(f),order:1,parse:Pe,render:(e,t,a)=>i("br",{key:a.key})},[r.breakThematic]:{match:Me(h),order:1,parse:Pe,render:(e,t,a)=>i("hr",{key:a.key})},[r.codeBlock]:{match:Me(g),order:0,parse:e=>({lang:void 0,text:e[0].replace(/^ {4}/gm,"").replace(/\n+$/,"")}),render:(e,a,n)=>i("pre",{key:n.key},i("code",t({},e.attrs,{className:e.lang?`lang-${e.lang}`:""}),e.text))},[r.codeFenced]:{match:Me(m),order:0,parse:e=>({attrs:V("code",e[3]||""),lang:e[2]||void 0,text:e[4],type:r.codeBlock})},[r.codeInline]:{match:Be(y),order:3,parse:e=>({text:e[2]}),render:(e,t,a)=>i("code",{key:a.key},e.text)},[r.footnote]:{match:Me(b),order:0,parse:e=>(q.push({footnote:e[2],identifier:e[1]}),{}),render:_e},[r.footnoteReference]:{match:Oe(v),order:1,parse:e=>({target:`#${n.slugify(e[1],Ce)}`,text:e[1]}),render:(e,t,a)=>i("a",{key:a.key,href:n.sanitizer(e.target,"a","href")},i("sup",{key:a.key},e.text))},[r.gfmTask]:{match:Oe($),order:1,parse:e=>({completed:"x"===e[1].toLowerCase()}),render:(e,t,a)=>i("input",{checked:e.completed,key:a.key,readOnly:!0,type:"checkbox"})},[r.heading]:{match:Me(n.enforceAtxHeadings?C:w),order:1,parse:(e,t,a)=>({children:je(t,e[2],a),id:n.slugify(e[2],Ce),level:e[1].length}),render:(e,t,a)=>i(`h${e.level}`,{id:e.id,key:a.key},t(e.children,a))},[r.headingSetext]:{match:Me(z),order:0,parse:(e,t,a)=>({children:je(t,e[1],a),level:"="===e[2]?1:2,type:r.heading})},[r.htmlBlock]:{match:Re(L),order:1,parse(e,t,a){const[,n]=e[3].match(re),s=new RegExp(`^${n}`,"gm"),r=e[3].replace(s,""),i=(l=r,we.some((e=>e.test(l)))?He:je);var l;const c=e[1].toLowerCase(),u=-1!==o.indexOf(c),d=(u?c:e[1]).trim(),m={attrs:V(d,e[2]),noInnerParse:u,tag:d};return a.inAnchor=a.inAnchor||"a"===c,u?m.text=e[3]:m.children=i(t,r,a),a.inAnchor=!1,m},render:(e,a,n)=>i(e.tag,t({key:n.key},e.attrs),e.text||a(e.children,n))},[r.htmlSelfClosing]:{match:Re(B),order:1,parse(e){const t=e[1].trim();return{attrs:V(t,e[2]||""),tag:t}},render:(e,a,n)=>i(e.tag,t({},e.attrs,{key:n.key}))},[r.htmlComment]:{match:Re(T),order:1,parse:()=>({}),render:_e},[r.image]:{match:Be(Ee),order:1,parse:e=>({alt:e[1],target:De(e[2]),title:e[3]}),render:(e,t,a)=>i("img",{key:a.key,alt:e.alt||void 0,title:e.title||void 0,src:n.sanitizer(e.target,"img","src")})},[r.link]:{match:Oe(Se),order:3,parse:(e,t,a)=>({children:Ne(t,e[1],a),target:De(e[2]),title:e[3]}),render:(e,t,a)=>i("a",{key:a.key,href:n.sanitizer(e.target,"a","href"),title:e.title},t(e.children,a))},[r.linkAngleBraceStyleDetector]:{match:Oe(U),order:0,parse:e=>({children:[{text:e[1],type:r.text}],target:e[1],type:r.link})},[r.linkBareUrlDetector]:{match:(e,t)=>t.inAnchor?null:Oe(R)(e,t),order:0,parse:e=>({children:[{text:e[1],type:r.text}],target:e[1],title:void 0,type:r.link})},[r.linkMailtoDetector]:{match:Oe(I),order:0,parse(e){let t=e[1],a=e[1];return s.test(a)||(a="mailto:"+a),{children:[{text:t.replace("mailto:",""),type:r.text}],target:a,type:r.link}}},[r.orderedList]:ve(i,1),[r.unorderedList]:ve(i,2),[r.newlineCoalescer]:{match:Me(k),order:3,parse:Pe,render:()=>"\n"},[r.paragraph]:{match:Ie,order:3,parse:Fe,render:(e,t,a)=>i("p",{key:a.key},t(e.children,a))},[r.ref]:{match:Oe(N),order:0,parse:e=>(G[e[1]]={target:e[2],title:e[4]},{}),render:_e},[r.refImage]:{match:Be(H),order:0,parse:e=>({alt:e[1]||void 0,ref:e[2]}),render:(e,t,a)=>G[e.ref]?i("img",{key:a.key,alt:e.alt,src:n.sanitizer(G[e.ref].target,"img","src"),title:G[e.ref].title}):null},[r.refLink]:{match:Oe(F),order:0,parse:(e,t,a)=>({children:t(e[1],a),fallbackChildren:t(e[0].replace(P,"\\$1"),a),ref:e[2]}),render:(e,t,a)=>G[e.ref]?i("a",{key:a.key,href:n.sanitizer(G[e.ref].target,"a","href"),title:G[e.ref].title},t(e.children,a)):i("span",{key:a.key},t(e.fallbackChildren,a))},[r.table]:{match:Me(j),order:1,parse:Ae,render(e,t,a){const n=e;return i("table",{key:a.key},i("thead",null,i("tr",null,n.header.map((function(e,s){return i("th",{key:s,style:Te(n,s)},t(e,a))})))),i("tbody",null,n.cells.map((function(e,s){return i("tr",{key:s},e.map((function(e,s){return i("td",{key:s,style:Te(n,s)},t(e,a))})))}))))}},[r.text]:{match:Re(te),order:4,parse:e=>({text:e[0].replace(A,((e,t)=>n.namedCodesToUnicode[t]?n.namedCodesToUnicode[t]:e))}),render:e=>e.text},[r.textBolded]:{match:Be(X),order:2,parse:(e,t,a)=>({children:t(e[2],a)}),render:(e,t,a)=>i("strong",{key:a.key},t(e.children,a))},[r.textEmphasized]:{match:Be(J),order:3,parse:(e,t,a)=>({children:t(e[2],a)}),render:(e,t,a)=>i("em",{key:a.key},t(e.children,a))},[r.textEscaped]:{match:Be(ee),order:1,parse:e=>({text:e[1],type:r.text})},[r.textMarked]:{match:Be(K),order:3,parse:Fe,render:(e,t,a)=>i("mark",{key:a.key},t(e.children,a))},[r.textStrikethroughed]:{match:Be(Y),order:3,parse:Fe,render:(e,t,a)=>i("del",{key:a.key},t(e.children,a))}};!0===n.disableParsingRawHTML&&(delete Z[r.htmlBlock],delete Z[r.htmlSelfClosing]);const Q=function(e){let t=Object.keys(e);function a(n,s){let r=[],o="";for(;n;){let i=0;for(;i<t.length;){const l=t[i],c=e[l],u=c.match(n,s,o);if(u){const e=u[0];n=n.substring(e.length);const t=c.parse(u,a,s);null==t.type&&(t.type=l),r.push(t),o=e;break}i++}}return r}return t.sort((function(t,a){let n=e[t].order,s=e[a].order;return n!==s?n-s:t<a?-1:1})),function(e,t){return a(function(e){return e.replace(x,"\n").replace(S,"").replace(W,"    ")}(e),t)}}(Z),ae=(se=function(e,t){return function(a,n,s){const r=e[a.type].render;return t?t((()=>r(a,n,s)),a,n,s):r(a,n,s)}}(Z,n.renderRule),function e(t,a={}){if(Array.isArray(t)){const n=a.key,s=[];let r=!1;for(let n=0;n<t.length;n++){a.key=n;const o=e(t[n],a),i="string"==typeof o;i&&r?s[s.length-1]+=o:null!==o&&s.push(o),r=i}return a.key=n,s}return se(t,e,a)});var se;const oe=d(e);return q.length?i("div",null,oe,i("footer",{key:"footer"},q.map((function(e){return i("div",{id:n.slugify(e.identifier,Ce),key:e.identifier},e.identifier,ae(Q(e.footnote,{inline:!0})))})))):oe}const index_modern=e=>{let{children:t="",options:a}=e,s=function(e,t){if(null==e)return{};var a,n,s={},r=Object.keys(e);for(n=0;n<r.length;n++)t.indexOf(a=r[n])>=0||(s[a]=e[a]);return s}(e,n);return external_React_.cloneElement(Ze(t,a),s)};var helpers=__webpack_require__(728);const BouncingDots=()=>{const e={width:9,height:9,margin:"5px 0px 0px 5px",borderRadius:"50%",backgroundColor:"#a3a1a1",opacity:1,animation:"bouncing-loader 0.4s infinite alternate"};return React.createElement(React.Fragment,null,React.createElement("style",null,"\n          @keyframes bouncing-loader {\n            to {\n              opacity: 0.6;\n              transform: translateY(-10px);\n            }\n          }\n        "),React.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:26}},["0.1s","0.2s","0.3s"].map(((t,a)=>React.createElement("div",{key:a,style:{...e,animationDelay:t}})))))};var js_helpers=__webpack_require__(678);function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},_extends.apply(this,arguments)}const{useState,useEffect,useRef,useCallback}=wp.element,svgPathDefault='<path d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" />',svgPathSuccess='<path d="M10.7673 18C10.3106 18 9.86749 17.8046 9.54432 17.4555L5.50694 13.1222C4.83102 12.3968 4.83102 11.2208 5.50694 10.4954C6.18287 9.76997 7.27871 9.76997 7.95505 10.4954L10.6794 13.4196L16.9621 5.63976C17.5874 4.86495 18.6832 4.78289 19.4031 5.45388C20.125 6.12487 20.2036 7.29638 19.5759 8.07391L12.0778 17.3589C11.7639 17.7475 11.3119 17.9801 10.8319 18C10.8087 18 10.788 18 10.7673 18Z" />',svgPathError='<path d="M17.7623 17.7626C17.0831 18.4418 15.9549 18.416 15.244 17.705L5.79906 8.26012C5.08811 7.54917 5.0623 6.42098 5.74145 5.74183C6.4206 5.06267 7.54879 5.08849 8.25975 5.79944L17.7047 15.2443C18.4156 15.9553 18.4414 17.0835 17.7623 17.7626Z" /><path d="M17.5508 8.52848L8.52842 17.5509C7.84927 18.23 6.72108 18.2042 6.01012 17.4933C5.29917 16.7823 5.27336 15.6541 5.95251 14.975L14.9749 5.95257C15.6541 5.27342 16.7823 5.29923 17.4932 6.01019C18.2042 6.72114 18.23 7.84933 17.5508 8.52848Z" />',ReplyActions=({enabled:e,content:t,children:a,className:n,...s})=>{const r=(0,helpers.gR)(),[o,i]=useState("idle"),[l,c]=useState(!0),u=useRef(null),d=useRef(!1),m=useCallback((()=>{d.current||(d.current=!0,u.current=setTimeout((()=>{c(!1)}),500))}),[]),p=useCallback((()=>{u.current&&clearTimeout(u.current),c(!0),d.current=!1}),[]);useEffect((()=>()=>{u.current&&clearTimeout(u.current)}),[]);const h="success"===o?svgPathSuccess:"error"===o?svgPathError:svgPathDefault;return React.createElement("div",_extends({},s,{onMouseLeave:p,onMouseEnter:m,onMouseOver:m}),React.createElement("span",{className:n},a),React.createElement("div",{className:r("mwai-reply-actions",{"mwai-hidden":l})},e&&React.createElement("div",{className:"mwai-copy-button",onClick:()=>{try{navigator.clipboard.writeText(t),i("success")}catch(e){i("error"),console.warn("Not allowed to copy to clipboard. Make sure your website uses HTTPS.",{content:t})}finally{setTimeout((()=>{i("idle")}),2e3)}}},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",dangerouslySetInnerHTML:{__html:h}}))))},components_ReplyActions=ReplyActions,{useMemo}=wp.element,ChatbotName=({role:e="user"})=>{const{state:t}=(0,ChatbotContext.o)(),{pluginUrl:a,iconUrl:n,userData:s,userName:r,aiName:o,guestName:i,userAvatar:l,aiAvatar:c,guestAvatar:u,userAvatarUrl:d,aiAvatarUrl:m,guestAvatarUrl:p}=t,h=useMemo((()=>{const t="assistant"===e,h=!s&&!t,g=e=>React.createElement("div",{className:"mwai-name-text"},e),_=(e,t,n,s,r=!1)=>{if(!e)return null;if((0,js_helpers.Ve)(t))return o=t,React.createElement("div",{className:"mwai-avatar mwai-emoji",style:{fontSize:"32px",lineHeight:"32px"}},o);var o;const i=((e,t=!1)=>(0,helpers.mv)(e)?e:e&&!(0,js_helpers.Ve)(e)?t?e:`${a}/images/${e}`:(t||(0,js_helpers.Ve)(e)||console.warn("Invalid URL for avatar:",e),null))(t,r)||n;return i?((e,t)=>React.createElement("div",{className:"mwai-avatar"},React.createElement("img",{width:"32",height:"32",src:e,alt:t})))(i,s):null};if(t){const e=_(c,m,n,"AI Avatar");return e?(null===m&&n&&console.warn("Using iconUrl as a temporary fallback for AI avatar. Please set aiAvatarUrl."),e):g(o)}if(!h){return _(l,d,null==s?void 0:s.AVATAR_URL,"User Avatar",!0)||g(formatName(r,i,s))}if(h){return _(u,p,null,"Guest Avatar")||g(i||"Guest")}}),[e,o,r,i,s,n,c,l,u,m,d,p,a]);return React.createElement("span",{className:"mwai-name"},h)};function formatName(e,t,a){return a&&0!==Object.keys(a).length?Object.entries(a).reduce(((e,[t,a])=>{const n=`{${t}}`;return e.includes(n)?e.replace(n,a):e}),e):t||e||"Guest"}const chatbot_ChatbotName=ChatbotName,{useState:ChatbotReply_useState,useMemo:ChatbotReply_useMemo,useEffect:ChatbotReply_useEffect,useRef:ChatbotReply_useRef}=wp.element,LinkContainer=({href:e,children:t})=>{if(!e)return React.createElement("span",null,t);const a="_blank";if("Uploaded File"===String(t)){const t=e.split("/").pop();return React.createElement("a",{href:e,target:a,rel:"noopener noreferrer",className:"mwai-filename"},React.createElement("span",null,"✓ ",t))}return React.createElement("a",{href:e,target:a,rel:"noopener noreferrer"},t)},RawMessage=({message:e,onRendered:t=(()=>{})})=>{const{state:a}=(0,ChatbotContext.o)(),{copyButton:n}=a,[s]=ChatbotReply_useState(e.isQuerying||e.isStreaming),r=e.isQuerying,o=e.isStreaming;let i=e.content??"";(i.match(/```/g)||[]).length%2!=0?i+="\n```":e.isStreaming&&(i+="<BlinkingCursor />"),ChatbotReply_useEffect((()=>{s&&(!s||r||o)||t()}),[s,r,o]);const l=ChatbotReply_useMemo((()=>{const e={overrides:{BlinkingCursor:{component:js_helpers.rn},a:{component:LinkContainer},img:{props:{onError:e=>{null!==e.target.src.match(/\.(jpeg|jpg|gif|png)$/)&&(e.target.src="https://placehold.co/600x200?text=Expired+Image")},className:"mwai-image"}}}};return e}),[]),c=ChatbotReply_useMemo((()=>{let e="";try{e=Ze(i,l)}catch(t){console.error("Crash in markdown-to-jsx! Reverting to plain text.",{e:t,content:i}),e=i}return e}),[i,l]);return r||o&&!i?React.createElement(BouncingDots,null):React.createElement(React.Fragment,null,React.createElement(chatbot_ChatbotName,{role:e.role}),React.createElement(components_ReplyActions,{content:e.content,enabled:n,className:"mwai-text"},c))},ImagesMessage=({message:e,onRendered:t=(()=>{})})=>{const[a,n]=ChatbotReply_useState(null==e?void 0:e.images);return ChatbotReply_useEffect((()=>{t()})),e.isQuerying?React.createElement(BouncingDots,null):React.createElement(React.Fragment,null,React.createElement(chatbot_ChatbotName,{role:e.role}),React.createElement("span",{className:"mwai-text"},React.createElement("div",{className:"mwai-gallery"},null==a?void 0:a.map(((e,t)=>React.createElement("a",{key:t,href:e,target:"_blank",rel:"noopener noreferrer"},React.createElement("img",{key:t,src:e,onError:()=>(e=>{n((t=>t.map(((t,a)=>a===e?"https://placehold.co/600x200?text=Expired+Image":t))))})(t)})))))))},ChatbotReply=({message:e,conversationRef:t})=>{var a;const{state:n}=(0,ChatbotContext.o)(),{typewriter:s}=n,r=(0,helpers.gR)(),o=ChatbotReply_useRef(),i=r("mwai-reply",{"mwai-ai":"assistant"===e.role,"mwai-user":"user"===e.role,"mwai-system":"system"===e.role}),l=(null==e||null===(a=e.images)||void 0===a?void 0:a.length)>0,c=()=>{!o.current||e.isQuerying||o.current.classList.contains("mwai-rendered")||"undefined"==typeof hljs||(o.current.classList.add("mwai-rendered"),o.current.querySelectorAll("pre code").forEach((e=>{hljs.highlightElement(e)})))};return ChatbotReply_useMemo((()=>"user"===e.role?React.createElement("div",{ref:o,className:i},React.createElement(RawMessage,{message:e})):"assistant"===e.role?l?React.createElement("div",{ref:o,className:i},React.createElement(ImagesMessage,{message:e,conversationRef:t,onRendered:c})):React.createElement("div",{ref:o,className:i},React.createElement(RawMessage,{message:e,conversationRef:t,onRendered:c})):"system"===e.role?React.createElement("div",{ref:o,className:i},React.createElement(RawMessage,{message:e,conversationRef:t,onRendered:c})):React.createElement("div",null,React.createElement("i",null,"Unhandled role."))),[e,t,l,s])},chatbot_ChatbotReply=ChatbotReply;function extends_extends(){return extends_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},extends_extends.apply(this,arguments)}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var a,n,s={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(s[a]=e[a]);return s}var index=external_React_.useLayoutEffect;const use_isomorphic_layout_effect_browser_esm=index;var useLatest=function(e){var t=external_React_.useRef(e);return use_isomorphic_layout_effect_browser_esm((function(){t.current=e})),t},updateRef=function(e,t){"function"!=typeof e?e.current=t:e(t)},useComposedRef=function(e,t){var a=(0,external_React_.useRef)();return(0,external_React_.useCallback)((function(n){e.current=n,a.current&&updateRef(a.current,null),a.current=t,t&&updateRef(t,n)}),[t])};const use_composed_ref_esm=useComposedRef;var HIDDEN_TEXTAREA_STYLE={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},forceHiddenStyles=function(e){Object.keys(HIDDEN_TEXTAREA_STYLE).forEach((function(t){e.style.setProperty(t,HIDDEN_TEXTAREA_STYLE[t],"important")}))},forceHiddenStyles$1=forceHiddenStyles,hiddenTextarea=null,getHeight=function(e,t){var a=e.scrollHeight;return"border-box"===t.sizingStyle.boxSizing?a+t.borderSize:a-t.paddingSize};function calculateNodeHeight(e,t,a,n){void 0===a&&(a=1),void 0===n&&(n=1/0),hiddenTextarea||((hiddenTextarea=document.createElement("textarea")).setAttribute("tabindex","-1"),hiddenTextarea.setAttribute("aria-hidden","true"),forceHiddenStyles$1(hiddenTextarea)),null===hiddenTextarea.parentNode&&document.body.appendChild(hiddenTextarea);var s=e.paddingSize,r=e.borderSize,o=e.sizingStyle,i=o.boxSizing;Object.keys(o).forEach((function(e){var t=e;hiddenTextarea.style[t]=o[t]})),forceHiddenStyles$1(hiddenTextarea),hiddenTextarea.value=t;var l=getHeight(hiddenTextarea,e);hiddenTextarea.value=t,l=getHeight(hiddenTextarea,e),hiddenTextarea.value="x";var c=hiddenTextarea.scrollHeight-s,u=c*a;"border-box"===i&&(u=u+s+r),l=Math.max(u,l);var d=c*n;return"border-box"===i&&(d=d+s+r),[l=Math.min(d,l),c]}var noop=function(){},pick=function(e,t){return e.reduce((function(e,a){return e[a]=t[a],e}),{})},SIZING_STYLE=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak"],isIE=!!document.documentElement.currentStyle,getSizingData=function(e){var t=window.getComputedStyle(e);if(null===t)return null;var a=pick(SIZING_STYLE,t),n=a.boxSizing;return""===n?null:(isIE&&"border-box"===n&&(a.width=parseFloat(a.width)+parseFloat(a.borderRightWidth)+parseFloat(a.borderLeftWidth)+parseFloat(a.paddingRight)+parseFloat(a.paddingLeft)+"px"),{sizingStyle:a,paddingSize:parseFloat(a.paddingBottom)+parseFloat(a.paddingTop),borderSize:parseFloat(a.borderBottomWidth)+parseFloat(a.borderTopWidth)})},getSizingData$1=getSizingData;function useListener(e,t,a){var n=useLatest(a);external_React_.useLayoutEffect((function(){var a=function(e){return n.current(e)};if(e)return e.addEventListener(t,a),function(){return e.removeEventListener(t,a)}}),[])}var useWindowResizeListener=function(e){useListener(window,"resize",e)},useFontsLoadedListener=function(e){useListener(document.fonts,"loadingdone",e)},_excluded=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],TextareaAutosize=function(e,t){var a=e.cacheMeasurements,n=e.maxRows,s=e.minRows,r=e.onChange,o=void 0===r?noop:r,i=e.onHeightChange,l=void 0===i?noop:i,c=_objectWithoutPropertiesLoose(e,_excluded),u=void 0!==c.value,d=external_React_.useRef(null),m=use_composed_ref_esm(d,t),p=external_React_.useRef(0),h=external_React_.useRef(),g=function(){var e=d.current,t=a&&h.current?h.current:getSizingData$1(e);if(t){h.current=t;var r=calculateNodeHeight(t,e.value||e.placeholder||"x",s,n),o=r[0],i=r[1];p.current!==o&&(p.current=o,e.style.setProperty("height",o+"px","important"),l(o,{rowHeight:i}))}};return external_React_.useLayoutEffect(g),useWindowResizeListener(g),useFontsLoadedListener(g),external_React_.createElement("textarea",extends_extends({},c,{onChange:function(e){u||g(),o(e)},ref:m}))},react_textarea_autosize_browser_esm_index=external_React_.forwardRef(TextareaAutosize);const{useState:ChatUploadIcon_useState,useMemo:ChatUploadIcon_useMemo,useRef:ChatUploadIcon_useRef}=wp.element,ChatUploadIcon=()=>{const e=(0,helpers.gR)(),{state:t,actions:a}=(0,ChatbotContext.o)(),{uploadedFile:n,busy:s,imageUpload:r,fileUpload:o,fileSearch:i,draggingType:l}=t,{onUploadFile:c}=a,[u,d]=ChatUploadIcon_useState(!1),m=ChatUploadIcon_useRef(),p=null==n?void 0:n.uploadedId,h=r||i||o,g=n,_=ChatUploadIcon_useMemo((()=>null!=g&&g.localFile?g.localFile.type.startsWith("image/")?"image":"document":l),[g,l]),f=ChatUploadIcon_useMemo((()=>{let e="idle";return null!=g&&g.uploadProgress?e="up":l?e="add":u&&p?e="del":p?e="ok":u&&!p&&(e="add"),`mwai-file-upload-icon mwai-${_?_.toLowerCase():"idle"}-${e}`}),[_,g,l,u,p]),b=ChatUploadIcon_useMemo((()=>null!=g&&g.uploadProgress?g.uploadProgress>99?99:Math.round(g.uploadProgress):""),[g]);return h?React.createElement("div",{disabled:s,onClick:()=>{null!=n&&n.localFile?c(null):s||m.current.click()},onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),className:e("mwai-file-upload",{"mwai-enabled":null==n?void 0:n.uploadedId,"mwai-busy":(null==n?void 0:n.localFile)&&!(null!=n&&n.uploadedId)}),style:{cursor:s?"default":"pointer"}},React.createElement("div",{className:f},React.createElement("span",{className:"mwai-file-upload-progress"},b)),React.createElement("input",{type:"file",ref:m,onChange:e=>{const t=e.target.files[0];t&&c(t)},style:{display:"none"}})):null},chatbot_ChatUploadIcon=ChatUploadIcon,{useRef:ChatbotInput_useRef,useState:ChatbotInput_useState,useEffect:ChatbotInput_useEffect,useImperativeHandle}=wp.element,ChatbotInput=()=>{const e=(0,helpers.gR)(),{state:t,actions:a}=(0,ChatbotContext.o)(),{inputText:n,textInputMaxLength:s,textInputPlaceholder:r,error:o,speechRecognitionAvailable:i,isMobile:l,conversationRef:c,open:u,uploadIconPosition:d,locked:m,isListening:p,busy:h,speechRecognition:g,chatbotInputRef:_}=t,{onSubmitAction:f,setIsListening:b,resetError:y,setInputText:v}=a,[w,R]=ChatbotInput_useState(!1),E=ChatbotInput_useRef();useImperativeHandle(_,(()=>({focusInput:()=>{var e;null===(e=E.current)||void 0===e||e.focus()},currentElement:()=>E.current}))),ChatbotInput_useEffect((()=>{!l&&u&&E.current.focus(),c.current&&(c.current.scrollTop=c.current.scrollHeight)}),[u,l,c]);const C=e("mwai-input-text",{});return React.createElement("div",{ref:_,className:C},"mwai-input"===d&&React.createElement(chatbot_ChatUploadIcon,null),React.createElement(react_textarea_autosize_browser_esm_index,{ref:E,disabled:h||m,placeholder:r,value:n,maxLength:s,onCompositionStart:()=>R(!0),onCompositionEnd:()=>R(!1),onKeyDown:e=>{w||"Enter"!==e.code||e.shiftKey||(e.preventDefault(),f())},onChange:e=>{return t=e.target.value,p&&b(!1),o&&y(),void v(t);var t}}),g&&React.createElement(helpers.tm,{active:p,disabled:!i||h,className:"mwai-microphone",onClick:()=>b(!p)}))},chatbot_ChatbotInput=ChatbotInput;var createLucideIcon=__webpack_require__(407);const Send=(0,createLucideIcon.A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),Eraser=(0,createLucideIcon.A)("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]),{useMemo:ChatbotSubmit_useMemo,useCallback:ChatbotSubmit_useCallback}=wp.element,ChatbotSubmit=()=>{const{state:e,actions:t}=(0,ChatbotContext.o)(),{onClear:a,onSubmitAction:n,setIsListening:s}=t,{textClear:r,textSend:o,uploadedFile:i,inputText:l,messages:c,isListening:u,timeElapsed:d,busy:m,submitButtonConf:p,locked:h}=e,g=!(null==i||!i.uploadProgress),_=!(null!=i&&i.uploadedId)&&l.length<1&&(null==c?void 0:c.length)>1,f=ChatbotSubmit_useMemo((()=>m?d?React.createElement("div",{className:"mwai-timer"},d):null:null!=p&&p.imageSend&&null!=p&&p.imageClear?React.createElement("img",{src:_?p.imageClear:p.imageSend,alt:_?r:o}):_||o?_&&!r?React.createElement(Eraser,{size:"20"}):React.createElement("span",null,_?r:o):React.createElement(Send,{size:"20",style:{marginLeft:10}})),[m,d,_,r,o,p]),b=ChatbotSubmit_useMemo((()=>"mwai-input-submit "+(m?"mwai-busy":"")),[m]),y=ChatbotSubmit_useCallback((()=>{u&&s(!1),_?a():n()}),[_,u,a,n,s]),v=ChatbotSubmit_useCallback((()=>{m||y()}),[m,y]);return React.createElement("button",{className:b,disabled:m||g||h,onClick:v},f)},chatbot_ChatbotSubmit=ChatbotSubmit,{useMemo:ChatbotHeader_useMemo}=wp.element;function formatAvatar(e,t,a,n){if((0,js_helpers.Ve)(n||a))return s=n||a,React.createElement("div",{className:"mwai-avatar mwai-emoji",style:{fontSize:"48px",lineHeight:"48px"}},s);var s;const r=(o=n,((0,helpers.mv)(o)?o:o?`${t}/images/${o}`:null)||a||`${t}/images/chat-openai.svg`);var o,i;return r?(i=r,"AI Engine",React.createElement("div",{className:"mwai-avatar"},React.createElement("img",{alt:"AI Engine",src:i}))):React.createElement("div",{className:"mwai-name-text"},e)}const ChatbotHeader=()=>{const{state:e,actions:t}=(0,ChatbotContext.o)(),{theme:a,isWindow:n,fullscreen:s,aiName:r,pluginUrl:o,open:i,iconUrl:l,aiAvatarUrl:c,windowed:u,headerSubtitle:d}=e,{setOpen:m,setWindowed:p}=t,h=ChatbotHeader_useMemo((()=>{if(!n)return null;const e="timeless"===(null==a?void 0:a.themeId),t=e?formatAvatar(r,o,l,c):null,h=null==d?"Discuss with":d;return React.createElement(React.Fragment,null,e&&React.createElement(React.Fragment,null,t,React.createElement("div",{className:"mwai-name"},h&&React.createElement("small",{className:"mwai-subtitle"},h),React.createElement("div",null,r)),React.createElement("div",{style:{flex:"auto"}})),React.createElement("div",{className:"mwai-buttons"},s&&React.createElement("div",{className:"mwai-resize-button",onClick:()=>p(!u)}),React.createElement("div",{className:"mwai-close-button",onClick:()=>m(!i)})))}),[n,null==a?void 0:a.themeId,r,o,l,c,s,p,u,m,i,d]);return React.createElement("div",{className:"mwai-header"},h)},chatbot_ChatbotHeader=ChatbotHeader,{useMemo:ChatbotTrigger_useMemo,useEffect:ChatbotTrigger_useEffect}=wp.element,ChatbotTrigger=()=>{const{state:e,actions:t}=(0,ChatbotContext.o)(),{isWindow:a,iconText:n,showIconMessage:s,iconAlt:r,iconUrl:o,open:i}=e,{setShowIconMessage:l,setOpen:c}=t;ChatbotTrigger_useEffect((()=>{i&&s&&l(!1)}),[i,l,s]);const u=ChatbotTrigger_useMemo((()=>a?React.createElement("div",{className:"mwai-trigger mwai-open-button"},React.createElement(helpers.bE,{className:"mwai-icon-text-container",if:n&&s},React.createElement("div",{className:"mwai-icon-text-close",onClick:()=>l(!1)},"✕"),React.createElement("div",{className:"mwai-icon-text",onClick:()=>c(!0)},n)),React.createElement("div",{className:"mwai-icon-container",onClick:()=>c(!0)},(0,js_helpers.Ve)(o)?React.createElement("div",{className:"mwai-icon mwai-emoji",style:{fontSize:"48px",lineHeight:"64px",width:"64px",height:"64px",display:"flex",justifyContent:"center",alignItems:"center"}},o):React.createElement("img",{className:"mwai-icon",width:"64",height:"64",alt:r,src:o}))):null),[a,n,s,r,o,l,c]);return React.createElement(React.Fragment,null,u)},chatbot_ChatbotTrigger=ChatbotTrigger,Play=(0,createLucideIcon.A)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),Loader=(0,createLucideIcon.A)("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]),Square=(0,createLucideIcon.A)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),Pause=(0,createLucideIcon.A)("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]),Users=(0,createLucideIcon.A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Captions=(0,createLucideIcon.A)("Captions",[["rect",{width:"18",height:"14",x:"3",y:"5",rx:"2",ry:"2",key:"12ruh7"}],["path",{d:"M7 15h4M15 15h2M7 11h2M13 11h4",key:"1ueiar"}]]),Bug=(0,createLucideIcon.A)("Bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]]),{useState:AudioVisualizer_useState,useRef:AudioVisualizer_useRef,useEffect:AudioVisualizer_useEffect}=wp.element;function measureVolume(e,t){e.getByteTimeDomainData(t);let a=0;for(let e=0;e<t.length;e++){const n=t[e]-128;a+=n*n}return Math.sqrt(a/t.length)}function AudioVisualizerTwoStreams({assistantStream:e=null,userStream:t=null,assistantColor:a=null,userColor:n=null,userUI:s={emoji:null,text:null,image:null,use:"text"},assistantUI:r={emoji:null,text:null,image:null,use:"text"},attackSpeed:o=.3,releaseSpeed:i=.05,circleSize:l=50,pulseMaxSize:c=30}){const[u,d]=AudioVisualizer_useState(0),[m,p]=AudioVisualizer_useState(0),h=AudioVisualizer_useRef(0),g=AudioVisualizer_useRef(0),_=AudioVisualizer_useRef(null),f=AudioVisualizer_useRef(null),b=AudioVisualizer_useRef(null),y=AudioVisualizer_useRef(null),v=AudioVisualizer_useRef(null);AudioVisualizer_useEffect((()=>{if(!e&&!t)return;_.current||(_.current=new AudioContext);const a=_.current;let n,s,r;e&&(n=a.createMediaStreamSource(e),f.current=a.createAnalyser(),f.current.fftSize=1024,b.current=new Uint8Array(f.current.frequencyBinCount),n.connect(f.current)),t&&(s=a.createMediaStreamSource(t),y.current=a.createAnalyser(),y.current.fftSize=1024,v.current=new Uint8Array(y.current.frequencyBinCount),s.connect(y.current));const l=()=>{let e=0;f.current&&b.current&&(e=measureVolume(f.current,b.current));let t=0;y.current&&v.current&&(t=measureVolume(y.current,v.current)),e>h.current?h.current=h.current*(1-o)+e*o:h.current=h.current*(1-i)+e*i,t>g.current?g.current=g.current*(1-o)+t*o:g.current=g.current*(1-i)+t*i,d(h.current),p(g.current),r=requestAnimationFrame(l)};return l(),()=>{n&&n.disconnect(),f.current&&f.current.disconnect(),s&&s.disconnect(),y.current&&y.current.disconnect(),r&&cancelAnimationFrame(r)}}),[e,t,o,i]);const w=l+Math.min(u/20,1)*c,R=l+Math.min(m/20,1)*c,E=l+c,C={width:R,height:R,borderRadius:"50%",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",opacity:.5};n&&(C.backgroundColor=n);const x={width:w,height:w,borderRadius:"50%",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",opacity:.5};a&&(x.backgroundColor=a);const k={width:l,height:l,borderRadius:"50%",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",color:"#fff"};n&&(k.backgroundColor=n);const I={width:l,height:l,borderRadius:"50%",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",color:"#fff"};a&&(I.backgroundColor=a);let S="mwai-visualizer";m>u?S+=" mwai-user-talking":u>m&&(S+=" mwai-assistant-talking");const M=e=>{if(!e)return null;const{emoji:t,text:a,image:n,use:s}=e;switch(s){case"emoji":return t?React.createElement("span",null,t):a?React.createElement("span",null,a.slice(0,1)):null;case"image":return n?React.createElement("img",{src:n,alt:"",style:{width:"100%",height:"100%",borderRadius:"50%"}}):t?React.createElement("span",null,t):a?React.createElement("span",null,a.slice(0,1)):null;default:return a?React.createElement("span",null,a.slice(0,1)):t?React.createElement("span",null,t):null}};return React.createElement("div",{className:S},React.createElement("div",{className:"mwai-visualizer-user",style:{position:"relative",width:E,height:E,overflow:"visible"}},React.createElement("div",{className:"mwai-animation",style:C}),React.createElement("div",{style:k},M(s))),React.createElement("hr",{className:"mwai-visualizer-line"}),React.createElement("div",{className:"mwai-visualizer-assistant",style:{position:"relative",width:E,height:E,overflow:"visible"}},React.createElement("div",{className:"mwai-animation",style:x}),React.createElement("div",{style:I},M(r))))}const{useState:ChatbotRealtime_useState,useRef:ChatbotRealtime_useRef,useCallback:ChatbotRealtime_useCallback,useMemo:ChatbotRealtime_useMemo,useEffect:ChatbotRealtime_useEffect}=wp.element,DEBUG_LEVELS={none:0,low:1,normal:2,high:3,verbose:4},CURRENT_DEBUG=DEBUG_LEVELS.low;function debugLog(e,...t){CURRENT_DEBUG>=e&&console.log(...t)}function parseUsage(e){if(!e)return null;const{input_token_details:{text_tokens:t=0,audio_tokens:a=0,cached_tokens_details:{text_tokens:n=0,audio_tokens:s=0}={}}={},output_token_details:{text_tokens:r=0,audio_tokens:o=0}={}}=e;return{text_input_tokens:t,audio_input_tokens:a,text_output_tokens:r,audio_output_tokens:o,text_cached_tokens:n,audio_cached_tokens:s}}function getChatbotRepresentation(e,t="user"){const{pluginUrl:a,iconUrl:n,userData:s,userName:r,aiName:o,guestName:i,userAvatar:l,aiAvatar:c,guestAvatar:u,userAvatarUrl:d,aiAvatarUrl:m,guestAvatarUrl:p}=e,h=(e,t,n,s,r=!1)=>{if(t){const e=((e,t=!1)=>(0,helpers.mv)(e)?e:e&&!(0,js_helpers.Ve)(e)?t?e:`${a}/images/${e}`:null)(n,r)||s;if(e)return{emoji:null,text:null,image:e,use:"image"}}return(0,js_helpers.Ve)(e)?{emoji:e,text:null,image:null,use:"emoji"}:{emoji:null,text:e,image:null,use:"text"}};return"assistant"===t?h(o,c,m,n):s?h(ChatbotRealtime_formatName(r,i,s),l,d,null==s?void 0:s.AVATAR_URL,!0):s||"user"!==t?{emoji:null,text:"Unknown",image:null,use:"text"}:h(i||"Guest",u,p,null)}function ChatbotRealtime_formatName(e,t,a){return a&&0!==Object.keys(a).length?Object.entries(a).reduce(((e,[t,a])=>{const n=`{${t}}`;return e.includes(n)?e.replace(n,a):e}),e):t||e||"Guest"}const ChatbotRealtime=()=>{const{state:e,actions:t}=(0,ChatbotContext.o)(),{busy:a,locked:n,open:s,popup:r}=e,{onStartRealtimeSession:o,onRealtimeFunctionCallback:i,onCommitStats:l,onCommitDiscussions:c}=t,[u,d]=ChatbotRealtime_useState(!1),[m,p]=ChatbotRealtime_useState(!1),[h,g]=ChatbotRealtime_useState(!1),[_,f]=ChatbotRealtime_useState(null),[b,y]=ChatbotRealtime_useState(null),[v,w]=ChatbotRealtime_useState({text_input_tokens:0,audio_input_tokens:0,text_output_tokens:0,audio_output_tokens:0,text_cached_tokens:0,audio_cached_tokens:0}),[R,E]=ChatbotRealtime_useState([]),C=ChatbotRealtime_useRef(new Set),x=ChatbotRealtime_useRef(null),k=ChatbotRealtime_useRef(null),I=ChatbotRealtime_useRef(null),[S,M]=ChatbotRealtime_useState(!0),[A,T]=ChatbotRealtime_useState(!0),[U,N]=ChatbotRealtime_useState(!1),[D,L]=ChatbotRealtime_useState(!1),[P,O]=ChatbotRealtime_useState(null),B=ChatbotRealtime_useRef([]),F=ChatbotRealtime_useMemo((()=>getChatbotRepresentation(e,"user")),[e]),$=ChatbotRealtime_useMemo((()=>getChatbotRepresentation(e,"assistant")),[e]);ChatbotRealtime_useEffect((()=>{!s&&m&&r&&V()}),[s,r,m]);const z=ChatbotRealtime_useCallback((async e=>{await l(e)}),[l]),j=ChatbotRealtime_useCallback((()=>{k.current&&"open"===k.current.readyState?(k.current.send(JSON.stringify({type:"session.update",session:{input_audio_transcription:{model:"whisper-1"}}})),debugLog(DEBUG_LEVELS.low,"Sent session.update to enable Whisper.")):console.error("Data channel is not open yet; cannot enable transcription.")}),[]),W=ChatbotRealtime_useCallback((async(e,t,a)=>{let n={};try{n=JSON.parse(a||"{}")}catch(e){console.error("Could not parse function arguments.",a)}const s=B.current.find((e=>e.name===t));if(s)try{var r;const t=await i(s.id,s.type,s.name,s.target,n);if(null==t||!t.success)return void console.error("Callback failed.",null==t?void 0:t.message);const a=t.data;"open"===(null===(r=k.current)||void 0===r?void 0:r.readyState)&&(debugLog(DEBUG_LEVELS.low,"Send callback value:",a),k.current.send(JSON.stringify({type:"conversation.item.create",item:{type:"function_call_output",call_id:e,output:JSON.stringify(a)}})),k.current.send(JSON.stringify({type:"response.create",response:{instructions:"Reply based on the function's output."}})))}catch(e){console.error("Error in handleFunctionCall.",e)}else console.error(`No match for callback: '${t}'.`)}),[i]),H=ChatbotRealtime_useCallback((async(e,t)=>{d(!0);const a=new RTCPeerConnection;let n;x.current=a;try{n=await navigator.mediaDevices.getUserMedia({audio:!0}),I.current=n,n.getTracks().forEach((e=>a.addTrack(e,n)))}catch(e){return console.error("Error accessing microphone.",e),void d(!1)}a.ontrack=e=>{const t=document.getElementById("mwai-audio");t&&(t.srcObject=e.streams[0]),O(e.streams[0])};const s=a.createDataChannel("oai-events");k.current=s,s.addEventListener("open",(()=>{debugLog(DEBUG_LEVELS.low,"Data channel open."),j()})),s.addEventListener("message",(e=>{let t;try{t=JSON.parse(e.data)}catch(t){return void console.error("Could not parse Realtime message.",e.data)}if(CURRENT_DEBUG>=DEBUG_LEVELS.high)console.log("Incoming message from Realtime API.",t);else if(CURRENT_DEBUG===DEBUG_LEVELS.low){var a;((null===(a=t.type)||void 0===a?void 0:a.endsWith(".done"))||"input_audio_buffer.committed"===t.type||"conversation.item.input_audio_transcription.completed"===t.type||"response.done"===t.type)&&console.log("Key event from Realtime API.",t)}switch(t.type){case"input_audio_buffer.committed":{const e=t.item_id;C.current.has(e)||(C.current.add(e),E((t=>[...t,{id:e,role:"user",content:"[Audio]"}]))),y("user");break}case"conversation.item.input_audio_transcription.completed":{const e=t.item_id,a=(t.transcript||"[Audio]").trim();E((t=>t.map((t=>t.id===e&&"user"===t.role?{...t,content:a}:t))));break}case"response.audio_transcript.done":{const e=t.item_id,a=(t.transcript||"[Audio]").trim();y("assistant"),C.current.has(e)||(C.current.add(e),E((t=>[...t,{id:e,role:"assistant",content:a}])));break}case"response.function_call_arguments.done":{const{call_id:e,name:a,arguments:n}=t;debugLog(DEBUG_LEVELS.low,"Function call requested.",e,a),W(e,a,n);break}case"response.done":{const e=t.response;if(null!=e&&e.usage){const t=parseUsage(e.usage);t&&w((e=>{const a={text_input_tokens:(e.text_input_tokens||0)+t.text_input_tokens,audio_input_tokens:(e.audio_input_tokens||0)+t.audio_input_tokens,text_output_tokens:(e.text_output_tokens||0)+t.text_output_tokens,audio_output_tokens:(e.audio_output_tokens||0)+t.audio_output_tokens,text_cached_tokens:(e.text_cached_tokens||0)+t.text_cached_tokens,audio_cached_tokens:(e.audio_cached_tokens||0)+t.audio_cached_tokens};return z(a),a}))}y("user");break}}}));const r=await a.createOffer();await a.setLocalDescription(r);const o=t||"gpt-4o-preview-2024-12-17",i=await fetch(`https://api.openai.com/v1/realtime?model=${o}`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/sdp"},body:r.sdp});if(!i.ok)return console.error("SDP exchange failed.",i),void d(!1);const l=await i.text();await a.setRemoteDescription({type:"answer",sdp:l}),debugLog(DEBUG_LEVELS.low,"Realtime connection established."),d(!1),p(!0),g(!1),y("user")}),[j,W,z]),V=ChatbotRealtime_useCallback((()=>{try{x.current&&(x.current.close(),x.current=null),I.current&&(I.current.getTracks().forEach((e=>e.stop())),I.current=null),k.current=null,d(!1),p(!1),g(!1),y(null),console.log("Messages:",R),console.log("Statistics:",v),c(R),E([]),w({text_input_tokens:0,audio_input_tokens:0,text_output_tokens:0,audio_output_tokens:0,text_cached_tokens:0,audio_cached_tokens:0}),debugLog(DEBUG_LEVELS.low,"Stopped Realtime connection.")}catch(e){console.error("Error stopping connection.",e)}}),[R,v,c]),K=ChatbotRealtime_useCallback((()=>{if(!I.current)return;const e=I.current.getAudioTracks();e.length&&(h?(e.forEach((e=>{e.enabled=!0})),debugLog(DEBUG_LEVELS.low,"Resumed microphone."),g(!1)):(e.forEach((e=>{e.enabled=!1})),debugLog(DEBUG_LEVELS.low,"Paused microphone."),g(!0)))}),[h]),q=ChatbotRealtime_useCallback((async()=>{d(!0);try{const e=await o();if(null==e||!e.success)return console.error("Could not start realtime session.",e),void d(!1);B.current=e.function_callbacks||[],f(e.session_id),await H(e.client_secret,e.model)}catch(e){console.error("Error in handlePlay.",e),d(!1)}}),[o,H]),G=ChatbotRealtime_useCallback((()=>V()),[V]),J=ChatbotRealtime_useCallback((()=>T((e=>!e))),[]),X=ChatbotRealtime_useCallback((()=>L((e=>!e))),[]),Z=ChatbotRealtime_useCallback((()=>N((e=>!e))),[]),Q=ChatbotRealtime_useMemo((()=>h?"mwai-pause mwai-active":"mwai-pause"),[h]),Y=ChatbotRealtime_useMemo((()=>{const e=[...R].reverse().find((e=>"assistant"===e.role));return e?e.content.length>256?`${e.content.slice(0,256)}...`:e.content:"..."}),[R]),ee=ChatbotRealtime_useMemo((()=>A?"mwai-option mwai-option-users mwai-active":"mwai-option mwai-option-users"),[A]),te=ChatbotRealtime_useMemo((()=>U?"mwai-option mwai-option-captions mwai-active":"mwai-option mwai-option-captions"),[U]),ae=ChatbotRealtime_useMemo((()=>D?"mwai-option mwai-option-statistics mwai-active":"mwai-option mwai-option-statistics"),[D]);return React.createElement("div",null,React.createElement("audio",{id:"mwai-audio",autoPlay:!0}),A&&React.createElement("div",{style:{display:"flex",justifyContent:"center"}},React.createElement(AudioVisualizerTwoStreams,{assistantStream:P,userUI:F,assistantUI:$,userStream:I.current})),React.createElement("div",{className:"mwai-controls"},!m&&!u&&React.createElement("button",{onClick:q,className:"mwai-play",disabled:a||n,"aria-label":"Play"},React.createElement(Play,{size:16})),u&&React.createElement("button",{className:"mwai-play",disabled:!0},React.createElement(Loader,{size:16,style:{animation:"spin 0.8s linear infinite"}})),m&&!u&&React.createElement(React.Fragment,null,React.createElement("button",{onClick:G,className:"mwai-stop",disabled:a||n,"aria-label":"Stop"},React.createElement(Square,{size:16})),React.createElement("button",{onClick:K,className:Q,disabled:a||n,"aria-label":"Pause"},React.createElement(Pause,{size:16})))),U&&Y&&Y.length>0&&React.createElement("div",{className:"mwai-last-transcript"},Y),D&&React.createElement("div",{className:"mwai-statistics"},React.createElement("div",null,React.createElement("label",null,"Text In"),React.createElement("span",null,v.text_input_tokens)),React.createElement("div",null,React.createElement("label",null,"Text Out"),React.createElement("span",null,v.text_output_tokens)),React.createElement("div",null,React.createElement("label",null,"Text Cached"),React.createElement("span",null,v.text_cached_tokens)),React.createElement("div",null,React.createElement("label",null,"Audio In"),React.createElement("span",null,v.audio_input_tokens)),React.createElement("div",null,React.createElement("label",null,"Audio Out"),React.createElement("span",null,v.audio_output_tokens)),React.createElement("div",null,React.createElement("label",null,"Audio Cached"),React.createElement("span",null,v.audio_cached_tokens))),S&&React.createElement("div",{className:"mwai-options"},React.createElement(Users,{size:13,title:"Show Users",className:ee,onClick:J}),React.createElement(Captions,{size:18,title:"Show Captions",className:te,onClick:Z}),React.createElement(Bug,{size:14,title:"Show Statistics",className:ae,onClick:X})))},chatbot_ChatbotRealtime=ChatbotRealtime,{useState:ChatbotUI_useState,useMemo:ChatbotUI_useMemo,useLayoutEffect,useCallback:ChatbotUI_useCallback,useEffect:ChatbotUI_useEffect,useRef:ChatbotUI_useRef}=wp.element,markdownOptions={overrides:{a:{props:{target:"_blank"}}}},isImage=e=>e.type.startsWith("image/"),isDocument=e=>["text/x-c","text/x-csharp","text/x-c++","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/html","text/x-java","application/json","text/markdown","application/pdf","text/x-php","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/x-python","text/x-script.python","text/x-ruby","text/x-tex","text/plain","text/css","text/javascript","application/x-sh","application/typescript"].includes(e.type),ChatbotUI=e=>{const t=(0,helpers.gR)(),{style:a}=e,[n,s]=ChatbotUI_useState(!0),{state:r,actions:o}=(0,ChatbotContext.o)(),{theme:i,botId:l,customId:c,messages:u,textCompliance:d,isWindow:m,fullscreen:p,iconPosition:h,iconBubble:g,shortcuts:_,blocks:f,imageUpload:b,fileSearch:y,fileUpload:v,draggingType:w,isBlocked:R,virtualKeyboardFix:E,isRealtime:C,windowed:x,cssVariables:k,error:I,conversationRef:S,open:M,busy:A,uploadIconPosition:T,chatbotInputRef:U}=r,{resetError:N,onSubmit:D,setIsBlocked:L,setDraggingType:P,onUploadFile:O}=o,B=ChatbotUI_useMemo((()=>"css"===(null==i?void 0:i.type)?null==i?void 0:i.style:null),[i]),F=b||y||v,$=F||d,z=ChatbotUI_useRef(null),{viewportHeight:j,isIOS:W,isAndroid:H}=(0,helpers.kW)();ChatbotUI_useEffect((()=>{if(!E)return;if(!W&&!H)return;if(!m)return;const e=document.querySelector(".mwai-window");e&&(M?(e.style.height=`${j}px`,W&&(()=>{if("INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName){window.scrollTo({top:0});const e=setInterval((()=>{window.scrollTo({top:0})}),100);setTimeout((()=>{clearInterval(e)}),1e3)}})()):e.style.height="")}),[p,H,W,m,x,M,j,E]);const V=t("mwai-chatbot",{[`mwai-${null==i?void 0:i.themeId}-theme`]:!0,"mwai-window":m,"mwai-bubble":g,"mwai-open":M,"mwai-fullscreen":!x||!m&&p,"mwai-bottom-left":"bottom-left"===h,"mwai-top-right":"top-right"===h,"mwai-top-left":"top-left"===h});useLayoutEffect((()=>{n&&S.current&&(S.current.scrollTop=S.current.scrollHeight)}),[u,n,S,A]);const K=ChatbotUI_useRef(new Set);ChatbotUI_useEffect((()=>{f&&f.length>0&&f.forEach((e=>{const{type:t,data:a}=e;"content"===t&&a.script&&(e=>{const t=(e=>{let t,a,n=0;if(0===e.length)return n;for(t=0;t<e.length;t++)a=e.charCodeAt(t),n=(n<<5)-n+a,n|=0;return n})(e);if(!K.current.has(t)){const a=document.createElement("script");a.type="text/javascript",a.textContent=e,document.body.appendChild(a),K.current.add(t)}})(a.script)}))}),[f]);const q=ChatbotUI_useMemo((()=>null==u?void 0:u.map((e=>React.createElement(chatbot_ChatbotReply,{key:e.id,message:e})))),[u]),G=ChatbotUI_useMemo((()=>_&&0!==_.length?React.createElement("div",{className:"mwai-shortcuts"},_.map(((e,a)=>{const{type:n,data:s}=e,{label:r,variant:o,icon:i,className:c}=s??{};let u=t("mwai-shortcut",{"mwai-success":"success"===o,"mwai-danger":"danger"===o,"mwai-warning":"warning"===o,"mwai-info":"info"===o});c&&(u+=` ${c}`);const d=i&&i.startsWith("http"),m=i&&!d&&i.length>=1&&i.length<=2;switch(n){case"message":{const{message:e}=s,t=()=>{D(e)};return React.createElement("button",{className:u,key:a,onClick:t},(d||m)&&React.createElement(React.Fragment,null,React.createElement("div",{className:"mwai-icon"},d&&React.createElement("img",{src:i,alt:r||"AI Shortcut"}),m&&React.createElement("span",{role:"img","aria-label":"AI Shortcut"},i)),React.createElement("div",{style:{flex:"auto"}})),React.createElement("div",{className:"mwai-label"},r||"N/A"))}case"callback":{const{onClick:e}=s,t=()=>{if("function"==typeof e)e();else if("string"==typeof e){const t=e.replace(/{CHATBOT_ID}/g,l),a=new Function(`return (${t});`)();s.onClick=a,a()}else console.warn("No valid callback function provided in data.onClick.")};return React.createElement("button",{className:u,key:a,onClick:t},(d||m)&&React.createElement(React.Fragment,null,React.createElement("div",{className:"mwai-icon"},d&&React.createElement("img",{src:i,alt:r||"AI Shortcut"}),m&&React.createElement("span",{role:"img","aria-label":"AI Shortcut"},i)),React.createElement("div",{style:{flex:"auto"}})),React.createElement("div",{className:"mwai-label"},r||"N/A"))}default:return console.warn(`This shortcut type is not supported: ${n}.`),null}}))):null),[t,D,_]),J=ChatbotUI_useMemo((()=>f&&0!==f.length?React.createElement("div",{className:"mwai-blocks"},f.map(((e,a)=>{const{type:n,data:s}=e;if("content"!==n)return console.warn(`Block type ${n} is not supported.`),null;const{html:r,variant:o}=s,i=t("mwai-block",{"mwai-success":"success"===o,"mwai-danger":"danger"===o,"mwai-warning":"warning"===o,"mwai-info":"info"===o});return React.createElement("div",{className:i,key:a,dangerouslySetInnerHTML:{__html:r}})}))):null),[t,f]),X=ChatbotUI_useCallback(((e,t)=>{e.preventDefault(),e.stopPropagation();const a=e.dataTransfer.items[0];t?(z.current&&(clearTimeout(z.current),z.current=null),b&&isImage(a)?(P("image"),L(!1)):(y||v)&&isDocument(a)?(P("document"),L(!1)):(P(!1),L(!0))):z.current||(z.current=setTimeout((()=>{P(!1),L(!1),z.current=null}),100))}),[b,y,v]),Z=ChatbotUI_useCallback((e=>{if(e.preventDefault(),X(e,!1),A)return;const t=e.dataTransfer.files[0];t&&("image"===w&&b||"document"===w&&(y||v)?O(t):(L(!0),setTimeout((()=>L(!1)),2e3)))}),[A,w,b,v,y,O]),Q=t("mwai-input",{"mwai-dragging":w,"mwai-blocked":R});return React.createElement(helpers.bE,{dir:"auto",id:`mwai-chatbot-${c||l}`,className:V,style:{...k,...a},if:!0,disableTransition:!m},B&&React.createElement("style",null,B),React.createElement(chatbot_ChatbotTrigger,null),React.createElement(chatbot_ChatbotHeader,null),React.createElement("div",{className:"mwai-content"},!C&&React.createElement(React.Fragment,null,React.createElement("div",{ref:S,className:"mwai-conversation",onScroll:()=>{if(S.current){const{scrollTop:e,scrollHeight:t,clientHeight:a}=S.current;s(t-e<=a+1)}}},q,G),I&&React.createElement("div",{className:"mwai-error",onClick:()=>N()},React.createElement(index_modern,{options:markdownOptions},I)),J,React.createElement("div",{className:Q,onClick:()=>{var e;return null===(e=U.current)||void 0===e?void 0:e.focusInput()},onDrop:Z,onDragEnter:e=>X(e,!0),onDragLeave:e=>X(e,!1),onDragOver:e=>X(e,!0)},React.createElement(chatbot_ChatbotInput,null),React.createElement(chatbot_ChatbotSubmit,null))),C&&React.createElement("div",{className:"mwai-realtime"},React.createElement(chatbot_ChatbotRealtime,null)),$&&React.createElement("div",{className:"mwai-footer"},F&&React.createElement("div",{className:"mwai-tools"},"mwai-tools"===T&&React.createElement(chatbot_ChatUploadIcon,null)),d&&React.createElement("div",{className:"mwai-compliance",dangerouslySetInnerHTML:{__html:d}}))))},chatbot_ChatbotUI=ChatbotUI,ChatbotSystem=e=>React.createElement(ChatbotContext.G,e,React.createElement(chatbot_ChatbotUI,e)),chatbot_ChatbotSystem=ChatbotSystem,{useContext,createContext,useState:DiscussionsContext_useState,useMemo:DiscussionsContext_useMemo,useEffect:DiscussionsContext_useEffect,useCallback:DiscussionsContext_useCallback}=wp.element,DiscussionsContext=createContext(),useDiscussionsContext=()=>{const e=useContext(DiscussionsContext);if(!e)throw new Error("useDiscussionsContext must be used within a DiscussionsContextProvider");return e},DiscussionsContextProvider=({children:e,...t})=>{const{system:a,theme:n}=t,[s,r]=DiscussionsContext_useState([]),[o,i]=DiscussionsContext_useState(null),[l,c]=DiscussionsContext_useState(!1),u=DiscussionsContext_useMemo((()=>(null==n?void 0:n.settings)||{}),[n]),d=a.botId,m=a.customId,p=a.restNonce,h=a.pluginUrl,g=a.restUrl,_=a.debugMode,f=DiscussionsContext_useMemo((()=>Object.keys(u).reduce(((e,t)=>(e[`--mwai-${t}`]=u[t],e)),{})),[u]),b=DiscussionsContext_useMemo((()=>s.some((e=>0===e.messages.length))),[s]),y=DiscussionsContext_useCallback((async(e=!1)=>{try{e||c(!0);const t={botId:d||m};_&&console.log("[DISCUSSIONS] OUT: ",t);const a=await fetch(`${g}/mwai-ui/v1/discussions/list`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":p},body:(0,js_helpers.F1)(t)}),n=await a.json();if(!n.success)throw new Error(`Could not retrieve the discussions: ${n.message}`);_&&console.log("[DISCUSSIONS] IN: ",n);const s=n.chats.map((e=>{const t=JSON.parse(e.messages),a=JSON.parse(e.extra);return{...e,messages:t,extra:a}}));r((e=>{const t=new Map;e.forEach((e=>{t.set(e.chatId,e)})),s.forEach((e=>{t.set(e.chatId,e)}));const a=Array.from(t.values());if(o){const e=a.find((e=>e.chatId===o.chatId));e&&e!==o&&i(e)}return a}))}catch(e){console.error(e)}finally{e||c(!1)}}),[o]);DiscussionsContext_useEffect((()=>{y();const e=setInterval((()=>{y(!0)}),5e3);return()=>clearInterval(e)}),[]),DiscussionsContext_useEffect((()=>{if(o){const e=s.find((e=>e.chatId===o.chatId));e&&e!==o&&i(e)}}),[s]);const v=e=>{const t=MwaiAPI.getChatbot(e);if(!t)throw new Error("Chatbot not found.",{botId:e,chatbots:MwaiAPI.chatbots});return t},w={onDiscussionClick:async e=>{const t=s.find((t=>t.chatId===e));t?(r((t=>t.filter((t=>t.messages.length>0||t.chatId===e)))),v(d).setContext({chatId:e,messages:t.messages}),i(t)):console.error("Discussion not found.",{chatId:e,discussions:s})},onNewChatClick:async()=>{const e=s.find((e=>0===e.messages.length));if(e)return void i(e);const t=v(d),a=(0,js_helpers.vx)();t.clear({chatId:a});const n={id:a,chatId:a,messages:[],title:"New Chat",extra:{}};i(n),r((e=>[n,...e]))},onEditDiscussion:async e=>{const t=prompt("Enter a new title for the discussion:",e.title||"");if(null===t)return;const a=t.trim();if(""!==a)try{c(!0);const t={chatId:e.chatId,title:a},n=await fetch(`${g}/mwai-ui/v1/discussions/edit`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":p},body:(0,js_helpers.F1)(t)}),s=await n.json();if(!s.success)throw new Error(`Could not update the discussion: ${s.message}`);r((t=>t.map((t=>t.chatId===e.chatId?{...t,title:a}:t))))}catch(e){console.error(e),alert("An error occurred while updating the discussion.")}finally{c(!1)}else alert("Title cannot be empty.")},onDeleteDiscussion:async e=>{if(confirm("Are you sure you want to delete this discussion?"))try{c(!0);const t={chatIds:[e.chatId]},a=await fetch(`${g}/mwai-ui/v1/discussions/delete`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":p},body:(0,js_helpers.F1)(t)}),n=await a.json();if(!n.success)throw new Error(`Could not delete the discussion: ${n.message}`);r((t=>t.filter((t=>t.chatId!==e.chatId)))),(null==o?void 0:o.chatId)===e.chatId&&i(null)}catch(e){console.error(e),alert("An error occurred while deleting the discussion.")}finally{c(!1)}}},R={botId:d,pluginUrl:h,busy:l,setBusy:c,cssVariables:f,discussions:s,discussion:o,theme:n,hasEmptyDiscussion:b};return React.createElement(DiscussionsContext.Provider,{value:{state:R,actions:w}},e)},Pencil=(0,createLucideIcon.A)("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Trash=(0,createLucideIcon.A)("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]),{useMemo:DiscussionsUI_useMemo,useEffect:DiscussionsUI_useEffect,useState:DiscussionsUI_useState,useCallback:DiscussionsUI_useCallback}=wp.element,Discussion=({discussion:e,onClick:t=(()=>{}),selected:a=!1,onEdit:n=(()=>{}),onDelete:s=(()=>{})})=>{const r=(0,helpers.gR)(),[o,i]=DiscussionsUI_useState(!1),l=e.messages,c=l[l.length-1],u=DiscussionsUI_useMemo((()=>e.title?e.title:((null==c?void 0:c.content.length)>64?c.content.substring(0,64)+"...":c.content)||"No messages yet"),[e,c]),d=r("mwai-discussion",{"mwai-active":a}),m=DiscussionsUI_useCallback((t=>{t.stopPropagation(),s(e)}),[e,s]),p=DiscussionsUI_useCallback((t=>{t.stopPropagation(),n(e)}),[e,n]);return React.createElement("li",{className:d,onClick:t,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1)},React.createElement("span",{className:r("mwai-discussion-title")},u),o&&React.createElement("div",{className:r("mwai-discussion-actions")},React.createElement("div",{className:r("mwai-icon"),onClick:p},React.createElement(Pencil,{size:18})),React.createElement("div",{className:r(["mwai-icon","mwai-danger"]),onClick:m},React.createElement(Trash,{size:18}))))},DiscussionsUI=e=>{const{theme:t,style:a,params:n}=e,s=(0,helpers.gR)(),r=DiscussionsUI_useMemo((()=>"css"===(null==t?void 0:t.type)?null==t?void 0:t.style:null),[t]),{state:o,actions:i}=useDiscussionsContext(),{botId:l,cssVariables:c,discussions:u,discussion:d,busy:m,hasEmptyDiscussion:p}=o,{onDiscussionClick:h,onNewChatClick:g,onEditDiscussion:_,onDeleteDiscussion:f}=i,{textNewChat:b}=n;DiscussionsUI_useEffect((()=>{}));const y=s("mwai-discussions",{[`mwai-${null==t?void 0:t.themeId}-theme`]:!0});return React.createElement(React.Fragment,null,React.createElement("div",{id:`mwai-discussions-${l}`,className:y,style:{...c,...a}},r&&React.createElement("style",null,r),React.createElement("div",{className:s("mwai-header")},React.createElement("button",{onClick:()=>g(),disabled:m||p},React.createElement("span",null,b??"+ New chat"))),React.createElement("ul",{className:s("mwai-content")},u.map((e=>React.createElement(Discussion,{key:e.id,discussion:e,selected:(null==d?void 0:d.id)===e.id,onClick:()=>h(e.chatId),onEdit:_,onDelete:f}))))))},chatbot_DiscussionsUI=DiscussionsUI,DiscussionsSystem=e=>React.createElement(DiscussionsContextProvider,e,React.createElement(chatbot_DiscussionsUI,e)),chatbot_DiscussionsSystem=DiscussionsSystem,{render}=wp.element;function decodeHtmlEntities(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}document.addEventListener("DOMContentLoaded",(function(){function e(e,t){e.forEach((e=>{const a=JSON.parse(decodeHtmlEntities(e.getAttribute("data-params"))),n=JSON.parse(decodeHtmlEntities(e.getAttribute("data-system"))),s=JSON.parse(decodeHtmlEntities(e.getAttribute("data-theme")));e.removeAttribute("data-params"),e.removeAttribute("data-system"),e.removeAttribute("data-theme"),render(t({system:n,params:a,theme:s}),e)}))}e(document.querySelectorAll(".mwai-chatbot-container"),chatbot_ChatbotSystem),e(document.querySelectorAll(".mwai-discussions-container"),chatbot_DiscussionsSystem)}))})();