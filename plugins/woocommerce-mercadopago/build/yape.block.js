(()=>{"use strict";const e=window.React,t=window.wc.wcBlocksRegistry,n=window.wc.wcSettings,o=window.wp.element,a=window.wp.htmlEntities,s="mercadopago_blocks_update_cart",c=({description:t,linkText:n,linkSrc:o,checkoutClass:a="pro"})=>(0,e.createElement)("div",{className:`mp-checkout-${a}-terms-and-conditions`},(0,e.createElement)("terms-and-conditions",{description:t,"link-text":n,"link-src":o})),r=({title:t,description:n,linkText:o,linkSrc:a})=>(0,e.createElement)("div",{className:"mp-test-mode-container"},(0,e.createElement)("test-mode",{title:t,description:n,"link-text":o,"link-src":a})),i=({labelMessage:t,emptyErrorMessage:n,invalidErrorMessage:o})=>(0,e.createElement)("input-field",{"label-message":t,"empty-error-message":n,"invalid-error-message":o}),l=({label:t,src:n,emptyErrorMessage:o,invalidErrorMessage:a,tooltipText:s})=>(0,e.createElement)("input-code",{label:t,src:n,"empty-error-message":o,"invalid-error-message":a,"tooltip-text":s}),m=({message:t,src:n,icon:o,footerText:a})=>(0,e.createElement)("checkout-notice",{message:t,src:n,icon:o,"footer-text":a});var p;const d="mp_checkout_blocks",u="woo-mercado-pago-yape",_=(0,n.getSetting)("woo-mercado-pago-yape_data",{}),y=(0,a.decodeEntities)(_.title)||"Checkout Yape",E=t=>{(e=>{const{extensionCartUpdate:t}=wc.blocksCheckout,{eventRegistration:n,emitResponse:a}=e,{onPaymentSetup:c,onCheckoutSuccess:r,onCheckoutFail:i}=n;(0,o.useEffect)((()=>{((e,t)=>{e({namespace:s,data:{action:"add",gateway:t}})})(t,u);const e=c((()=>({type:a.responseTypes.SUCCESS})));return()=>(((e,t)=>{e({namespace:s,data:{action:"remove",gateway:t}})})(t,u),e())}),[c]),(0,o.useEffect)((()=>{const e=r((async e=>{const t=e.processingResponse;return sendMetric("MP_YAPE_BLOCKS_SUCCESS",t.paymentStatus,d),{type:a.responseTypes.SUCCESS}}));return()=>e()}),[r]),(0,o.useEffect)((()=>{const e=i((e=>{const t=e.processingResponse;return sendMetric("MP_YAPE_BLOCKS_ERROR",t.paymentStatus,d),{type:a.responseTypes.FAIL,messageContext:a.noticeContexts.PAYMENTS,message:t.paymentDetails.message}}));return()=>e()}),[i])})(t);const{test_mode:n,test_mode_title:a,test_mode_description:p,test_mode_link_text:y,test_mode_link_src:E,terms_and_conditions_description:k,terms_and_conditions_link_text:g,terms_and_conditions_link_src:h,input_field_label:w,yape_title:S,yape_subtitle:v,input_code_icon:b,checkout_notice_icon_one:f,checkout_notice_icon_two:C,checkout_notice_message:R,input_code_label:T,footer_text:x,yape_tooltip_text:M,yape_input_code_error_message1:N,yape_input_code_error_message2:P,yape_phone_number_error_message1:B,yape_phone_number_error_message2:O}=_.params,U=(0,o.useRef)(null),{eventRegistration:A,emitResponse:L}=t,{onPaymentSetup:F}=A;return window.mpFormId="blocks_checkout_form",window.mpCheckoutForm=document.querySelector(".wc-block-components-form.wc-block-checkout__form"),(0,o.useEffect)((()=>{const e=F((async()=>{const e=getCodeValue(),t=document.getElementById("checkout__yapePhoneNumber").value.replaceAll(" ","");if(""===e&&""===t)return document.getElementsByTagName("input-field")[0].validate(),document.getElementsByTagName("input-code")[0].validate(),{type:L.responseTypes.ERROR};const n={otp:e,phoneNumber:t},o={},a=new MercadoPago(wc_mercadopago_yape_checkout_params.public_key).yape(n);try{const e=await a.create();o["mercadopago_yape[token]"]=e.id}catch(e){return console.warn("Token creation error: ",e),{type:L.responseTypes.ERROR}}return{type:L.responseTypes.SUCCESS,meta:{paymentMethodData:o}}}));return()=>e()}),[F,L.responseTypes.ERROR,L.responseTypes.SUCCESS]),(0,e.createElement)("div",null,(0,e.createElement)("div",{className:"mp-checkout-custom-load"},(0,e.createElement)("div",{className:"spinner-card-form"})),(0,e.createElement)("div",{className:"mp-checkout-yape-container"},(0,e.createElement)("div",{ref:U,className:"mp-checkout-yape-content"},(0,e.createElement)("div",{className:"mp-checkout-yape-test-mode"},n?(0,e.createElement)(r,{title:a,description:p,linkText:y,linkSrc:E}):null),(0,e.createElement)("div",{className:"mp-checkout-yape-title-container"},(0,e.createElement)("h2",{className:"mp-checkout-yape-title"},S),(0,e.createElement)("p",{className:"mp-checkout-yape-subtitle"},v)),(0,e.createElement)("div",{className:"mp-checkout-yape-inputs"},(0,e.createElement)(i,{labelMessage:w,emptyErrorMessage:B,invalidErrorMessage:O}),(0,e.createElement)(l,{label:T,src:b,emptyErrorMessage:N,invalidErrorMessage:P,tooltipText:M})),(0,e.createElement)(m,{message:R,src:f,icon:C},"footerText=",x)),(0,e.createElement)("div",{className:"mp-checkout-yape-terms-and-conditions"},(0,e.createElement)(c,{description:k,linkText:g,linkSrc:h}))),(0,e.createElement)("div",{id:"mercadopago-utilities",style:{display:"none"}},(0,e.createElement)("input",{type:"hidden",id:"yapeToken",name:"mercadopago_yape[token]"})))},k={name:u,label:(0,e.createElement)((t=>{const{PaymentMethodLabel:n}=t.components,o=(0,a.decodeEntities)(_?.params?.fee_title||""),s=`${y} ${o}`;return(0,e.createElement)(n,{text:s})}),null),content:(0,e.createElement)(E,null),edit:(0,e.createElement)(E,null),canMakePayment:()=>!0,ariaLabel:y,supports:{features:null!==(p=_?.supports)&&void 0!==p?p:[]}};(0,t.registerPaymentMethod)(k)})();