"use strict";(globalThis.webpackChunk_wcAdmin_webpackJsonp=globalThis.webpackChunk_wcAdmin_webpackJsonp||[]).push([[9680],{59255:(e,c,n)=>{n.d(c,{W:()=>a});var o=n(56427),t=n(39793);const a=({size:e="medium"})=>(0,t.jsx)("div",{className:`woocommerce-field-placeholder woocommerce-field-placeholder--${e}`,children:(0,t.jsx)(o.Placeholder,{})})},32905:(e,c,n)=>{n.d(c,{w:()=>a});var o=n(56427),t=n(39793);const a=({children:e})=>(0,t.jsx)(t.Fragment,{children:e});a.Layout=({children:e})=>(0,t.jsx)("div",{className:"settings-layout",children:e}),a.Section=({title:e,description:c,children:n,id:o})=>(0,t.jsxs)("div",{className:"settings-section",id:o,children:[(0,t.jsxs)("div",{className:"settings-section__details",children:[(0,t.jsx)("h2",{children:e}),(0,t.jsx)("p",{children:c})]}),(0,t.jsx)("div",{className:"settings-section__controls",children:n})]}),a.Actions=({children:e})=>(0,t.jsx)(o.Card,{className:"settings-card__wrapper ",children:(0,t.jsx)(o.CardBody,{className:"form__actions",children:e})}),a.Form=({children:e,onSubmit:c})=>(0,t.jsx)("form",{onSubmit:c,className:"settings-form",children:e})},53490:(e,c,n)=>{n.r(c),n.d(c,{SettingsPaymentsBacs:()=>g,default:()=>k});var o=n(27723),t=n(47143),a=n(56427),s=n(86087),i=n(40314),r=n(59255),l=n(98846),m=n(51609),d=n(18537);const u=e=>{switch(e){case"AU":return(0,o.__)("BSB","woocommerce");case"CA":return(0,o.__)("Bank transit number","woocommerce");case"IN":return(0,o.__)("IFSC","woocommerce");case"IT":return(0,o.__)("Branch sort","woocommerce");case"NZ":case"SE":return(0,o.__)("Bank code","woocommerce");case"US":return(0,o.__)("Routing number","woocommerce");case"ZA":return(0,o.__)("Branch code","woocommerce");default:return(0,o.__)("Sort code","woocommerce")}},_=()=>Math.random().toString(36).substring(2,10),h=e=>""===e.trim()?"This field is required.":void 0;var b=n(39793);const x=({account:e,onClose:c,onSave:n,defaultCountry:t})=>{const s=window.wcSettings.countries,[i,r]=(0,m.useState)(e||{account_name:"",account_number:"",bank_name:"",sort_code:"",iban:"",bic:"",country_code:t}),[l,_]=(0,m.useState)(e?.country_code||t),[x,p]=(0,m.useState)({}),w=(e,c)=>{r((n=>({...n,[e]:c})))};return(0,b.jsxs)(a.Modal,{className:"bank-account-modal",title:e?(0,o.__)("Edit bank account","woocommerce"):(0,o.__)("Add a bank account","woocommerce"),onRequestClose:c,shouldCloseOnClickOutside:!1,children:[(0,b.jsx)("p",{className:"bank-account-modal__description",children:e?(0,o.__)("Edit your bank account details.","woocommerce"):(0,o.__)("Add your bank account details.","woocommerce")}),(0,b.jsx)(a.SelectControl,{className:"bank-account-modal__field is-required",label:(0,o.__)("Country","woocommerce"),required:!0,value:l,options:Object.entries(s).map((([e,c])=>({label:(0,d.decodeEntities)(c),value:e}))),onChange:e=>{_(e),w("country_code",e)}}),(0,b.jsx)(a.TextControl,{className:"bank-account-modal__field is-required",label:(0,o.__)("Account Name","woocommerce"),required:!0,value:i.account_name,onChange:e=>w("account_name",e),help:x.account_name?(0,b.jsx)("span",{className:"bank-account-modal__error",children:x.account_name}):void 0}),(0,b.jsx)(a.TextControl,{className:"bank-account-modal__field",label:(0,o.__)("Bank Name","woocommerce"),value:i.bank_name,onChange:e=>w("bank_name",e)}),(0,b.jsx)(a.TextControl,{className:"bank-account-modal__field is-required",label:(0,o.__)("Account Number","woocommerce"),required:!0,value:i.account_number,onChange:e=>w("account_number",e),help:x.account_number?(0,b.jsx)("span",{className:"bank-account-modal__error",children:x.account_number}):void 0}),(0,b.jsx)(a.TextControl,{className:"bank-account-modal__field is-required",label:u(l),required:!0,value:i.sort_code,onChange:e=>w("sort_code",e),help:x.sort_code?(0,b.jsx)("span",{className:"bank-account-modal__error",children:x.sort_code}):void 0}),(0,b.jsx)(a.TextControl,{className:"bank-account-modal__field",label:(0,o.__)("IBAN","woocommerce"),value:i.iban,onChange:e=>w("iban",e),help:x.iban?(0,b.jsx)("span",{className:"bank-account-modal__error",children:x.iban}):void 0}),(0,b.jsx)(a.TextControl,{className:"bank-account-modal__field",label:(0,o.__)("BIC / SWIFT","woocommerce"),value:i.bic,onChange:e=>w("bic",e),help:x.bic?(0,b.jsx)("span",{className:"bank-account-modal__error",children:x.bic}):void 0}),(0,b.jsxs)("div",{className:"bank-account-modal__actions",children:[(0,b.jsx)(a.Button,{variant:"tertiary",onClick:c,children:(0,o.__)("Cancel","woocommerce")}),(0,b.jsx)(a.Button,{className:"bank-account-modal__save",variant:"primary",onClick:()=>{(()=>{const e={};var c;e.account_name=h(i.account_name),e.account_number=h(i.account_number)||(c=i.account_number,/^\d+$/.test(c.trim())?void 0:"This field must be numeric."),e.sort_code=h(i.sort_code);const n=Object.fromEntries(Object.entries(e).filter((([,e])=>e)));return p(n),0===Object.keys(n).length})()&&n(i)},children:(0,o.__)("Save","woocommerce")})]})]})};var p=n(15698);const w=({accounts:e,onChange:c,defaultCountry:n})=>{const[t,s]=(0,m.useState)((()=>e.map((e=>({...e,id:_()})))));(0,m.useEffect)((()=>{e.length&&0===t.length&&s(e.map((e=>({...e,id:_()}))))}),[e,t.length]);const[i,r]=(0,m.useState)(null),[d,u]=(0,m.useState)(!1),[h,w]=(0,m.useState)(null),j=(e=null)=>{r(e),u(!0)};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(p.q6,{items:t,className:"bank-accounts__list",setItems:e=>{s(e),c(e.map((({id:e,...c})=>c)))},children:[(0,b.jsx)("div",{className:"bank-accounts__list-header",children:(0,b.jsxs)("div",{className:"bank-accounts__list-item-inner",children:[(0,b.jsx)("div",{className:"bank-accounts__list-item-before"}),(0,b.jsxs)("div",{className:"bank-accounts__list-item-text",children:[(0,b.jsx)("div",{children:"Account Name"}),(0,b.jsx)("div",{children:"Account Number"}),(0,b.jsx)("div",{children:"Bank Name"})]}),(0,b.jsx)("div",{className:"bank-accounts__list-item-after"})]})}),t.map(((e,c)=>(0,b.jsx)(p.Uq,{id:e.id,className:"bank-accounts__list-item"+(0===c?" first-item":""),children:(0,b.jsxs)("div",{className:"bank-accounts__list-item-inner",children:[(0,b.jsx)("div",{className:"bank-accounts__list-item-before",children:(0,b.jsx)(p.Gh,{})}),(0,b.jsxs)("div",{className:"bank-accounts__list-item-text",children:[(0,b.jsx)("div",{children:e.account_name}),(0,b.jsx)("div",{children:e.account_number}),(0,b.jsx)("div",{children:e.bank_name})]}),(0,b.jsx)("div",{className:"bank-accounts__list-item-after",children:(0,b.jsx)(l.EllipsisMenu,{label:(0,o.__)("Options","woocommerce"),placement:"bottom-right",renderContent:({onClose:c=()=>{}})=>(0,b.jsxs)(a.MenuGroup,{children:[(0,b.jsx)(a.MenuItem,{role:"menuitem",onClick:()=>{c(),j(e)},children:(0,o.__)("View / edit","woocommerce")}),(0,b.jsx)(a.MenuItem,{isDestructive:!0,onClick:()=>{c(),w(e)},children:(0,o.__)("Delete","woocommerce")})]})})})]})},e.id))),(0,b.jsx)("li",{className:"bank-accounts__list-item action"+(0===t.length?" first-item":""),children:(0,b.jsx)(a.Button,{variant:"secondary",onClick:()=>j(null),children:(0,o.__)("+ Add account","woocommerce")})})]}),d&&(0,b.jsx)(x,{account:i,onClose:()=>u(!1),onSave:e=>{const n=t.findIndex((e=>e.id===i?.id));let o;-1!==n?(o=[...t],o[n]={...e,id:i?.id||_()}):o=[...t,{...e,id:_()}],s(o),c(o.map((({id:e,...c})=>c))),u(!1)},defaultCountry:n}),h&&(0,b.jsxs)(a.Modal,{title:(0,o.__)("Delete account","woocommerce"),onRequestClose:()=>w(null),shouldCloseOnClickOutside:!1,children:[(0,b.jsx)("p",{children:(0,o.__)("Are you sure you want to delete this bank account?","woocommerce")}),(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"16px"},children:[(0,b.jsx)(a.Button,{variant:"secondary",onClick:()=>w(null),children:(0,o.__)("Cancel","woocommerce")}),(0,b.jsx)(a.Button,{variant:"primary",isDestructive:!0,onClick:()=>{if(!h)return;const e=t.filter((e=>e.id!==h.id));s(e),c(e.map((({id:e,...c})=>c))),w(null)},children:(0,o.__)("Delete","woocommerce")})]})]})]})};var j=n(32905);const g=()=>{const e=window.wcSettings?.admin?.preloadSettings?.general?.woocommerce_default_country||"US",{createSuccessNotice:c,createErrorNotice:n}=(0,t.useDispatch)("core/notices"),{bacsSettings:l,isLoading:m}=(0,t.useSelect)((e=>({bacsSettings:e(i.paymentGatewaysStore).getPaymentGateway("bacs"),isLoading:!e(i.paymentGatewaysStore).hasFinishedResolution("getPaymentGateway",["bacs"])})),[]),{accountsOption:d,isLoadingAccounts:u}=(0,t.useSelect)((e=>{const c=e(i.optionsStore);return{accountsOption:c.getOption("woocommerce_bacs_accounts"),isLoadingAccounts:!c.hasFinishedResolution("getOption",["woocommerce_bacs_accounts"])}}),[]),[_,h]=(0,s.useState)({}),[x,p]=(0,s.useState)(!1),[g,k]=(0,s.useState)(!1);(0,s.useEffect)((()=>{l&&(h({enabled:l.enabled,title:l.settings.title.value,description:l.description,instructions:l.settings.instructions.value}),k(!1))}),[l]);const[v,C]=(0,s.useState)([]);(0,s.useEffect)((()=>{d&&C(d)}),[d]);const{updateOptions:y}=(0,t.useDispatch)(i.optionsStore),{updatePaymentGateway:S}=(0,t.useDispatch)(i.paymentGatewaysStore);return(0,b.jsx)(j.w,{children:(0,b.jsx)(j.w.Layout,{children:(0,b.jsxs)(j.w.Form,{onSubmit:e=>{e.preventDefault(),(async()=>{if(!l)return;p(!0);const e={title:String(_.title),instructions:String(_.instructions)};try{await Promise.all([y({woocommerce_bacs_accounts:v.map((({account_name:e,account_number:c,bank_name:n,sort_code:o,iban:t,bic:a,country_code:s})=>({account_name:e,account_number:c,bank_name:n,sort_code:o,iban:t,bic:a,country_code:s})))}),S("bacs",{enabled:Boolean(_.enabled),description:String(_.description),settings:e})]),c((0,o.__)("Settings updated successfully","woocommerce"))}catch(e){n((0,o.__)("Failed to update settings","woocommerce"))}finally{p(!1),k(!1)}})()},children:[(0,b.jsxs)(j.w.Section,{title:(0,o.__)("Enable and customise","woocommerce"),description:(0,o.__)("Choose how you want to present bank transfer to your customers during checkout.","woocommerce"),children:[m?(0,b.jsx)(r.W,{size:"small"}):(0,b.jsx)(a.CheckboxControl,{label:(0,o.__)("Enable direct bank transfers","woocommerce"),checked:Boolean(_.enabled),onChange:e=>{h({..._,enabled:e}),k(!0)}}),m?(0,b.jsx)(r.W,{size:"medium"}):(0,b.jsx)(a.TextControl,{label:(0,o.__)("Title","woocommerce"),help:(0,o.__)("Payment method name that the customer will see during checkout.","woocommerce"),placeholder:(0,o.__)("Direct bank transfer payments","woocommerce"),value:String(_.title),onChange:e=>{h({..._,title:e}),k(!0)}}),m?(0,b.jsx)(r.W,{size:"large"}):(0,b.jsx)(a.TextareaControl,{label:(0,o.__)("Description","woocommerce"),help:(0,o.__)("Payment method description that the customer will see during checkout.","woocommerce"),value:String(_.description),onChange:e=>{h({..._,description:e}),k(!0)}}),m?(0,b.jsx)(r.W,{size:"large"}):(0,b.jsx)(a.TextareaControl,{label:(0,o.__)("Instructions","woocommerce"),help:(0,o.__)("Instructions that will be added to the thank you page and emails.","woocommerce"),value:String(_.instructions),onChange:e=>{h({..._,instructions:e}),k(!0)}})]}),(0,b.jsx)(j.w.Section,{title:(0,o.__)("Account details","woocommerce"),description:(0,o.__)("Configure your bank account details.","woocommerce"),children:u?(0,b.jsx)(r.W,{size:"large"}):(0,b.jsx)(w,{accounts:v,onChange:e=>{C(e),k(!0)},defaultCountry:e})}),(0,b.jsx)(j.w.Actions,{children:(0,b.jsx)(a.Button,{variant:"primary",type:"submit",isBusy:x,disabled:x||!g,children:(0,o.__)("Save changes","woocommerce")})})]})})})},k=g}}]);