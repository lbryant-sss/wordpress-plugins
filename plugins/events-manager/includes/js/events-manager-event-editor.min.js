(function(){"use strict";function TimerangesEditor(){this.init()}TimerangesEditor.prototype={init:function(){this.bindEvents()},bindEvents:function(){let self=this;document.querySelectorAll(".em-timeranges-editor").forEach(editor=>{editor.addEventListener("click",function(e){if(e.target.matches(".em-timerange-add")||e.target.closest(".em-timerange-add")){e.preventDefault();let button=e.target.matches(".em-timerange-add")?e.target:e.target.closest(".em-timerange-add");self.addTimerange(button);self.updatePreview(e.target)}});editor.addEventListener("click",function(e){if(e.target.matches(".em-timerange-delete")||e.target.closest(".em-timerange-delete")){e.preventDefault();let button=e.target.matches(".em-timerange-delete")?e.target:e.target.closest(".em-timerange-delete");let timeranges=button.closest(".em-timeranges");self.deleteTimerange(button);self.updatePreview(timeranges)}if(e.target.matches(".em-timerange-editor-edit")){self.openUnlockModal(e.target)}});editor.querySelector(".em-timeranges-editor-modal")?.addEventListener("click",function(e){if(e.target.matches("button.unlock-confirm")){self.unlockEditor(e.target)}else if(e.target.matches("button.unlock-cancel")){closeModal(e.currentTarget)}});editor.addEventListener("change",function(e){if(e.target.matches(".em-time-start, .em-time-end, .em-time-all-day")){self.validateTimeRanges(e.target);self.updatePreview(e.target)}});editor.addEventListener("change",function(e){if(e.target.matches(".em-timerange-duration, .em-timerange-buffer, .em-timerange-frequency, .em-timerange-duration-unit, .em-timerange-buffer-unit, .em-timerange-frequency-unit, .em-timerange-overlap")){self.updatePreview(e.target);if(e.target.matches(".em-timerange-duration-unit")){self.syncFrequencyUnit(e.target)}}});editor.addEventListener("input",function(e){if(e.target.matches(".em-time-start, .em-time-end")){self.updatePreview(e.target)}});editor.addEventListener("input",function(e){if(e.target.matches(".em-timerange-duration")){self.syncFrequencyWithDuration(e.target);self.updatePreview(e.target)}});editor.addEventListener("change",function(e){if(e.target.matches('.em-timerange-timeslots-trigger input[type="checkbox"]')){self.handleAdvancedToggle(e.target)}else if(e.target.matches('.em-timerange-allday input[type="checkbox"]')){self.handleAllDayToggle(e.target);self.updatePreview(e.target)}});editor.addEventListener("click",function(e){if(e.target.matches(".em-timeranges-preview-toggle")||e.target.closest(".em-timeranges-preview-toggle")){e.preventDefault();let toggle=e.target.matches(".em-timeranges-preview-toggle")?e.target:e.target.closest(".em-timeranges-preview-toggle");self.togglePreview(toggle)}});editor.querySelectorAll(".em-timerange .em-time-start").forEach(input=>{self.updatePreview(input)});if(editor.classList.contains("disabled")){let selector="input[name], .em-timeranges select, .em-timeranges button:not(.em-timerange-editor-edit), .em-timeranges-actions button";editor.querySelectorAll(selector).forEach(el=>{el.disabled=true})}})},openUnlockModal:function(button){let editor=button.closest(".em-timeranges-editor");let modal=button.closest(".em-timeranges-editor").querySelector(".em-timeranges-editor-modal");modal.editor=editor;openModal(modal);modal.addEventListener("em_modal_close",function(){editor.append(modal)},{once:true})},unlockEditor:function(button){let modal=button.closest(".em-timeranges-editor-modal");modal.editor.classList.remove("disabled");modal.editor.querySelectorAll("[disabled]").forEach(el=>{el.disabled=false});let timeranges=modal.editor.querySelector(".em-timeranges");timeranges.insertBefore(modal.querySelector(".timeranges-edit-action"),timeranges.firstElementChild.nextSibling);let nonce=modal.editor.querySelector(".em-timeranges-editor-nonce");if(nonce){nonce.value=nonce.dataset.nonce}else{alert("ERROR: No nonce found for timeranges edit, editing not possible and your changes will not be saved. Contact an administrator about this.")}closeModal(modal)},addTimerange:function(button){let container=button.closest(".em-timeranges-editor").querySelector(".em-timeranges");let template=container.querySelector("template");let currentIndex=parseInt(container.dataset.index||"0",10);let newIndex=currentIndex+1;if(template){let templateHtml=template.innerHTML;let newTimerangeHtml=templateHtml.replace(/\[X\]/g,`[${newIndex}]`);let tempDiv=document.createElement("div");tempDiv.innerHTML=newTimerangeHtml;let newTimerange=tempDiv.firstElementChild;template.before(newTimerange);em_setup_ui_elements(newTimerange);let durationInput=newTimerange.querySelector(".em-timerange-duration");if(durationInput){this.syncFrequencyWithDuration(durationInput)}container.querySelectorAll('.em-timerange-allday input[type="checkbox"]').forEach(checkbox=>{if(checkbox.checked){checkbox.click()}});container.dataset.index=newIndex;container.dataset.count=container.querySelectorAll("& > .em-timerange").length;let startInput=newTimerange.querySelector(".em-time-start");if(startInput){this.updatePreview(startInput)}let event=new CustomEvent("timerange:added",{detail:{timerange:newTimerange,index:newIndex}});container.dispatchEvent(event)}},deleteTimerange:function(button){let container=button.closest(".em-timeranges-editor").querySelector(".em-timeranges");let currentCount=container.querySelectorAll("& > .em-timerange").length;let timerange=button.closest(".em-timerange");if(currentCount>1){let nonce=timerange.querySelector(".em-timerange-delete-nonce");if(nonce){nonce.value=nonce.dataset.nonce;container.append(nonce)}timerange.remove();currentCount--;container.dataset.count=container.querySelectorAll("& > .em-timerange").length;let event=new CustomEvent("em_timerange:deleted",{detail:{count:currentCount}});container.dispatchEvent(event)}},handleAdvancedToggle:function(advancedCheckbox){let timerange=advancedCheckbox.closest(".em-timerange");if(advancedCheckbox.checked){timerange.querySelectorAll('.em-timerange-timeslots input[type="text"]').forEach(input=>{input.value="";input.setAttribute("placeholder","0")});let allDayCheckbox=timerange.querySelector('.em-timerange-allday input[type="checkbox"]');if(allDayCheckbox&&allDayCheckbox.checked){allDayCheckbox.checked=false;allDayCheckbox.dispatchEvent(new Event("change",{bubbles:true}))}}else{timerange.querySelectorAll('.em-timerange-timeslots input[type="text"]').forEach(input=>{input.value="";input.setAttribute("placeholder","0")});this.updatePreview(advancedCheckbox)}},handleAllDayToggle:function(allDayCheckbox){if(allDayCheckbox.checked){let timerange=allDayCheckbox.closest(".em-timerange");timerange.querySelectorAll('.em-timerange-timeslots input[type="text"]').forEach(input=>{input.value="";input.setAttribute("placeholder","0")});let advancedCheckbox=timerange.querySelector('.em-timerange-timeslots-trigger input[type="checkbox"]');if(advancedCheckbox&&advancedCheckbox.checked){advancedCheckbox.checked=false;advancedCheckbox.dispatchEvent(new Event("change",{bubbles:true}))}}},validateTimeRanges:function(changedInput){let container=changedInput.closest(".em-timeranges");if(!container)return;let allTimeranges=container.querySelectorAll(".em-timerange");let hasErrors=false;allTimeranges.forEach(timerange=>{timerange.querySelectorAll(".em-time-start, .em-time-end").forEach(input=>{input.classList.remove("error")})});let timeRanges=[];allTimeranges.forEach((timerange,index)=>{let startInput=timerange.querySelector(".em-time-start");let endInput=timerange.querySelector(".em-time-end");if(startInput&&endInput&&startInput.value&&endInput.value){timeRanges.push({index:index,start:this.timeToMinutes(startInput.value),end:this.timeToMinutes(endInput.value),startInput:startInput,endInput:endInput})}});for(let i=0;i<timeRanges.length;i++){for(let j=i+1;j<timeRanges.length;j++){let range1=timeRanges[i];let range2=timeRanges[j];if(this.rangesOverlap(range1,range2)){range1.startInput.classList.add("error");range1.endInput.classList.add("error");range2.startInput.classList.add("error");range2.endInput.classList.add("error");hasErrors=true}}}return!hasErrors},timeToMinutes:function(timeString){if(!timeString)return 0;let parts=timeString.toLowerCase().replace(/\s/g,"").match(/^(\d{1,2}):?(\d{2})?\s*(am|pm)?$/);if(!parts)return 0;let hours=parseInt(parts[1]);let minutes=parseInt(parts[2]||0);let ampm=parts[3];if(ampm==="pm"&&hours!==12)hours+=12;if(ampm==="am"&&hours===12)hours=0;return hours*60+minutes},rangesOverlap:function(range1,range2){let start1=range1.start;let end1=range1.end;let start2=range2.start;let end2=range2.end;if(end1<start1)end1+=24*60;if(end2<start2)end2+=24*60;return start1<end2&&start2<end1},syncFrequencyWithDuration:function(durationInput){let timerange=durationInput.closest(".em-timerange");if(timerange){let frequencyInput=timerange.querySelector(".em-timerange-frequency");if(frequencyInput){frequencyInput.placeholder=durationInput.value||"0"}}},syncFrequencyUnit:function(durationUnitSelect){let frequencyUnitSelect=durationUnitSelect.closest(".em-timerange")?.querySelector(".em-timerange-frequency-unit");if(frequencyUnitSelect&&!frequencyUnitSelect.previousElementSibling?.value){frequencyUnitSelect.value=durationUnitSelect.value}},updatePreview:function(changedInput){let editor=changedInput.closest(".em-timeranges-editor");let previewDiv=editor.querySelector(".em-timeranges-preview");let previewContent=previewDiv.querySelector(".em-timeranges-preview-content");if(!previewContent)return;let timeranges=editor.querySelector(".em-timeranges");let allTimeranges=timeranges.querySelectorAll(".em-timerange");let allGeneratedTimes=[];let earliestTime=null;let latestTime=null;let latestTimeFormatted=null;let earliestTimeFormatted=null;let allDay=false;allTimeranges.forEach(timerange=>{let startInput=timerange.querySelector(".em-time-start");let endInput=timerange.querySelector(".em-time-end");let duration=this.getTimeValue(timerange,"duration");let buffer=this.getTimeValue(timerange,"buffer");let frequency=this.getTimeValue(timerange,"frequency");if(startInput.value){let startMinutes=this.timeToMinutes(startInput.value);if(earliestTime===null||startMinutes<earliestTime){earliestTime=startMinutes;earliestTimeFormatted=startInput.value;startInput.classList.add("earliest-time")}else{startInput.classList.remove("earliest-time")}}if(endInput.value){let endMinutes=this.timeToMinutes(endInput.value);if(latestTime===null||endMinutes>latestTime){latestTime=endMinutes;latestTimeFormatted=endInput.value;endInput.classList.add("latest-time")}else{endInput.classList.remove("latest-time")}}if(timerange.querySelector('.em-timerange-allday input[type="checkbox"]')?.checked){allDay=true}if(duration||frequency){let times=this.generateTimeranges(startInput.value,endInput.value,duration,buffer,frequency);allGeneratedTimes.push(...times)}else{let startMinutes=this.timeToMinutes(startInput.value);allGeneratedTimes.push(startMinutes)}});let uniqueTimes=[...new Set(allGeneratedTimes)];uniqueTimes.sort((a,b)=>a-b);uniqueTimes=uniqueTimes.map(time=>this.formatTimeRange(time));timeranges.dataset.start=earliestTimeFormatted;timeranges.dataset.end=latestTimeFormatted;timeranges.dataset.allday=allDay?1:0;previewDiv.classList.toggle("hidden",uniqueTimes.length===0||uniqueTimes.length===1&&allTimeranges.length===1);previewContent.innerHTML=uniqueTimes.join("");previewDiv.querySelector(".em-timeranges-preview-count").textContent=uniqueTimes.length},formatSingleTime:function(timeString){if(!timeString)return"";let minutes=this.timeToMinutes(timeString);let hours=Math.floor(minutes/60);let mins=minutes%60;let ampm=hours>=12?"PM":"AM";let displayHours=hours>12?hours-12:hours===0?12:hours;return`${displayHours}:${mins.toString().padStart(2,"0")} ${ampm}`},getTimeValue:function(timerange,type){let qtyInput=timerange.querySelector(`.em-timerange-${type}`);let unitSelect=timerange.querySelector(`.em-timerange-${type}-unit`);if(!qtyInput||!unitSelect||!qtyInput.value)return 0;let qty=parseInt(qtyInput.value);let unit=unitSelect.value;switch(unit){case"H":return qty*60;case"I":return qty;case"S":return Math.round(qty/60);default:return qty}},generateTimeranges:function(startTime,endTime,duration,buffer,frequency){let startMinutes=this.timeToMinutes(startTime);let endMinutes=this.timeToMinutes(endTime);let slots=[];if(endMinutes>=startMinutes){let currentStart=startMinutes;if(currentStart===endMinutes){slots.push(currentStart)}else{let interval=frequency>0?frequency:duration+(buffer||0);for(let i=0;currentStart<=endMinutes;i++){slots.push(currentStart);currentStart+=interval}}}return slots},formatTimeRange:function(startMinutes,endMinutes=null){let formatTime=minutes=>{minutes=minutes%(24*60);if(minutes<0)minutes+=24*60;let hours=Math.floor(minutes/60);let mins=minutes%60;let ampm=hours>=12?"PM":"AM";let displayHours=hours>12?hours-12:hours===0?12:hours;return`${displayHours}:${mins.toString().padStart(2,"0")} ${ampm}`};let result=`<span class="em-timeranges-preview-time">${formatTime(startMinutes)}`;if(endMinutes){result+=` - ${formatTime(endMinutes)}`}result+="</span>";return result},togglePreview:function(toggle){let previewDiv=toggle.closest(".em-timeranges-preview");let previewContent=previewDiv.querySelector(".em-timeranges-preview-content");let chevron=toggle.querySelector(".em-icon-chevron-down, .em-icon-chevron-up");if(previewContent.classList.contains("hidden")){previewContent.classList.remove("hidden");if(chevron)chevron.className=chevron.className.replace("chevron-down","chevron-up");let container=toggle.closest(".em-timeranges-editor");if(container){let anyInput=container.querySelector(".em-timerange .em-time-start");if(anyInput){this.updatePreview(anyInput)}}}else{previewContent.classList.add("hidden");if(chevron)chevron.className=chevron.className.replace("chevron-up","chevron-down")}}};document.addEventListener("em_event_editor_ready",()=>{window.EM_TimerangesEditor=new TimerangesEditor})})();document.addEventListener("em_event_editor_ready",function(){document.querySelectorAll(".em-recurrence-sets").forEach(function(recurrenceSets){recurrenceSets.querySelector('.em-recurrence-set[data-type="include"]:first-child').dataset.primary="1";document.dispatchEvent(new CustomEvent("em_event_editor_recurrences",{detail:{recurrenceSets:recurrenceSets}}))});document.querySelectorAll('select[name="event_active_status"]').forEach(select=>{select.addEventListener("change",function(event){if(select.value==="0"&&!confirm(EM.event_cancellations.warning.replace(/\\n/g,"\n"))){event.preventDefault()}})});document.querySelectorAll(".event_type").forEach(eventType=>{const form=eventType.closest("form");eventType.addEventListener("change",function(){if(handleRecurring()){let eventDateTimes=form.querySelector(".event-form-when");let eventDatePicker=eventDateTimes.querySelector(".em-datepicker.em-event-dates");let selectedDates;if(eventDatePicker.classList.contains("em-datepicker-until")){selectedDates=[eventDatePicker.querySelector(".em-date-input-start.flatpickr-input")._flatpickr.selectedDates[0],eventDatePicker.querySelector(".em-date-input-end.flatpickr-input")._flatpickr.selectedDates[0]]}else{selectedDates=eventDatePicker.querySelector(".em-date-input.flatpickr-input")._flatpickr.selectedDates}let eventTimeRange=eventDateTimes.querySelector(".event-times.em-time-range");let eventStartTime=eventTimeRange.querySelector(".em-time-input.em-time-start");let eventEndTime=eventTimeRange.querySelector(".em-time-input.em-time-end");let eventAllDay=eventTimeRange.querySelector("input.em-time-all-day");let timezone=eventDateTimes.querySelector("select.event_timezone")?.value;let eventStatus=eventDateTimes.querySelector("select.event_active_status")?.value;let setDateTimes=false;let recurrenceSet=form.querySelector('.em-recurrence-set[data-primary="1"]');if(recurrenceSet){let timeRange=recurrenceSet.querySelector(".em-recurrence-advanced .em-time-range");if(timeRange){let recurrenceStartTime=timeRange.querySelector(".em-time-input.em-time-start");let recurrenceEndTime=timeRange.querySelector(".em-time-input.em-time-end");let recurrenceAllDay=timeRange.querySelector(".em-time-all-day");if(recurrenceStartTime){recurrenceStartTime.value=eventStartTime?.value}if(recurrenceEndTime){recurrenceEndTime.value=eventEndTime?.value}if(recurrenceAllDay){recurrenceAllDay.checked=eventAllDay?.checked}}if(recurrenceSet.querySelector("select.recurrence_freq")?.value==="on"){let recurrenceDatePicker=recurrenceSet.querySelector(".em-on-selector .em-date-input.flatpickr-input")?._flatpickr;if(!recurrenceDatePicker?.selectedDates){recurrenceDatePicker?.setDate(selectedDates,true);setDateTimes=true}}else{recurrenceSet.querySelectorAll(".em-recurrence-advanced .em-datepicker .em-date-input.flatpickr-input").forEach(input=>{if(!input._flatpickr?.selectedDates.length){if(input.closest(".em-datepicker-until")){input._flatpickr.setDate(input.classList.contains("em-date-input-start")?selectedDates[0]:selectedDates[1],true);setDateTimes=true}else if(input.closest(".em-datepicker-range")){input._flatpickr.setDate(selectedDates,true);setDateTimes=true}}})}["select.recurrence_timezone","select.recurrence_status"].forEach(selector=>{let select=recurrenceSet.querySelector(selector);let value=selector==="select.recurrence_timezone"?timezone:eventStatus;if(value&&select){if(select.selectize){select.selectize.setValue(value,true)}else{select.value=value}}});if(!setDateTimes){recurrenceSet.closest(".em-recurrence-sets").dispatchEvent(new CustomEvent("setDateTimes"))}}}});let handleRecurring=function(){let isRecurring=false;if(form){isRecurring=eventType.type==="checkbox"?eventType.checked:eventType.value!=="single";form.classList.toggle("em-is-recurring",isRecurring);if(eventType.type==="checkbox"){form.classList.toggle("em-type-recurring",eventType.checked)}form.classList.remove(...[...form.classList].filter(className=>className.startsWith("em-type-")));form.classList.add("em-type-"+eventType.value)}return isRecurring};handleRecurring()});document.querySelectorAll(".em-convert-recurrence-link").forEach(link=>{link.addEventListener("click",function(e){if(!confirm(EM.convert_recurring_warning)){e.preventDefault();return false}let nonce=this.getAttribute("data-nonce");if(nonce){this.href=this.href.replace("nonce=x","nonce="+nonce)}})});document.dispatchEvent(new CustomEvent("em_event_editor_loaded"))});document.addEventListener("em_event_editor_recurrences",function(e){let recurrenceSets=e.detail.recurrenceSets;let updateRecurrenceSummary=recurrenceSet=>recurrenceSet.dispatchEvent(new CustomEvent("updateRecurrenceSummary",{bubbles:true}));let updateSetsCount=()=>recurrenceSets.dispatchEvent(new CustomEvent("updateSetsCount"));let updateRecurrenceOrder=()=>recurrenceSets.dispatchEvent(new CustomEvent("updateRecurrenceOrder"));let addRecurrence=function(recurrenceType){let recurrenceTypeSets=recurrenceSets.querySelector(".em-recurrence-type-"+recurrenceType+" .em-recurrence-type-sets");let index=recurrenceTypeSets.querySelectorAll(".em-recurrence-set").length+1;let recurrenceSet=recurrenceSets.querySelector(".em-recurrence-set-template").cloneNode(true);recurrenceSet.classList.remove("em-recurrence-set-template","hidden");recurrenceSet.classList.add("em-recurrence-set","new-recurrence-set");recurrenceSet.querySelector(".em-recurrence-set-type").value=recurrenceType;recurrenceSet.dataset.type=recurrenceType;recurrenceSet.dataset.index=index;recurrenceSet.innerHTML=recurrenceSet.innerHTML.replace(/T%/g,`${recurrenceType}`);recurrenceSet.innerHTML=recurrenceSet.innerHTML.replace(/N%/g,`${index}`);if(recurrenceType==="exclude"){recurrenceSet.querySelectorAll(".em-recurrence-advanced .only-include-type").forEach(el=>el.remove())}if(recurrenceType==="include"){recurrenceSet.querySelectorAll(".em-recurrence-advanced .only-exclude-type").forEach(el=>el.remove())}let result={recurrenceSet:recurrenceSet,index:index,success:true};recurrenceTypeSets.dispatchEvent(new CustomEvent("beforeAddRecurrence",{detail:result}));if(result.success){recurrenceTypeSets.append(recurrenceSet);em_setup_ui_elements(recurrenceSet);updateSetsCount();emRecurrenceEditor.updateIntervalDescriptor(recurrenceSet);emRecurrenceEditor.updateIntervalSelectors(recurrenceSet);emRecurrenceEditor.updateDurationDescriptor(recurrenceSet);updateRecurrenceSummary(recurrenceSet)}return recurrenceSet};recurrenceSets.querySelectorAll('.em-add-recurrence-set[data-type="include"]').forEach(function(addButton){addButton.addEventListener("click",()=>addRecurrence("include"))});recurrenceSets.querySelectorAll(".em-recurrence-type").forEach(function(recurrenceSetsType){recurrenceSetsType.addEventListener("addRecurrence",function(e){e.detail.recurrenceSet=addRecurrence(recurrenceSetsType.dataset.type)})});recurrenceSets.addEventListener("click",function(e){if(e.target.matches(".em-recurrence-set-action-remove")){let removeButton=e.target;e.preventDefault();let recurrenceSet=removeButton.closest(".em-recurrence-set");let setId=recurrenceSet.querySelector("input.em-recurrence-set-id");let deleteField=recurrenceSet.querySelector("input.em-recurrence-set-delete-field");if(setId&&deleteField){deleteField.value=deleteField.getAttribute("data-nonce");recurrenceSets.appendChild(deleteField);recurrenceSets.appendChild(setId)}recurrenceSet.remove();updateSetsCount();updateRecurrenceOrder()}})});document.addEventListener("em_event_editor_recurrences",function(e){let recurrenceSets=e.detail.recurrenceSets;recurrenceSets.querySelectorAll(".em-recurrence-type-sets").forEach(function(recurrenceTypeSets){let draggedElem=null;let placeholder=null;let offsetX=0,offsetY=0;let originalParent=null,originalNextSibling=null;recurrenceTypeSets.addEventListener("mousedown",function(e){recurrenceTypeSets.querySelectorAll(".em-recurrence-set:not(:first-child)").forEach(recurrenceSet=>recurrenceSet.classList.add("reordering"));const handle=e.target.closest(".em-recurrence-set-action-order");if(!handle)return;const set=handle.closest(".em-recurrence-set");if(!set)return;e.preventDefault();originalParent=set.parentNode;originalNextSibling=set.nextSibling;const rect=set.getBoundingClientRect();offsetX=e.pageX-(rect.left+window.pageXOffset);offsetY=e.pageY-(rect.top+window.pageYOffset);draggedElem=document.createElement("div");draggedElem.classList.add("em","em-recurrence-sets");draggedElem.append(set);placeholder=document.createElement("div");placeholder.classList.add("drop-placeholder");placeholder.style.height=rect.height+"px";placeholder.style.width=rect.width+"px";originalParent.insertBefore(placeholder,originalNextSibling);document.body.appendChild(draggedElem);draggedElem.style.position="absolute";draggedElem.style.width="100%";draggedElem.style.left=rect.left+window.pageXOffset+"px";draggedElem.style.top=rect.top+window.pageYOffset+"px";draggedElem.style.zIndex="1000";document.addEventListener("mousemove",onMouseMove);document.addEventListener("mouseup",onMouseUp)});function onMouseMove(e){if(!draggedElem)return;draggedElem.style.left=e.pageX-offsetX+"px";draggedElem.style.top=e.pageY-offsetY+"px";let sets=Array.from(recurrenceTypeSets.querySelectorAll(".em-recurrence-set"));let inserted=false;for(let set of sets){let rect=set.getBoundingClientRect();let setTop=rect.top+window.pageYOffset;if(e.pageY<setTop+rect.height/2){recurrenceTypeSets.insertBefore(placeholder,set);inserted=true;break}}if(!inserted){recurrenceTypeSets.appendChild(placeholder)}}function onMouseUp(e){document.removeEventListener("mousemove",onMouseMove);document.removeEventListener("mouseup",onMouseUp);recurrenceTypeSets.insertBefore(draggedElem.firstElementChild,placeholder);draggedElem.remove();placeholder.remove();placeholder=null;draggedElem=null;recurrenceTypeSets.querySelectorAll(".em-recurrence-set").forEach(function(recurrenceSet){if(recurrenceSet.matches(":first-child")){recurrenceSet.dataset.primary="1";recurrenceSet.querySelectorAll(".em-time-all-day").forEach(el=>{el.indeterminate=false})}else{delete recurrenceSet.dataset.primary}recurrenceSet.classList.remove("reordering")});recurrenceSets.dispatchEvent(new CustomEvent("updateRecurrenceOrder"))}})});document.addEventListener("em_event_editor_recurrences",function(e){let recurrenceSets=e.detail.recurrenceSets;let recurrenceExcludeSets=recurrenceSets.querySelector(".em-recurrence-type-exclude");let recurrenceExcludeModal=recurrenceExcludeSets.querySelector("& > .em-recurrence-set-reshedule-modal");let rescheduleExcludeAction=recurrenceExcludeModal.querySelector(".recurrence-reschedule-action");recurrenceSets.querySelectorAll("button.undo").forEach(function(button){button.addEventListener("click",()=>{button.closest(".em-recurrence-set, .em-recurrence-type, .em-recurrence-sets")?.dispatchEvent(new CustomEvent("undo",{detail:{button:button},bubbles:true}))})});recurrenceSets.addEventListener("undo",function(e){e.stopPropagation();let recurrences;if(e.target.matches(".em-recurrence-set")){recurrences=[e.target]}else if(e.target.matches(".em-recurrence-type")){recurrences=e.target.querySelectorAll(".em-recurrence-set")}else{recurrences=recurrenceSets.querySelectorAll(".em-recurrence-set")}recurrences.forEach(function(recurrenceSet){recurrenceSet.querySelectorAll('[data-undo]:not([type="checkbox"]):not(.selectized)').forEach(input=>{input.value=input.dataset.undo;input.readonly=false;input.disabled=false;if(input.classList.contains("em-recurrence-frequency")){input.dispatchEvent(new Event("change",{bubbles:false}))}});recurrenceSet.querySelectorAll('input[data-undo][type="checkbox"]').forEach(input=>{input.checked=input.dataset.undo==="1"});recurrenceSet.querySelectorAll(".em-datepicker").forEach(function(datePicker){if(datePicker.closest(".reschedulable")){datePicker.querySelectorAll("input.em-date-input").forEach(el=>{el.disabled=true;el.value=""});datePicker.querySelectorAll(".em-date-input.disabled, .em-datepicker-dates").forEach(el=>{el.classList.add("disabled")})}});em_setup_datepicker_dates(recurrenceSet);recurrenceSet.querySelectorAll("select.em-selectize.selectized").forEach(el=>{if(el.dataset.undo!==undefined){el.selectize?.setValue(el.dataset.undo.split(","))}if(el.closest(".reschedulable")){el.selectize?.disable()}});let timeRangeEditor=recurrenceSet.querySelector(".em-recurrence-timeranges");if(timeRangeEditor){timeRangeEditor.querySelector(".recurrence-timeranges-editor").innerHTML=timeRangeEditor.querySelector(".recurrence-timeranges-undo").innerHTML}recurrenceSet.querySelectorAll(".reschedulable [name]:not(.selectized), .reschedulable button").forEach(input=>{input.disabled=true});recurrenceSet.querySelector('input[type="hidden"][data-nonce]').disabled=true;recurrenceSet.querySelectorAll(".reschedule-trigger").forEach(button=>{button.disabled=false});delete recurrenceSet.dataset.rescheduled;recurrenceSet.classList.remove("advanced-modified","advanced-modified-dates");emRecurrenceEditor.updateIntervalDescriptor(recurrenceSet);emRecurrenceEditor.updateIntervalSelectors(recurrenceSet);emRecurrenceEditor.updateDurationDescriptor(recurrenceSet)});if(e.target.matches(".em-recurrence-type-exclude")){recurrenceExcludeSets.querySelectorAll(".em-recurrence-set.new-recurrence-set").forEach(recurrenceSet=>recurrenceSet.querySelector(".em-recurrence-set-action-remove")?.click());recurrenceExcludeModal.querySelector(".em-modal-content")?.append(rescheduleExcludeAction);rescheduleExcludeAction.querySelector("[data-nonce]").disabled=true}else if(e.target.matches('.em-recurrence-set[data-type="exclude"]')){if(e.target.closest(".em-recurrence-type-exclude").querySelectorAll(".em-recurrence-set[data-rescheduled]").length===0){recurrenceExcludeModal.querySelector(".em-modal-content")?.append(rescheduleExcludeAction)}}recurrenceSets.dispatchEvent(new CustomEvent("updateSetsCount"));recurrenceSets.dispatchEvent(new CustomEvent("setAdvancedDefaults",{bubbles:true}))});recurrenceSets.querySelectorAll(".em-recurrence-set").forEach(function(recurrenceSet){delete recurrenceSet.dataset.rescheduled;let modal=recurrenceSet.dataset.type==="exclude"?recurrenceExcludeModal:recurrenceSet.querySelector(".em-recurrence-set-reshedule-modal");recurrenceSet.querySelectorAll("button.reschedule-trigger").forEach(function(button){button.addEventListener("click",function(e){if(recurrenceSet.dataset.rescheduled!==undefined){unlockReschedule(button)}else{modal.rescheduleButton=button;modal.classList.toggle("primary-recurrence",recurrenceSet.dataset.primary);openModal(modal)}})});if(recurrenceSet.dataset.type==="include"){modal.addEventListener("em_modal_close",function(){recurrenceSet.append(modal);delete modal.rescheduleButton});modal.querySelector("button.reschedule-cancel")?.addEventListener("click",()=>closeModal(modal));modal.querySelector("button.reschedule-confirm")?.addEventListener("click",function(e){unlockReschedule(modal.rescheduleButton);recurrenceSet.querySelector(".em-recurrence-pattern")?.prepend(modal.querySelector(".recurrence-reschedule-action"));recurrenceSet.dataset.rescheduled="1";closeModal(modal)});recurrenceSet.addEventListener("undo",function(){modal.querySelector(".em-modal-content")?.append(recurrenceSet.querySelector(".recurrence-reschedule-action"))})}});let unlockReschedule=function(rescheduleButton){let reschedulable=rescheduleButton.closest(".reschedulable");reschedulable.querySelectorAll("[disabled]").forEach(el=>{el.disabled=false});reschedulable.querySelectorAll(".disabled").forEach(el=>{el.classList.remove("disabled")});reschedulable.querySelectorAll(".em-datepicker-data input").forEach(input=>{input.dataset.undo=input.value});reschedulable.querySelectorAll("select.em-selectize.selectized").forEach(function(el){el.selectize?.enable();let days=el.selectize?.getValue();if(days){el.dataset.undo=days.join()}});reschedulable.closest(".em-recurrence-set").querySelector(rescheduleButton.dataset.nonce).disabled=false;reschedulable.querySelectorAll(".reschedule-trigger").forEach(button=>{button.disabled=true})};recurrenceSets.querySelectorAll('.em-add-recurrence-set[data-type="exclude"]').forEach(function(addButton){addButton.addEventListener("click",function(e){if(recurrenceExcludeSets.querySelectorAll("[data-rescheduled]").length>0||!recurrenceSets.dataset.event_id){addButton.closest(".em-recurrence-type-exclude")?.dispatchEvent(new CustomEvent("addRecurrence",{bubbles:true}))}else{openModal(recurrenceExcludeModal)}})});recurrenceExcludeModal.addEventListener("em_modal_close",function(){recurrenceExcludeSets.append(recurrenceExcludeModal);delete recurrenceExcludeModal.rescheduleButton});recurrenceExcludeModal.querySelector("button.reschedule-cancel")?.addEventListener("click",()=>closeModal(recurrenceExcludeModal));recurrenceExcludeModal.querySelector("button.reschedule-confirm")?.addEventListener("click",function(e){let recurrenceSet;if(recurrenceExcludeModal.rescheduleButton){unlockReschedule(recurrenceExcludeModal.rescheduleButton);recurrenceSet=recurrenceExcludeModal.rescheduleButton.closest(".em-recurrence-set")}else{let recurrenceTypeSets=recurrenceSets.querySelector(".em-recurrence-type-exclude");recurrenceTypeSets?.dispatchEvent(new CustomEvent("addRecurrence",{bubbles:true}));recurrenceSet=recurrenceTypeSets?.querySelector(".em-recurrence-set:last-child")}if(recurrenceSet){recurrenceSet.dataset.rescheduled="1"}recurrenceExcludeSets.firstElementChild.after(rescheduleExcludeAction);rescheduleExcludeAction.querySelector("[data-nonce]").disabled=false;closeModal(recurrenceExcludeModal)});recurrenceSets.addEventListener("updateSetsCount",function(){if(recurrenceExcludeSets.dataset.count==="0"){recurrenceExcludeModal.querySelector(".em-modal-content")?.append(rescheduleExcludeAction)}})});document.addEventListener("em_event_editor_recurrences",function(e){let recurrenceSets=e.detail.recurrenceSets;document.addEventListener("em_luxon_ready",function(){recurrenceSets.addEventListener("setDateTimes",function(){let eventDateTimes=recurrenceSets.closest("form").querySelector(".event-form-when");if(eventDateTimes){let startDateTime;let endDateTime;let eventDatePicker=eventDateTimes.querySelector(".em-datepicker.em-event-dates");let eventTimeRange=eventDateTimes.querySelector(".em-timeranges");let $eventStartTime=jQuery(eventTimeRange.querySelector(".em-time-input.em-time-start"));let $eventEndTime=jQuery(eventTimeRange.querySelector(".em-time-input.em-time-end"));let DateTime=luxon.DateTime;let timezone=recurrenceSets.querySelector('.em-recurrence-set[data-primary="1"] select.recurrence_timezone')?.value;timezone=timezone?.replace(/\.5/g,":30")||timezone;let defaultStartTimeSeconds,defaultEndTimeSeconds;let defaultStartDate,defaultEndDate;let allRecurrencesAllDay=true;let uniqueTimezones=new Set;recurrenceSets.querySelectorAll(".em-recurrence-type-include .em-recurrence-set").forEach(recurrenceSet=>{let recurrenceTimezone=recurrenceSet.querySelector(".em-recurrence-timezone select")?.value||timezone;recurrenceTimezone=recurrenceTimezone?.replace(/\.5/g,":30")||recurrenceTimezone;if(recurrenceTimezone){uniqueTimezones.add(recurrenceTimezone)}let recurrenceStart;let recurrenceEnd;if(recurrenceSet.querySelector("select.recurrence_freq")?.value==="on"){let selectedDates=recurrenceSet.querySelector(".em-on-selector .em-date-input")?._flatpickr?.selectedDates;if(selectedDates){selectedDates.sort(function(a,b){return a-b});recurrenceStart=DateTime.fromJSDate(selectedDates[0]);recurrenceEnd=DateTime.fromJSDate(selectedDates[selectedDates.length-1])}}else{recurrenceSet.querySelectorAll(".em-recurrence-advanced .em-datepicker .em-date-input.flatpickr-input").forEach(input=>{if(input._flatpickr?.selectedDates.length){if(input.closest(".em-datepicker-until")){if(input.classList.contains("em-date-input-start")){recurrenceStart=DateTime.fromJSDate(input._flatpickr.selectedDates[0])}else if(input.classList.contains("em-date-input-end")){recurrenceEnd=DateTime.fromJSDate(input._flatpickr.selectedDates[0])}}else if(input.closest(".em-datepicker-range")){recurrenceStart=DateTime.fromJSDate(input._flatpickr.selectedDates[0]);if(input._flatpickr.selectedDates.length>=2){recurrenceEnd=DateTime.fromJSDate(input._flatpickr.selectedDates[1])}else{recurrenceEnd=recurrenceStart}}defaultStartDate??=recurrenceStart;defaultEndDate??=recurrenceEnd}})}recurrenceStart??=defaultStartDate;recurrenceEnd??=defaultEndDate||defaultStartDate;recurrenceStart=recurrenceStart?.setZone(recurrenceTimezone,{keepLocalTime:true});recurrenceEnd=recurrenceEnd?.setZone(recurrenceTimezone,{keepLocalTime:true});if(recurrenceStart&&recurrenceEnd){let timeRange=recurrenceSet.querySelector(".em-timeranges");if(timeRange&&(recurrenceSet.dataset.primary||recurrenceSet.querySelector(".recurrences-timeranges-default-trigger")?.checked)){let $recurrenceStartTime=jQuery(timeRange.querySelector(".em-time-input.earliest-time"));let $recurrenceEndTime=jQuery(timeRange.querySelector(".em-time-input.latest-time"));if(timeRange.dataset.allday==="1"){recurrenceEnd=recurrenceEnd.endOf("day");defaultStartTimeSeconds|=0;defaultEndTimeSeconds|=86399}else{allRecurrencesAllDay=false;let secondsFromMidnight=$recurrenceStartTime.em_timepicker("getSecondsFromMidnight");if($recurrenceStartTime.val()){recurrenceStart=recurrenceStart.plus({seconds:secondsFromMidnight})}else{recurrenceStart=recurrenceStart.plus({seconds:defaultStartTimeSeconds||0})}if($recurrenceEndTime.val()){let secondsFromMidnight=$recurrenceEndTime.em_timepicker("getSecondsFromMidnight");recurrenceEnd=recurrenceEnd.plus({seconds:secondsFromMidnight})}else{recurrenceEnd=recurrenceEnd.plus({seconds:defaultEndTimeSeconds||0})}defaultStartTimeSeconds|=$recurrenceStartTime.em_timepicker("getSecondsFromMidnight");defaultEndTimeSeconds|=$recurrenceEndTime.em_timepicker("getSecondsFromMidnight")}let duration=recurrenceSet.querySelector(".recurrence_duration")?.value;if(duration){recurrenceEnd=recurrenceEnd.plus({days:duration})}if(recurrenceStart.isValid&&(!startDateTime||recurrenceStart<startDateTime)){startDateTime=recurrenceStart.setZone(timezone)}if(recurrenceEnd.isValid&&(!endDateTime||recurrenceEnd>endDateTime)){endDateTime=recurrenceEnd.setZone(timezone)}}}});if(startDateTime?.isValid&&endDateTime?.isValid){let startDate=startDateTime.setZone("system",{keepLocalTime:true}).toJSDate();let endDate=endDateTime.setZone("system",{keepLocalTime:true}).toJSDate();if(eventDatePicker.classList.contains("em-datepicker-range")){eventDatePicker.querySelector(".em-date-input.flatpickr-input")?._flatpickr?.setDate([startDate,endDate],true)}else{eventDatePicker.querySelector(".em-date-input-start.flatpickr-input")?._flatpickr?.setDate(startDate,true);eventDatePicker.querySelector(".em-date-input-end.flatpickr-input")?._flatpickr?.setDate(endDate,true)}$eventStartTime.em_timepicker("setTime",startDate);$eventEndTime.em_timepicker("setTime",endDate);let recurringSection=eventDateTimes.querySelector(".recurring-summary-dates");if(recurringSection){recurringSection.classList.remove("hidden");let datePickerFormat="D";let timeFormat=EM.show24hours==1?"H:mm":"h:mm a";let startDateElem=recurringSection.querySelector(".date.start-date");if(startDateElem){startDateElem.textContent=startDateTime.toFormat(datePickerFormat)}let startTimeElem=recurringSection.querySelector(".time.start-time");if(startTimeElem){startTimeElem.textContent=" @ "+startDateTime.toFormat(timeFormat)}let endDateElem=recurringSection.querySelector(".date.end-date");if(endDateElem){endDateElem.textContent=endDateTime.toFormat(datePickerFormat)}let endTimeElem=recurringSection.querySelector(".time.end-time");if(endTimeElem){endTimeElem.textContent=" @ "+endDateTime.toFormat(timeFormat)}recurringSection.classList.remove("is-all-day","has-all-day");if(eventTimeRange.dataset.allday==="1"){recurringSection.classList.add("is-all-day")}else if(allRecurrencesAllDay){recurringSection.classList.add("has-all-day")}let timezoneElem=recurringSection.querySelector(".recurring-timezone .timezone");if(timezoneElem&&timezone){timezoneElem.textContent=timezone}if(uniqueTimezones.size>1){recurringSection.classList.add("has-multiple-timezones")}else{recurringSection.classList.remove("has-multiple-timezones")}let missingInfoElem=eventDateTimes.querySelector(".recurring-summary-missing");if(missingInfoElem){missingInfoElem.classList.add("hidden")}}}}})});let breakpoints={small:500,large:false};let recurringSummaries=document.querySelectorAll(".em-recurring-summary .recurring-summary-dates");if(recurringSummaries.length>0){EM_ResizeObserver(breakpoints,recurringSummaries)}});let emRecurrenceEditor={updateIntervalDescriptor:function(container){let sets=container.matches(".em-recurrence-sets")?container.querySelectorAll(".em-recurrence-set"):[container.closest(".em-recurrence-set")];sets.forEach(function(set){set.querySelectorAll(".interval-desc").forEach(el=>el.classList.add("hidden"));let number="-plural";let input=set.querySelector("input.em-recurrence-interval");if(input){if(input.value==="1"||input.value===""){number="-singular"}}let select=set.querySelector("select.em-recurrence-frequency");let freq=select?select.value:"";let descriptorSelector="span.interval-desc.interval-"+freq+number;set.querySelectorAll(descriptorSelector).forEach(el=>el.classList.remove("hidden"));set.querySelectorAll(".interval-desc-intro").forEach(el=>el.classList.toggle("hidden",freq==="on"))})},updateDurationDescriptor:function(container){let sets=container.matches(".em-recurrence-sets")?container.querySelectorAll(".em-recurrence-set"):[container.closest(".em-recurrence-set")];sets.forEach(function(set){set.querySelectorAll(".recurrence-days-desc").forEach(el=>el.classList.add("hidden"));let input=set.querySelector("input.em-recurrence-duration");let number=input&&(input.value==="1"||input.value===""&&input.placeholder==="1")?"singular":"plural";set.querySelectorAll(".recurrence-days-desc.em-"+number).forEach(el=>el.classList.remove("hidden"))})},updateIntervalSelectors:function(container){let sets=container.matches(".em-recurrence-sets")?container.querySelectorAll(".em-recurrence-set"):[container.closest(".em-recurrence-set")];sets.forEach(function(set){set.querySelectorAll(".alternate-selector").forEach(el=>el.classList.add("hidden"));let select=set.querySelector("select.em-recurrence-frequency");let freq=select?select.value:"";set.querySelectorAll(".em-"+freq+"-selector").forEach(el=>el.classList.remove("hidden"));set.querySelectorAll(".em-recurrence-interval").forEach(el=>el.classList.toggle("hidden",freq==="on"))})}};document.addEventListener("em_event_editor_recurrences",function(e){let recurrenceSets=e.detail.recurrenceSets;recurrenceSets.addEventListener("setAdvancedDefaults",function(){let recurrenceSetPrimary=recurrenceSets.querySelector(".em-recurrence-type-include .em-recurrence-set:first-child");let selector=".em-recurrence-type-include .em-recurrence-set:not(:first-child) .em-recurrence-advanced";recurrenceSets.querySelectorAll(".em-recurrence-set").forEach(recurrenceSet=>{recurrenceSet.dataset.primaryModified="0"});recurrenceSets.querySelectorAll(".em-recurrence-set").forEach(recurrenceSet=>{if(recurrenceSet!==recurrenceSetPrimary){if(recurrenceSet.querySelector(".recurrences-timeranges-default-trigger")?.checked){recurrenceSet.dataset.primaryModified="1"}}});recurrenceSets.querySelectorAll(".em-recurrence-set").forEach(function(recurrenceSet){if(!recurrenceSet.matches(".em-recurrence-type-include .em-recurrence-set:first-child")){recurrenceSetPrimary.querySelectorAll(".em-recurrence-advanced .em-datepicker .em-date-input.flatpickr-input").forEach(function(input){let datePicker=input.closest(".em-datepicker");let value=input._flatpickr.altInput.value;let modifiedDefault=input._flatpickr._inputData.some(input=>input.value!==input.dataset.undo);let datesSelector=".em-recurrence-dates .em-date-input.form-control";if(datePicker.classList.contains("em-datepicker-range")){recurrenceSet.querySelectorAll(datesSelector).forEach(function(dp){dp.previousElementSibling.placeholder||=dp.placeholder;dp.placeholder=value?value:dp.previousElementSibling.placeholder;if(dp.value===""&&modifiedDefault){dp.closest(".em-recurrence-set").dataset.primaryModified="1"}})}else if(datePicker.classList.contains("em-datepicker-until")){datesSelector+=input.classList.contains("em-date-input-start")?".em-date-input-start":".em-date-input-end";recurrenceSet.querySelectorAll(datesSelector).forEach(function(dp){dp.placeholder=value?value:dp.previousElementSibling.placeholder;if(dp.value===""&&modifiedDefault){dp.closest(".em-recurrence-set").dataset.primaryModified="1"}})}})}});["timezone","status"].forEach(function(selectType){const classPrefix=".em-recurrence-"+selectType;let select=recurrenceSetPrimary.querySelector(classPrefix+" select");if(select){let selectors=selectType==="timezone"?[selector,".em-recurrence-type-exclude .em-recurrence-set .em-recurrence-advanced"]:[selector];selectors.forEach(function(selector){recurrenceSets.querySelectorAll(selector+" "+classPrefix+" select").forEach(function(otherSelect){if(otherSelect.selectize){if(select.value){otherSelect.selectize.settings.placeholder=select.querySelector(`option[value="${select.value}"]`)?.textContent||select.value;otherSelect.selectize.updatePlaceholder();if(otherSelect.value===""&&select.value!==select.dataset.undo){otherSelect.closest(".em-recurrence-set").dataset.primaryModified="1"}}else{otherSelect.selectize.settings.placeholder=select.selectize?.settings.placeholder;otherSelect.selectize.updatePlaceholder()}}})})}});let durationInput=recurrenceSetPrimary.querySelector("input.em-recurrence-duration");if(durationInput&&durationInput.value.trim()){recurrenceSets.querySelectorAll(selector+" input.em-recurrence-duration").forEach(function(otherInput){otherInput.placeholder=durationInput.value.trim();if(otherInput.value===""&&durationInput.value!==durationInput.dataset.undo){otherInput.closest(".em-recurrence-set").dataset.primaryModified="1"}})}recurrenceSets.querySelectorAll(".em-recurrence-set").forEach(function(recurrenceSet){recurrenceSet.classList.toggle("advanced-modified-primary",recurrenceSet.dataset.primaryModified==="1");if(recurrenceSet.dataset.primaryModified){recurrenceSet.dispatchEvent(new Event("change",{bubbles:true}))}delete recurrenceSet.dataset.primaryModified;let hasDates=0;let hasStartDate=false,hasStartDateModified=false;let hasEndDate=false,hasEndDateModified=false;let hasModifiedDates;if(recurrenceSet.querySelector("select.em-recurrence-frequency")?.value==="on"){hasDates=2}else{recurrenceSet.querySelectorAll(`.em-recurrence-dates .em-datepicker-data input[name]`).forEach(function(input){hasDates+=input.value?1:0;if(input.matches(":first-of-type")){hasStartDate=!!input.value;hasStartDateModified=input.value!==input.dataset.undo}if(input.matches(":last-of-type")){hasEndDate=!!input.value;hasEndDateModified=input.value!==input.dataset.undo}hasModifiedDates||=input.value!==input.dataset.undo})}recurrenceSet.classList.toggle("has-date-range",hasDates>=2);if(hasDates<2){recurrenceSet.classList.toggle("has-date-range-start",hasStartDate);recurrenceSet.classList.toggle("has-date-range-end",hasEndDate)}if(hasStartDateModified&&hasEndDateModified){recurrenceSet.classList.toggle("has-modified-date-range",true);recurrenceSet.classList.toggle("has-modified-date-range-start",false);recurrenceSet.classList.toggle("has-modified-date-range-end",false)}else{recurrenceSet.classList.toggle("has-modified-date-range",false);recurrenceSet.classList.toggle("has-modified-date-range-start",hasStartDateModified);recurrenceSet.classList.toggle("has-modified-date-range-end",hasEndDateModified)}});recurrenceSets.dispatchEvent(new Event("updateRecurrenceSummary",{bubbles:true}))});recurrenceSets.addEventListener("updateSetsCount",function(){["include","exclude"].forEach(function(recurrenceType){let recurrenceTypeSets=recurrenceSets.querySelector(".em-recurrence-type-"+recurrenceType);if(recurrenceTypeSets){let count=recurrenceTypeSets.querySelectorAll(".em-recurrence-set").length;recurrenceSets.setAttribute("data-"+recurrenceType+"-count",count);recurrenceTypeSets.dataset.count=count}})});recurrenceSets.addEventListener("updateRecurrenceOrder",function(){let primaryRecurrence;recurrenceSets.querySelectorAll(".em-recurrence-type-include .em-recurrence-set").forEach(function(recurrenceSet,index){let order_input=recurrenceSet.querySelector(".em-recurrence-order");if(order_input){order_input.value=index+1}recurrenceSet.classList.toggle("show-advanced",index===0);if(recurrenceSet!==primaryRecurrence&&index===0){primaryRecurrence=recurrenceSet;primaryRecurrence.querySelectorAll("[data-placeholder]").forEach(el=>{el.placeholder=el.dataset.placeholder});primaryRecurrence.querySelectorAll(".em-datepicker .em-date-input-end.form-control").forEach(el=>{el.placeholder=el.previousElementSibling.placeholder});primaryRecurrence.querySelectorAll(".em-datepicker .em-date-input-start.form-control").forEach(el=>{el.placeholder=el.previousElementSibling.placeholder});recurrenceSets.dispatchEvent(new CustomEvent("updateSetsCount"));recurrenceSets.dispatchEvent(new CustomEvent("setAdvancedDefaults"));recurrenceSets.dispatchEvent(new CustomEvent("updateRecurrenceSummary"))}if(recurrenceSet.matches(":first-child")){recurrenceSet.dataset.primary="1";recurrenceSet.querySelectorAll(".em-time-all-day").forEach(el=>{el.indeterminate=false})}else{delete recurrenceSet.dataset.primary}})});recurrenceSets.dispatchEvent(new CustomEvent("updateSetsCount"));emRecurrenceEditor.updateIntervalDescriptor(recurrenceSets);emRecurrenceEditor.updateIntervalSelectors(recurrenceSets);emRecurrenceEditor.updateDurationDescriptor(recurrenceSets)});document.addEventListener("em_event_editor_recurrences",function(e){let recurrenceSets=e.detail.recurrenceSets;recurrenceSets.addEventListener("keyup",function(e){if(e.target.matches("input.em-recurrence-interval")){emRecurrenceEditor.updateIntervalDescriptor(e.target.closest(".em-recurrence-set"))}else if(e.target.matches("input.em-recurrence-duration")){emRecurrenceEditor.updateDurationDescriptor(e.target.closest(".em-recurrence-set"))}});recurrenceSets.addEventListener("change",function(e){if(e.target.matches("select.em-recurrence-frequency")){let recurrenceSet=e.target.closest(".em-recurrence-set");emRecurrenceEditor.updateIntervalDescriptor(recurrenceSet);emRecurrenceEditor.updateIntervalSelectors(recurrenceSet)}})});document.querySelectorAll("form.em-event-admin-recurring").forEach(form=>{form.addEventListener("submit",function(event){let warning_text;let recreateInput=form.querySelector('input[name="event_recreate_tickets"]');if(recreateInput&&recreateInput.value==="1"){warning_text=EM.event_recurrence_bookings}if(warning_text&&!confirm(warning_text)){event.preventDefault()}})});document.querySelectorAll(".em-reschedule-trigger, .em-reschedule-cancel").forEach(trigger=>{trigger.addEventListener("click",e=>{e.preventDefault();const el=e.currentTarget;const show=el.matches(".em-reschedule-trigger");el.closest(".em-recurrence-reschedule")?.querySelector(el.dataset.target)?.classList.toggle("reschedule-hidden",!show);el.parentElement.querySelectorAll("[data-nonce]").forEach(el=>{el.disabled=!show});el.parentElement.querySelectorAll("button").forEach(link=>link.classList.remove("reschedule-hidden"));el.classList.add("reschedule-hidden")})});document.addEventListener("em_event_editor_recurrences",function(e){let recurrenceSets=e.detail.recurrenceSets;let setAdvancedDefaults=()=>recurrenceSets.dispatchEvent(new CustomEvent("setAdvancedDefaults"));let updateRecurrenceSummary=recurrenceSet=>recurrenceSet.dispatchEvent(new CustomEvent("updateRecurrenceSummary",{bubbles:true}));let setDateTimes=()=>recurrenceSets.dispatchEvent(new CustomEvent("setDateTimes"));recurrenceSets.addEventListener("click",function(e){const toggleButton=e.target.closest(".em-recurrence-set-action-advanced");if(!toggleButton)return;const recurrenceSet=toggleButton.closest(".em-recurrence-set");recurrenceSet.classList.toggle("show-advanced");if("_tippy"in toggleButton){if(recurrenceSet.classList.contains("show-advanced")){toggleButton._tippy.setContent(toggleButton.getAttribute("data-label-hide"))}else{toggleButton._tippy.setContent(toggleButton.getAttribute("data-label-show"))}}});let updateAdvancedIcon=function(recurrenceSet){const advancedSection=recurrenceSet.querySelector(".em-recurrence-advanced");const advancedIcon=recurrenceSet.querySelector(".em-recurrence-set-action-advanced");if(!advancedSection||!advancedIcon)return;const inputs=advancedSection.querySelectorAll("input, select, textarea");let hasValue=Array.from(inputs).some(input=>{if(input.type==="checkbox"){return input.checked}else{return input.value.trim()!==""}});recurrenceSet.classList.toggle("has-advanced-value",hasValue)};recurrenceSets.addEventListener("change",function(e){if(e.target.closest(".em-recurrence-advanced")){updateAdvancedIcon(e.target.closest(".em-recurrence-set"))}});recurrenceSets.querySelectorAll(".em-recurrence-set").forEach(recurrenceSet=>updateAdvancedIcon(recurrenceSet));recurrenceSets.querySelectorAll(".em-recurrence-type").forEach(function(recurrenceSetType){recurrenceSetType.addEventListener("change",function(e){let recurrenceSet=e.target.closest(".em-recurrence-set");if(e.target.closest(".em-recurrence-advanced")){if(recurrenceSetType.classList.contains("em-recurrence-type-include")){if(recurrenceSet===recurrenceSet.parentElement?.firstElementChild){setAdvancedDefaults()}setDateTimes()}updateRecurrenceSummary(recurrenceSet)}else if(recurrenceSet?.querySelector("select.recurrence_freq")?.value==="on"){if(e.target.closest(".em-datepicker.em-on-selector")){let selectedDates=e.target.closest(".em-date-input")?._flatpickr?.selectedDates;if(selectedDates){selectedDates.sort(function(a,b){return a-b});let datepickerDates=recurrenceSet.querySelector(".em-recurrence-dates.em-datepicker");if(datepickerDates){if(datepickerDates.classList.contains("em-datepicker-until")){datepickerDates.querySelector(`.em-date-input-start`)?._flatpickr?.setDate(selectedDates[0]);datepickerDates.querySelector(`.em-date-input-end`)?._flatpickr?.setDate(selectedDates[selectedDates.length-1])}else if(datepickerDates.classList.contains("em-datepicker-range")){let selectedDatesArray=[selectedDates[0],selectedDates[selectedDates.length-1]];datepickerDates.querySelector(`.em-date-input`)?._flatpickr?.setDate(selectedDatesArray)}}if(recurrenceSetType.classList.contains("em-recurrence-type-include")){if(recurrenceSet===recurrenceSet.parentElement?.firstElementChild){setAdvancedDefaults()}}}}setDateTimes()}})});recurrenceSets.addEventListener("change",function(e){if(e.target.closest(".em-recurrence-advanced")){let recurrenceSet=e.target.closest(".em-recurrence-set");let isModified=false;recurrenceSet.querySelectorAll(".em-recurrence-advanced [name]:not([disabled]):not([data-nonce]").forEach(input=>{if(input.name&&input.dataset.undo){if(input.type==="checkbox"){if(input.checked&&input.dataset.undo!=="1"){isModified=true}}else{if(input.value!==input.dataset.undo){isModified=true}}}else if(recurrenceSets.dataset.event_id&&input.value){isModified=true}});recurrenceSet.classList.toggle("advanced-modified",isModified)}if(e.target.matches(".em-recurrence-timeranges *")){let recurrenceSet=e.target.closest(".em-recurrence-set");let timeranges=recurrenceSet.querySelector(".em-recurrence-timeranges .em.timeranges");let startTimeInput=recurrenceSet.querySelector(".em-time-input.em-time-start.earliest-time");let endTimeInput=recurrenceSet.querySelector(".em-time-input.em-time-end.latest-time");let durationInput=recurrenceSet.querySelector("input.em-recurrence-duration");let isMultiDay=durationInput?.value>0||durationInput?.placeholder>0||false;if(!isMultiDay){let startTime=startTimeInput.dataset.seconds?parseInt(startTimeInput.dataset.seconds):null;let endTime=endTimeInput.dataset.seconds?parseInt(endTimeInput.dataset.seconds):null;if(!startTime||!endTime){let recurrenceSetPrimary=recurrenceSets.querySelector('.em-recurrence-set[data-type="include"]:first-child');if(recurrenceSetPrimary){if(startTime===null){let seconds=recurrenceSetPrimary.querySelector(".em-time-input.em-time-start")?.dataset.seconds;startTime=seconds===undefined?null:parseInt(recurrenceSetPrimary.querySelector(".em-time-input.em-time-start")?.dataset.seconds||0)}if(endTime===null){let seconds=recurrenceSetPrimary.querySelector(".em-time-input.em-time-end")?.dataset.seconds;endTime=seconds===undefined?null:parseInt(recurrenceSetPrimary.querySelector(".em-time-input.em-time-end")?.dataset.seconds||0)}}}if(startTime!==null&&endTime!==null){if(e.target.matches(".em-time-start")&&startTime>endTime){endTimeInput.value=startTimeInput.value;endTimeInput.dispatchEvent(new Event("change"))}if(e.target.matches(".em-time-end")&&startTime>endTime){startTimeInput.value=endTimeInput.value;startTimeInput.dispatchEvent(new Event("change"))}}}}if(e.target.matches("input.em-recurrence-duration")){if(e.target.value==="0"||e.target.value===""&&e.target.placeholder==="0"){let recurrenceSet=e.target.closest(".em-recurrence-set");let sets=recurrenceSet.dataset.primary?recurrenceSet:recurrenceSets;sets.querySelectorAll(".em-recurrence-times .em-time-end").forEach(el=>el.dispatchEvent(new Event("change")))}}let primaryCb=recurrenceSets.querySelector(".em-recurrence-set[data-primary] .em-time-all-day");if(e.target.matches(".em-time-all-day")){let cb=e.target;if(cb.matches(".em-recurrence-set[data-primary] .em-time-all-day")){if(cb.readOnly){cb.checked=true;cb.readOnly=false}}else{if(cb.readOnly){cb.checked=true;cb.readOnly=false}else if(cb.checked&&primaryCb.checked){cb.readOnly=true;cb.indeterminate=true;cb.closest(".em-time-range").querySelectorAll(".em-time-input").forEach(el=>{el.value=""})}}}});recurrenceSets.addEventListener("updateRecurrenceSummary",function(e){let sets=e.target.matches(".em-recurrence-set")?[e.target]:e.target.querySelectorAll(".em-recurrence-set");let timerangeDefault=e.target.querySelector(".em-recurrence-set[data-primary] .em-recurrence-timeranges .em-timeranges");sets.forEach(function(recurrenceSet){let advancedSummary=recurrenceSet.querySelector(".advanced-summary");if(advancedSummary){let dateValues={start:"",end:"",startIsSet:false,endIsSet:false};let timeValues={start:timerangeDefault.dataset.start,end:timerangeDefault.dataset.end,startIsSet:false,endIsSet:false};if(recurrenceSet.querySelector("select.recurrence_freq")?.value==="on"){let selectedDates=recurrenceSet.querySelector(".em-on-selector .em-date-input")?._flatpickr?.selectedDates;if(selectedDates){selectedDates.sort(function(a,b){return a-b});dateValues["start"]=selectedDates[0];dateValues["startIsSet"]=true;dateValues["end"]=selectedDates[selectedDates.length-1];dateValues["endIsSet"]=true}}else{let datepickerDates=recurrenceSet.querySelector(".em-recurrence-dates.em-datepicker");if(datepickerDates.classList.contains("em-datepicker-until")){["start","end"].forEach(function(type){let dateInput=datepickerDates.querySelector(`.em-date-input-${type}`);if(dateInput){if(dateInput._flatpickr&&dateInput._flatpickr.altInput&&dateInput._flatpickr.selectedDates.length){dateValues[type]=dateInput._flatpickr.altInput.value;dateValues[type+"IsSet"]=true}else if(dateInput.nextElementSibling){dateValues[type]=dateInput.nextElementSibling.value||dateInput.nextElementSibling.placeholder}}})}else if(datepickerDates.classList.contains("em-datepicker-range")){let dateInput=datepickerDates.querySelector(`.em-date-input`);if(dateInput){if(dateInput._flatpickr&&dateInput._flatpickr.altInput&&dateInput._flatpickr.selectedDates.length){dateValues["start"]=dateInput._flatpickr.altInput.value;dateValues["startIsSet"]=true}else if(dateInput.nextElementSibling){dateValues["start"]=dateInput.nextElementSibling.value||dateInput.nextElementSibling.placeholder}}}}if(recurrenceSet.querySelector(".em-recurrence-timeranges .recurrence-timeranges-default input:checked")){timeranges=recurrenceSet.querySelector(".em-recurrence-timeranges .em.timeranges");["start","end"].forEach(function(type){let timeInput=recurrenceSet.querySelector(`.em-recurrence-times .em-time-${type}`);if(timeInput){timeValues[type]=timeranges.dataset[type];if(timeInput.value){timeValues[type+"IsSet"]=!!timeValues[type]}}})}let timezoneSelect=recurrenceSet.querySelector(".em-recurrence-timezone select");let timezoneValue="";if(timezoneSelect){let value=timezoneSelect.value;if(value){timezoneValue=timezoneSelect.querySelector(`option[value="${value}"]`)?.textContent||""}else{timezoneValue=recurrenceSet.querySelector(".em-recurrence-timezone .selectize-input input")?.placeholder||""}}let durationInput=recurrenceSet.querySelector(".em-recurrence-duration input.em-recurrence-duration");let durationValue=durationInput?durationInput.value.trim()||durationInput.placeholder||"0":"0";emRecurrenceEditor.updateDurationDescriptor(recurrenceSet);if(Object.entries(dateValues).length===4){advancedSummary.querySelectorAll(".start-date").forEach(el=>{el.textContent=dateValues.start;el.classList.toggle("is-set",dateValues.startIsSet)});advancedSummary.querySelectorAll(".end-date").forEach(el=>{el.textContent=dateValues.end;el.classList.toggle("is-set",dateValues.endIsSet)})}else{advancedSummary.querySelectorAll(".dates").forEach(el=>{el.textContent=dateValues.start;el.classList.toggle("is-set",dateValues.startIsSet)})}advancedSummary.querySelectorAll(".times").forEach(function(el){el.innerHTML=`<span class="start-time">${timeValues.start}</span> - <span class="end-time">${timeValues.end}</span>`;el.firstElementChild.classList.toggle("is-set",timeValues.startIsSet);el.lastElementChild.classList.toggle("is-set",timeValues.endIsSet)});advancedSummary.querySelector(".all-day")?.classList.toggle("is-set",recurrenceSet.querySelector(".em-time-all-day")?.checked);advancedSummary.querySelectorAll(".timezone").forEach(el=>{el.textContent=timezoneValue;el.classList.toggle("is-set",timezoneSelect?.value)});advancedSummary.querySelectorAll(".duration").forEach(el=>{el.textContent=durationValue;el.classList.toggle("is-set",durationInput&&durationInput.value!=="")})}})})});document.addEventListener("em_event_editor_recurrences",function(e){let recurrenceSets=e.detail.recurrenceSets;let setup_ui_elements=function(container){if(container===document){let template=recurrenceSets.querySelector(".em-recurrence-set-template");em_unsetup_ui_elements(template)}recurrenceSets.dispatchEvent(new CustomEvent("setAdvancedDefaults"));if(container===document){let firstRecurrenceSet=recurrenceSets.querySelector(".em-recurrence-type-include .em-recurrence-set:first-child");const fieldMappings={".em-recurrence-timezone select":'select[name="event_timezone"]',".em-recurrence-status select":'select[name="event_active_status"]'};Object.entries(fieldMappings).forEach(function([recurrenceSelector,eventSelector]){let recurrenceField=firstRecurrenceSet.querySelector(recurrenceSelector);let eventFormWhen=recurrenceSets.closest("form").querySelector(".event-form-when");let eventField=eventFormWhen?.querySelector(eventSelector);if(recurrenceField&&eventField){if(recurrenceField.selectize){recurrenceField.selectize.on("change",function(value){if(eventField.selectize){eventField.selectize.setValue(value,true)}else{eventField.value=value;eventField.dispatchEvent(new Event("change",{bubbles:true}))}})}else{recurrenceField.addEventListener("change",function(){if(eventField.selectize){eventField.selectize.setValue(recurrenceField.value,true)}else{eventField.value=recurrenceField.value;eventField.dispatchEvent(new Event("change",{bubbles:true}))}})}let initialValue=recurrenceField.selectize?recurrenceField.selectize.getValue():recurrenceField.value;if(initialValue){if(eventField.selectize){eventField.selectize.setValue(initialValue,true)}else{eventField.value=initialValue}}}})}};document.addEventListener("em_setup_ui_elements",function(e){setup_ui_elements(e.detail.container)});if(document.readyState==="complete"||document.readyState==="interactive"){setup_ui_elements(document)}});document.addEventListener("em_event_editor_loaded",function(e){const $=jQuery.noConflict();if($("#em-tickets-form").length>0){document.getElementById("event-rsvp").addEventListener("click",function(event){const nonceInput=this.parentElement.querySelector("input.event_rsvp_delete[data-nonce]");const rsvpOptions=document.getElementById("event-rsvp-options");if(!this.checked){const confirmation=confirm(EM.disable_bookings_warning);if(!confirmation){event.preventDefault()}else{rsvpOptions.classList.add("hidden");nonceInput.disabled=false}}else{rsvpOptions.classList.remove("hidden");nonceInput.disabled=true}});if($("input#event-rsvp").is(":checked")){$("div#rsvp-data").fadeIn()}else{$("div#rsvp-data").hide()}var reset_ticket_forms=function(){$("#em-tickets-form table tbody tr.em-tickets-row").show();$("#em-tickets-form table tbody tr.em-tickets-row-form").hide()};document.querySelectorAll('#em-tickets-form input.possibly-indeterminate[type="checkbox"], #em-tickets-form input[type="checkbox"][indeterminate]').forEach(cb=>{if(cb.hasAttribute("indeterminate")&&cb.readOnly){cb.indeterminate=true}cb.addEventListener("click",()=>{if(cb.hasAttribute("indeterminate")&&!cb.classList.contains("determinate")){if(cb.readOnly){cb.checked=true;cb.readOnly=false}else if(cb.checked){cb.readOnly=true;cb.indeterminate=true}if(cb.classList.contains("possibly-indeterminate")){cb.nextElementSibling.value=cb.indeterminate?"default":cb.checked?1:0}}else{cb.nextElementSibling.value=cb.checked?1:0}})});$("#em-tickets-add").on("click",function(e){e.preventDefault();reset_ticket_forms();var tickets=$("#em-tickets-form table tbody");tickets.first(".em-ticket-template").find("input.em-date-input.flatpickr-input").each(function(){if("_flatpickr"in this){this._flatpickr.destroy()}});var rowNo=tickets.length+1;var slot=tickets.first(".em-ticket-template").clone(true).attr("id","em-ticket-"+rowNo).removeClass("em-ticket-template").addClass("em-ticket").appendTo($("#em-tickets-form table"));slot.find("*[name]").each(function(index,el){el=$(el);el.attr("name",el.attr("name").replace("em_tickets[0]","em_tickets["+rowNo+"]"))});let start_datepicker=slot.find(".ticket-dates-from-normal").first();if(start_datepicker.attr("data-until-id")){let until_id=start_datepicker.attr("data-until-id").replace("-0","-"+rowNo);start_datepicker.attr("data-until-id",until_id);slot.find(".ticket-dates-to-normal").attr("id",start_datepicker.attr("data-until-id"))}slot.show().find(".ticket-actions-edit").trigger("click");slot.find(".em-time-input").off().each(function(index,el){if(typeof this.em_timepickerObj=="object"){this.em_timepicker("remove")}});em_setup_ui_elements(slot);$("html, body").animate({scrollTop:slot.offset().top-30});check_ticket_sortability();slot.find(".ticket_uuid").val("10000000-1000-4000-8000-100000000000".replace(/[018]/g,c=>(+c^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+c/4).toString(16)))});$(document).on("click",".ticket-actions-edit",function(e){e.preventDefault();reset_ticket_forms();var tbody=$(this).closest("tbody");tbody.find("tr.em-tickets-row").hide();tbody.find("tr.em-tickets-row-form").fadeIn();return false});$(document).on("click",".ticket-actions-edited",function(e){e.preventDefault();var tbody=$(this).closest("tbody");var rowNo=tbody.attr("id").replace("em-ticket-","");tbody.find(".em-tickets-row").fadeIn();tbody.find(".em-tickets-row-form").hide();tbody.find("*[name]").each(function(index,el){el=$(el);if(el.attr("name")=="ticket_start_pub"){tbody.find("span.ticket_start").text(el.val())}else if(el.attr("name")=="ticket_end_pub"){tbody.find("span.ticket_end").text(el.val())}else if(el.attr("name")=="em_tickets["+rowNo+"][ticket_type]"){if(el.find(":selected").val()=="members"){tbody.find("span.ticket_name").prepend("* ")}}else if(el.attr("name")=="em_tickets["+rowNo+"][ticket_start_recurring_days]"){var text=tbody.find("select.ticket-dates-from-recurring-when").val()=="before"?"-"+el.val():el.val();if(el.val()!=""){tbody.find("span.ticket_start_recurring_days").text(text);tbody.find("span.ticket_start_recurring_days_text, span.ticket_start_time").removeClass("hidden").show()}else{tbody.find("span.ticket_start_recurring_days").text(" - ");tbody.find("span.ticket_start_recurring_days_text, span.ticket_start_time").removeClass("hidden").hide()}}else if(el.attr("name")=="em_tickets["+rowNo+"][ticket_end_recurring_days]"){var text=tbody.find("select.ticket-dates-to-recurring-when").val()=="before"?"-"+el.val():el.val();if(el.val()!=""){tbody.find("span.ticket_end_recurring_days").text(text);tbody.find("span.ticket_end_recurring_days_text, span.ticket_end_time").removeClass("hidden").show()}else{tbody.find("span.ticket_end_recurring_days").text(" - ");tbody.find("span.ticket_end_recurring_days_text, span.ticket_end_time").removeClass("hidden").hide()}}else{var classname=el.attr("name").replace("em_tickets["+rowNo+"][","").replace("]","").replace("[]","");tbody.find(".em-tickets-row ."+classname).text(el.val())}});$(document).triggerHandler("em_maps_tickets_edit",[tbody,rowNo,true]);$("html, body").animate({scrollTop:tbody.parent().offset().top-30});return false});$(document).on("change",".em-ticket-form select.ticket_type",function(e){var el=$(this);let ticketForm=el.closest(".em-ticket-form");if(this.value==="members"||this.value==="-1"&&this.dataset.default==="members"){el.closest(".em-ticket-form").find(".ticket-roles").fadeIn()}else{el.closest(".em-ticket-form").find(".ticket-roles").hide()}if(this.value==="-1"&&this.dataset.default==="members"){ticketForm[0].querySelectorAll('.ticket-roles input[type="checkbox"][indeterminate]').forEach(el=>{el.indeterminate=true;el.classList.remove("determinate")});ticketForm[0].querySelectorAll('.ticket-roles input[type="checkbox"]:not([indeterminate])').forEach(el=>{el.checked=false})}else if(this.value==="members"){ticketForm[0].querySelectorAll('.ticket-roles input[type="checkbox"][indeterminate]').forEach(el=>{el.indeterminate=false;el.readOnly=false;el.checked=true;el.classList.add("determinate")})}});$(".em-ticket-form select.ticket_type").trigger("change");$(document).on("change",'.em-ticket-form .ticket-roles input[type="checkbox"]',function(e){let ticketForm=this.closest(".em-ticket-form");let select=ticketForm.querySelector(".em-ticket-form select.ticket_type");if(select.dataset.default==="members"&&select.value==="-1"){select.value="members";ticketForm.querySelectorAll('.ticket-roles input[type="checkbox"][indeterminate]').forEach(el=>{el.indeterminate=false;el.readOnly=false;el.checked=true;el.classList.add("determinate")})}});$(document).on("click",".em-ticket-form .ticket-options-advanced",function(e){e.preventDefault();var el=$(this);if(el.hasClass("show")){el.closest(".em-ticket-form").find(".em-ticket-form-advanced").fadeIn();el.find(".show,.show-advanced").hide();el.find(".hide,.hide-advanced").show()}else{el.closest(".em-ticket-form").find(".em-ticket-form-advanced").hide();el.find(".show,.show-advanced").show();el.find(".hide,.hide-advanced").hide()}el.toggleClass("show")});$(".em-ticket-form").each(function(){var show_advanced=false;var el=$(this);el.find('.em-ticket-form-advanced input[type="text"]').each(function(){if(this.value!="")show_advanced=true});if(el.find('.em-ticket-form-advanced input[type="checkbox"]:checked').length>0){show_advanced=true}el.find(".em-ticket-form-advanced option:selected").each(function(){if(this.value!="")show_advanced=true});if(show_advanced)el.find(".ticket-options-advanced").trigger("click")});$(document).on("click",".ticket-actions-delete",function(e){e.preventDefault();var el=$(this);var tbody=el.closest("tbody");if(tbody.find("input.ticket_id").val()>0){let warning=this.classList.contains("parent-ticket")?EM.eventEditor.deleteTicketParentWarning:EM.eventEditor.deleteTicketWarning;if(confirm(warning)){tbody.find("input.delete[data-nonce]").prop("disabled",false);tbody.closest(".em-ticket").addClass("ticket-deleted")}}else{tbody.remove()}check_ticket_sortability();return false});$("#em-tickets-form.em-tickets-sortable table").sortable({items:"> tbody",placeholder:"em-ticket-sortable-placeholder",handle:".ticket-status",helper:function(event,el){var helper=$(el).clone().addClass("em-ticket-sortable-helper");var tds=helper.find(".em-tickets-row td").length;helper.children().remove();helper.append('<tr class="em-tickets-row"><td colspan="'+tds+'" style="text-align:left; padding-left:15px;"><span class="dashicons dashicons-tickets-alt"></span></td></tr>');return helper}});var check_ticket_sortability=function(){var em_tickets=$("#em-tickets-form table tbody.em-ticket");if(em_tickets.length==1){em_tickets.find(".ticket-status").addClass("single");$("#em-tickets-form.em-tickets-sortable table").sortable("option","disabled",true)}else{em_tickets.find(".ticket-status").removeClass("single");$("#em-tickets-form.em-tickets-sortable table").sortable("option","disabled",false)}};check_ticket_sortability()}});