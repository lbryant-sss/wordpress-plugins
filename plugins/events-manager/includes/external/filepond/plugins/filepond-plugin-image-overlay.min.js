(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):(global=typeof globalThis!=="undefined"?globalThis:global||self,global.FilePondPluginImageOverlay=factory())})(this,function(){"use strict";const isImage=file=>/^image/.test(file.type);const getImageSize=(url,cb)=>{let image=new Image;image.onload=()=>{const width=image.naturalWidth;const height=image.naturalHeight;image=null;cb(width,height)};image.src=url};const registerFullSizeOverlay=(item,el,labelButtonOverlay)=>{const info=el.querySelector(".filepond--file-info-main"),magnifyIcon=getMagnifyIcon(labelButtonOverlay);info.append(magnifyIcon);magnifyIcon.addEventListener("click",()=>createFullSizeOverlay(item));window.setTimeout(()=>{const imagePreview=el.querySelector(".filepond--image-preview");if(imagePreview){imagePreview.classList.add("clickable");imagePreview.addEventListener("click",()=>createFullSizeOverlay(item))}},1e3)};const getMagnifyIcon=labelButtonOverlay=>{let icon=document.createElement("span");icon.className="filepond--magnify-icon";icon.title=labelButtonOverlay;return icon};const createFullSizeOverlay=item=>{const overlay=document.createElement("div");overlay.className="filepond--fullsize-overlay";const imgContainer=document.createElement("div");const imgUrl=URL.createObjectURL(item.file);imgContainer.className="image-container";imgContainer.style.backgroundImage="url("+imgUrl+")";determineImageOverlaySize(imgUrl,imgContainer);let body=document.getElementsByTagName("body")[0];overlay.appendChild(imgContainer);body.appendChild(overlay);overlay.addEventListener("click",()=>overlay.remove())};const determineImageOverlaySize=(imgUrl,imgContainer)=>{const w=Math.max(document.documentElement.clientWidth,window.innerWidth||0),h=Math.max(document.documentElement.clientHeight,window.innerHeight||0);getImageSize(imgUrl,(width,height)=>{if(width>w||height>h){imgContainer.style.backgroundSize="contain"}})};const plugin=fpAPI=>{const{addFilter,utils}=fpAPI;const{Type,createRoute}=utils;addFilter("CREATE_VIEW",viewAPI=>{const{is,view,query}=viewAPI;if(!is("file")){return}const didLoadItem=({root,props})=>{const{id}=props;const item=query("GET_ITEM",id);if(!item||item.archived||!isImage(item.file)){return}const labelButtonOverlay=root.query("GET_LABEL_BUTTON_IMAGE_OVERLAY");registerFullSizeOverlay(item,root.element,labelButtonOverlay);root.dispatch("DID_MEDIA_PREVIEW_CONTAINER_CREATE",{id:id})};view.registerWriter(createRoute({DID_LOAD_ITEM:didLoadItem},({root,props})=>{const{id}=props;const item=query("GET_ITEM",id);if(!isImage(item.file)||root.rect.element.hidden)return}))});return{options:{labelButtonImageOverlay:["Open image in overlay",Type.STRING]}}};const isBrowser=typeof window!=="undefined"&&typeof window.document!=="undefined";if(isBrowser){document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:plugin}))}return plugin});