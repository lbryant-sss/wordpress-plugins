(()=>{var e={49:e=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}var a={objectToQueryParams:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object.keys(e).map((function(o){var i=e[o],n=r?"".concat(r,"[").concat(o,"]"):o;return"object"!==t(i)||Array.isArray(i)?"".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(i)):a.objectToQueryParams(i,n)})).join("&")}};e.exports=a},354:e=>{var t={warning:function(e){return t.removeMsg("notice"),'<div class="notice notice-warning">'+e+"</div>"},error:function(e){return t.removeMsg("notice"),'<div class="notice notice-error">'+e+"</div>"},info:function(e){return t.removeMsg("notice"),'<div class="notice notice-info">'+e+"</div>"},success:function(e){return t.removeMsg("notice"),'<div class="notice notice-success">'+e+"</div>"},removeMsg:function(e){jQuery("."+e).hide("slow").remove()}};e.exports=t}},t={};function a(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,a),i.exports}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var o=a.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}var n=a(49),l=a(354);new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.selectedFile=null,this.init()},t=[{key:"init",value:function(){this.bindEvents()}},{key:"bindEvents",value:function(){var e=this;jQuery(document).ready((function(){e.setupSearchInput(),e.setupReplaceButton(),e.setupPopupHandlers(),e.setupFileUploadHandlers(),e.setupUploadButton()}))}},{key:"setupSearchInput",value:function(){jQuery(".input-media-replace-query").on("keyup",(function(e){var t=jQuery(e.target).val();if(t.length>=2){var a={action:"query-attachments",post_id:0,query:{orderby:"date",s:t,order:"DESC",post_per_page:80,paged:1}};fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.objectToQueryParams(a)}).then((function(e){return e.json()})).then((function(e){if("object"===r(e.data)&&0!==Object.keys(e.data).length){var t=e.data.map((function(e){if("image"===e.type){var t="image"===e.type?e.url:e.thumb.src;return'<div class="image-item">\n                                        <img class="media-item-'.concat(e.id,'" data-id="').concat(e.id,'" src="').concat(t,'" alt="').concat(e.title,'" height="250px">\n                                        <button class="button-overlay btn-img-replace" data-id="').concat(e.id,'">Replace</button>\n                                    </div>')}if("video"===e.type)return"undefined"!==e.image.src?e.image.src:"undefined"!==e.icon&&e.icon,'<div class="image-item">\n                                        <video class="media-item-'.concat(e.id,'" data-id="').concat(e.id,'" controls height="250px">\n                                            <source src="').concat(e.url,'" type="video/mp4">\n                                            Your browser does not support the video tag.\n                                        </video>\n                                        <button class="button-overlay btn-img-replace" data-id="').concat(e.id,'">Replace</button>\n                                    </div>')})).join("");jQuery(".image-container").html(t)}else jQuery(".image-container").html("No images found. Try searching with a new word..")}))}else jQuery(".image-container").html("Please type at least 2 characters to get images..")}))}},{key:"videoPreview",value:function(e,t){return'<video class="media-item-'.concat(e,' video-preview" data-id="').concat(e,'" controls height="207px">\n            <source src="').concat(t,'" type="video/mp4">\n            Your browser does not support the video tag.\n        </video>')}},{key:"imagePreview",value:function(e,t,a){return'<img class="media-item-'.concat(e,' preview-image" data-oldmediaid="').concat(e,'" src="').concat(t,'" alt="').concat(a,'"  />')}},{key:"setupReplaceButton",value:function(){var e=this;jQuery("body").on("click",".btn-img-replace",(function(t){jQuery(".notice").hide("slow"),jQuery("#popup1").addClass("show-popup").removeClass("hide-popup"),jQuery("#popup1 > .popup > .content").removeClass("hidden"),jQuery(".title-popup-media-replacer ").text("Upload New Media File");var a=jQuery(t.target).data("id");a?(e.enableDetailForm(),wp.media.attachment(a).fetch().then((function(t){"image"===t.type?(jQuery(".old-media-preview-wrapper").html(e.imagePreview(t.id,t.url,t.title)).removeClass("video-preview").attr({"data-type":"image","data-previd":t.id}),jQuery("#file-input").attr("accept","image/*")):"video"===t.type&&(jQuery(".old-media-preview-wrapper").html(e.videoPreview(t.id,t.url)).addClass("video-preview").attr({"data-type":"video","data-previd":t.id}),jQuery("#file-input").attr("accept","video/*")),jQuery(".ai-date").html(t.dateFormatted),jQuery(".author-info").html('<a href="'.concat(t.authorLink,'">').concat(t.authorName,"</a>")),jQuery(".ai-filename").html(t.filename),jQuery(".ai-filetype").html(t.mime),jQuery(".ai-filesize").html(t.filesizeHumanReadable),jQuery(".ai-dimensions").html("".concat(t.height," by ").concat(t.width)),"image"===t.type?(jQuery("#bfrModalContent .alt-text").show(),jQuery("#attachment-details-two-column-alt-text").val(t.alt)):jQuery("#bfrModalContent .alt-text").hide(),jQuery("#attachment-details-two-column-title").val(void 0===t.title?"":t.title),jQuery("#attachment-details-two-column-caption").val(t.caption),jQuery("#attachment-details-two-column-description").val(t.description),jQuery(".attachment-details-copy-link").val(t.url)}))):alert("No attachment ID found.")}))}},{key:"setupPopupHandlers",value:function(){var e=this;jQuery("body").on("click",".popup a.close",(function(){jQuery("#popup1").addClass("hide-popup").removeClass("show-popup"),e.resetFormData()}))}},{key:"setupFileUploadHandlers",value:function(){var e=this,t=jQuery("#upload-container"),a=jQuery("#file-input");t.on("dragover",(function(e){e.preventDefault(),t.addClass("dragover")})),t.on("dragleave",(function(){t.removeClass("dragover")})),t.on("drop",(function(a){a.preventDefault(),t.removeClass("dragover");var r=a.originalEvent.dataTransfer.files[0];r&&e.handleFileSelection(r)})),a.on("change",(function(t){var a=t.target.files[0];a&&e.handleFileSelection(a)}))}},{key:"handleFileSelection",value:function(e){var t=this;this.selectedFile=e;var a=new FileReader;a.onload=function(a){var r=jQuery(".old-media-preview-wrapper").attr("data-previd");wp.media.attachment(r).fetch().then((function(r){if(console.log(r),console.log(a.target),console.log("File type:",e.type),!e.type.startsWith(r.type+"/"))return jQuery(".response").html(l.error("Error: Please select same file type to proceed with the replacement. Ex: for image replace, select image file.")),void t.resetFormOnError();"image"===r.type?jQuery(".upload-preview-wrapper").html(t.imagePreview(r.id,a.target.result)):"video"===r.type&&jQuery(".upload-preview-wrapper").html(t.videoPreview(r.id,a.target.result))}))},a.readAsDataURL(e)}},{key:"setupUploadButton",value:function(){var e=this;jQuery(".btn-media-replace").on("click",(function(t){var a=jQuery(t.target);if(jQuery(".response").html(""),a.prop("disabled",!0).text("Replacing..."),!e.selectedFile)return a.prop("disabled",!1).text("Replace"),void jQuery(".response").html(l.error("Error: Please select a new file to proceed with the replacement..."));jQuery(e).text("Replacing..");var r=jQuery(".old-media-preview-wrapper").attr("data-previd"),o=jQuery("#cs_token").val(),i=jQuery("#attachment-details-two-column-alt-text").val(),n=jQuery("#attachment-details-two-column-title").val(),c=jQuery("#attachment-details-two-column-caption").val(),u=jQuery("#attachment-details-two-column-description").val();e.disableDetailForm();var p=new FormData;p.append("media_file",e.selectedFile),p.append("attachment_id",r),p.append("cs_token",o),p.append("action","rtafar_ajax"),p.append("method","admin\\functions\\MediaImageReplacer@handleMediaReplace"),p.append("alt_text",i),p.append("caption",c),p.append("description",u),p.append("title",n),jQuery.ajax({url:ajaxurl,type:"POST",data:p,processData:!1,contentType:!1,success:function(t){t.success?(jQuery(".response").html(l.success(t.message)),jQuery(".media-item-"+t.media_id).attr("src",""),a.prop("disabled",!0).text("Success! Redirecting.."),setTimeout((function(){jQuery(".media-item-"+t.media_id).attr("src",t.new_media_url),e.enableDetailForm(),a.prop("disabled",!1).text("Replace"),e.closePopup()}),1e3)):jQuery(".response").html(l.error("Error: "+t.message))},error:function(){jQuery(".response").html(l.error("An error occurred while uploading the image."))}})}))}},{key:"resetFormData",value:function(){this.selectedFile=null,jQuery("#file-input").val(""),jQuery(".upload-preview-wrapper").html(this.imagePreview("",rtafr.pimg,"")),jQuery(".old-media-preview-wrapper").html(this.imagePreview("",rtafr.pimg,""))}},{key:"resetFormOnError",value:function(){this.selectedFile=null,jQuery("#file-input").val(""),jQuery(".upload-preview-wrapper").html(this.imagePreview("",rtafr.pimg,""))}},{key:"closePopup",value:function(){this.resetFormData(),jQuery("#popup1").addClass("hide-popup").removeClass("show-popup")}},{key:"enableDetailForm",value:function(){jQuery("#attachment-details-two-column-alt-text, #attachment-details-two-column-title, #attachment-details-two-column-caption, #attachment-details-two-column-description").removeAttr("readonly")}},{key:"disableDetailForm",value:function(){jQuery("#attachment-details-two-column-alt-text, #attachment-details-two-column-title, #attachment-details-two-column-caption, #attachment-details-two-column-description").prop("readonly",!0)}}],t&&o(e.prototype,t),a&&o(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,a}())})();