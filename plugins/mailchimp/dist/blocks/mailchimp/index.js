!function(){"use strict";var e={n:function(i){var t=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(t,{a:t}),t},d:function(i,t){for(var l in t)e.o(t,l)&&!e.o(i,l)&&Object.defineProperty(i,l,{enumerable:!0,get:t[l]})},o:function(e,i){return Object.prototype.hasOwnProperty.call(e,i)}},i=window.wp.element,t=window.wp.blocks,l=window.wp.blockEditor,a=window.wp.i18n,n=window.wp.components,r=window.wp.apiFetch,s=e.n(r),o=window.wp.data,c=()=>(0,i.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 786 834"},(0,i.createElement)("path",{fill:"#000",d:"M593.928 394.101c9.225 0 16.704-14.067 16.704-31.419s-7.479-31.419-16.704-31.419c-9.225 0-16.704 14.067-16.704 31.419s7.479 31.419 16.704 31.419zM462.274 414.515c24.911 0 45.106-6.62 45.106-14.786s-20.195-14.786-45.106-14.786-45.106 6.62-45.106 14.786 20.195 14.786 45.106 14.786zM476.163 438.738c15.14 0 27.413-4.414 27.413-9.859s-12.273-9.859-27.413-9.859-27.413 4.414-27.413 9.859 12.273 9.859 27.413 9.859zM561.885 456.22c7.789 0 14.103-5.226 14.103-11.672 0-6.446-6.314-11.672-14.103-11.672s-14.103 5.226-14.103 11.672c0 6.446 6.314 11.672 14.103 11.672zM604.006 442.623c5.957 0 10.786-6.621 10.786-14.788s-4.829-14.788-10.786-14.788-10.786 6.621-10.786 14.788 4.829 14.788 10.786 14.788zM157.109 573.544c26.516 0 48.011-24.096 48.011-53.821 0-29.724-21.495-53.821-48.011-53.821-26.516 0-48.011 24.097-48.011 53.821 0 29.725 21.495 53.821 48.011 53.821z"}),(0,i.createElement)("path",{fill:"#000",d:"M449.778 582.534l.011.02c.006.011.01.027.017.04l-.028-.06zm306.171 3.396c-6.089 36.902-21.776 66.849-48.137 94.4-16.044 17.272-35.525 32.289-57.813 43.209a244.174 244.174 0 01-37.755 15.946c-99.374 32.455-201.092-3.227-233.883-79.852a123.14 123.14 0 01-6.576-18.099c-13.973-50.493-2.109-111.076 34.972-149.206.004-.004-.005-.015-.003-.02 2.288-2.428 4.62-5.288 4.62-8.887 0-3.009-1.912-6.185-3.57-8.434-12.974-18.818-57.912-50.883-48.892-112.936 6.477-44.579 45.465-75.976 81.816-74.115 3.07.158 6.145.348 9.21.53 15.753.932 29.495 2.952 42.464 3.494 21.701.936 41.22-2.217 64.333-21.477 7.799-6.5 14.05-12.132 24.628-13.924 1.109-.189 3.877-1.18 9.405-.92 5.644.3 11.015 1.851 15.843 5.064 18.531 12.332 21.16 42.197 22.121 64.045.546 12.472 2.055 42.645 2.571 51.307 1.177 19.806 6.384 22.6 16.917 26.068 5.923 1.949 11.423 3.404 19.527 5.678 24.531 6.887 39.073 13.874 48.241 22.85 5.468 5.609 8.009 11.569 8.795 17.253 2.893 21.101-16.383 47.166-67.409 70.85-55.778 25.89-123.444 32.446-170.197 27.239-3.587-.4-16.336-1.845-16.38-1.851-37.399-5.038-58.732 43.295-36.287 76.406 14.464 21.341 53.865 35.23 93.289 35.235 90.385.014 159.86-38.586 185.701-71.921.774-.997.85-1.106 2.07-2.946 1.269-1.918.221-2.972-1.363-1.89-21.113 14.447-114.897 71.803-215.209 54.548 0 0-12.189-2.004-23.316-6.335-8.843-3.437-27.347-11.95-29.597-30.938 80.956 25.037 131.929 1.371 131.929 1.371.918-.388 1.555-1.442 1.449-2.487a2.347 2.347 0 00-.848-1.575 2.322 2.322 0 00-1.713-.513s-66.361 9.824-129.051-13.127c6.828-22.192 24.986-14.177 52.428-11.964 49.467 2.948 93.8-4.277 126.564-13.68 28.392-8.15 65.683-24.213 94.644-47.073 9.77 21.459 13.22 45.077 13.22 45.077s7.562-1.354 13.881 2.536c5.972 3.675 10.352 11.314 7.361 31.064zm-461.04-351.539c31.095-35.933 69.376-67.174 103.667-84.716 1.184-.606 2.445.682 1.8 1.847-2.722 4.931-7.964 15.487-9.626 23.499-.26 1.246 1.1 2.186 2.152 1.469 21.335-14.543 58.444-30.124 90.995-32.127 1.4-.085 2.074 1.707.962 2.562-4.95 3.796-10.365 9.05-14.318 14.365-.674.905-.04 2.208 1.088 2.216 22.856.161 55.078 8.161 76.078 19.939 1.424.797.411 3.55-1.178 3.185-31.778-7.284-83.791-12.808-137.821.371-48.235 11.764-85.051 29.929-111.909 49.465-1.356.986-2.988-.807-1.89-2.075zm-161.546 170.89c-28.155 5.475-52.97 21.43-68.141 43.472-9.07-7.565-25.967-22.208-28.95-27.913-24.226-46 26.438-135.434 61.83-185.941C185.568 110.079 322.56 15.602 385.98 32.742c10.308 2.918 44.453 42.508 44.453 42.508s-63.392 35.173-122.178 84.201c-79.211 60.992-139.047 149.639-174.892 245.83zm47.308 211.083a67.773 67.773 0 01-12.991.912c-42.361-1.138-88.12-39.274-92.666-84.502-5.026-49.99 20.517-88.466 65.744-97.586 5.406-1.089 11.94-1.719 18.985-1.352 25.34 1.388 62.68 20.845 71.212 76.045 7.554 48.889-4.446 98.667-50.284 106.483zm573.845-88.52c-.365-1.283-2.727-9.926-5.976-20.339-3.248-10.413-6.611-17.744-6.611-17.744 13.028-19.506 13.262-36.952 11.531-46.828-1.852-12.249-6.949-22.685-17.225-33.473-10.278-10.788-31.293-21.836-60.831-30.129-3.378-.948-14.518-4.006-15.498-4.303-.076-.641-.815-36.538-1.488-51.946-.49-11.14-1.446-28.53-6.84-45.662-6.432-23.185-17.636-43.473-31.622-56.453 38.596-40.009 62.688-84.08 62.631-121.89-.111-72.71-89.407-94.71-199.449-49.144-.117.05-23.151 9.816-23.317 9.898-.103-.1-42.151-41.357-42.784-41.909C291.572-91.512-100.705 344.515 24.714 450.413l27.41 23.219c-7.111 18.418-9.904 39.518-7.622 62.209 2.93 29.145 17.964 57.084 42.329 78.671 23.132 20.494 53.544 33.465 83.057 33.439 48.807 112.472 160.32 181.469 291.074 185.353 140.254 4.166 257.991-61.645 307.325-179.867 3.226-8.299 16.92-45.683 16.92-78.683 0-33.166-18.75-46.91-30.691-46.91z"}));const{mailchimp_sf_block_data:m}=window,{merge_fields:d=[],interest_groups:u=[],merge_fields_visibility:p={},interest_groups_visibility:h={}}=m,_={"email-only-form":["EMAIL"],"name-and-email-form":["FNAME","LNAME","EMAIL"],"contact-form":["FNAME","LNAME","EMAIL","PHONE","ADDRESS"],default:[]},b={FNAME:(0,a.__)("First Name","mailchimp"),LNAME:(0,a.__)("Last Name","mailchimp"),EMAIL:(0,a.__)("Email","mailchimp"),PHONE:(0,a.__)("Phone","mailchimp"),ADDRESS:(0,a.__)("Address","mailchimp")},f=(e=[],i="default")=>{const t=_[i]||[];return[...[...e].sort(((e,i)=>{const l=t.indexOf(e.tag),a=t.indexOf(i.tag);return(-1===l?1/0:l)-(-1===a?1/0:a)})).map((e=>{let l="default"===i&&e.required||t.includes(e.tag)||t.includes(e.type?.toUpperCase());return 0===t.length&&(l=e.required||"on"===p?.[e.tag]),["mailchimp/mailchimp-form-field",{tag:e.tag,label:e.name,type:e.type,visible:l}]})),...u.map((e=>["mailchimp/mailchimp-audience-group",{id:e.id,label:e.title,visible:"default"===i&&("on"===h?.[e.id]&&"hidden"!==e.type)}]))]},g=[{name:"email-only-form",title:(0,a.__)("Quick Signup (Email Only)","mailchimp"),description:(0,a.__)("A quick signup form with only an email field.","mailchimp"),icon:"email",attributes:{template:"email-only-form"},innerBlocks:f(d,"email-only-form"),scope:["block"]},{name:"name-and-email-form",title:(0,a.__)("Personal Signup (Name and Email)","mailchimp"),description:(0,a.__)("A personal signup form with only a name and email fields","mailchimp"),icon:"admin-users",attributes:{template:"name-and-email-form"},innerBlocks:f(d,"name-and-email-form"),scope:["block"]},{name:"contact-form",title:(0,a.__)("Contact Form (Contact Details)","mailchimp"),description:(0,a.__)("A full contact details form with name, email, phone and address fields","mailchimp"),icon:"id",attributes:{template:"contact-form"},innerBlocks:f(d,"contact-form"),scope:["block"]},{name:"default",title:(0,a.__)("Default Form (All Fields)","mailchimp"),description:(0,a.__)("A default form, Fields based on settings.","mailchimp"),icon:"admin-settings",attributes:{template:"default"},isDefault:!0,innerBlocks:f(d,"default"),scope:["block"]}],{merge_fields:k=[]}=window.mailchimp_sf_block_data,w=({name:e,setAttributes:n,clientId:r})=>{const{blockType:s,defaultVariation:c,variations:m}=(0,o.useSelect)((i=>{const{getBlockVariations:l,getBlockType:a,getDefaultBlockVariation:n}=i(t.store);return{blockType:a(e),defaultVariation:n(e,"block"),variations:l(e,"block")}}),[e]),{replaceInnerBlocks:d}=(0,o.useDispatch)(l.store),{createNotice:u,removeNotice:p}=(0,o.useDispatch)("core/notices"),h=(0,l.useBlockProps)();return(0,i.createElement)("div",h,(0,i.createElement)(l.__experimentalBlockVariationPicker,{icon:s?.icon?.src,label:s?.title,instructions:(0,a.__)("Start by selecting one of these templates","mailchimp"),variations:m,onSelect:(e=c)=>{if(e.attributes&&n(e.attributes),e.innerBlocks){const i=(e=>{const i=e.name,t=_[i]||[],l=e.innerBlocks.filter((e=>"mailchimp/mailchimp-form-field"===e[0])).map((e=>{const[,i]=e,{tag:t}=i;return t}));return t.filter((e=>!l.includes(e)))})(e),l=(e=>{const i=e.name;if("default"===i)return[];const t=k.filter((e=>e.required)).map((e=>e.tag)),l=_[i]||[];return t.filter((e=>!l.includes(e))).map((e=>b[e]||e))})(e);p("mailchimp-form-template-required-field-notice"),p("mailchimp-form-template-field-notice"),d(r,(0,t.createBlocksFromInnerBlocksTemplate)(e.innerBlocks)),l.length>0&&u("warning",(0,a.sprintf)((0,a.__)("The selected form template is missing some required fields (%s) for Mailchimp, so merge validation will be turned off for this form.","mailchimp"),l.join(", ")),{id:"mailchimp-form-template-required-field-notice",isDismissible:!0}),i.length>0&&u("warning",(0,a.sprintf)((0,a._n)("%s form field is missing from the selected form template. Please create this field in the Mailchimp dashboard, then click the 'Fetch list settings' button on the plugin settings page to update the list and include the missing field.","Some form fields are missing from the selected form template: %s. Please create these fields in the Mailchimp dashboard, then click the 'Fetch list settings' button on the plugin settings page to update the list and include the missing fields.",i.length,"mailchimp"),i.map((e=>`${b[e]||e} (${e})`)).join(", ")),{id:"mailchimp-form-template-field-notice",isDismissible:!0})}},allowSkip:!0}))},E=()=>(0,i.createElement)(n.Placeholder,{icon:c,label:(0,a.__)("Mailchimp Block","mailchimp"),instructions:(0,a.__)("Please select the Mailchimp list in the block settings sidebar.","mailchimp")});var v=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"mailchimp/mailchimp","title":"Mailchimp List Subscribe Form","category":"widgets","description":"Mailchimp List Subscribe Form","attributes":{"list_id":{"type":"string"},"header":{"type":"string"},"sub_header":{"type":"string"},"submit_text":{"type":"string"},"double_opt_in":{"type":"boolean"},"update_existing_subscribers":{"type":"boolean"},"show_unsubscribe_link":{"type":"boolean"},"unsubscribe_link_text":{"type":"string","default":"unsubscribe from list"},"show_required_indicator":{"type":"boolean","default":true},"required_indicator_text":{"type":"string","default":"* = required field"},"template":{"type":"string","default":"default"}},"supports":{"html":false,"reusable":true,"align":["wide","full"],"__experimentalBorder":{"color":true,"radius":true,"style":true,"width":true,"__experimentalDefaultControls":{"radius":true,"style":true,"width":true}},"spacing":{"margin":true,"padding":true},"color":{"background":true,"text":true,"border":true},"typography":{"fontSize":true,"lineHeight":true,"textAlign":true}},"allowedBlocks":["mailchimp/mailchimp-form-field"],"providesContext":{"mailchimp/list_id":"list_id","mailchimp/show_required_indicator":"show_required_indicator","mailchimp/template":"template"},"textdomain":"mailchimp","editorScript":"file:./index.js","render":"file:./markup.php","editorStyle":["file:./editor.css","dashicons"]}');(0,t.registerBlockType)(v,{icon:c,variations:g,transforms:{from:[{type:"shortcode",tag:"mailchimpsf_form",attributes:{}}]},edit:e=>{const{clientId:r,attributes:c,setAttributes:m}=e,{mailchimp_sf_block_data:d}=window,{lists:u,merge_fields_visibility:p,interest_groups_visibility:h,list_id:_,header_text:b,sub_header_text:f,submit_text:g,show_unsubscribe_link:k,update_existing_subscribers:v,double_opt_in:y}=d,{header:x=b,sub_header:B=f,list_id:N=_,submit_text:M=g,double_opt_in:S=y,update_existing_subscribers:q=v,show_unsubscribe_link:C=k,unsubscribe_link_text:A,show_required_indicator:D=!0,required_indicator_text:F,template:P="default"}=c,[I,L]=(0,i.useState)({}),[T,z]=(0,i.useState)(!0),[O,H]=(0,i.useState)(""),R=(0,l.useBlockProps)(),{replaceInnerBlocks:j}=(0,o.useDispatch)(l.store),V=(0,o.useSelect)((e=>e(l.store).getBlocksByClientId(r)?.[0]?.innerBlocks||[]),[r]),$=V.map((e=>e?.attributes?.tag)).filter(Boolean),U=V.map((e=>e?.attributes?.id)).filter(Boolean),G=V.filter((e=>e?.attributes?.visible)).map((e=>e?.attributes?.tag)),J=G.length,Q=[],K=u?.map((e=>e.id))||[];!K.includes(N)&&K.length>0&&(Q.push({label:(0,a.__)("Select a list","mailchimp"),value:""}),m({list_id:""})),Q.push(...u?.map((e=>({label:e.name,value:e.id})))||[]);const W=(e,i=!1)=>{H(""),z(!0),s()({path:`/mailchimp/v1/list-data/${e}`}).then((l=>{if(!l)return H((0,a.__)("Error fetching list data.","mailchimp")),void z(!1);if(i){const e=l?.merge_fields?.map((e=>(0,t.createBlock)("mailchimp/mailchimp-form-field",{tag:e.tag,label:e.name,type:e.type,visible:"default"===P&&e.required||G.length>0&&G.includes(e.tag)||0===G.length&&(e.required||"on"===p?.[e.tag]&&e.public)})))||[],i=l?.interest_groups?.map((e=>(0,t.createBlock)("mailchimp/mailchimp-audience-group",{id:e.id,label:e.title,visible:!1})))||[];j(r,[...e,...i],!1)}else if($&&$.length>0){const e=l?.merge_fields?.filter((e=>!$.includes(e.tag)))||[],i=l?.interest_groups?.filter((e=>!U.includes(e.id)))||[],a=V.filter((e=>{const{tag:i,id:t}=e.attributes;return i?l?.merge_fields?.find((e=>e.tag===i)):l?.interest_groups?.find((e=>e.id===t))}));if(e.length>0||i.length>0||a.length!==V.length){const l=e.map((e=>(0,t.createBlock)("mailchimp/mailchimp-form-field",{tag:e.tag,label:e.name,type:e.type,visible:"default"===P&&e.required}))),n=i.map((e=>(0,t.createBlock)("mailchimp/mailchimp-audience-group",{id:e.id,label:e.title,visible:!1})));j(r,[...a,...l,...n],!1)}}L(l),window.mailchimpListData||(window.mailchimpListData={});const n=l?.merge_fields?.reduce(((e,i)=>(e[i.tag]=i,e)),{})||{},s=l?.interest_groups?.reduce(((e,i)=>(e[i.id]=i,e)),{})||{};window.mailchimpListData[e]={mergeFields:n,interestGroups:s},z(!1)})).catch((e=>{console.error("Error fetching list data:",e),H(e.message),z(!1)}))};if((0,i.useEffect)((()=>{m(J>1?{show_required_indicator:!0}:{show_required_indicator:!1})}),[m,J]),(0,i.useEffect)((()=>{const e=u?.map((e=>e.id))||[];if(!N||!e.includes(N))return L({}),void z(!1);if(H(""),z(!0),W(N,!1),void 0===c.list_id){const e={list_id:_};void 0===c.header&&(e.header=b),void 0===c.sub_header&&(e.sub_header=f),void 0===c.submit_text&&(e.submit_text=g),void 0===c.double_opt_in&&(e.double_opt_in=y),void 0===c.update_existing_subscribers&&(e.update_existing_subscribers=v),void 0===c.show_unsubscribe_link&&(e.show_unsubscribe_link=k),m(e)}}),[]),T)return(0,i.createElement)("div",{style:{position:"relative"}},(0,i.createElement)("div",{style:{position:"absolute",top:"50%",left:"50%",marginTop:"-9px",marginLeft:"-9px"}},(0,i.createElement)(n.Spinner,null)));if(0===V.length)return(0,i.createElement)(w,e);const X=[...I?.merge_fields?.map((e=>["mailchimp/mailchimp-form-field",{tag:e.tag,label:e.name,type:e.type,visible:(e.required||"on"===p?.[e.tag])&&e.public}]))||[],...I?.interest_groups?.map((e=>["mailchimp/mailchimp-audience-group",{id:e.id,label:e.title,visible:"on"===h?.[e.id]&&"hidden"!==e.type}]))||[]];return(0,i.createElement)(i.Fragment,null,(0,i.createElement)("div",R,!N&&(0,i.createElement)(E,null),N&&(0,i.createElement)(i.Fragment,null,(0,i.createElement)(l.RichText,{className:"mailchimp-block__header mc_custom_border_hdr",tagName:"h2",placeholder:(0,a.__)("Enter a header (optional)","mailchimp"),value:x,onChange:e=>m({header:e})}),(0,i.createElement)("div",{className:"mc_signup"},(0,i.createElement)("div",{className:"mc_signup_form"},(0,i.createElement)("div",{className:"mc_subheader"},(0,i.createElement)(l.RichText,{className:"mailchimp-block__sub-header",tagName:"h3",placeholder:(0,a.__)("Enter a sub header (optional)","mailchimp"),value:B,onChange:e=>m({sub_header:e})})),O&&(0,i.createElement)(n.Placeholder,null,(0,a.sprintf)((0,a.__)("Error fetching list data: %s"),O)),(0,i.createElement)("div",{className:"mc_form_inside"},(0,i.createElement)(l.InnerBlocks,{allowedBlocks:["mailchimp/mailchimp-form-field"],orientation:"vertical",template:X,templateLock:"insert"}),D&&(0,i.createElement)("div",{className:"mc-indicates-required"},(0,i.createElement)(l.RichText,{tagName:"span",value:F,placeholder:(0,a.__)("* = required field","mailchimp"),onChange:e=>m({required_indicator_text:e})})),(0,i.createElement)("div",{className:"mc_signup_submit"},(0,i.createElement)(l.RichText,{className:"mc_signup_submit_button button",tagName:"button",placeholder:(0,a.__)("Enter button text.","mailchimp"),value:M,onChange:e=>m({submit_text:e})})),!!C&&(0,i.createElement)("div",{className:"mc_unsub_link"},(0,i.createElement)(l.RichText,{tagName:"a",value:A,onChange:e=>m({unsubscribe_link_text:e})}))))))),(0,i.createElement)(l.InspectorControls,null,(0,i.createElement)(n.PanelBody,{title:(0,a.__)("Settings","mailchimp"),initialOpen:!0},(0,i.createElement)(n.SelectControl,{label:(0,a.__)("Select a list","mailchimp"),value:N,options:Q,className:"mailchimp-list-select",onChange:e=>{z(!0),m({list_id:e}),W(e,!0)},help:(0,a.__)("Please select the Mailchimp list you'd like to connect to your form.","mailchimp"),__nextHasNoMarginBottom:!0})),(0,i.createElement)(n.PanelBody,{title:(0,a.__)("Form Settings","mailchimp"),initialOpen:!1},(0,i.createElement)(n.ToggleControl,{label:(0,a.__)("Double opt-in","mailchimp"),checked:S,className:"mailchimp-double-opt-in",onChange:()=>m({double_opt_in:!S}),help:(0,a.__)("Before new subscribers are added to your list, they'll need to confirm their email address.","mailchimp"),__nextHasNoMarginBottom:!0}),(0,i.createElement)(n.ToggleControl,{label:(0,a.__)("Update existing subscribers","mailchimp"),checked:q,className:"mailchimp-update-existing-subscribers",onChange:()=>m({update_existing_subscribers:!q}),help:(0,a.__)("If an existing subscriber submits the form, their information will be updated with what's provided.","mailchimp"),__nextHasNoMarginBottom:!0}),(0,i.createElement)(n.ToggleControl,{label:(0,a.__)("Include unsubscribe link","mailchimp"),checked:C,className:"mailchimp-unsubscribe-link",onChange:()=>m({show_unsubscribe_link:!C}),help:(0,a.__)("Automatically add a link to your list's unsubscribe form.","mailchimp"),__nextHasNoMarginBottom:!0}))))},save:()=>(0,i.createElement)(l.InnerBlocks.Content,null)})}();