System.register(["./style.scss-legacy.CHq7dT4S.js"],function(e,a){"use strict";return{setters:[null],execute:function(){!function(e,a,t){const{__:o}=e.wp.i18n;t(function(){t(".adt-manage-feeds-table-row").each(function(){const e=t(this),a=e.hasClass("processing"),o=e.find(".adt-manage-feeds-action-refresh"),s=e.find(".adt-manage-feeds-action-cancel");a?(o.addClass("hidden"),s.removeClass("hidden")):(o.removeClass("hidden"),s.addClass("hidden"))}),t(".adt-manage-feeds-bulk-actions-select").prop("disabled",!0);let a=!1,s=null,d=null;function n(s,d,c){console.log(`Generating batch for feed ${s}, offset: ${d}, batch size: ${c}`);const i=t(`.adt-manage-feeds-table-row[data-feed-id="${s}"]`);if(i.length){const e=i.find(".adt-manage-feeds-table-row-status-text"),a=i.find(".adt-manage-feeds-table-row-status-dot");i.addClass("processing"),e.text().includes(o("Processing","woo-product-feed-pro"))||e.text(o("Processing","woo-product-feed-pro")+" (0%)"),a.attr("data-status","processing")}t.ajax({url:e.ajaxurl,type:"POST",data:{action:"adt_pfp_generate_product_feed",nonce:e.adtObj.adtNonce,feed_id:s,offset:d,batch_size:c},success:function(e){e.success&&"processing"===e.data.status?(a?console.log("Feed status polling already active, continuing with batch processing"):(console.log("Starting feed status polling for batch processing"),r([s])),n(e.data.feed_id,e.data.offset,e.data.batch_size)):e.success&&console.log(`Feed ${s} batch processing completed`)},error:function(e,a,t){console.error(`Error generating feed batch: ${t}`)}})}function r(e){i(),a=!0,l(e),d=window.setInterval(()=>{if(a){const e=c();e.length>0?l(e):(console.log("No more processing feeds found, stopping poll"),i())}else i()},1e3)}function c(){const e=[];return t(".adt-manage-feeds-table-row").each(function(){const a=t(this),o=a.data("feed-id"),s=a.hasClass("processing"),d=a.find(".adt-manage-feeds-table-row-status-dot"),n="processing"===d.attr("data-status"),r=a.find(".adt-manage-feeds-table-row-status-text").text().toLowerCase().includes("processing");if((s||n||r)&&o){e.push(o),s||a.addClass("processing"),n||d.attr("data-status","processing");const t=a.find(".adt-manage-feeds-action-refresh"),r=a.find(".adt-manage-feeds-action-cancel");t.hasClass("hidden")||t.addClass("hidden"),r.hasClass("hidden")&&r.removeClass("hidden")}}),console.log("Found processing feed IDs:",e),e}function i(){console.log("Stopping feed status polling"),null!==d&&(console.log("Clearing interval ID:",d),window.clearInterval(d),d=null),null!==s&&(console.log("Aborting active XHR request"),s.abort(),s=null),a=!1,console.log("Poll stopped, isRefreshRunning =",a)}function l(a){null===s&&(0!==a.length?(console.log("Checking status for feed IDs:",a),s=t.ajax({url:e.ajaxurl,type:"POST",data:{action:"adt_get_feed_processing_status",nonce:e.adtObj.adtNonce,feed_ids:a},success:function(e){s=null,e.success&&e.data&&e.data.length>0?e.data.forEach(e=>{const a=t(`.adt-manage-feeds-table-row[data-feed-id="${e.feed_id}"]`);if(a.length){const s=a.find(".adt-manage-feeds-table-row-status-text"),d=a.find(".adt-manage-feeds-table-row-status-dot"),n=a.find(".adt-manage-feeds-action-refresh"),r=a.find(".adt-manage-feeds-action-cancel"),c=a.find(".adt-manage-feeds-table-row-last-updated div");c.length&&c.text(e.last_updated);const i=a.find(".adt-manage-feeds-table-row-url div");i.length&&e.feed_url_html&&(i.html(e.feed_url_html),i.find(".adt-manage-feeds-table-row-url-copy-button").on("click",function(){const e=t(this).closest(".adt-manage-feeds-table-row-url").find("input");e.length&&f(e.val(),t(this))})),"processing"===e.status&&e.proc_perc<100?(a.addClass("processing"),s.text(o("Processing","woo-product-feed-pro")+` (${e.proc_perc}%)`),d.attr("data-status","processing"),n.hasClass("hidden")||n.addClass("hidden"),r.hasClass("hidden")&&r.removeClass("hidden"),console.log(`Feed ${e.feed_id} still processing at ${e.proc_perc}%`)):(a.removeClass("processing"),s.text(e.status),d.attr("data-status",e.status.toLowerCase()),n.hasClass("hidden")&&n.removeClass("hidden"),r.hasClass("hidden")||r.addClass("hidden"),console.log(`Feed ${e.feed_id} completed with status: ${e.status}`))}}):console.log("No valid data in response or empty response")},error:function(e,a,t){s=null,console.error("Error checking feed status:",t)}})):i())}function f(e,a){navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(e).then(()=>{p(a)}).catch(t=>{console.error("Failed to copy text: ",t),u(e,a)}):u(e,a)}function u(e,a){try{const t=document.createElement("input");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999);const o=document.execCommand("copy");document.body.removeChild(t),o?p(a):console.error("Failed to copy text with execCommand")}catch(t){console.error("Failed to copy text with fallback method: ",t)}}function p(e){const a=e.find(".adt-tooltip-content"),t=a.text();a.text(o("Copied!","woo-product-feed-pro")),setTimeout(()=>{a.text(t)},2e3)}t(".adt-manage-feeds-status-toggle").on("click",function(){const a=t(this),s=a.closest(".adt-manage-feeds-table-row"),d=s.data("feed-id"),n=a.data("current-status").toLowerCase(),r=s.find(".adt-manage-feeds-table-row-status-dot");if("ready"===n||"inactive"===n){const c="inactive"===n,i=o(c?"Are you sure you want to activate this feed?":"Are you sure you want to deactivate this feed?","woo-product-feed-pro");confirm(i)&&t.ajax({url:e.ajaxurl,type:"POST",data:{action:c?"adt_feed_action_activate":"adt_feed_action_deactivate",id:d,nonce:e.adtObj.adtNonce},success:function(e){if(e.success){const e=c?"ready":"inactive",t=o(c?"Ready":"Inactive","woo-product-feed-pro");a.text(t),a.data("current-status",e),a.attr("data-current-status",e),s.attr("data-post-status",c?"publish":"draft"),r.attr("data-status",e),c?s.find(".adt-manage-feeds-table-row-actions-refresh-cancel").show():s.find(".adt-manage-feeds-table-row-actions-refresh-cancel").hide()}else{var t;alert(o("Error: ","woo-product-feed-pro")+((null===(t=e.data)||void 0===t?void 0:t.message)||o("An unknown error occurred.","woo-product-feed-pro")))}},error:function(){alert(o("A network error occurred. Please try again.","woo-product-feed-pro"))}})}}),t(".adt-manage-feeds-table-header-checkbox input").on("change",function(){const e=t(this).prop("checked");t(".adt-manage-feeds-table-row-checkbox input").prop("checked",e),t(".adt-manage-feeds-bulk-actions-select").prop("disabled",!e)}),t(".adt-manage-feeds-table-row-checkbox input").on("change",function(){const e=t(".adt-manage-feeds-table-row-checkbox input:checked").length>0;t(".adt-manage-feeds-bulk-actions-select").prop("disabled",!e),function(){const e=t(".adt-manage-feeds-table-row-checkbox input").length,a=t(".adt-manage-feeds-table-row-checkbox input:checked").length,o=t(".adt-manage-feeds-table-header-checkbox input");0===a?(o.prop("checked",!1),o.prop("indeterminate",!1)):a===e?(o.prop("checked",!0),o.prop("indeterminate",!1)):(o.prop("checked",!1),o.prop("indeterminate",!0))}()}),t(".adt-manage-feeds-pagination-show-select").on("change",function(){const e=t(this).val();if(e!==t(this).data("current-page-size")){const a=new URL(window.location.href);a.searchParams.set("page_num","1"),a.searchParams.set("per_page",e),window.location.href=a.toString()}}),t(".adt-manage-feeds-table-row-url-copy-button").on("click",function(){const e=t(this).closest(".adt-manage-feeds-table-row-url").find("input");e.length&&f(e.val(),t(this))}),t(".adt-manage-feeds-action-duplicate").on("click",function(a){a.preventDefault();const s=t(this).closest(".adt-manage-feeds-table-row").data("feed-id");s&&confirm(o("Are you sure you want to duplicate this feed?","woo-product-feed-pro"))&&t.ajax({url:e.ajaxurl,type:"POST",data:{action:"adt_feed_action_clone",id:s,nonce:e.adtObj.adtNonce},success:function(e){e.success?window.location.reload():alert(o("Error: ","woo-product-feed-pro")+(e.data.message||o("An unknown error occurred.","woo-product-feed-pro")))},error:function(){alert(o("A network error occurred. Please try again.","woo-product-feed-pro"))}})}),t(".adt-manage-feeds-action-refresh, .adt-manage-feeds-action-cancel").on("click",function(a){a.preventDefault();const s=t(this).closest(".adt-manage-feeds-table-row"),d=s.data("feed-id"),c=s.find(".adt-manage-feeds-table-row-status-text"),i=s.find(".adt-manage-feeds-table-row-status-dot"),l=s.find(".adt-manage-feeds-action-refresh"),f=s.find(".adt-manage-feeds-action-cancel"),u=t(this).hasClass("adt-manage-feeds-action-cancel");d&&(u?confirm(o("Are you sure you want to cancel processing the feed?","woo-product-feed-pro"))&&t.ajax({url:e.ajaxurl,type:"POST",data:{action:"adt_feed_action_cancel",id:d,nonce:e.adtObj.adtNonce},success:function(e){var a;e.success?(s.removeClass("processing"),c.text(o("Stopped","woo-product-feed-pro")),i.attr("data-status","ready"),l.removeClass("hidden"),f.addClass("hidden")):alert(o("Error: ","woo-product-feed-pro")+((null===(a=e.data)||void 0===a?void 0:a.message)||o("An unknown error occurred.","woo-product-feed-pro")))},error:function(){alert(o("A network error occurred. Please try again.","woo-product-feed-pro"))}}):confirm(o("Are you sure you want to refresh this feed now?","woo-product-feed-pro"))&&(s.addClass("processing"),c.text(o("Processing","woo-product-feed-pro")+" (0%)"),i.attr("data-status","processing"),l.addClass("hidden"),f.removeClass("hidden"),t.ajax({url:e.ajaxurl,type:"POST",data:{action:"adt_feed_action_refresh",id:d,nonce:e.adtObj.adtNonce},success:function(e){var a;e.success?(console.log("Starting feed status polling for single feed refresh"),r([d]),e.data&&"ajax"===e.data.executed_from&&n(e.data.feed_id,e.data.offset||0,e.data.batch_size||0)):(alert(o("Error: ","woo-product-feed-pro")+((null===(a=e.data)||void 0===a?void 0:a.message)||o("An unknown error occurred.","woo-product-feed-pro"))),s.removeClass("processing"),c.text(o("Ready","woo-product-feed-pro")),i.attr("data-status","ready"),l.removeClass("hidden"),f.addClass("hidden"))},error:function(){alert(o("A network error occurred. Please try again.","woo-product-feed-pro")),s.removeClass("processing"),c.text(o("Ready","woo-product-feed-pro")),i.attr("data-status","ready"),l.removeClass("hidden"),f.addClass("hidden")}})))}),function(){const a=c();a.length>0?(console.log("Found in-progress feeds on page load:",a),t(".adt-manage-feeds-table-row.processing").each(function(){const e=t(this).find(".adt-manage-feeds-action-refresh"),a=t(this).find(".adt-manage-feeds-action-cancel");e.hasClass("hidden")||e.addClass("hidden"),a.hasClass("hidden")&&a.removeClass("hidden")}),console.log("Starting initial feed status polling"),r(a),console.log("Checking for feeds that need batch processing"),t.ajax({url:e.ajaxurl,type:"POST",data:{action:"adt_get_feed_processing_status",nonce:e.adtObj.adtNonce,feed_ids:a},success:function(e){e.success&&e.data&&e.data.length>0?e.data.forEach(e=>{"processing"===e.status&&"ajax"===e.executed_from&&(console.log(`Resuming batch generation for feed ID ${e.feed_id}`),n(e.feed_id,e.offset,e.batch_size))}):console.log("No feeds need batch processing or no valid response data")},error:function(e,a,t){console.error("Error checking feed details:",t)}})):console.log("No in-progress feeds found on page load")}(),t(".adt-manage-feeds-action-delete").on("click",function(a){a.preventDefault();const s=t(this).closest(".adt-manage-feeds-table-row").data("feed-id");s&&confirm(o("Are you sure you want to delete this feed? This action cannot be undone.","woo-product-feed-pro"))&&t.ajax({url:e.ajaxurl,type:"POST",data:{action:"adt_feed_action_delete",id:s,nonce:e.adtObj.adtNonce},success:function(e){e.success?window.location.reload():alert(o("Error: ","woo-product-feed-pro")+(e.data.message||o("An unknown error occurred.","woo-product-feed-pro")))},error:function(){alert(o("A network error occurred. Please try again.","woo-product-feed-pro"))}})}),t(".adt-manage-feeds-bulk-actions-select").on("change",function(){const s=t(this).val();s&&(!function(s,d){let l;if("cancel"===s){const e=[];if(t(".adt-manage-feeds-table-row-checkbox input:checked").each(function(){const a=t(this).closest(".adt-manage-feeds-table-row"),o=a.data("feed-id"),s=a.hasClass("processing")||"processing"===a.find(".adt-manage-feeds-table-row-status-dot").attr("data-status");o&&s&&e.push(o)}),0===(d=e.length))return void alert(o("No processing feeds selected. The cancel action only applies to feeds that are currently processing.","woo-product-feed-pro"));l=o(`Are you sure you want to cancel processing ${d} feed(s)?`,"woo-product-feed-pro")}else if("refresh"===s){const e=[];if(t(".adt-manage-feeds-table-row-checkbox input:checked").each(function(){const a=t(this).closest(".adt-manage-feeds-table-row"),o=a.data("feed-id"),s="publish"===a.data("post-status");o&&s&&e.push(o)}),0===(d=e.length))return void alert(o("No active feeds selected. The refresh action only applies to feeds that are currently active.","woo-product-feed-pro"));l=o(`Are you sure you want to refresh ${d} feed(s)?`,"woo-product-feed-pro")}else switch(s){case"activate":l=o(`Are you sure you want to activate ${d} feed(s)?`,"woo-product-feed-pro");break;case"deactivate":l=o(`Are you sure you want to deactivate ${d} feed(s)?`,"woo-product-feed-pro");break;case"duplicate":l=o(`Are you sure you want to duplicate ${d} feed(s)?`,"woo-product-feed-pro");break;case"delete":l=o(`Are you sure you want to delete ${d} feed(s)? This action cannot be undone.`,"woo-product-feed-pro");break;default:return}confirm(l)&&function(s){let d=[];t(".adt-manage-feeds-table-row-checkbox input:checked").each(function(){const e=t(this).closest(".adt-manage-feeds-table-row").data("feed-id");e&&d.push(e)}),"cancel"!==s||(d=d.filter(e=>{const a=t(`.adt-manage-feeds-table-row[data-feed-id="${e}"]`);return a.hasClass("processing")||"processing"===a.find(".adt-manage-feeds-table-row-status-dot").attr("data-status")}),0!==d.length)?"refresh"!==s||(d=d.filter(e=>"publish"===t(`.adt-manage-feeds-table-row[data-feed-id="${e}"]`).data("post-status")),0!==d.length)?d.length>0&&(console.log(`Processing ${s} for feed IDs:`,d),"refresh"===s&&d.forEach(e=>{const a=t(`.adt-manage-feeds-table-row[data-feed-id="${e}"]`),s=a.find(".adt-manage-feeds-table-row-status-text"),d=a.find(".adt-manage-feeds-table-row-status-dot"),n=a.find(".adt-manage-feeds-action-refresh"),r=a.find(".adt-manage-feeds-action-cancel");a.addClass("processing"),s.text(o("Processing","woo-product-feed-pro")+" (0%)"),d.attr("data-status","processing"),n.addClass("hidden"),r.removeClass("hidden")}),"cancel"===s&&d.forEach(e=>{t(`.adt-manage-feeds-table-row[data-feed-id="${e}"]`).find(".adt-manage-feeds-table-row-status-text").text(o("Cancelling...","woo-product-feed-pro"))}),t.ajax({url:e.ajaxurl,type:"POST",data:{action:"adt_process_bulk_feed_actions",feed_ids:d,bulk_action:s,nonce:e.adtObj.adtNonce},success:function(e){var l;if(e.success)if("refresh"===s)console.log("Starting feed status polling for refresh action"),r(d),e.data&&e.data.feeds&&e.data.feeds.length>0?(console.log("Received feeds for processing:",e.data.feeds),e.data.feeds.forEach(e=>{"ajax"===e.executed_from?(console.log(`Starting batch generation for feed ID ${e.feed_id}`),n(e.feed_id,e.offset||0,e.batch_size||0)):console.log(`Feed ID ${e.feed_id} will be processed via cron`)})):console.warn("No feeds data returned in the response, continuing with status polling only");else if("cancel"===s){if(d.forEach(e=>{const a=t(`.adt-manage-feeds-table-row[data-feed-id="${e}"]`),s=a.find(".adt-manage-feeds-table-row-status-text"),d=a.find(".adt-manage-feeds-table-row-status-dot"),n=a.find(".adt-manage-feeds-action-refresh"),r=a.find(".adt-manage-feeds-action-cancel");a.removeClass("processing"),s.text(o("Stopped","woo-product-feed-pro")),d.attr("data-status","stopped"),n.removeClass("hidden"),r.addClass("hidden")}),a){const e=c();0===e.length?(console.log("No more feeds are processing after cancel action, stopping poll"),i()):console.log(`${e.length} feeds still processing after cancel action, continuing poll`)}}else if(e.data&&e.data.pagination){const a=new URL(window.location.href),t=e.data.pagination;a.searchParams.set("page_num",t.current_page.toString()),a.searchParams.set("per_page",t.per_page.toString()),window.location.href=a.toString()}else window.location.href=window.location.href;else alert(o("Error: ","woo-product-feed-pro")+((null===(l=e.data)||void 0===l?void 0:l.message)||o("An unknown error occurred.","woo-product-feed-pro"))),"refresh"!==s&&"cancel"!==s||d.forEach(e=>{const a=t(`.adt-manage-feeds-table-row[data-feed-id="${e}"]`),d=a.find(".adt-manage-feeds-table-row-status-text"),n=a.find(".adt-manage-feeds-table-row-status-dot"),r=a.find(".adt-manage-feeds-action-refresh"),c=a.find(".adt-manage-feeds-action-cancel");"refresh"===s&&(a.removeClass("processing"),d.text(o("Ready","woo-product-feed-pro")),n.attr("data-status","ready"),r.removeClass("hidden"),c.addClass("hidden"))})},error:function(){alert(o("A network error occurred. Please try again.","woo-product-feed-pro")),"refresh"!==s&&"cancel"!==s||d.forEach(e=>{const a=t(`.adt-manage-feeds-table-row[data-feed-id="${e}"]`),d=a.find(".adt-manage-feeds-table-row-status-text"),n=a.find(".adt-manage-feeds-table-row-status-dot"),r=a.find(".adt-manage-feeds-action-refresh"),c=a.find(".adt-manage-feeds-action-cancel");"refresh"===s&&(a.removeClass("processing"),d.text(o("Ready","woo-product-feed-pro")),n.attr("data-status","ready"),r.removeClass("hidden"),c.addClass("hidden"))})}})):alert(o("No active feeds selected. The refresh action only applies to feeds that are currently active.","woo-product-feed-pro")):alert(o("No processing feeds selected. The cancel action only applies to feeds that are currently processing.","woo-product-feed-pro"))}(s)}(s,t(".adt-manage-feeds-table-row-checkbox input:checked").length),t(this).val(""))})})}(window,document,jQuery)}}});
