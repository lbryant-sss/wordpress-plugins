jQuery(document).ready((function(o){const e=window.pagenow.length?window.pagenow:"";if(window.typenow.length&&window.typenow,"edit-product"===e){let p=!1;o("input#doaction, input#doaction2").on("click",(function(e){if(p)return!0;e.preventDefault();let c=o(this),n=c.prev("select").val();if("facebook_include"===n){let e=[];o.each(o('input[name="post[]"]:checked'),(function(){e.push(parseInt(o(this).val(),10))})),o.post(facebook_for_woocommerce_products_admin.ajax_url,{action:"facebook_for_woocommerce_set_product_sync_bulk_action_prompt",security:facebook_for_woocommerce_products_admin.set_product_sync_bulk_action_prompt_nonce,toggle:n,products:e},(function(e){e&&!e.success?(closeExistingModal(),new o.WCBackboneModal.View({target:"facebook-for-woocommerce-modal",string:e.data})):(p=!0,c.trigger("click"))}))}else p=!0,c.trigger("click")}))}if("product"===e){function c(o,e){e.find(".enable-if-sync-enabled").prop("disabled",!o)}function n(o,e){o?(e.find("option[value='sync_and_show']").show(),e.prop("original")&&e.val(e.prop("original"))):(e.find("option[value='sync_and_show']").hide(),"sync_and_show"===e.val()&&e.val("sync_and_hide"))}function t(o,e){let c=e.find("#wc_facebook_commerce_enabled"),n=c.prop("original");c.prop("checked",!!o&&n).prop("disabled",!o),c.trigger("change"),c.prop("original",n),e.find("#product-not-ready-notice, #variable-product-not-ready-notice").hide(),r()&&!i()?e.find("#variable-product-not-ready-notice").show():o||e.find("#product-not-ready-notice").show()}function a(){return!!(r()?i():"sync_disabled"!==h.val())&&!!(r()||o("#_regular_price").val()||o("#fb_product_price").val())&&!(!o("#_manage_stock").prop("checked")||!o("#_stock").val())}function i(){let e=o(".js-variable-fb-sync-toggle");return 0===e.length?!!facebook_for_woocommerce_products_admin.is_sync_enabled_for_product:!!e.map(((e,c)=>"sync_disabled"!==o(c).val()?c:null)).length}function r(){var e=o("select#product-type").val();return!(!e||!e.match(/variable/))}function s(o){o.attr("data-original-value",o.val())}function d(e){return e.map((function(e,c){let n=o(c),t=n.val();return!!facebook_for_woocommerce_products_admin.is_product_published&&"sync_disabled"===t&&t!==n.attr("data-original-value")})).toArray().indexOf(!0)>-1}function l(e){return h===e?o("input#post_ID").val():e.closest(".woocommerce_variation").find("input[name^=variable_post_id]").val()}function _(e){closeExistingModal(),m=e,g=l(e),new o.WCBackboneModal.View({target:"facebook-for-woocommerce-modal",string:{message:facebook_for_woocommerce_products_admin.product_removed_from_sync_confirm_modal_message,buttons:facebook_for_woocommerce_products_admin.product_removed_from_sync_confirm_modal_buttons}})}function u(){o(facebook_for_woocommerce_products_admin.product_removed_from_sync_field_id).val(b.join(","))}function f(o){b=b.filter((function(e){return e!==o})),u()}let m=null,g=null,b=[];o(document.body).on("click","button.button-product-removed-from-sync-delete",(function(){g&&(closeExistingModal(),b.push(g),u())})).on("click","button.button-product-removed-from-sync-cancel",(function(){var o;closeExistingModal(),m&&((o=m).val(o.attr("data-original-value")),m=null),u()})),o("#facebook_options #wc_facebook_commerce_enabled").on("change",(function(){let e=o(this).prop("checked");e?o(".wc_facebook_commerce_fields").show():o(".wc_facebook_commerce_fields").hide(),o(".product_attributes").find(".woocommerce_attribute").length?o(".show_if_has_attributes").show():o(".show_if_has_attributes").hide(),o(this).prop("original",e)})).trigger("change");const h=o("#wc_facebook_sync_mode"),v=h.closest(".woocommerce_options_panel");s(h),h.on("change",(function(){let o="sync_disabled"!==h.val();c(o,v),function(o,e){let c=e.find(".wc-facebook-commerce-options-group");o?c.show():c.hide()}(o,v),o&&f(l(h)),h.prop("original",h.val()),d(h)&&_(h)})).trigger("change"),o("#_virtual").on("change",(function(){n(!o(this).prop("checked"),h)})).trigger("change"),o("input[name=_visibility]").on("change",(function(){"hidden"!==o(this).val()&&"search"!==o(this).val()&&"sync_disabled"===h.val()&&h.val("sync_and_show").trigger("change")}));const w=o("#woocommerce-product-data");w.on("change","#_regular_price, #_manage_stock, #_stock, #wc_facebook_sync_mode, #fb_product_price",(function(e){setTimeout((function(){t(a(),o("#facebook_options"))}),1)})),o(".woocommerce_variations").on("change",".js-variable-fb-sync-toggle",(function(){let e=o(this),n="sync_disabled"!==e.val();c(n,e.closest(".wc-metabox-content")),t(a(),o("#facebook_options")),n&&f(l(e)),e.prop("original",e.val()),d(e)&&_(e)})),w.on("woocommerce_variations_loaded",(function(){w.find(".js-variable-fb-sync-toggle").each((function(e,n){let t=o(n);c("sync_disabled"!==t.val(),t.closest(".wc-metabox-content")),t.prop("original",t.val()),s(t)})),o(".variable_is_virtual").on("change",(function(){const e=o(this).closest(".wc-metabox-content").find(".js-variable-fb-sync-toggle");n(!o(this).prop("checked"),e)})),t(a(),o("#facebook_options"))})),w.on("change",".js-fb-product-image-source",(function(){let e=o(this).closest(".woocommerce_options_panel, .wc-metabox-content"),c=o(this).val();e.find(".product-image-source-field").closest(".form-field").hide(),e.find(`.show-if-product-image-source-${c}`).closest(".form-field").show()})),o(".js-fb-product-image-source:checked").trigger("change"),w.on("woocommerce_variations_loaded",(function(){o(".js-variable-fb-sync-toggle:visible").trigger("change"),o(".js-fb-product-image-source:checked").trigger("change"),o(".variable_is_virtual:visible").trigger("change")})),o("#facebook_options").on("click","#product-not-ready-notice-open-modal",(function(e){e.preventDefault(),closeExistingModal(),new o.WCBackboneModal.View({target:"facebook-for-woocommerce-modal",string:{message:facebook_for_woocommerce_products_admin.product_not_ready_modal_message,buttons:facebook_for_woocommerce_products_admin.product_not_ready_modal_buttons}})})),t(a(),v)}}));