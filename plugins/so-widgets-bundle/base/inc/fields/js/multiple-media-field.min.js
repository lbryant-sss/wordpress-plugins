!function(i){const e=function(){const e=i(this);if(e.data("initialized"))return;const t=e.find(".siteorigin-widget-input");let n=t.val().split(","),d=t.data("repeater");d&&(d.field=e.siblings(".siteorigin-widget-field-"+d.field).find(" > .siteorigin-widget-field-repeater"),d.addBtn=d.field.find("> .siteorigin-widget-field-repeater-add")),e.find(".button-secondary").on("click",function(a){if(a.preventDefault(),void 0===window.top.wp.media)return;const l=i(this);let o=i(this).data("frame");if(o)return o.open(),!1;o=window.top.wp.media({title:l.data("choose"),library:{type:l.data("library").split(",").map(function(i){return i.trim()})},multiple:!0,button:{text:l.data("update"),close:!1}}),d||o.on("open",function(){if(n.length){const e=o.state().get("selection");i.each(n,function(){e.add(window.top.wp.media.attachment(this))})}}),l.data("frame",o),o.on("select",function(){const a=[];let l,s,r,f,m;i.each(o.state().get("selection").models,function(){if(l=this.attributes,d)d.addBtn.trigger("click"),r=d.field.find("> .siteorigin-widget-field-repeater-items > .siteorigin-widget-field-repeater-item:last-of-type > .siteorigin-widget-field-repeater-item-form > .siteorigin-widget-field-"+d.setting),m=r.find(".siteorigin-widget-input").not(".media-fallback-external"),m.val(l.id),r.find(".thumbnail").show();else{if(a.push(l.id),-1!=n.indexOf(l.id.toString()))return;e.find(".multiple-media-field-template .multiple-media-field-item").clone().appendTo(e.find(".multiple-media-field-items")),r=e.find(".multiple-media-field-items .multiple-media-field-item").last(),r.attr("data-id",l.id)}f=r.find(".thumbnail"),f.attr("title",l.title),r.find(".title").html(l.title),s=void 0!==l.sizes?void 0!==l.sizes.thumbnail?l.sizes.thumbnail.url:l.sizes.full.url:l.icon,f.attr("src",s),d&&m.trigger("change",{silent:!0})}),e.find(".multiple-media-field-items .multiple-media-field-item").each(function(){-1==a.indexOf(i(this).data("id"))&&i(this).remove()}),a.length?(n=a,t.val(a.join(","))):(n=[],t.val("")),o.close()}),o.open()}),d||e.on("click","a.media-remove-button",function(e){e.preventDefault();const d=i(this).parent();n.splice(n.indexOf(d.data("id")),1),t.val(n.join(",")),d.remove()}),e.data("initialized",!0)};window.top===window.self&&"string"==typeof pagenow&&"site-editor"!==pagenow&&i(document).on("sowsetupformfield",".siteorigin-widget-field-type-multiple_media",e),window.addEventListener("message",function(t){t.data&&"sowbBlockFormInit"===t.data.action&&i(".siteorigin-widget-field-type-multiple_media").each(function(){e.call(this)})})}(jQuery);