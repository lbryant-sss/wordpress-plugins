!function(t){let e=!1;const i=function(i){if(i.attr("data-initialized"))return;i.attr("data-initialized",!0),frameElement&&void 0===window.tinyMCEPreInit&&(window.tinyMCEPreInit=window.top.tinyMCEPreInit);const n=wp.oldEditor?wp.oldEditor:wp.editor;n&&n.hasOwnProperty("autop")&&(wp.editor.autop=n.autop,wp.editor.removep=n.removep,wp.editor.initialize=n.initialize);const o=i.find(".siteorigin-widget-tinymce-container"),d=o.data("editorSettings");if(window.top.tinyMCEPreInit.mceInit&&window.top.tinyMCEPreInit.mceInit.hasOwnProperty("content")){const t=window.top.tinyMCEPreInit.mceInit.content;if(t.hasOwnProperty("content_css")&&t.content_css){const e=t.content_css.split(",");if(d.tinymce.hasOwnProperty("content_css")&&d.tinymce.content_css)for(let t=0;t<e.length;t++){const i=e[t];-1===d.tinymce.content_css.indexOf(i)&&(d.tinymce.content_css+=","+i)}else d.tinymce.content_css=e}}let s;if(d.wpautopToggleField){const t=o.closest(".siteorigin-widget-form");s=t.find(d.wpautopToggleField),d.tinymce.wpautop=s.is(":checked")}const c=o.find("textarea");let a=c.data("tinymce-id");if(a||(a=c.attr("id")+Math.floor(1e3*Math.random()),c.data("tinymce-id",a),c.attr("id",a)),t(window.document).one("wp-before-tinymce-init",function(t,n){if(n.selector!==d.tinymce.selector)return;const s=o.data("mediaButtons");void 0!==s&&0===i.find(".wp-media-buttons").length&&i.find(".wp-editor-tabs").before(s.html);const c=i.find(".add_media");if(c.length>0){const t=o.find("textarea").data("tinymce-id");c.attr("data-editor",t),window.frameElement&&c.removeClass("insert-media add_media").addClass("siteorigin-widget-tinymce-add-media").on("click",()=>{!function(t){if(e)return;e=!0;const i=window.top.wp.media({title:"Select or Upload Media",button:{text:"Insert Media"},multiple:!1});i.on("select",()=>{const e=i.state().get("selection").first().toJSON(),n=window.tinymce.get(t);n.insertContent(`<img src="${e.url}" alt="${e.alt}" />`),n.save(),n.fire("change")}),i.on("close",()=>{e=!1}),i.open()}(t)})}}),t(window.top.document).one("tinymce-editor-setup",function(){const t=i.find(".wp-editor-wrap");t.length>0&&!t.hasClass(d.selectedEditor+"-active")&&setTimeout(function(){window.switchEditors.go(a)},10)}),d.tinymce){const e=function(t){t.on("change",function(){window.tinymce.get(a).save(),c.trigger("change")}),s&&(s.off("change"),s.on("change",function(){window.wp.editor.remove(a),d.tinymce.wpautop=s.is(":checked"),window.wp.editor.initialize(a,d)}))};d.tinymce=t.extend({},d.tinymce,{selector:"#"+a,setup:function(t){window.frameElement&&t.on("init",()=>{const t=document.querySelector(`#${a}-html`);t&&(t.innerHTML=window.top.wp.i18n.__("Code"))}),e(t)}})}if(n.remove(a),window.tinymce&&window.tinymce.EditorManager.overrideDefaults({base_url:d.baseURL,suffix:d.suffix}),c.is(":visible"))n.initialize(a,d);else{const t=setInterval(function(){c.is(":visible")&&(n.initialize(a,d),clearInterval(t))},500)}i.on("click",function(e){const n=t(e.target);if(!n.is(".wp-switch-editor"))return;const o=n.hasClass("switch-tmce")?"tmce":"html";if("tmce"===o){const t=window.tinymce.get(a);if(null!==t){let e=c.val();-1!==e.search("<")&&-1===e.search(">")&&(e=e.replace(/</g,""),c.val(e)),t.setContent(window.switchEditors.wpautop(e))}}d.selectedEditor=o,i.find("textarea.wp-editor-area").css("visibility","tmce"===o?"hidden":"visible"),i.find(".siteorigin-widget-tinymce-selected-editor").val(o)})},n=function(){const e=t(this);e.is(":visible")?i(e):e.attr("data-pre-init")||e.attr("data-pre-init",!0).one("sowsetupformfield",()=>{i(e)})},o=function(e,n){let o;o=n.item.is(".siteorigin-widget-field-repeater-item")?n.item.find("> .siteorigin-widget-field-repeater-item-form"):n.item.find(".siteorigin-widget-form"),o.find(".siteorigin-widget-field-type-tinymce").each(function(){t(this).removeAttr("data-initialized"),i(t(this))})};window.top===window.self&&"string"==typeof pagenow&&"site-editor"!==pagenow&&t(document).on("sowsetupformfield",".siteorigin-widget-field-type-tinymce",n),t(document).on("sortstop",o),window.addEventListener("message",function(e){e.data&&"sowbBlockFormInit"===e.data.action&&(t(".siteorigin-widget-field-type-tinymce").each(function(){n.call(this)}),window.wp.editor.getDefaultSettings||(window.wp.editor.getDefaultSettings=window.top.wp.editor.getDefaultSettings),t(window.top.document).data("sortstop-bound")||(t(window.top.document).data("sortstop-bound",!0),t(window.top.document).on("sortstop",o)))})}(jQuery);