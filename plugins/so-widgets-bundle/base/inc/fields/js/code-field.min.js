(function(e){"use strict";var t,n=n||(t={},{add:function(e,n){var r;if("object"==typeof e)for(r=0;r<e.length;r++){var a=e[r];t[a]||(t[a]=[]),t[a].push(n)}else t[e]||(t[e]=[]),t[e].push(n)},get:function(e){if(t[e])return t[e]}}),r=r||function(t){"function"!=typeof String.prototype.repeat&&(String.prototype.repeat=function(e){if(e<1)return"";if(e%2)return this.repeat(e-1)+this;var t=this.repeat(e/2);return t+t}),"function"!=typeof Array.prototype.filter&&(Array.prototype.filter=function(e){if(null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=[],a=arguments[1],o=0;o<n;o++)if(o in t){var i=t[o];e.call(a,i,o,t)&&r.push(i)}return r});var r,a,o,i={textarea:null,replaceTab:!0,softTabs:!0,tabSize:4,autoOpen:!0,overwrite:!0,autoStrip:!0,autoIndent:!0,fence:!1},s={keyMap:[{open:'"',close:'"',canBreak:!1},{open:"'",close:"'",canBreak:!1},{open:"(",close:")",canBreak:!1},{open:"[",close:"]",canBreak:!0},{open:"{",close:"}",canBreak:!0}]},c={_callHook:function(t,r){var a=n.get(t);if(r="boolean"!=typeof r||!1!==r,a)if(r){var o,s=i.textarea,l=s.value,u=c.cursor.get();for(o=0;o<a.length;o++)a[o].call(e,{editor:{element:s,text:l,levelsDeep:c.levelsDeep()},caret:{pos:u},lines:{current:c.cursor.getLine(l,u),total:c.editor.getLines(l)}})}else for(o=0;o<a.length;o++)a[o].call(e)},defineNewLine:function(){var e=document.createElement("textarea");e.value="\n",a=2==e.value.length?"\r\n":"\n"},defineTabSize:function(e){void 0===i.textarea.style.OTabSize?void 0===i.textarea.style.MozTabSize?void 0===i.textarea.style.tabSize||(i.textarea.style.tabSize=e):i.textarea.style.MozTabSize=e:i.textarea.style.OTabSize=e},cursor:{getLine:function(e,t){return e.substring(0,t).split("\n").length},get:function(){if("number"==typeof document.createElement("textarea").selectionStart)return i.textarea.selectionStart;if(document.selection){var e=0,t=i.textarea.createTextRange(),n=document.selection.createRange().duplicate().getBookmark();for(t.moveToBookmark(n);0!==t.moveStart("character",-1);)e++;return e}},set:function(e,t){if(t||(t=e),i.textarea.setSelectionRange)i.textarea.trigger("focus"),i.textarea.setSelectionRange(e,t);else if(i.textarea.createTextRange){var n=i.textarea.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.trigger("select")}},selection:function(){var e,t,n,r,o,s=i.textarea,l=0,u=0;return"number"==typeof s.selectionStart&&"number"==typeof s.selectionEnd?(l=s.selectionStart,u=s.selectionEnd):(t=document.selection.createRange())&&t.parentElement()==s&&(r=(e=c.editor.get()).length,(n=s.createTextRange()).moveToBookmark(t.getBookmark()),(o=s.createTextRange()).collapse(!1),n.compareEndPoints("StartToEnd",o)>-1?l=u=r:(l=-n.moveStart("character",-r),l+=e.slice(0,l).split(a).length-1,n.compareEndPoints("EndToEnd",o)>-1?u=r:(u=-n.moveEnd("character",-r),u+=e.slice(0,u).split(a).length-1))),l!=u&&{start:l,end:u}}},editor:{getLines:function(e){return e.split("\n").length},get:function(){return i.textarea.value.replace(/\r/g,"")},set:function(e){i.textarea.value=e}},fenceRange:function(){if("string"==typeof i.fence){for(var e=c.editor.get(),t=c.cursor.get(),n=0,r=e.indexOf(i.fence),a=0;r>=0&&(a++,!(t<r+n));)n+=r+i.fence.length,r=(e=e.substring(r+i.fence.length)).indexOf(i.fence);return n<t&&r+n>t&&a%2==0}return!0},isEven:function(e,t){return t%2},levelsDeep:function(){var e,t,n=c.cursor.get(),r=c.editor.get().substring(0,n),a=0;for(e=0;e<r.length;e++)for(t=0;t<s.keyMap.length;t++)s.keyMap[t].canBreak&&(s.keyMap[t].open==r.charAt(e)&&a++,s.keyMap[t].close==r.charAt(e)&&a--);var o=0,i=["'",'"'];for(e=0;e<s.keyMap.length;e++)if(s.keyMap[e].canBreak)for(t in i)o+=r.split(i[t]).filter(c.isEven).join("").split(s.keyMap[e].open).length-1;var l=a-o;return l>=0?l:0},deepExtend:function(e,t){for(var n in t)t[n]&&t[n].constructor&&t[n].constructor===Object?(e[n]=e[n]||{},c.deepExtend(e[n],t[n])):e[n]=t[n];return e},addEvent:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},removeEvent:function(e,t,n){e.addEventListener?e.removeEventListener(t,n,!1):e.attachEvent&&e.detachEvent("on"+t,n)},preventDefaultEvent:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}},l=function(e){if(c.fenceRange()){if(9==e.keyCode){c.preventDefaultEvent(e);var t=!0;c._callHook("tab:before");var n=c.cursor.selection(),a=c.cursor.get(),o=c.editor.get();if(n){for(var i=n.start;i--;)if("\n"==o.charAt(i)){n.start=i+1;break}var s,l=o.substring(n.start,n.end),u=l.split("\n");if(e.shiftKey){for(s=0;s<u.length;s++)u[s].substring(0,r.length)==r&&(u[s]=u[s].substring(r.length));l=u.join("\n"),c.editor.set(o.substring(0,n.start)+l+o.substring(n.end)),c.cursor.set(n.start,n.start+l.length)}else{for(s in u)u[s]=r+u[s];l=u.join("\n"),c.editor.set(o.substring(0,n.start)+l+o.substring(n.end)),c.cursor.set(n.start,n.start+l.length)}}else{var f=o.substring(0,a),d=o.substring(a),g=f+r+d;e.shiftKey?o.substring(a-r.length,a)==r&&(g=o.substring(0,a-r.length)+d,c.editor.set(g),c.cursor.set(a-r.length)):(c.editor.set(g),c.cursor.set(a+r.length),t=!1)}c._callHook("tab:after")}return t}},u=function(e){if(c.fenceRange()&&13==e.keyCode){c.preventDefaultEvent(e),c._callHook("enter:before");var t,n,o=c.cursor.get(),i=c.editor.get(),l=i.substring(0,o),u=i.substring(o),f=l.charAt(l.length-1),d=u.charAt(0),g=c.levelsDeep(),p="",v="";if(g){for(;g--;)p+=r;for(t=p.length+1,n=0;n<s.keyMap.length;n++)s.keyMap[n].open==f&&s.keyMap[n].close==d&&(v=a)}else t=1;var h=l+a+p+v+p.substring(0,p.length-r.length)+u;c.editor.set(h),c.cursor.set(o+t),c._callHook("enter:after")}},f=function(e){if(c.fenceRange()&&8==e.keyCode){c.preventDefaultEvent(e),c._callHook("delete:before");var t,n=c.cursor.get(),r=c.editor.get(),a=r.substring(0,n),o=r.substring(n),i=a.charAt(a.length-1),l=o.charAt(0);if(!1===c.cursor.selection()){for(t=0;t<s.keyMap.length;t++)if(s.keyMap[t].open==i&&s.keyMap[t].close==l){var u=r.substring(0,n-1)+r.substring(n+1);return c.editor.set(u),void c.cursor.set(n-1)}u=r.substring(0,n-1)+r.substring(n);c.editor.set(u),c.cursor.set(n-1)}else{var f=c.cursor.selection();u=r.substring(0,f.start)+r.substring(f.end);c.editor.set(u),c.cursor.set(n)}c._callHook("delete:after")}},d=function(e,t){c.preventDefaultEvent(t),c._callHook("openChar:before");var n=c.cursor.get(),r=c.editor.get(),a=r.substring(0,n),o=r.substring(n),s=a+e.open+e.close+o;i.textarea.value=s,c.cursor.set(n+1),c._callHook("openChar:after")},g=function(e,t){var n=c.cursor.get();return c.editor.get().substring(n,n+1)==e.close&&(c.preventDefaultEvent(t),c._callHook("closeChar:before"),c.cursor.set(c.cursor.get()+1),c._callHook("closeChar:after"),!0)},p={filter:function(e){if(c.fenceRange()){var t=e.which||e.keyCode;if(39!=t&&(40!=t||0!==e.which)){var n,r=String.fromCharCode(t);for(n=0;n<s.keyMap.length;n++){if(s.keyMap[n].close==r)!(i.overwrite&&g(s.keyMap[n],e))&&s.keyMap[n].open==r&&i.autoOpen&&d(s.keyMap[n],e);else s.keyMap[n].open==r&&i.autoOpen&&d(s.keyMap[n],e)}}}},listen:function(){i.replaceTab&&c.addEvent(i.textarea,"keydown",l),i.autoIndent&&c.addEvent(i.textarea,"keydown",u),i.autoStrip&&c.addEvent(i.textarea,"keydown",f),c.addEvent(i.textarea,"keypress",p.filter),c.addEvent(i.textarea,"keydown",function(){c._callHook("keydown")}),c.addEvent(i.textarea,"keyup",function(){c._callHook("keyup")})}};this.destroy=function(){c.removeEvent(i.textarea,"keydown",l),c.removeEvent(i.textarea,"keydown",u),c.removeEvent(i.textarea,"keydown",f),c.removeEvent(i.textarea,"keypress",p.filter)},(o=t).textarea&&(c._callHook("init:before",!1),c.deepExtend(i,o),c.defineNewLine(),i.softTabs?r=" ".repeat(i.tabSize):(r="\t",c.defineTabSize(i.tabSize)),p.listen(),c._callHook("init:after",!1))};"undefined"!=typeof module&&module.exports&&(module.exports=r),"undefined"==typeof ender&&(this.Behave=r,this.BehaveHooks=n),"function"==typeof define&&define.amd&&define("behave",[],function(){return r})}).call(this),function(e){const t=function(t){const n=e(this);new Behave({textarea:n.find(".siteorigin-widget-code-input").get(0)})};window.top===window.self&&"string"==typeof pagenow&&"site-editor"!==pagenow&&e(document).on("sowsetupformfield",".siteorigin-widget-field-type-code",t),window.addEventListener("message",function(n){n.data&&"sowbBlockFormInit"===n.data.action&&e(".siteorigin-widget-field-type-code").each(function(){t.call(this)})})}(jQuery);