var wp;(wp||={}).annotations=(()=>{var X=Object.create;var l=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var J=Object.getPrototypeOf,K=Object.prototype.hasOwnProperty;var m=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),_=(t,e)=>{for(var n in e)l(t,n,{get:e[n],enumerable:!0})},S=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of z(e))!K.call(t,o)&&o!==n&&l(t,o,{get:()=>e[o],enumerable:!(r=q(e,o))||r.enumerable});return t};var p=(t,e,n)=>(n=t!=null?X(J(t)):{},S(e||!t||!t.__esModule?l(n,"default",{value:t,enumerable:!0}):n,t)),Q=t=>S(l({},"__esModule",{value:!0}),t);var g=m((Nt,D)=>{D.exports=window.wp.richText});var M=m((Tt,C)=>{C.exports=window.wp.i18n});var F=m((ht,G)=>{G.exports=window.wp.hooks});var d=m((It,B)=>{B.exports=window.wp.data});var _t={};_(_t,{store:()=>b});var k=p(g());var P=p(M()),T=p(g());var u="core/annotations";var E="core/annotation",N="annotation-text-";function Z(t,e=[]){return e.forEach(n=>{let{start:r,end:o}=n;r>t.text.length&&(r=t.text.length),o>t.text.length&&(o=t.text.length);let i=N+n.source,s=N+n.id;t=(0,T.applyFormat)(t,{type:E,attributes:{className:i,id:s}},r,o)}),t}function $(t){let e={};return t.forEach((n,r)=>{n=n||[],n=n.filter(o=>o.type===E),n.forEach(o=>{let{id:i}=o.attributes;i=i.replace(N,""),e.hasOwnProperty(i)||(e[i]={start:r}),e[i].end=r+1})}),e}function tt(t,e,{removeAnnotation:n,updateAnnotationRange:r}){t.forEach(o=>{let i=e[o.id];if(!i){n(o.id);return}let{start:s,end:x}=o;(s!==i.start||x!==i.end)&&r(o.id,i.start,i.end)})}var V={name:E,title:(0,P.__)("Annotation"),tagName:"mark",className:"annotation-text",attributes:{className:"class",id:"id"},edit(){return null},__experimentalGetPropsForEditableTreePreparation(t,{richTextIdentifier:e,blockClientId:n}){return{annotations:t(u).__experimentalGetAnnotationsForRichText(n,e)}},__experimentalCreatePrepareEditableTree({annotations:t}){return(e,n)=>{if(t.length===0)return e;let r={formats:e,text:n};return r=Z(r,t),r.formats}},__experimentalGetPropsForEditableTreeChangeHandler(t){return{removeAnnotation:t(u).__experimentalRemoveAnnotation,updateAnnotationRange:t(u).__experimentalUpdateAnnotationRange}},__experimentalCreateOnChangeEditableValue(t){return e=>{let n=$(e),{removeAnnotation:r,updateAnnotationRange:o,annotations:i}=t;tt(i,n,{removeAnnotation:r,updateAnnotationRange:o})}}};var{name:et,...nt}=V;(0,k.registerFormatType)(et,nt);var j=p(F()),H=p(d());var rt=t=>(0,H.withSelect)((e,{clientId:n,className:r})=>({className:e(u).__experimentalGetAnnotationsForBlock(n).map(i=>"is-annotated-by-"+i.source).concat(r).filter(Boolean).join(" ")}))(t);(0,j.addFilter)("editor.BlockListBlock","core/annotations",rt);var f=p(d());function L(t,e){let n=t.filter(e);return t.length===n.length?t:n}var R=(t,e)=>Object.entries(t).reduce((n,[r,o])=>({...n,[r]:e(o)}),{});function ot(t){return typeof t.start=="number"&&typeof t.end=="number"&&t.start<=t.end}function it(t={},e){switch(e.type){case"ANNOTATION_ADD":let n=e.blockClientId,r={id:e.id,blockClientId:n,richTextIdentifier:e.richTextIdentifier,source:e.source,selector:e.selector,range:e.range};if(r.selector==="range"&&!ot(r.range))return t;let o=t?.[n]??[];return{...t,[n]:[...o,r]};case"ANNOTATION_REMOVE":return R(t,i=>L(i,s=>s.id!==e.annotationId));case"ANNOTATION_UPDATE_RANGE":return R(t,i=>{let s=!1,x=i.map(A=>A.id===e.annotationId?(s=!0,{...A,range:{start:e.start,end:e.end}}):A);return s?x:i});case"ANNOTATION_REMOVE_SOURCE":return R(t,i=>L(i,s=>s.source!==e.source))}return t}var W=it;var h={};_(h,{__experimentalGetAllAnnotationsForBlock:()=>st,__experimentalGetAnnotations:()=>pt,__experimentalGetAnnotationsForBlock:()=>at,__experimentalGetAnnotationsForRichText:()=>ut});var y=p(d()),O=[],at=(0,y.createSelector)((t,e)=>(t?.[e]??[]).filter(n=>n.selector==="block"),(t,e)=>[t?.[e]??O]);function st(t,e){return t?.[e]??O}var ut=(0,y.createSelector)((t,e,n)=>(t?.[e]??[]).filter(r=>r.selector==="range"&&n===r.richTextIdentifier).map(r=>{let{range:o,...i}=r;return{...o,...i}}),(t,e)=>[t?.[e]??O]);function pt(t){return Object.values(t).flat()}var U={};_(U,{__experimentalAddAnnotation:()=>ct,__experimentalRemoveAnnotation:()=>ft,__experimentalRemoveAnnotationsBySource:()=>At,__experimentalUpdateAnnotationRange:()=>xt});var c,lt=new Uint8Array(16);function I(){if(!c&&(c=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!c))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return c(lt)}var a=[];for(let t=0;t<256;++t)a.push((t+256).toString(16).slice(1));function Y(t,e=0){return a[t[e+0]]+a[t[e+1]]+a[t[e+2]]+a[t[e+3]]+"-"+a[t[e+4]]+a[t[e+5]]+"-"+a[t[e+6]]+a[t[e+7]]+"-"+a[t[e+8]]+a[t[e+9]]+"-"+a[t[e+10]]+a[t[e+11]]+a[t[e+12]]+a[t[e+13]]+a[t[e+14]]+a[t[e+15]]}var mt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),v={randomUUID:mt};function dt(t,e,n){if(v.randomUUID&&!e&&!t)return v.randomUUID();t=t||{};let r=t.random||(t.rng||I)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){n=n||0;for(let o=0;o<16;++o)e[n+o]=r[o];return e}return Y(r)}var w=dt;function ct({blockClientId:t,richTextIdentifier:e=null,range:n=null,selector:r="range",source:o="default",id:i=w()}){let s={type:"ANNOTATION_ADD",id:i,blockClientId:t,richTextIdentifier:e,source:o,selector:r};return r==="range"&&(s.range=n),s}function ft(t){return{type:"ANNOTATION_REMOVE",annotationId:t}}function xt(t,e,n){return{type:"ANNOTATION_UPDATE_RANGE",annotationId:t,start:e,end:n}}function At(t){return{type:"ANNOTATION_REMOVE_SOURCE",source:t}}var b=(0,f.createReduxStore)(u,{reducer:W,selectors:h,actions:U});(0,f.register)(b);return Q(_t);})();
//# sourceMappingURL=index.min.js.map
