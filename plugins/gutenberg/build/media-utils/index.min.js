"use strict";var wp;(wp||={}).mediaUtils=(()=>{var ie=Object.create;var _=Object.defineProperty;var se=Object.getOwnPropertyDescriptor;var ae=Object.getOwnPropertyNames;var ne=Object.getPrototypeOf,le=Object.prototype.hasOwnProperty;var g=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),me=(e,t)=>{for(var o in t)_(e,o,{get:t[o],enumerable:!0})},D=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of ae(t))!le.call(e,i)&&i!==o&&_(e,i,{get:()=>t[i],enumerable:!(r=se(t,i))||r.enumerable});return e};var p=(e,t,o)=>(o=e!=null?ie(ne(e)):{},D(t||!e||!e.__esModule?_(o,"default",{value:e,enumerable:!0}):o,e)),de=e=>D(_({},"__esModule",{value:!0}),e);var N=g((be,j)=>{j.exports=window.wp.element});var h=g((Se,z)=>{z.exports=window.wp.i18n});var Y=g((Me,q)=>{q.exports=window.wp.blob});var P=g((Te,W)=>{W.exports=window.wp.apiFetch});var te=g((Qe,ee)=>{ee.exports=window.wp.privateApis});var we={};me(we,{MediaUpload:()=>J,privateApis:()=>L,transformAttachment:()=>y,uploadMedia:()=>H,validateFileSize:()=>x,validateMimeType:()=>T,validateMimeTypeForUser:()=>A});var k=p(N()),$=p(h()),pe=[],ce=()=>{let{wp:e}=window;return e.media.view.MediaFrame.Select.extend({featuredImageToolbar(t){this.createSelectToolbar(t,{text:e.media.view.l10n.setFeaturedImage,state:this.options.state})},editState(){let t=this.state("featured-image").get("selection"),o=new e.media.view.EditImage({model:t.single(),controller:this}).render();this.content.set(o),o.loadEditor()},createStates:function(){this.on("toolbar:create:featured-image",this.featuredImageToolbar,this),this.on("content:render:edit-image",this.editState,this),this.states.add([new e.media.controller.FeaturedImage,new e.media.controller.EditImage({model:this.options.editImage})])}})},fe=()=>{let{wp:e}=window;return e.media.view.MediaFrame.Select.extend({createStates(){let t=this.options;this.options.states||this.states.add([new e.media.controller.Library({library:e.media.query(t.library),multiple:t.multiple,title:t.title,priority:20,filterable:"uploaded"}),new e.media.controller.EditImage({model:t.editImage})])}})},he=()=>{let{wp:e}=window;return e.media.view.MediaFrame.Post.extend({galleryToolbar(){let t=this.state().get("editing");this.toolbar.set(new e.media.view.Toolbar({controller:this,items:{insert:{style:"primary",text:t?e.media.view.l10n.updateGallery:e.media.view.l10n.insertGallery,priority:80,requires:{library:!0},click(){let o=this.controller,r=o.state();o.close(),r.trigger("update",r.get("library")),o.setState(o.options.state),o.reset()}}}}))},editState(){let t=this.state("gallery").get("selection"),o=new e.media.view.EditImage({model:t.single(),controller:this}).render();this.content.set(o),o.loadEditor()},createStates:function(){this.on("toolbar:create:main-gallery",this.galleryToolbar,this),this.on("content:render:edit-image",this.editState,this),this.states.add([new e.media.controller.Library({id:"gallery",title:e.media.view.l10n.createGalleryTitle,priority:40,toolbar:"main-gallery",filterable:"uploaded",multiple:"add",editable:!1,library:e.media.query({type:"image",...this.options.library})}),new e.media.controller.EditImage({model:this.options.editImage}),new e.media.controller.GalleryEdit({library:this.options.selection,editing:this.options.editing,menu:"gallery",displaySettings:!1,multiple:!0}),new e.media.controller.GalleryAdd])}})},R=e=>["sizes","mime","type","subtype","id","url","alt","link","caption"].reduce((o,r)=>(e?.hasOwnProperty(r)&&(o[r]=e[r]),o),{}),F=e=>{let{wp:t}=window;return t.media.query({order:"ASC",orderby:"post__in",post__in:e,posts_per_page:-1,query:!0,type:"image"})},G=class extends k.Component{constructor(){super(...arguments),this.openModal=this.openModal.bind(this),this.onOpen=this.onOpen.bind(this),this.onSelect=this.onSelect.bind(this),this.onUpdate=this.onUpdate.bind(this),this.onClose=this.onClose.bind(this)}initializeListeners(){this.frame.on("select",this.onSelect),this.frame.on("update",this.onUpdate),this.frame.on("open",this.onOpen),this.frame.on("close",this.onClose)}buildAndSetGalleryFrame(){let{addToGallery:t=!1,allowedTypes:o,multiple:r=!1,value:i=pe}=this.props;if(i===this.lastGalleryValue)return;let{wp:s}=window;this.lastGalleryValue=i,this.frame&&this.frame.remove();let a;t?a="gallery-library":a=i&&i.length?"gallery-edit":"gallery",this.GalleryDetailsMediaFrame||(this.GalleryDetailsMediaFrame=he());let n=F(i),f=new s.media.model.Selection(n.models,{props:n.props.toJSON(),multiple:r});this.frame=new this.GalleryDetailsMediaFrame({mimeType:o,state:a,multiple:r,selection:f,editing:!!i?.length}),s.media.frame=this.frame,this.initializeListeners()}buildAndSetFeatureImageFrame(){let{wp:t}=window,{value:o,multiple:r,allowedTypes:i}=this.props,s=ce(),a=F(o),n=new t.media.model.Selection(a.models,{props:a.props.toJSON()});this.frame=new s({mimeType:i,state:"featured-image",multiple:r,selection:n,editing:o}),t.media.frame=this.frame,t.media.view.settings.post={...t.media.view.settings.post,featuredImageId:o||-1}}buildAndSetSingleMediaFrame(){let{wp:t}=window,{allowedTypes:o,multiple:r=!1,title:i=(0,$.__)("Select or Upload Media"),value:s}=this.props,a={title:i,multiple:r};o&&(a.library={type:o}),this.frame&&this.frame.remove();let n=fe(),f=F(s),v=new t.media.model.Selection(f.models,{props:f.props.toJSON()});this.frame=new n({mimeType:o,multiple:r,selection:v,...a}),t.media.frame=this.frame}componentWillUnmount(){this.frame?.remove()}onUpdate(t){let{onSelect:o,multiple:r=!1}=this.props,i=this.frame.state(),s=t||i.get("selection");!s||!s.models.length||o(r?s.models.map(a=>R(a.toJSON())):R(s.models[0].toJSON()))}onSelect(){let{onSelect:t,multiple:o=!1}=this.props,r=this.frame.state().get("selection").toJSON();t(o?r:r[0])}onOpen(){let{wp:t}=window,{value:o}=this.props;if(this.updateCollection(),this.props.mode&&this.frame.content.mode(this.props.mode),!(Array.isArray(o)?!!o?.length:!!o))return;let i=this.props.gallery,s=this.frame.state().get("selection"),a=Array.isArray(o)?o:[o];i||a.forEach(f=>{s.add(t.media.attachment(f))});let n=F(a);n.more().done(function(){i&&n?.models?.length&&s.add(n.models)})}onClose(){let{onClose:t}=this.props;t&&t(),this.frame.detach()}updateCollection(){let t=this.frame.content.get();if(t&&t.collection){let o=t.collection;o.toArray().forEach(r=>r.trigger("destroy",r)),o.mirroring._hasMore=!0,o.more()}}openModal(){let{gallery:t=!1,unstableFeaturedImageFlow:o=!1,modalClass:r}=this.props;t?this.buildAndSetGalleryFrame():this.buildAndSetSingleMediaFrame(),r&&this.frame.$el.addClass(r),o&&this.buildAndSetFeatureImageFrame(),this.initializeListeners(),this.frame.open()}render(){return this.props.render({open:this.openModal})}},J=G;var S=p(h()),I=p(Y());var B=p(P());function ue(e){return e!==null&&typeof e=="object"&&Object.getPrototypeOf(e)===Object.prototype}function b(e,t,o){if(ue(o))for(let[r,i]of Object.entries(o))b(e,`${t}[${r}]`,i);else o!==void 0&&e.append(t,String(o))}function y(e){let{alt_text:t,source_url:o,...r}=e;return{...r,alt:e.alt_text,caption:e.caption?.raw??"",title:e.title.raw,url:e.source_url,poster:e._embedded?.["wp:featuredmedia"]?.[0]?.source_url||void 0}}async function V(e,t={},o){let r=new FormData;r.append("file",e,e.name||e.type.replace("/","."));for(let[i,s]of Object.entries(t))b(r,i,s);return y(await(0,B.default)({path:"/wp/v2/media?_embed=wp:featuredmedia",body:r,method:"POST",signal:o}))}var M=p(h());var m=class extends Error{code;file;constructor({code:t,message:o,file:r,cause:i}){super(o,{cause:i}),Object.setPrototypeOf(this,new.target.prototype),this.code=t,this.file=r}};function T(e,t){if(!t)return;let o=t.some(r=>r.includes("/")?r===e.type:e.type.startsWith(`${r}/`));if(e.type&&!o)throw new m({code:"MIME_TYPE_NOT_SUPPORTED",message:(0,M.sprintf)((0,M.__)("%s: Sorry, this file type is not supported here."),e.name),file:e})}var E=p(h());function Z(e){return e?Object.entries(e).flatMap(([t,o])=>{let[r]=o.split("/"),i=t.split("|");return[o,...i.map(s=>`${r}/${s}`)]}):null}function A(e,t){let o=Z(t);if(!o)return;let r=o.includes(e.type);if(e.type&&!r)throw new m({code:"MIME_TYPE_NOT_ALLOWED_FOR_USER",message:(0,E.sprintf)((0,E.__)("%s: Sorry, you are not allowed to upload this file type."),e.name),file:e})}var w=p(h());function x(e,t){if(e.size<=0)throw new m({code:"EMPTY_FILE",message:(0,w.sprintf)((0,w.__)("%s: This file is empty."),e.name),file:e});if(t&&e.size>t)throw new m({code:"SIZE_ABOVE_LIMIT",message:(0,w.sprintf)((0,w.__)("%s: This file exceeds the maximum upload size for this site."),e.name),file:e})}function H({wpAllowedMimeTypes:e,allowedTypes:t,additionalData:o={},filesList:r,maxUploadFileSize:i,onError:s,onFileChange:a,signal:n,multiple:f=!0}){if(!f&&r.length>1){s?.(new Error((0,S.__)("Only one file can be used here.")));return}let v=[],u=[],C=(l,c)=>{window.__experimentalMediaProcessing||u[l]?.url&&(0,I.revokeBlobURL)(u[l].url),u[l]=c,a?.(u.filter(d=>d!==null))};for(let l of r){try{A(l,e)}catch(c){s?.(c);continue}try{T(l,t)}catch(c){s?.(c);continue}try{x(l,i)}catch(c){s?.(c);continue}v.push(l),window.__experimentalMediaProcessing||(u.push({url:(0,I.createBlobURL)(l)}),a?.(u))}v.map(async(l,c)=>{try{let d=await V(l,o,n);C(c,d)}catch(d){C(c,null);let U;typeof d=="object"&&d!==null&&"message"in d?U=typeof d.message=="string"?d.message:String(d.message):U=(0,S.sprintf)((0,S.__)("Error while uploading file %s to the media library."),l.name),s?.(new m({code:"GENERAL",message:U,file:l,cause:d instanceof Error?d:void 0}))}})}var O=p(h());var K=p(P());async function Q(e,t,o={},r){let i=new FormData;i.append("file",e,e.name||e.type.replace("/","."));for(let[s,a]of Object.entries(o))b(i,s,a);return y(await(0,K.default)({path:`/wp/v2/media/${t}/sideload`,body:i,method:"POST",signal:r}))}var ye=()=>{};async function X({file:e,attachmentId:t,additionalData:o={},signal:r,onFileChange:i,onError:s=ye}){try{let a=await Q(e,t,o,r);i?.([a])}catch(a){let n;a instanceof Error?n=a.message:n=(0,O.sprintf)((0,O.__)("Error while sideloading file %s to the server."),e.name),s(new m({code:"GENERAL",message:n,file:e,cause:a instanceof Error?a:void 0}))}}var oe=p(te()),{lock:re,unlock:Xe}=(0,oe.__dangerousOptInToUnstableAPIsOnlyForCoreModules)("I acknowledge private features are not for use in themes or plugins and doing so will break in the next version of WordPress.","@wordpress/media-utils");var L={};re(L,{sideloadMedia:X});return de(we);})();
//# sourceMappingURL=index.min.js.map
