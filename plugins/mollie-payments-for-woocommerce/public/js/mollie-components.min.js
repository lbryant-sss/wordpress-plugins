(()=>{const e=".cardToken",t="#mollie-notice",o=()=>!1,n=()=>!0,r=(e,...t)=>{console.log(`[Mollie Components] ${e}`,...t)},a=new Map,c=(e=document)=>e.querySelector(".wc_payment_methods"),l=(e,t=document)=>t.querySelector(`.payment_method_mollie_wc_gateway_${e}`),s=e=>e?e.querySelector(".mollie-components"):(r("Components container search failed: no container provided"),null),i=e=>{const o=((e=document)=>e.querySelector(t))()||c();o&&e.scroll_to_notices?e.scroll_to_notices(e(o)):o&&o.scrollIntoView({behavior:"smooth",block:"center"})},u=e=>e?e.closest("form"):null,m=e=>{e.off("checkout_place_order",o),e.off("submit",d)},d=async o=>{const{jQuery:n,mollie:a,gateway:s,gatewayContainer:d,messages:y}=o.data,p=n(u(d)),f=n(document.body);if(!(e=>{const t=l(e);if(!t)return!1;const o=t.querySelector(`#payment_method_mollie_wc_gateway_${e}`);return!!o&&o.checked})(s))return m(p),void p.submit();o.preventDefault(),o.stopImmediatePropagation();try{const t=await(async t=>await(async t=>{const{token:o,error:n}=await t.createToken(e);if(n)throw r("Token creation failed:",n),new Error(n.message||"");return o})(t))(a);((t,o,n)=>{var r;m(n),t&&((e,t)=>{t&&(t.value=e,t.setAttribute("value",e))})(t,(r=o)?r.querySelector(e):null),n.submit()})(t,d,p)}catch(e){((e,o,n,r,a)=>{const l=o?.message||n.defaultErrorMessage;l&&((e,o)=>{const n=c(),r=n?u(n):null,a=r?r.parentElement:null,l=document.querySelector(t),s=((e,t)=>{const o=document.createElement("div");return o.id="mollie-notice",o.className=`woocommerce-${t}`,o.innerHTML=e,o})(o.content,o.type);l&&l.remove(),a?(a.insertAdjacentElement("beforebegin",s),i(e)):alert(o.content)})(e,{content:l,type:"error"}),r.removeClass("processing").unblock(),a.trigger("checkout_error")})(n,e,y,p,f)}},y=(e,t,o)=>`<${e} ${Object.entries(t).map(([e,t])=>`${e}="${t}"`).join(" ")}>${o}</${e}>`,p=(e,t,o,n,c)=>{const{name:l}=o,i=((e,t,o,n)=>n.has(e)?n.get(e):t.createComponent(e,o))(l,e,t,n);((e,t)=>{const o=document.createElement("div");o.id=e,t.appendChild(o)})(l,s(c)),((e,t)=>{e.mount(`#${t}`),setTimeout(()=>{((e,t)=>{if(a.has(t))try{const o=a.get(t);o&&"function"==typeof e.setValue&&e.setValue(o)}catch(e){r("Could not restore state for component:",t,e)}})(e,t)},100)})(i,l);const u=(m=l,(d=c)?d.querySelector(`.mollie-component--${m}`):null);var m,d;u?(((e,t)=>{((e,{label:t})=>{const o=y("b",{class:"mollie-component-label"},t);e.insertAdjacentHTML("beforebegin",o)})(e,t),((e,{name:t})=>{const o=y("div",{role:"alert",id:`${t}-errors`},"");e.insertAdjacentHTML("afterend",o)})(e,t)})(u,o),((e,t)=>{const o=document.querySelector(`#${t}-errors`);e.addEventListener("change",e=>{e.error&&e.touched?o&&(o.textContent=e.error):o&&(o.textContent="")})})(i,l),n.set(l,i)):console.warn(`Component ${l} not found in the DOM. Probably had problem during mount.`)},f=(e,t,{options:n,merchantProfileId:c,componentsSettings:i,componentsAttributes:y,enabledGateways:f,messages:h},g)=>{f.forEach(n=>{const c=l(n),f=s(c),w=u(c),b=e(w);var _;c?w?(((e,t)=>{const o=l(e),n=s(o);if(!n)return!0;const r=n.querySelectorAll("[id]").length>0,a=t.size>0;return!r||!a})(n,g)?((e=>{(e=>{e.forEach((e,t)=>{try{e&&"function"==typeof e.getValue&&a.set(t,e.getValue())}catch(e){r("Could not preserve state for component:",t,e)}})})(e),e.forEach((e,t)=>{try{e.unmount()}catch(e){r("Error unmounting component:",t,e)}})})(g),(_=f)?_.innerHTML="":r("Cannot clean container: container is null"),(e=>{const t=document.createElement("input");t.type="hidden",t.name="cardToken",t.className="cardToken",t.value="",e.appendChild(t)})(f),((e,t,o,n,r)=>{o.forEach(o=>p(e,t,o,n,r))})(t,i[n],y,g,c)):r("Components already mounted for gateway:",n),m(b),b.on("checkout_place_order",o),b.on("submit",null,{jQuery:e,mollie:t,gateway:n,gatewayContainer:c,messages:h},d)):console.warn("Cannot initialize Mollie Components, no form found."):console.warn(`Cannot initialize Mollie Components for gateway ${n}.`)})};(e=>{const{Mollie:t,mollieComponentsSettings:o,jQuery:a}=e;if(null==(c=o)||("object"==typeof c?Array.isArray(c)?0===c.length:0===Object.keys(c).length:"string"==typeof c&&0===c.length)||!(e=>"function"==typeof e)(t))return;var c;let s="updated_checkout";const i=new Map,u=a(document),{merchantProfileId:m,options:d,isCheckoutPayPage:y}=o,p=new t(m,d);if(y)return s="payment_method_selected",void u.on(s,()=>{f(a,p,o,i)});const h=((e,t,o,a)=>function(){const c=(s=o,Array.isArray(s)?[...s]:s&&"object"==typeof s?{...s}:s);var s;c.enabledGateways=o.enabledGateways.filter(t=>!!l(t)||(r("Gateway container not found, enabling fallback for:",t),e('form[name="checkout"]').on("checkout_place_order",n),!1)),0!==c.enabledGateways.length&&(r("Proceeding with enhanced initialization for gateways:",c.enabledGateways),f(e,t,c,a))})(a,p,o,i);let g;const w=function(){clearTimeout(g),g=setTimeout(h,250)};u.on(s,w),u.on("update_checkout",w)})(window)})();