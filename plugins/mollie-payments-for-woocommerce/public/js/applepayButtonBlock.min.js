(()=>{"use strict";const e=window.wp.data;function t(e){const t=[];for(const a of e){const{contactField:e=null,code:o=null,message:n=null}=a,i=e?new ApplePayError(o,e,n):new ApplePayError(o);t.push(i)}return t}const a=window.ReactJSXRuntime,o=({buttonAttributes:o={}})=>{let n=window.mollieApplePayBlockDataCart||window.mollieBlockData.mollieApplePayBlockDataCart;0===n.length&&(n=window.mollieBlockData.gatewayData.appleButtonData);let i=!1,p=document.getElementById("woocommerce-process-checkout-nonce");p&&(i=p.value),i||(i=window.mollieBlockData.gatewayData.appleButtonData.nonce);let s=[],l="";const{shop:{countryCode:r,totalLabel:c=""},ajaxUrl:d}=n,m=(0,e.select)("wc/store/cart"),u=m.getNeedsShipping(),h=m.getCartTotals().total_price,_=window.wcSettings.currency.code,g=m.getCartTotals().currency_minor_unit,y=h/Math.pow(10,g),w={height:`${(b=o).height||48}px`,borderRadius:`${b.borderRadius||4}px`};var b;let C=[],f=()=>{const e=new ApplePaySession(3,((e,t,a,o)=>({countryCode:e,currencyCode:t,supportedNetworks:["amex","maestro","masterCard","visa","vPay"],merchantCapabilities:["supports3DS"],shippingType:"shipping",requiredBillingContactFields:["postalAddress","email"],requiredShippingContactFields:["postalAddress","email"],total:{label:a,amount:o,type:"final"}}))(r,_,c,y));e.begin(),e.onshippingmethodselected=function(a){jQuery.ajax({url:d,method:"POST",data:{action:"mollie_apple_pay_update_shipping_method",shippingMethod:a.shippingMethod,callerPage:"cart",simplifiedContact:s,"woocommerce-process-checkout-nonce":i},complete:(e,t)=>{},success:(e,o,n)=>{let i=e.data;C=a.shippingMethod,!1===e.success&&(i.errors=t(i.errors)),this.completeShippingMethodSelection(i)},error:(t,a,o)=>{console.warn(a,o),e.abort()}})},e.onshippingcontactselected=function(a){jQuery.ajax({url:d,method:"POST",data:{action:"mollie_apple_pay_update_shipping_contact",simplifiedContact:a.shippingContact,callerPage:"cart",needShipping:u,"woocommerce-process-checkout-nonce":i},complete:(e,t)=>{},success:(e,o,n)=>{let i=e.data;s=a.shippingContact,!1===e.success&&(i.errors=t(i.errors)),i.newShippingMethods&&(C=i.newShippingMethods[0]),this.completeShippingContactSelection(i)},error:(t,a,o)=>{console.warn(a,o),e.abort()}})},e.onvalidatemerchant=t=>{jQuery.ajax({url:d,method:"POST",data:{action:"mollie_apple_pay_validation",validationUrl:t.validationURL,"woocommerce-process-checkout-nonce":i},complete:(e,t)=>{},success:(t,a,o)=>{!0===t.success?e.completeMerchantValidation(JSON.parse(t.data)):(console.warn(t.data),e.abort())},error:(t,a,o)=>{console.warn(a,o),e.abort()}})},e.onpaymentauthorized=a=>{const{billingContact:o,shippingContact:n}=a.payment;jQuery.ajax({url:d,method:"POST",data:{action:"mollie_apple_pay_create_order_cart",shippingContact:a.payment.shippingContact,billingContact:a.payment.billingContact,token:a.payment.token,shippingMethod:C,"mollie-payments-for-woocommerce_issuer_applepay":"applepay","woocommerce-process-checkout-nonce":i,billing_first_name:o.givenName||"",billing_last_name:o.familyName||"",billing_company:"",billing_country:o.countryCode||"",billing_address_1:o.addressLines[0]||"",billing_address_2:o.addressLines[1]||"",billing_postcode:o.postalCode||"",billing_city:o.locality||"",billing_state:o.administrativeArea||"",billing_phone:o.phoneNumber||"000000000000",billing_email:n.emailAddress||"",shipping_first_name:n.givenName||"",shipping_last_name:n.familyName||"",shipping_company:"",shipping_country:n.countryCode||"",shipping_address_1:n.addressLines[0]||"",shipping_address_2:n.addressLines[1]||"",shipping_postcode:n.postalCode||"",shipping_city:n.locality||"",shipping_state:n.administrativeArea||"",shipping_phone:n.phoneNumber||"000000000000",shipping_email:n.emailAddress||"",order_comments:"",payment_method:"mollie_wc_gateway_applepay",_wp_http_referer:"/?wc-ajax=update_order_review"},complete:(e,t)=>{},success:(a,o,n)=>{let i=a.data;!0===a.success?(l=i.returnUrl,e.completePayment(i.responseToApple),window.location.href=l):(i.errors=t(i.errors),e.completePayment(i))},error:(t,a,o)=>{console.warn(a,o),e.abort()}})}};return(0,a.jsx)("button",{id:"mollie_applepay_button",className:"apple-pay-button apple-pay-button-black",onClick:e=>{e.preventDefault(),f()},style:w})},n=({buttonAttributes:e={}})=>{const t={height:`${e.height||48}px`,borderRadius:`${e.borderRadius||4}px`};return(0,a.jsx)("button",{id:"mollie_applepay_button",className:"apple-pay-button apple-pay-button-black",style:t})};!function({mollieApplePayBlockDataCart:e}){if(0===e.length)return;const{ApplePaySession:t}=window;if(!t||!t.canMakePayments())return null;const{registerExpressPaymentMethod:i}=wc.wcBlocksRegistry;i({name:"mollie_wc_gateway_applepay_express",content:(0,a.jsx)(o,{}),edit:(0,a.jsx)(n,{}),ariaLabel:"Apple Pay",canMakePayment:()=>!0,paymentMethodId:"mollie_wc_gateway_applepay",supports:{features:["products"]}})}(window)})();