(()=>{"use strict";function e(e){const t=[];for(const o of e){const{contactField:e=null,code:n=null,message:a=null}=o,i=e?new ApplePayError(n,e,a):new ApplePayError(n);t.push(i)}return t}const t=()=>{const{ApplePaySession:e}=window,t=document.querySelector("#mollie-applepayDirect-button");if(!(t&&e&&e.canMakePayments()))return!1;const o=document.createElement("button");return o.setAttribute("id","mollie_applepay_button"),o.classList.add("apple-pay-button"),o.classList.add("apple-pay-button-black"),t.appendChild(o),!0};!function({_:o,mollieApplePayDirectDataCart:n,jQuery:a}){if(o.isEmpty(n))return;const{product:{needShipping:i=!0,subtotal:p},shop:{countryCode:s,currencyCode:c="EUR",totalLabel:r=""},ajaxUrl:l}=n;if(!p||!s||!l)return;const d=document.getElementById("woocommerce-process-checkout-nonce").value;let m=[],u=[],_="";const h=()=>{const t=new ApplePaySession(3,((e,t,o,n)=>({countryCode:e,currencyCode:t,supportedNetworks:["amex","maestro","masterCard","visa","vPay"],merchantCapabilities:["supports3DS"],shippingType:"shipping",requiredBillingContactFields:["postalAddress","email"],requiredShippingContactFields:["postalAddress","email"],total:{label:o,amount:n,type:"final"}}))(s,c,r,Math.round(p)));t.begin(),t.onshippingmethodselected=function(o){a.ajax({url:l,method:"POST",data:{action:"mollie_apple_pay_update_shipping_method",shippingMethod:o.shippingMethod,callerPage:"cart",simplifiedContact:m,"woocommerce-process-checkout-nonce":d},complete:(e,t)=>{},success:(t,n,a)=>{const i=t.data;u=o.shippingMethod,!1===t.success&&(i.errors=e(i.errors)),this.completeShippingMethodSelection(i)},error:(e,o,n)=>{console.warn(o,n),t.abort()}})},t.onshippingcontactselected=function(o){a.ajax({url:l,method:"POST",data:{action:"mollie_apple_pay_update_shipping_contact",simplifiedContact:o.shippingContact,callerPage:"cart",needShipping:i,"woocommerce-process-checkout-nonce":d},complete:(e,t)=>{},success:(t,n,a)=>{const i=t.data;m=o.shippingContact,!1===t.success&&(i.errors=e(i.errors)),i.newShippingMethods&&(u=i.newShippingMethods[0]),this.completeShippingContactSelection(i)},error:(e,o,n)=>{console.warn(o,n),t.abort()}})},t.onvalidatemerchant=e=>{a.ajax({url:l,method:"POST",data:{action:"mollie_apple_pay_validation",validationUrl:e.validationURL,"woocommerce-process-checkout-nonce":d},complete:(e,t)=>{},success:(e,o,n)=>{!0===e.success?t.completeMerchantValidation(JSON.parse(e.data)):(console.warn(e.data),t.abort())},error:(e,o,n)=>{console.warn(o,n),t.abort()}})},t.onpaymentauthorized=o=>{const{billingContact:n,shippingContact:i}=o.payment;a.ajax({url:l,method:"POST",data:{action:"mollie_apple_pay_create_order_cart",shippingContact:o.payment.shippingContact,billingContact:o.payment.billingContact,token:o.payment.token,shippingMethod:u,"mollie-payments-for-woocommerce_issuer_applepay":"applepay","woocommerce-process-checkout-nonce":d,billing_first_name:n.givenName||"",billing_last_name:n.familyName||"",billing_company:"",billing_country:n.countryCode||"",billing_address_1:n.addressLines[0]||"",billing_address_2:n.addressLines[1]||"",billing_postcode:n.postalCode||"",billing_city:n.locality||"",billing_state:n.administrativeArea||"",billing_phone:n.phoneNumber||"000000000000",billing_email:i.emailAddress||"",shipping_first_name:i.givenName||"",shipping_last_name:i.familyName||"",shipping_company:"",shipping_country:i.countryCode||"",shipping_address_1:i.addressLines[0]||"",shipping_address_2:i.addressLines[1]||"",shipping_postcode:i.postalCode||"",shipping_city:i.locality||"",shipping_state:i.administrativeArea||"",shipping_phone:i.phoneNumber||"000000000000",shipping_email:i.emailAddress||"",order_comments:"",payment_method:"mollie_wc_gateway_applepay",_wp_http_referer:"/?wc-ajax=update_order_review"},complete:(e,t)=>{},success:(o,n,a)=>{const i=o.data;!0===o.success?(_=i.returnUrl,t.completePayment(i.responseToApple),window.location.href=_):(i.errors=e(i.errors),t.completePayment(i))},error:(e,o,n)=>{console.warn(o,n),t.abort()}})}};t()&&(a(document.body).on("updated_cart_totals",function(e){t(),document.querySelector("#mollie_applepay_button").addEventListener("click",e=>{e.preventDefault(),h()})}),document.querySelector("#mollie_applepay_button").addEventListener("click",e=>{e.preventDefault(),h()}))}(window)})();