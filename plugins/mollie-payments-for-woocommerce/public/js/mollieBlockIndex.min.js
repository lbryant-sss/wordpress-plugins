(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{clearComponentContainer:()=>le,clearComponentError:()=>Q,clearTokenData:()=>ae,clearTokenError:()=>oe,setActivePaymentMethod:()=>O,setBillingData:()=>q,setCardToken:()=>U,setComponentContainer:()=>re,setComponentError:()=>W,setComponentFocused:()=>X,setComponentInitialized:()=>Y,setComponentInitializing:()=>K,setComponentMounted:()=>Z,setComponentMounting:()=>J,setComponentsReady:()=>ie,setGatewayComponents:()=>se,setInputBirthdate:()=>F,setInputCompany:()=>L,setInputPhone:()=>R,setPaymentItemData:()=>j,setPhoneFieldVisible:()=>z,setPhonePlaceholder:()=>H,setRequiredFields:()=>B,setSelectedIssuer:()=>D,setShippingData:()=>$,setTokenCreated:()=>te,setTokenCreating:()=>ee,setTokenError:()=>ne,setValidationState:()=>G,updatePhonePlaceholderByCountry:()=>V});const n=window.wp.data,o="SET_SELECTED_ISSUER",a="SET_INPUT_PHONE",i="SET_INPUT_BIRTHDATE",s="SET_INPUT_COMPANY",r="SET_ACTIVE_PAYMENT_METHOD",l="SET_PAYMENT_ITEM_DATA",c="SET_REQUIRED_FIELDS",p="SET_PHONE_FIELD_VISIBLE",d="SET_BILLING_DATA",m="SET_SHIPPING_DATA",u="SET_VALIDATION_STATE",h="SET_PHONE_PLACEHOLDER",y="SET_CARD_TOKEN",g="SET_COMPONENT_INITIALIZING",_="SET_COMPONENT_INITIALIZED",C="SET_COMPONENT_ERROR",w="CLEAR_COMPONENT_ERROR",E="SET_COMPONENT_MOUNTING",b="SET_COMPONENT_MOUNTED",P="SET_COMPONENT_FOCUSED",T="SET_TOKEN_CREATING",f="SET_TOKEN_CREATED",x="SET_TOKEN_ERROR",I="CLEAR_TOKEN_ERROR",k="CLEAR_TOKEN_DATA",M="SET_COMPONENTS_READY",v="SET_GATEWAY_COMPONENTS",S="SET_COMPONENT_CONTAINER",N="CLEAR_COMPONENT_CONTAINER",A={selectedIssuer:"",inputPhone:"",inputBirthdate:"",inputCompany:"",activePaymentMethod:"",paymentItemData:{},requiredFields:{companyNameString:"",phoneString:""},shouldHidePhoneField:!0,billingData:{},shippingData:{},isValid:!0,phonePlaceholder:"+316xxxxxxxx",cardToken:"",componentInitializing:!1,componentInitialized:!1,componentError:null,componentMounting:{},componentMounted:{},componentFocused:{},tokenCreating:!1,tokenCreated:!1,tokenError:null,componentsReady:{},gatewayComponents:{},componentContainers:{}},D=e=>({type:o,payload:e}),R=e=>({type:a,payload:e}),F=e=>({type:i,payload:e}),L=e=>({type:s,payload:e}),O=e=>({type:r,payload:e}),j=e=>({type:l,payload:e}),B=e=>({type:c,payload:e}),z=e=>({type:p,payload:e}),q=e=>({type:d,payload:e}),$=e=>({type:m,payload:e}),G=e=>({type:u,payload:e}),H=e=>({type:h,payload:e}),U=e=>({type:y,payload:e}),V=e=>({dispatch:t})=>{const n={BE:"+32xxxxxxxxx",NL:"+316xxxxxxxx",DE:"+49xxxxxxxxx",AT:"+43xxxxxxxxx",ES:"+34xxxxxxxxx",AD:"+372xxxxxxxxx"};t(H(n[e]||n.NL))},K=e=>({type:g,payload:e}),Y=e=>({type:_,payload:e}),W=e=>({type:C,payload:e}),Q=()=>({type:w}),J=(e,t)=>({type:E,payload:{gateway:e,isMounting:t}}),Z=(e,t)=>({type:b,payload:{gateway:e,isMounted:t}}),X=(e,t)=>({type:P,payload:{componentName:e,isFocused:t}}),ee=e=>({type:T,payload:e}),te=e=>({type:f,payload:e}),ne=e=>({type:x,payload:e}),oe=()=>({type:I}),ae=()=>({type:k}),ie=(e,t)=>({type:M,payload:{gateway:e,isReady:t}}),se=(e,t)=>({type:v,payload:{gateway:e,components:t}}),re=(e,t)=>({type:S,payload:{gateway:e,container:t}}),le=e=>({type:N,payload:{gateway:e}}),ce={getSelectedIssuer:e=>e.selectedIssuer,getInputPhone:e=>e.inputPhone,getInputBirthdate:e=>e.inputBirthdate,getInputCompany:e=>e.inputCompany,getActivePaymentMethod:e=>e.activePaymentMethod,getPaymentItemData:e=>e.paymentItemData,getRequiredFields:e=>e.requiredFields,getshouldHidePhoneField:e=>e.shouldHidePhoneField,getBillingData:e=>e.billingData,getShippingData:e=>e.shippingData,getIsValid:e=>e.isValid,getPhonePlaceholder:e=>e.phonePlaceholder,getCardToken:e=>e.cardToken,getIssuerKey:e=>`mollie-payments-for-woocommerce_issuer_${e.activePaymentMethod}`,getComponentInitializing:e=>e.componentInitializing,getComponentInitialized:e=>e.componentInitialized,getComponentError:e=>e.componentError,getComponentMounting:(e,t)=>e.componentMounting[t]||!1,getComponentMounted:(e,t)=>e.componentMounted[t]||!1,getComponentFocused:(e,t)=>e.componentFocused[t]||!1,getTokenCreating:e=>e.tokenCreating,getTokenCreated:e=>e.tokenCreated,getTokenError:e=>e.tokenError,getComponentsReady:(e,t)=>e.componentsReady[t]||!1,getGatewayComponents:(e,t)=>e.gatewayComponents[t]||[],getIsComponentReady:e=>{const t=e.activePaymentMethod;return e.componentInitialized&&e.componentMounted[t]&&!e.componentError&&!e.componentInitializing},getIsTokenReady:e=>e.tokenCreated&&e.cardToken&&!e.tokenError&&!e.tokenCreating,getCanCreateToken:e=>{const t=e.activePaymentMethod;return ce.getIsComponentReady(e)&&!e.tokenCreating&&t&&e.componentMounted[t]},getPaymentMethodData:e=>({payment_method:e.activePaymentMethod,payment_method_title:e.paymentItemData.title,[`mollie-payments-for-woocommerce_issuer_${e.activePaymentMethod}`]:e.selectedIssuer,billing_phone:e.inputPhone,billing_company_billie:e.inputCompany,billing_birthdate:e.inputBirthdate,cardToken:e.cardToken,tokenCreated:e.tokenCreated,componentsReady:ce.getIsComponentReady(e)}),getComponentContainer:(e,t)=>e.componentContainers[t]||null},pe=ce,de="mollie-payments",me="wc/store/payment",ue=(0,n.createReduxStore)(de,{reducer:(e=A,t)=>{switch(t.type){case o:return{...e,selectedIssuer:t.payload};case a:return{...e,inputPhone:t.payload};case i:return{...e,inputBirthdate:t.payload};case s:return{...e,inputCompany:t.payload};case r:return{...e,activePaymentMethod:t.payload};case l:return{...e,paymentItemData:t.payload};case c:return{...e,requiredFields:{...e.requiredFields,...t.payload}};case p:return{...e,shouldHidePhoneField:t.payload};case d:return{...e,billingData:t.payload};case m:return{...e,shippingData:t.payload};case u:return{...e,isValid:t.payload};case h:return{...e,phonePlaceholder:t.payload};case y:return{...e,cardToken:t.payload};case g:return{...e,componentInitializing:t.payload};case _:return{...e,componentInitialized:t.payload};case C:return{...e,componentError:t.payload};case w:return{...e,componentError:null};case E:return{...e,componentMounting:{...e.componentMounting,[t.payload.gateway]:t.payload.isMounting}};case b:return{...e,componentMounted:{...e.componentMounted,[t.payload.gateway]:t.payload.isMounted}};case P:return{...e,componentFocused:{...e.componentFocused,[t.payload.componentName]:t.payload.isFocused}};case T:return{...e,tokenCreating:t.payload};case f:return{...e,tokenCreated:t.payload};case x:return{...e,tokenError:t.payload};case I:return{...e,tokenError:null};case k:return{...e,cardToken:"",tokenCreated:!1,tokenCreating:!1,tokenError:null};case M:return{...e,componentsReady:{...e.componentsReady,[t.payload.gateway]:t.payload.isReady}};case v:return{...e,gatewayComponents:{...e.gatewayComponents,[t.payload.gateway]:t.payload.components}};case S:return{...e,componentContainers:{...e.componentContainers,[t.payload.gateway]:t.payload.container}};case N:return{...e,componentContainers:{...e.componentContainers,[t.payload.gateway]:null}};default:return e}},actions:t,selectors:pe});(0,n.register)(ue);const he=window.wp.hooks,ye=window.wp.element,ge=window.ReactJSXRuntime,_e=({content:e})=>(0,ge.jsx)("div",{dangerouslySetInnerHTML:{__html:e}}),Ce=({item:e,useEffect:t,activePaymentMethod:n,isComponentReady:o,componentError:a})=>{const i=e.shouldLoadComponents;return t(()=>{if("mollie_wc_gateway_creditcard"===n){const e=new Event("mollie_creditcard_component_selected",{bubbles:!0});document.documentElement.dispatchEvent(e)}},[n]),i?(0,ge.jsxs)(ge.Fragment,{children:[(0,ge.jsx)("div",{children:(0,ge.jsx)("p",{children:e.content})}),(0,ge.jsx)("div",{dangerouslySetInnerHTML:{__html:e.componentsDescription}})]}):(0,ge.jsxs)("div",{className:"mollie-creditcard-component",children:[a&&i?(0,ge.jsxs)("div",{className:"mollie-error",children:["Error: ",a]}):!o&&i?(0,ge.jsx)("div",{className:"mollie-loading",children:"Loading payment form..."}):null,e.content&&(0,ge.jsx)(_e,{content:e.content})]})},we=({issuerKey:e,issuers:t,selectedIssuer:n,updateIssuer:o})=>{const a=(0,ye.useCallback)(e=>{o(e.target.value)},[o]);return(0,ge.jsx)("select",{name:e,dangerouslySetInnerHTML:{__html:t},value:n,onChange:a})},Ee=({item:e,activePaymentMethod:t,selectedIssuer:n,setSelectedIssuer:o})=>{const a=`mollie-payments-for-woocommerce_issuer_${t}`;let i=null;return e.content&&""!==e.content&&(i=(0,ge.jsx)("p",{children:e.content})),e.issuers&&e.issuers.length>0?(0,ge.jsxs)("div",{children:[i,(0,ge.jsx)(we,{issuerKey:a,issuers:e.issuers,selectedIssuer:n,updateIssuer:o})]}):(0,ge.jsx)("div",{children:i})},be=({id:e,label:t,value:n,onChange:o,placeholder:a})=>{const i=(0,ye.useCallback)(e=>{o(e.target.value)},[o]),s=` wc-block-components-address-form__${e}`;return(0,ge.jsx)("div",{className:"wc-block-components-text-input wc-block-components-address-form__phone",children:(0,ge.jsx)("input",{type:"tel",className:s,name:e,id:e,value:n,onChange:i,placeholder:a})})},Pe=({label:e,value:t,onChange:n})=>{const o=(0,ye.useCallback)(e=>{n(e.target.value)},[n]);return(0,ge.jsx)("div",{className:"wc-block-components-text-input",children:(0,ge.jsx)("input",{type:"date",className:"wc-block-components-address-form__billing-birthdate",name:"billing-birthdate",id:"billing-birthdate",value:t,onChange:o})})},Te=({label:e,value:t,onChange:n})=>{const o=(0,ye.useCallback)(e=>{n(e.target.value)},[n]);return(0,ge.jsx)("div",{className:"wc-block-components-text-input wc-block-components-address-form__company",children:(0,ge.jsx)("input",{type:"text",className:"wc-block-components-address-form__billing_company_billie",name:"billing_company_billie",id:"billing_company_billie",value:t,onChange:o,placeholder:e})})},fe=({item:e,useEffect:t,billing:n,shippingData:o,eventRegistration:a,requiredFields:i,inputPhone:s,inputBirthdate:r,inputCompany:l,phonePlaceholder:c,setInputPhone:p,setInputBirthdate:d,setInputCompany:m,updatePhonePlaceholderByCountry:u,fieldConfig:h={}})=>{const{onCheckoutValidation:y}=a,{companyNameString:g,phoneString:_}=i,{hasCustomCompanyField:C=!1,hasCustomPhoneField:w=!1,hasCustomBirthdateField:E=!1,companyRequired:b=!1,companyLabel:P="Company name",phoneLabel:T="Phone",birthdateLabel:f="Birthdate"}=h;function x(){const e=document.getElementById("shipping-phone");return document.getElementById("billing-phone")||e}const I=(()=>{const e=x();return!!e&&(e.hasAttribute("required")||"true"===e.getAttribute("aria-required"))})();return t(()=>{if(!C)return;const t=document.querySelector("div.wc-block-components-text-input.wc-block-components-address-form__company > label");if(!t||!0===e.hideCompanyField)return;const n=e.companyPlaceholder||g||"Company name";t.innerText=n},[C,e.companyPlaceholder,e.hideCompanyField,g]),t(()=>{var t;if(!w)return;const n=null!==(t=x()?.labels?.[0])&&void 0!==t?t:null;if(!n||0===n.length)return;const o=e.phonePlaceholder||_||"Phone";n.innerText=o},[w,e.phonePlaceholder,_]),t(()=>{const t=y(()=>{if(b&&""===n.billingData.company&&""===o.shippingAddress.company&&""===l)return{errorMessage:e.errorMessage||"Company field is required"}});return()=>{t()}},[y,b,n.billingData,o.shippingAddress,l,e.errorMessage]),t(()=>{if(!w)return;const e=n.billingData.country;e&&u(e)},[n.billingData.country,u,w]),(0,ge.jsxs)(ge.Fragment,{children:[(0,ge.jsx)("div",{children:e.content&&(0,ge.jsx)("p",{children:e.content})}),C&&(0,ge.jsx)(Te,{label:e.companyPlaceholder||P,value:l,onChange:m}),E&&(0,ge.jsx)(Pe,{label:e.birthdatePlaceholder||f,value:r,onChange:d}),w&&!I&&(0,ge.jsx)(be,{id:`billing-phone-${e.name}`,label:e.phoneLabel||T,value:s,onChange:p,placeholder:c})]})},xe=e=>{const t=t=>{const o=(0,n.useSelect)(e=>({selectedIssuer:e(de).getSelectedIssuer(),inputPhone:e(de).getInputPhone(),inputBirthdate:e(de).getInputBirthdate(),inputCompany:e(de).getInputCompany(),phonePlaceholder:e(de).getPhonePlaceholder(),cardToken:e(de).getCardToken()}),[]),a=(0,n.useDispatch)(de),{setSelectedIssuer:i,setInputPhone:s,setInputBirthdate:r,setInputCompany:l,setCardToken:c,updatePhonePlaceholderByCountry:p}=a;return(0,ge.jsx)(e,{...t,selectedIssuer:o.selectedIssuer,inputPhone:o.inputPhone,inputBirthdate:o.inputBirthdate,inputCompany:o.inputCompany,phonePlaceholder:o.phonePlaceholder,cardToken:o.cardToken,setSelectedIssuer:i,setInputPhone:s,setInputBirthdate:r,setInputCompany:l,setCardToken:c,updatePhonePlaceholderByCountry:p})};return t.displayName=`withMollieStore(${e.displayName||e.name||"Component"})`,t},Ie=(e,t)=>{if(!e||!e.name)return(0,ge.jsx)("div",{children:"Loading payment methods..."});switch(e.name){case"mollie_wc_gateway_creditcard":const n=xe(Ce);return(0,ge.jsx)(n,{...t});case"mollie_wc_gateway_billie":const o=xe(fe);return(0,ge.jsx)(o,{...t,fieldConfig:{hasCustomCompanyField:!0,companyRequired:!0,companyLabel:e.companyPlaceholder||"Company name"}});case"mollie_wc_gateway_in3":const a=xe(fe);return(0,ge.jsx)(a,{...t,fieldConfig:{hasCustomPhoneField:!0,hasCustomBirthdateField:!0,phoneLabel:e.phoneLabel||"Phone",birthdateLabel:e.birthdatePlaceholder||"Birthdate"}});case"mollie_wc_gateway_riverty":const i=xe(fe);return(0,ge.jsx)(i,{...t,fieldConfig:{hasCustomPhoneField:!0,hasCustomBirthdateField:!0,phoneLabel:e.phoneLabel||"Phone",birthdateLabel:e.birthdatePlaceholder||"Birthdate"}});case"mollie_wc_gateway_bizum":const s=xe(fe);return(0,ge.jsx)(s,{...t,fieldConfig:{hasCustomPhoneField:!0,hasCustomBirthdateField:!1,phoneLabel:e.phoneLabel||"Phone"}});default:const r=xe(Ee);return(0,ge.jsx)(r,{...t})}},ke=new class{constructor(){this.mollie=null,this.components=new Map,this.isInitialized=!1,this.initializationPromise=null,this.activeGateway=null,this.initialize=this.initialize.bind(this),this.createToken=this.createToken.bind(this),this.cleanup=this.cleanup.bind(this)}async initialize(e){return this.initializationPromise||(this.initializationPromise=this._initializeMollie(e)),this.initializationPromise}async _initializeMollie(e){try{(0,n.dispatch)(de).setComponentInitializing(!0),(0,n.dispatch)(de).clearComponentError(),this.mollie=new window.Mollie(e.merchantProfileId,e.options),this.isInitialized=!0,(0,n.dispatch)(de).setComponentInitialized(!0),(0,n.dispatch)(de).setComponentInitializing(!1)}catch(e){throw this.isInitialized=!1,(0,n.dispatch)(de).setComponentError(e.message),(0,n.dispatch)(de).setComponentInitializing(!1),new Error(`Failed to initialize Mollie Components: ${e.message}`)}}async mountComponents(e,t,o,a){if(!this.isInitialized)throw new Error("TokenManager not initialized");if(!o)return void console.warn("Components configuration not ready, skipping mount");const i=e.replace("mollie_wc_gateway_","");if(o[i]&&"object"==typeof o[i])try{await this.unmountComponents(e),(0,n.dispatch)(de).setComponentMounting(e,!0);const s=new Map;for(const e of t){const t=await this._mountSingleComponent(e,o[i],a);s.set(e.name,t)}this.components.set(e,s),this.activeGateway=e,(0,n.dispatch)(de).setComponentMounted(e,!0),(0,n.dispatch)(de).setComponentMounting(e,!1),(0,n.dispatch)(de).clearComponentError()}catch(t){throw(0,n.dispatch)(de).setComponentError(t.message),(0,n.dispatch)(de).setComponentMounting(e,!1),t}else console.warn("Invalid components configuration structure, skipping mount")}async _mountSingleComponent(e,t,o){const{name:a,label:i}=e;try{let e=o.querySelector(".mollie-components");e||(e=document.createElement("div"),e.className="mollie-components",o.appendChild(e));const s=document.createElement("div");if(s.className=`mollie-component-wrapper mollie-component-wrapper--${a}`,s.setAttribute("data-component",a),e.appendChild(s),i){const e=document.createElement("label");e.className="mollie-component-label",e.setAttribute("for",a),e.innerHTML=i,s.appendChild(e)}const r=document.createElement("div");r.id=a,s.appendChild(r);const l=document.createElement("div");l.id=`${a}-errors`,l.setAttribute("role","alert"),l.className="mollie-component-error",s.appendChild(l);const c=this.mollie.createComponent(a,t);return c.mount(`#${a}`),c.addEventListener("change",e=>{const t=r.querySelector(".mollie-component");e.error&&e.touched?(t&&t.classList.add("is-invalid"),l.textContent=e.error,(0,n.dispatch)(de).setComponentError(e.error)):(t&&t.classList.remove("is-invalid"),l.textContent="",(0,n.dispatch)(de).clearComponentError())}),c.addEventListener("focus",()=>{const e=r.querySelector(".mollie-component");e&&e.classList.add("has-focus"),(0,n.dispatch)(de).setComponentFocused(a,!0)}),c.addEventListener("blur",()=>{const e=r.querySelector(".mollie-component");e&&e.classList.remove("has-focus"),(0,n.dispatch)(de).setComponentFocused(a,!1)}),c}catch(e){throw new Error(`Failed to mount component ${a}: ${e.message}`)}}async unmountComponents(e){const t=this.components.get(e);if(t)try{for(const[e,n]of t)try{n.unmount();const t=document.getElementById(`${e}`);[t,document.getElementById(`${e}-errors`),document.querySelector(`.mollie-component-label[for="${e}"]`)].forEach(e=>{e&&e.remove()})}catch(t){console.warn(`Failed to unmount component ${e}:`,t)}const o=document.querySelector(".mollie-components");o&&0===o.children.length&&o.remove(),this.components.delete(e),(0,n.dispatch)(de).setComponentMounted(e,!1),this.activeGateway===e&&(this.activeGateway=null)}catch(t){throw console.error(`Failed to unmount components for gateway ${e}:`,t),t}}async createToken(){if(!this.isInitialized||!this.mollie)throw new Error("Mollie Components not initialized");if(!this.activeGateway)throw new Error("No active payment gateway");try{(0,n.dispatch)(de).setTokenCreating(!0),(0,n.dispatch)(de).clearTokenError();const{token:e,error:t}=await this.mollie.createToken();if(t)throw new Error(t.message||"Token creation failed");if(!e)throw new Error("No token received from Mollie Components");return(0,n.dispatch)(de).setCardToken(e),(0,n.dispatch)(de).setTokenCreated(!0),(0,n.dispatch)(de).setTokenCreating(!1),e}catch(e){throw(0,n.dispatch)(de).setTokenError(e.message),(0,n.dispatch)(de).setTokenCreating(!1),(0,n.dispatch)(de).setTokenCreated(!1),e}}isReady(){return this.isInitialized&&this.activeGateway&&this.components.has(this.activeGateway)&&!(0,n.select)(de).getComponentError()}getActiveGateway(){return this.activeGateway}cleanup(){try{for(const e of this.components.keys())this.unmountComponents(e);this.components.clear(),this.mollie=null,this.isInitialized=!1,this.initializationPromise=null,this.activeGateway=null,(0,n.dispatch)(de).setComponentInitialized(!1),(0,n.dispatch)(de).clearTokenData(),(0,n.dispatch)(de).clearComponentError()}catch(e){console.error("TokenManager cleanup failed:",e)}}},Me=e=>{const{item:t,requiredFields:o,shouldHidePhoneField:a,props:{emitResponse:i,eventRegistration:s,billing:r,shippingData:l}}=e,{responseTypes:c}=i,{onPaymentSetup:p}=s,d=(0,ye.useRef)(null),{setComponentContainer:m,clearComponentContainer:u}=(0,n.useDispatch)(de),{isComponentReady:h,componentError:y}=(0,n.useSelect)(e=>({isComponentReady:e(de).getIsComponentReady(),componentError:e(de).getComponentError()}),[]),g=(0,n.useSelect)(e=>e(de).getActivePaymentMethod(),[]);(0,ye.useEffect)(()=>(d.current&&g&&m(g,d.current),()=>{g&&u(g)}),[g,m,u]),(0,ye.useEffect)(()=>p(async()=>{if(!g.startsWith("mollie_wc_gateway_"))return c.SUCCESS;try{const e=(0,n.select)(de),{cardToken:o,getPaymentMethodData:a,getActivePaymentMethod:i}={cardToken:e.getCardToken(),getPaymentMethodData:e.getPaymentMethodData,getActivePaymentMethod:e.getActivePaymentMethod};let s=o;const r=t.shouldLoadComponents||!1,l=t.isMultiStepsCheckout||!1;"mollie_wc_gateway_creditcard"===t.name&&r&&!l&&!s&&(s=await ke.createToken());const p={...a(),payment_method:i()||g,payment_method_title:t.title,cardToken:s||""};return{type:c.SUCCESS,meta:{paymentMethodData:p}}}catch(e){return console.error("Payment processing failed:",e),{type:c.ERROR,message:e.message||"Payment processing failed"}}}),[p,g,t.title,t.name,c]);const _={item:t,useEffect:ye.useEffect,billing:r,shippingData:l,eventRegistration:s,requiredFields:o,shouldHidePhoneField:a,activePaymentMethod:g,containerRef:d,mollieComponentsManager:ke,isComponentReady:h,componentError:y};return(0,ge.jsx)("div",{ref:d,className:"mollie-payment-method-container",children:Ie(t,_)})};function ve(e){const t=[];for(const n of e){const{contactField:e=null,code:o=null,message:a=null}=n,i=e?new ApplePayError(o,e,a):new ApplePayError(o);t.push(i)}return t}const Se=({buttonAttributes:e={}})=>{let t=window.mollieApplePayBlockDataCart||window.mollieBlockData.mollieApplePayBlockDataCart;0===t.length&&(t=window.mollieBlockData.gatewayData.appleButtonData);let o=!1,a=document.getElementById("woocommerce-process-checkout-nonce");a&&(o=a.value),o||(o=window.mollieBlockData.gatewayData.appleButtonData.nonce);let i=[],s="";const{shop:{countryCode:r,totalLabel:l=""},ajaxUrl:c}=t,p=(0,n.select)("wc/store/cart"),d=p.getNeedsShipping(),m=p.getCartTotals().total_price,u=window.wcSettings.currency.code,h=p.getCartTotals().currency_minor_unit,y=m/Math.pow(10,h),g={height:`${(_=e).height||48}px`,borderRadius:`${_.borderRadius||4}px`};var _;let C=[],w=()=>{const e=new ApplePaySession(3,((e,t,n,o)=>({countryCode:e,currencyCode:t,supportedNetworks:["amex","maestro","masterCard","visa","vPay"],merchantCapabilities:["supports3DS"],shippingType:"shipping",requiredBillingContactFields:["postalAddress","email"],requiredShippingContactFields:["postalAddress","email"],total:{label:n,amount:o,type:"final"}}))(r,u,l,y));e.begin(),e.onshippingmethodselected=function(t){jQuery.ajax({url:c,method:"POST",data:{action:"mollie_apple_pay_update_shipping_method",shippingMethod:t.shippingMethod,callerPage:"cart",simplifiedContact:i,"woocommerce-process-checkout-nonce":o},complete:(e,t)=>{},success:(e,n,o)=>{let a=e.data;C=t.shippingMethod,!1===e.success&&(a.errors=ve(a.errors)),this.completeShippingMethodSelection(a)},error:(t,n,o)=>{console.warn(n,o),e.abort()}})},e.onshippingcontactselected=function(t){jQuery.ajax({url:c,method:"POST",data:{action:"mollie_apple_pay_update_shipping_contact",simplifiedContact:t.shippingContact,callerPage:"cart",needShipping:d,"woocommerce-process-checkout-nonce":o},complete:(e,t)=>{},success:(e,n,o)=>{let a=e.data;i=t.shippingContact,!1===e.success&&(a.errors=ve(a.errors)),a.newShippingMethods&&(C=a.newShippingMethods[0]),this.completeShippingContactSelection(a)},error:(t,n,o)=>{console.warn(n,o),e.abort()}})},e.onvalidatemerchant=t=>{jQuery.ajax({url:c,method:"POST",data:{action:"mollie_apple_pay_validation",validationUrl:t.validationURL,"woocommerce-process-checkout-nonce":o},complete:(e,t)=>{},success:(t,n,o)=>{!0===t.success?e.completeMerchantValidation(JSON.parse(t.data)):(console.warn(t.data),e.abort())},error:(t,n,o)=>{console.warn(n,o),e.abort()}})},e.onpaymentauthorized=t=>{const{billingContact:n,shippingContact:a}=t.payment;jQuery.ajax({url:c,method:"POST",data:{action:"mollie_apple_pay_create_order_cart",shippingContact:t.payment.shippingContact,billingContact:t.payment.billingContact,token:t.payment.token,shippingMethod:C,"mollie-payments-for-woocommerce_issuer_applepay":"applepay","woocommerce-process-checkout-nonce":o,billing_first_name:n.givenName||"",billing_last_name:n.familyName||"",billing_company:"",billing_country:n.countryCode||"",billing_address_1:n.addressLines[0]||"",billing_address_2:n.addressLines[1]||"",billing_postcode:n.postalCode||"",billing_city:n.locality||"",billing_state:n.administrativeArea||"",billing_phone:n.phoneNumber||"000000000000",billing_email:a.emailAddress||"",shipping_first_name:a.givenName||"",shipping_last_name:a.familyName||"",shipping_company:"",shipping_country:a.countryCode||"",shipping_address_1:a.addressLines[0]||"",shipping_address_2:a.addressLines[1]||"",shipping_postcode:a.postalCode||"",shipping_city:a.locality||"",shipping_state:a.administrativeArea||"",shipping_phone:a.phoneNumber||"000000000000",shipping_email:a.emailAddress||"",order_comments:"",payment_method:"mollie_wc_gateway_applepay",_wp_http_referer:"/?wc-ajax=update_order_review"},complete:(e,t)=>{},success:(t,n,o)=>{let a=t.data;!0===t.success?(s=a.returnUrl,e.completePayment(a.responseToApple),window.location.href=s):(a.errors=ve(a.errors),e.completePayment(a))},error:(t,n,o)=>{console.warn(n,o),e.abort()}})}};return(0,ge.jsx)("button",{id:"mollie_applepay_button",className:"apple-pay-button apple-pay-button-black",onClick:e=>{e.preventDefault(),w()},style:g})},Ne=({buttonAttributes:e={}})=>{const t={height:`${e.height||48}px`,borderRadius:`${e.borderRadius||4}px`};return(0,ge.jsx)("button",{id:"mollie_applepay_button",className:"apple-pay-button apple-pay-button-black",style:t})},Ae={GATEWAY_NAME:"mollie_wc_gateway_applepay",isApplePayMethod:e=>e.name===Ae.GATEWAY_NAME,isAppleSessionAvailable:()=>"function"==typeof window.ApplePaySession&&window.ApplePaySession.canMakePayments(),canRegisterApplePay:()=>wc?.wcBlocksData?.isEditor()||Ae.isAppleSessionAvailable()},De=()=>wc?.wcBlocksData?.isEditor();!function({mollieBlockData:e,wc:t,_:o}){if(o.isEmpty(e))console.warn("Mollie: No block data available");else if(!e.gatewayData.isOrderPayPage)try{const{gatewayData:o}=e.gatewayData,a=(e=>{const{defaultFields:t}=e.wcSettings.allSettings;return{wc:e,requiredFields:{companyNameString:t?.company?.label,phoneString:t?.phone?.label}}})(t);((e,t)=>{void 0!==e&&e.length>0&&e.forEach(n=>{const o=`${n.name}_checkout_fields`;let a=e.find(e=>e.name===n.name);(0,he.addFilter)(o,"mollie/register-payment-content-renderer",e=>[...e,e=>{const n={props:e,item:a,requiredFields:t.requiredFields,shouldHidePhoneField:t.shouldHidePhoneField};return(0,ge.jsx)(Me,{...n})}])})})(o,a),(e=>{const t=e.find(e=>e.name===Ae.GATEWAY_NAME);t&&(0,he.addFilter)(`${t.name}_should_register_payment_method`,"mollie/apple-pay-conditional-registration",(e,t,n)=>!!De()||Ae.canRegisterApplePay())})(o),(e=>{const t=e.find(e=>e.name===Ae.GATEWAY_NAME);t&&t.isExpressEnabled&&((0,he.addFilter)(`${t.name}_express_payment_method_args`,"mollie/apple-pay-express-args",(e,t)=>{const n=Ae.isAppleSessionAvailable();return{name:"mollie_wc_gateway_applepay_express",title:"Apple Pay Express button",description:"Apple Pay Express button",content:(0,ge.jsx)(Se,{}),edit:(0,ge.jsx)(Ne,{}),ariaLabel:"Apple Pay",canMakePayment:()=>!!De()||n&&window.ApplePaySession.canMakePayments(),paymentMethodId:"mollie_wc_gateway_applepay",gatewayId:"mollie_wc_gateway_applepay",supports:{features:["products"],style:["height","borderRadius"]}}}),(0,he.addFilter)(`${t.name}_express_payment_methods`,"mollie/apple-pay-express-registration",(e,t,n)=>!!De()||Ae.canRegisterApplePay()))})(o),(e=>{e&&e.forEach(t=>{const n=`${t.name}_payment_method_icons`;(0,he.addFilter)(n,"inpsyde-payment-gateway/icons",n=>e.find(e=>e.name===t.name).label.iconsArray,10)})})(o);let i=!1,s=null;const r=()=>{i||(0,n.select)(me)&&(i=!0,s&&(s(),s=null),(()=>{let e;const t=()=>{try{const t=(0,n.select)(me).getActivePaymentMethod();e!==t&&((0,n.dispatch)(de).setActivePaymentMethod(t),e=t)}catch(e){console.log("Checkout store not ready yet:",e)}};(0,n.subscribe)(t,me);t()})(),e.gatewayData.componentData&&!e.gatewayData.componentData.isMultistepsCheckout&&function(e){let t=!1,o=null,a=null;const i=()=>{try{const e=(0,n.select)("wc/store/checkout"),t=(0,n.select)(me);if(!e||!t)return!1;const o=e.isCalculating(),a=e.hasError();return!o&&!a}catch(e){return console.warn("Mollie: Error checking checkout readiness:",e),!1}},s=async()=>{if(!t){t=!0;try{if(!e.merchantProfileId)return console.error("Mollie merchant profile ID not found"),void(t=!1);await ke.initialize({merchantProfileId:e.merchantProfileId,options:e.options||{}}),o&&(o(),o=null),r()}catch(e){console.error("Mollie: Failed to initialize Components Manager:",e),t=!1}}},r=()=>{let t=null,o=null,i=!1;a=(0,n.subscribe)(()=>{try{const a=(0,n.select)(de),s=a.getActivePaymentMethod(),r=a.getComponentContainer(s),l=t!==s,c=o!==r,p="mollie_wc_gateway_creditcard"===s;if("mollie_wc_gateway_creditcard"===t&&!p&&i&&(ke.unmountComponents(t),i=!1),t=s,o=r,!p||!r||!l&&!c||i)return;(async()=>{try{await ke.mountComponents(s,e.componentsAttributes,e.componentsSettings,r),i=!0}catch(e){console.error("Mollie: Failed to mount components:",e),i=!1}})()}catch(e){console.warn("Mollie: Error in component mounting subscription:",e)}},de)};i()?s():o=(0,n.subscribe)(()=>{t||i()&&s()},"wc/store/checkout")}(e.gatewayData.componentData),function(){const e=()=>{document.querySelectorAll('[id*="mollie_wc_gateway"] .wc-block-components-payment-method-icons').forEach(e=>{e.querySelectorAll("img").forEach(e=>{e.classList.contains("mollie-gateway-icon")||e.classList.add("mollie-gateway-icon")})})};e();const t=new MutationObserver(t=>{let n=!1;t.forEach(e=>{"childList"===e.type&&e.addedNodes.length>0&&e.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&(e.classList?.contains("wc-block-components-payment-method-icons")||e.querySelector?.(".wc-block-components-payment-method-icons"))&&(n=!0)})}),n&&setTimeout(e,10)});t.observe(document.body,{childList:!0,subtree:!0}),window.addEventListener("beforeunload",()=>{t.disconnect()})}())};r(),i||(s=(0,n.subscribe)(r,me))}catch(e){console.error("Mollie: Initialization failed:",e)}}(window,wc)})();