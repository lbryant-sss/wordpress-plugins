(()=>{"use strict";function e(e){const t=[];for(const o of e){const{contactField:e=null,code:n=null,message:i=null}=o,a=e?new ApplePayError(n,e,i):new ApplePayError(n);t.push(a)}return t}!function({_:t,mollieApplePayDirectData:o,jQuery:n}){if(t.isEmpty(o))return;const{product:{id:i,needShipping:a=!0,isVariation:s=!1,price:p,stock:r},shop:{countryCode:c,currencyCode:l="EUR",totalLabel:d=""},ajaxUrl:u}=o;if(!(i&&p&&c&&u))return;if("outofstock"===r||!(()=>{const{ApplePaySession:e}=window,t=document.querySelector("#mollie-applepayDirect-button");if(!(t&&e&&e.canMakePayments()))return!1;const o=document.createElement("button");return o.setAttribute("id","mollie_applepay_button"),o.classList.add("apple-pay-button"),o.classList.add("apple-pay-button-black"),t.appendChild(o),!0})())return;const m=document.getElementById("woocommerce-process-checkout-nonce").value;let _=i,h=1,g=[],y=[],b="";function w(e){e.disabled=!0,e.classList.add("buttonDisabled")}if(document.querySelector("input.qty").addEventListener("change",e=>{h=e.currentTarget.value}),s){const e=document.querySelector("#mollie_applepay_button");n(".single_variation_wrap").on("hide_variation",function(t,o){w(e)}),n(".single_variation_wrap").on("show_variation",function(t,o){o.is_in_stock?(o.variation_id&&(_=o.variation_id),function(e){e.disabled=!1,e.classList.remove("buttonDisabled")}(e)):w(e)}),w(e)}const f=h*p,C=()=>{const t=new ApplePaySession(3,((e,t,o,n)=>({countryCode:e,currencyCode:t,supportedNetworks:["amex","maestro","masterCard","visa","vPay"],merchantCapabilities:["supports3DS"],shippingType:"shipping",requiredBillingContactFields:["postalAddress","email"],requiredShippingContactFields:["postalAddress","email"],total:{label:o,amount:n,type:"final"}}))(c,l,d,f));t.begin(),a&&(t.onshippingmethodselected=function(o){n.ajax({url:u,method:"POST",data:{action:"mollie_apple_pay_update_shipping_method",shippingMethod:o.shippingMethod,productId:_,callerPage:"productDetail",productQuantity:h,simplifiedContact:g,"woocommerce-process-checkout-nonce":m},complete:(e,t)=>{},success:(t,n,i)=>{const a=t.data;y=o.shippingMethod,!1===t.success&&(a.errors=e(a.errors)),this.completeShippingMethodSelection(a)},error:(e,o,n)=>{console.warn(o,n),t.abort()}})},t.onshippingcontactselected=function(o){n.ajax({url:u,method:"POST",data:{action:"mollie_apple_pay_update_shipping_contact",productId:_,callerPage:"productDetail",productQuantity:h,simplifiedContact:o.shippingContact,needShipping:a,"woocommerce-process-checkout-nonce":m},complete:(e,t)=>{},success:(t,n,i)=>{const a=t.data;g=o.shippingContact,!1===t.success&&(a.errors=e(a.errors)),a.newShippingMethods&&(y=a.newShippingMethods[0]),this.completeShippingContactSelection(a)},error:(e,o,n)=>{console.warn(o,n),t.abort()}})}),t.onvalidatemerchant=e=>{n.ajax({url:u,method:"POST",data:{action:"mollie_apple_pay_validation",validationUrl:e.validationURL,"woocommerce-process-checkout-nonce":m},complete:(e,t)=>{},success:(e,o,n)=>{!0===e.success?t.completeMerchantValidation(JSON.parse(e.data)):(console.warn(e.data),t.abort())},error:(e,o,n)=>{console.warn(o,n),t.abort()}})},t.onpaymentauthorized=o=>{const{billingContact:i,shippingContact:a}=o.payment;n.ajax({url:u,method:"POST",data:{action:"mollie_apple_pay_create_order",productId:_,productQuantity:h,shippingContact:o.payment.shippingContact,billingContact:o.payment.billingContact,token:o.payment.token,shippingMethod:y,"mollie-payments-for-woocommerce_issuer_applepay":"applepay","woocommerce-process-checkout-nonce":m,billing_first_name:i.givenName||"",billing_last_name:i.familyName||"",billing_company:"",billing_country:i.countryCode||"",billing_address_1:i.addressLines[0]||"",billing_address_2:i.addressLines[1]||"",billing_postcode:i.postalCode||"",billing_city:i.locality||"",billing_state:i.administrativeArea||"",billing_phone:i.phoneNumber||"000000000000",billing_email:a.emailAddress||"",shipping_first_name:a.givenName||"",shipping_last_name:a.familyName||"",shipping_company:"",shipping_country:a.countryCode||"",shipping_address_1:a.addressLines[0]||"",shipping_address_2:a.addressLines[1]||"",shipping_postcode:a.postalCode||"",shipping_city:a.locality||"",shipping_state:a.administrativeArea||"",shipping_phone:a.phoneNumber||"000000000000",shipping_email:a.emailAddress||"",order_comments:"",payment_method:"mollie_wc_gateway_applepay",_wp_http_referer:"/?wc-ajax=update_order_review"},complete:(e,t)=>{},success:(o,n,i)=>{const a=o.data;!0===o.success?(b=a.returnUrl,t.completePayment(a.responseToApple),window.location.href=b):(a.errors=e(a.errors),t.completePayment(a))},error:(e,o,n)=>{console.warn(o,n),t.abort()}})}};document.querySelector("#mollie_applepay_button").addEventListener("click",e=>{e.preventDefault(),C()})}(window)})();