var S=Object.defineProperty,E=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var g=(t,e,s)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,h=(t,e)=>{for(var s in e||(e={}))Z.call(e,s)&&g(t,s,e[s]);if(k)for(var s of k(e))L.call(e,s)&&g(t,s,e[s]);return t},$=(t,e)=>E(t,U(e));import{_ as r,aa as A,$ as _,c as w,u as P,r as y,j as a,C as D}from"./main-381.js";import{t as N}from"./bf-35-88.js";import{a4 as O,a5 as q,a6 as B}from"./bf-433-81.js";import{N as H}from"./bf-68-108.js";const V=(t,e,s,c,d,o)=>{if(!t.dataCenter||!t.clientId||!t.clientSecret){s({dataCenter:t.dataCenter?"":r("Data center cann't be empty"),clientId:t.clientId?"":r("Client ID cann't be empty"),clientSecret:t.clientSecret?"":r("Secret key cann't be empty")});return}const i=A(_);d(!0);const l="ZohoCampaigns.contact.READ,ZohoCampaigns.contact.CREATE,ZohoCampaigns.contact.UPDATE",n=`https://accounts.zoho.${t.dataCenter}/oauth/v2/auth?scope=${l}&response_type=code&client_id=${t.clientId}&prompt=Consent&access_type=offline&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(i.zohoRedirectURL)}`,u=window.open(n,"zohoCampaigns","width=400,height=609,toolbar=off"),v=setInterval(()=>{if(u.closed){clearInterval(v);let m={},x=!1;const p=localStorage.getItem("__bitforms_zohoCampaigns");if(p&&(x=!0,m=JSON.parse(p),localStorage.removeItem("__bitforms_zohoCampaigns")),!m.code||m.error||!m||!x){const f=m.error?`Cause: ${m.error}`:"";o({show:!0,msg:`${r("Authorization failed")} ${f}. ${r("please try again")}`}),d(!1)}else{const f=h({},t);f.accountServer=m["accounts-server"],J(m,f,e,c,d,o)}}},500)},J=(t,e,s,c,d,o)=>{const i=A(_),l=h({},t);l.dataCenter=e.dataCenter,l.clientId=e.clientId,l.clientSecret=e.clientSecret,l.redirectURI=encodeURIComponent(i.zohoRedirectURL),w(l,"bitforms_zcampaigns_generate_token").then(n=>n).then(n=>{if(n&&n.success){const u=h({},e);u.tokenDetails=n.data,s(u),O(u),c(!0),o({show:!0,msg:r("Authorized Successfully")})}else n&&n.data&&n.data.data||!n.success&&typeof n.data=="string"?o({show:!0,msg:`${r("Authorization failed Cause:")}${n.data.data||n.data}. ${r("please try again")}`}):o({show:!0,msg:r("Authorization failed. please try again")});d(!1)})},te=(t,e,s,c,d,o)=>{let i=h({},s);switch(i[t.target.name]=t.target.value,t.target.name){case"list":i=M(i,e,c,d,o);break}c(h({},i))},M=(t,e,s,c,d)=>{var i,l;const o=h({},t);return o.field_map=[{formField:"",zohoFormField:"Contact Email"}],(l=(i=o==null?void 0:o.default)==null?void 0:i.fields)!=null&&l[o.list]||G(e,o,s,c,d),o},W=(t,e,s,c,d)=>{c(!0);const o={formID:t,id:e.id,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails};w(o,"bitforms_zcampaigns_refresh_lists").then(i=>{if(i&&i.success){const l=h({},e);i.data.lists&&(l.default=$(h({},l.default),{lists:i.data.lists})),i.data.tokenDetails&&(l.tokenDetails=i.data.tokenDetails),d({show:!0,msg:r("Lists refreshed")}),s(h({},l))}else i&&i.data&&i.data.data||!i.success&&typeof i.data=="string"?d({show:!0,msg:`${r("Lists refresh failed Cause:")}${i.data.data||i.data}. ${r("please try again")}`}):d({show:!0,msg:r("Lists refresh failed. please try again")});c(!1)}).catch(()=>c(!1))},G=(t,e,s,c,d)=>{const{list:o}=e;if(!o)return;c(!0);const i={formID:t,list:o,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails};w(i,"bitforms_zcampaigns_refresh_contact_fields").then(l=>{if(l&&l.success){const n=h({},e);l.data.fields?(n.default.fields||(n.default.fields={}),n.default.fields[o]=l.data,l.data.tokenDetails&&(n.tokenDetails=l.data.tokenDetails),d({show:!0,msg:r("Contact Fields refreshed")})):d({show:!0,msg:r("Zoho didn't provide fields names for this list")}),l.data.tokenDetails&&(n.tokenDetails=l.data.tokenDetails),s(h({},n))}else d({show:!0,msg:r("Contact Fields refresh failed. please try again")});c(!1)}).catch(()=>c(!1))},ae=t=>!((t!=null&&t.field_map?t.field_map.filter(s=>{var c,d,o;return!s.formField&&s.zohoFormField&&((o=(d=(c=t==null?void 0:t.default)==null?void 0:c.fields)==null?void 0:d[t.list])==null?void 0:o.required.indexOf(s.zohoFormField))!==-1}):[]).length>0);function K({formID:t,campaignsConf:e,setCampaignsConf:s,step:c,setstep:d,isLoading:o,setisLoading:i,setSnackbar:l,redirectLocation:n,isInfo:u,authorizedAction:v}){const m=P(_),{siteURL:x}=m,[p,f]=y.useState(!1),[j,I]=y.useState({dataCenter:"",clientId:"",clientSecret:""}),F=()=>{setTimeout(()=>{document.getElementById("btcd-settings-wrp").scrollTop=0},300),d(2),W(t,e,s,i,l)},z=b=>{const C=h({},e),R=h({},j);R[b.target.name]="",C[b.target.name]=b.target.value,I(R),s(C)};return y.useEffect(()=>{p&&v()},[p]),a.jsxs(a.Fragment,{children:[a.jsx(q,{title:N.zohoCampaigns.title,youTubeLink:N.zohoCampaigns.link}),a.jsxs("div",{className:"btcd-stp-page",style:{width:900,height:"100%"},children:[a.jsx("div",{className:"mt-3",children:a.jsx("b",{children:r("Integration Name:")})}),a.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:z,name:"name",value:e.name,type:"text",placeholder:r("Integration Name..."),disabled:u}),a.jsx("div",{className:"mt-3",children:a.jsx("b",{children:r("Data Center:")})}),a.jsxs("select",{onChange:z,name:"dataCenter",value:e.dataCenter,className:"btcd-paper-inp w-6 mt-1",disabled:u,children:[a.jsx("option",{value:"",children:r("--Select a data center--")}),a.jsx("option",{value:"com",children:"zoho.com"}),a.jsx("option",{value:"eu",children:"zoho.eu"}),a.jsx("option",{value:"com.cn",children:"zoho.com.cn"}),a.jsx("option",{value:"in",children:"zoho.in"}),a.jsx("option",{value:"com.au",children:"zoho.com.au"})]}),a.jsx("div",{style:{color:"red"},children:j.dataCenter}),a.jsx("div",{className:"mt-3",children:a.jsx("b",{children:r("Homepage URL:")})}),a.jsx(D,{value:x,className:"field-key-cpy w-6 ml-0",readOnly:u}),a.jsx("div",{className:"mt-3",children:a.jsx("b",{children:r("Authorized Redirect URIs:")})}),a.jsx(D,{value:n||`${m.zohoRedirectURL}`,className:"field-key-cpy w-6 ml-0",readOnly:u}),a.jsxs("small",{className:"d-blk mt-5",children:[r("To get Client ID and SECRET , Please Visit")," ",a.jsx("a",{className:"btcd-link",href:`https://api-console.zoho.${(e==null?void 0:e.dataCenter)||"com"}/`,target:"_blank",rel:"noreferrer",children:r("Zoho API Console")})]}),a.jsx("div",{className:"mt-3",children:a.jsx("b",{children:r("Client id:")})}),a.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:z,name:"clientId",value:e.clientId,type:"text",placeholder:r("Client id..."),disabled:u}),a.jsx("div",{style:{color:"red"},children:j.clientId}),a.jsx("div",{className:"mt-3",children:a.jsx("b",{children:r("Client secret:")})}),a.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:z,name:"clientSecret",value:e.clientSecret,type:"text",placeholder:r("Client secret..."),disabled:u}),a.jsx("div",{style:{color:"red"},children:j.clientSecret}),!u&&a.jsxs(a.Fragment,{children:[a.jsx(B,{isAuthorized:p,isLoading:o,handleAuthorize:()=>V(e,s,I,f,i,l)}),a.jsx("br",{}),a.jsx(H,{nextPageHandler:()=>F(),disabled:!p})]})]})]})}var se=Object.freeze({__proto__:null,default:K});export{K as Z,G as a,se as b,ae as c,te as h,W as r};
