import{t as T,v as E,r,a as F,f as A,j as t,M as b,_ as I,S as B,F as C,ah as P}from"./main-215.js";import{B as z}from"./bf-458-78.js";import{S as O}from"./bf-591-260.js";import{C as $}from"./bf-234-86.js";import{ac as J}from"./bf-221-80.js";import{c as L,s as R}from"./bf-152-201.js";import{I as W}from"./bf-141-186.js";import k from"./bf-270-115.js";import{r as q,a as H,d as K}from"./bf-400-172.js";import{G as Q}from"./bf-22-202.js";import"./bf-190-87.js";import"./bf-945-171.js";import"./bf-912-113.js";import"./bf-35-173.js";function pe({formFields:j,setIntegration:N,integrations:y,allIntegURL:p}){const w=T(),{formID:d}=E(),[v,h]=r.useState(!1),[u,l]=r.useState(!1),[s,m]=r.useState(1),{css:G}=F(),[_,a]=r.useState({show:!1}),[e,o]=r.useState({name:"Google Sheet API",type:"Google Sheet",clientId:"",clientSecret:"",spreadsheetId:"",worksheetName:"",field_map:[{formField:"",googleSheetField:""}],header:"ROWS",headerRow:"A1",actions:{}}),S=J([e.type]),x=()=>{setTimeout(()=>{w(`${p}/new/${e.type}`)},1e3),h(!1)},D=(i,f)=>{if(i.integration_type===e.type){const c=JSON.parse(i.integration_details);o(n=>A(n,g=>{g.parentAppId=i.id,g.clientId=c.clientId,g.clientSecret=c.clientSecret,g.tokenDetails=c.tokenDetails})),m(2)}};r.useEffect(()=>{o(i=>A(i,f=>{const c=S.find(n=>n.id===e.parentAppId);if(c){const n=JSON.parse(c.integration_details);f.clientId=n.clientId,f.clientSecret=n.clientSecret,f.tokenDetails=n.tokenDetails}})),e!=null&&e.parentAppId&&q(d,e,o,l,a)},[e.parentAppId]),r.useEffect(()=>{window.opener&&L("googleSheet")},[]);const M=()=>{if(setTimeout(()=>{document.getElementById("btcd-settings-wrp").scrollTop=0},300),!K(e)){a({show:!0,msg:"Please map fields to continue."});return}e.spreadsheetId!==""&&e.worksheetName!==""&&e.field_map.length>0&&m(3)};return t.jsxs("div",{children:[t.jsx(b,{title:I("Authorize New Google App"),show:v,setModal:()=>h(!1),children:t.jsx(k,{formID:d,sheetConf:e,setSheetConf:o,step:s,setstep:m,setSnackbar:a,isLoading:u,setisLoading:l,allIntegURL:p,authorizedAction:x})}),t.jsx(B,{snack:_,setSnackbar:a}),t.jsx("div",{className:"txt-center w-9 mt-2 cal-width",children:t.jsx(O,{step:3,active:s})}),S.length>0&&s===1&&t.jsx($,{allIntegURL:p,specificTypes:[e.type],onClickAction:D,allowAddNew:!0,addNewAction:()=>h(!0)}),s===1&&S.length===0&&t.jsx(k,{formID:d,sheetConf:e,setSheetConf:o,step:s,setstep:m,setSnackbar:a,isLoading:u,setisLoading:l,allIntegURL:p,authorizedAction:x}),t.jsxs("div",{className:"btcd-stp-page",style:{width:s===2&&900,height:s===2&&"100%"},children:[t.jsx(Q,{formID:d,formFields:j,handleInput:i=>H(i,e,o,d,l,a),sheetConf:e,setSheetConf:o,isLoading:u,setisLoading:l,setSnackbar:a,setShowMdl:h}),t.jsxs(C,{onClick:()=>M(),disabled:!e.spreadsheetId||!e.worksheetName||e.field_map.length<1,className:G(P.ftRight),children:[I("Next"),t.jsx(z,{className:"ml-1 rev-icn"})]})]}),t.jsx(W,{step:s,saveConfig:()=>R(y,N,p,e,w)})]})}export{pe as default};
