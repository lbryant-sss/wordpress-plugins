var bit_data_view=function(){"use strict";class t{#t={};#e=null;#s=null;#i=null;#a=null;#n=null;#r=null;#l=null;#o=[];#h=0;#c=10;#d=null;#u=null;#b=10;#g=1;#p=null;#f=null;#m=null;#w={};#P=[];#I={};#v=null;#E=null;#S=null;#y=null;#C={};#$={};#_=[];#B=null;#T=null;constructor(t,e){Object.assign(this.#t,e),this.#e=e?.document||document,this.#s=e?.window||window,this.#f=e.formId,this.#m=e.viewId,this.#w=e.tableConfig,this.#P=e.tableConfig.columnsMap,this.#I=e.tableConfig.actionsBtn,this.#d=e.totalRecords,this.#$=e.accessControl,this.#_=e?.formFields,this.#l="string"==typeof t?this.#e.querySelector(t):t,this.#v=this.#s.bf_view_globals.entries,this.#C=this.#s.bf_view_globals.userInfo,this.#B=this.#s.bf_view_globals.uploadUrl,this.init()}init(){this.#O(),this.#L(),this.#M(),this.#k(),this.#c=Math.ceil(this.#d/this.#b),this.#y.innerHTML=this.#c,this.#F()}#F(){this.#r[0].disabled=0===this.#h,this.#r[1].disabled=0===this.#h,this.#r[2].disabled=this.#h===this.#c-1,this.#r[3].disabled=this.#h===this.#c-1}#O(){this.#r=this.#l.querySelectorAll(`.bf${this.#f}-${this.#m}-pgn-btn`),this.#u=this.#H(`.bf${this.#f}-${this.#m}-tbl-pgn-slt`),this.#n=this.#H(`.bf${this.#f}-${this.#m}-tbody`),this.#E=this.#H(`.bf${this.#f}-${this.#m}-serc-bx`),this.#S=this.#H(`.bf${this.#f}-${this.#m}-curr-page`),this.#y=this.#H(`.bf${this.#f}-${this.#m}-total-page`)}clear(){this.#l.innerHTML="",this.#N()}#N(){this.#o.forEach((({selector:t,eventType:e,cb:s})=>{t.removeEventListener(e,s)}))}#D(t,e,s){t.addEventListener(e,s),this.#o.push({selector:t,eventType:e,cb:s})}#H(t){return this.#l.querySelector(t)}#M(){this.#D(this.#u,"change",(t=>{t.preventDefault();const e=t.target.value;this.#b=parseInt(e,10),this.#c=Math.ceil(this.#d/this.#b),this.#y.innerHTML=this.#c,this.#F(),this.#S.innerHTML=1,this.#z()}))}#L(){this.#r.forEach((t=>{this.#D(t,"click",(t=>{switch(t.preventDefault(),t.target.dataset.page){case"start":this.#h=0;break;case"end":this.#h=this.#c-1;break;case"previous":this.#h>=1&&(this.#h-=1);break;case"next":this.#h<this.#c&&(this.#h+=1)}this.#F(),this.#S.innerHTML=this.#h+1,this.#z()}))}))}debounce(t,e,s){let i;return function(){const a=this,n=arguments,r=s&&!i;clearTimeout(i),i=setTimeout((function(){i=null,s||t.apply(a,n)}),e),r&&t.apply(a,n)}}#k(){this.#D(this.#E,"keyup",this.debounce((t=>{let e;e=t.target.value?this.#j(t.target.value):this.#v,this.#A(e)}),500))}#j(t){const e=t.toLowerCase(),s={};return Object.keys(this.#v).forEach((t=>{const i=this.#v[t];for(const a in i)i[a].toLowerCase().includes(e)&&(s[t]=i)})),s}#U(){const{accessFor:t,all:e}=this.#$,{roles:s}=this.#C;return!("all"!==t||!e.entryEdit.includes(s[0]))}#W(){const{accessFor:t,user:e}=this.#$,{id:s}=this.#C;return!("user"!==t||!e.ids.includes(s))}#R(t){const e=this.#x("td"),s=this.#x("div"),i=this.#I.editButton,a=this.#I.viewButton,{accessFor:n,all:r}=this.#$,{roles:l}=this.#C;if(this.#J(s,`bf${this.#f}-${this.#m}-tbl-action-btns`),i.show&&"all"===n&&r.entryEdit.includes(l[0])){const e=this.#x("a");e.innerHTML=i.btnTxt,this.#J(e,`bf${this.#f}-${this.#m}-tbl-edit-btn`),e.href=`${i.slug}?bf_entry_id=${t}`,this.#q(s,e)}if(a.show&&"all"===n&&r.singleEntryDetailsView.includes(l[0])){const e=this.#x("a");e.innerHTML=a.btnTxt,this.#J(e,`bf${this.#f}-${this.#m}-tbl-view-btn`),e.href=`${a.slug}?bf_entry_id=${t}`,this.#q(s,e)}return this.#q(e,s),e}#z(){let t=0;0!==this.#h&&(t=this.#h*this.#b),async function(t,e,s=null,i=null){if(!bf_view_globals)return!1;const a=new URL(bf_view_globals?.ajaxURL);if(a.searchParams.append("action",e),i)for(const t in i)t&&a.searchParams.append(t,i[t]);return await fetch(a,{method:"POST",headers:{"Content-Type":null===s?"application/x-www-form-urlencoded":s},body:t instanceof FormData?t:JSON.stringify(t)}).then((t=>t.json()))}({formId:this.#f,tableId:this.#m,offset:t,pageSize:this.#b},"bitforms_get_entries").then((t=>{const{data:e}=t,s=Object.keys(e).sort(((t,e)=>e-t)),i={};s.forEach((t=>{i[t]=e[t]})),this.#v=i,this.#A(this.#v)}))}#V(t,e,s,i,a){const n=`${this.#T||this.#B}${t}`,r=this.#x("img");return r.src=n,r.alt=e,void 0!==i&&(r.style.width=i),void 0!==a&&(r.style.height=a),r}#Z(t){return t in this.#_&&["advanced-file-up","signature","file-up"].includes(this.#_[t].typ)}#A(t){this.#n.innerHTML="";const{head:e}=this.#w.actionsBtn;Object.keys(t).forEach((s=>{const i=this.#x("tr");if(this.#P.forEach((e=>{const a=this.#x("td"),n=e.fk.replace(/\${([a-zA-Z0-9]+-\d+)}/g,"$1");if(this.#Z(n)){const i=t[s][e.fk];this.#T=t[s]?.resourcePath;const n=this.#G(i)&&JSON.parse(i);if(Array.isArray(n))n.forEach((t=>{const e=this.#V(t,t,s,"100%");this.#q(a,e)}));else{const t=this.#V(i,i,s,"100%");this.#q(a,t)}}else a.innerHTML=t[s][e.fk];this.#q(i,a)})),e?.show&&(this.#U()||this.#W())){const t=this.#R(s);this.#q(i,t)}this.#q(this.#n,i)}))}#G(t){try{JSON.parse(t)}catch(t){return!1}return!0}#x(t){return this.#e.createElement(t)}#J(t,e){t.classList.add(e)}#q(t,e){t.appendChild(e)}}return document.addEventListener("DOMContentLoaded",(()=>{void 0!==bit_data_view&&bit_data_view()})),function(){Object.keys(window?.bf_view_globals.bf_tables||{}).forEach((e=>{const s=window.bf_view_globals.bf_tables[e];if(s){const{formId:e,viewId:a}=s,n=(i=`.bf${e}-${a}-tbl-wrp`,document.querySelector(i));s.inits=new t(n,s)}var i}))}}();
