var E=Object.defineProperty;var D=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var R=(a,e,o)=>e in a?E(a,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[e]=o,k=(a,e)=>{for(var o in e||(e={}))W.call(e,o)&&R(a,o,e[o]);if(D)for(var o of D(e))U.call(e,o)&&R(a,o,e[o]);return a};import{_ as d,aa as S,$ as y,c as x,b_ as F,u as P,r as _,j as s,C as A}from"./main-381.js";import{t as N}from"./bf-35-88.js";import{a4 as C,a5 as Z,a6 as H}from"./bf-433-81.js";const X=(a,e,o,h,c,t,r,l,i)=>{let n=k({},e);if(r){const m=k({},l);m[a.target.name]="",i(k({},m))}switch(n[a.target.name]=a.target.value,a.target.name){case"workbook":n=O(n,h,o,c,t);break;case"worksheet":n=q(n,h,o,c,t);break}o(k({},n))},O=(a,e,o,h,c)=>{var r,l,i,n,m,u,f,p,w;const t=k({},a);return t.worksheet="",t.field_map=[{formField:"",zohoFormField:""}],(l=(r=t==null?void 0:t.default)==null?void 0:r.worksheets)!=null&&l[a.workbook]?Object.keys((n=(i=t==null?void 0:t.default)==null?void 0:i.worksheets)==null?void 0:n[a.workbook]).length===1&&(t.worksheet=(u=(m=t==null?void 0:t.default)==null?void 0:m.worksheets)==null?void 0:u[a.workbook][0].viewName,(w=(p=(f=t==null?void 0:t.default)==null?void 0:f.worksheets)==null?void 0:p.headers)!=null&&w[t.worksheet]||$(e,t,o,h,c)):V(e,t,o,h,c),t},q=(a,e,o,h,c)=>{var r,l,i;const t=k({},a);return t.field_map=[{formField:"",zohoFormField:""}],(i=(l=(r=t==null?void 0:t.default)==null?void 0:r.worksheets)==null?void 0:l.headers)!=null&&i[a.worksheet]||$(e,t,o,h,c),t},Y=(a,e,o,h,c)=>{h(!0);const t={formID:a,id:e.id,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails,ownerEmail:e.ownerEmail};x(t,"bitforms_zsheet_refresh_workbooks").then(r=>{if(r&&r.success){const l=k({},e);l.default||(l.default={}),r.data.workbooks&&(l.default.workbooks=r.data.workbooks),r.data.tokenDetails&&(l.tokenDetails=r.data.tokenDetails),c({show:!0,msg:d("Workbooks refreshed")}),o(k({},l))}else r&&r.data&&r.data.data||!r.success&&typeof r.data=="string"?c({show:!0,msg:F(d("Workbooks refresh failed Cause: %s. please try again"),r.data.data||r.data)}):c({show:!0,msg:d("Workbooks refresh failed. please try again")});h(!1)}).catch(()=>h(!1))},V=(a,e,o,h,c)=>{const{workbook:t}=e;if(!t)return;h(!0);const r={formID:a,workbook:t,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails};x(r,"bitforms_zsheet_refresh_worksheets").then(l=>{if(l&&l.success){const i=k({},e);l.data.worksheets&&(i.default.worksheets||(i.default.worksheets={}),i.default.worksheets[t]=l.data.worksheets),l.data.tokenDetails&&(i.tokenDetails=l.data.tokenDetails),c({show:!0,msg:d("Worksheets refreshed")}),o(k({},i))}else c({show:!0,msg:d("Worksheets refresh failed. please try again")});h(!1)}).catch(()=>h(!1))},$=(a,e,o,h,c)=>{const{workbook:t,worksheet:r,headerRow:l}=e;if(!r)return;h(!0);const i={formID:a,workbook:t,worksheet:r,headerRow:l,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails,ownerEmail:e.ownerEmail};x(i,"bitforms_zsheet_refresh_worksheet_headers").then(n=>{if(n&&n.success){const m=k({},e);n.data.worksheet_headers.length>0?(m.default.worksheets.headers||(m.default.worksheets.headers={}),m.default.worksheets.headers[r]||(m.default.worksheets.headers[r]={}),m.default.worksheets.headers[r][l]=n.data.worksheet_headers,n.data.tokenDetails&&(m.tokenDetails=n.data.tokenDetails),c({show:!0,msg:d("Worksheet Headers refreshed")})):c({show:!0,msg:d("No Worksheet headers found. Try changing the header row number or try again")}),n.data.tokenDetails&&(m.tokenDetails=n.data.tokenDetails),o(k({},m))}else c({show:!0,msg:d("Worksheet Headers refresh failed. please try again")});h(!1)}).catch(()=>h(!1))},B=(a,e,o,h,c,t)=>{if(!a.dataCenter||!a.clientId||!a.clientSecret){o({dataCenter:a.dataCenter?"":d("Data center cann't be empty"),clientId:a.clientId?"":d("Client ID cann't be empty"),clientSecret:a.clientSecret?"":d("Secret key cann't be empty")});return}const r=S(y);c(!0);const l="ZohoSheet.dataAPI.READ,ZohoSheet.dataAPI.UPDATE",i=`https://accounts.zoho.${a.dataCenter}/oauth/v2/auth?scope=${l}&response_type=code&client_id=${a.clientId}&prompt=Consent&access_type=offline&state=${encodeURIComponent(window.location.href)}?redirect&redirect_uri=${encodeURIComponent(r.zohoRedirectURL)}`,n=window.open(i,"zohoSheet","width=400,height=609,toolbar=off"),m=setInterval(()=>{if(n.closed){clearInterval(m);let u={},f=!1;const p=localStorage.getItem("__bitforms_zohoSheet");if(p&&(f=!0,u=JSON.parse(p),localStorage.removeItem("__bitforms_zohoSheet")),!u.code||u.error||!u||!f){const w=u.error?`Cause: ${u.error}`:"";t({show:!0,msg:`${d("Authorization failed")} ${w}. ${d("please try again")}`}),c(!1)}else{const w=k({},a);w.accountServer=u["accounts-server"],J(u,w,e,h,c,t)}}},500)},J=(a,e,o,h,c,t)=>{const r=k({},a);r.dataCenter=e.dataCenter,r.clientId=e.clientId,r.clientSecret=e.clientSecret;const l=S(y);r.redirectURI=l.zohoRedirectURL,x(r,"bitforms_zsheet_generate_token").then(i=>i).then(i=>{if(i&&i.success){const n=k({},e);n.tokenDetails=i.data,o(n),C(n),h(!0),t({show:!0,msg:d("Authorized Successfully")})}else i&&i.data&&i.data.data||!i.success&&typeof i.data=="string"?t({show:!0,msg:`${d("Authorization failed Cause:")}${i.data.data||i.data}. ${d("please try again")}`}):t({show:!0,msg:d("Authorization failed. please try again")});c(!1)})};function M({formID:a,sheetConf:e,setSheetConf:o,step:h,setstep:c,isLoading:t,setisLoading:r,setSnackbar:l,redirectLocation:i,isInfo:n,authorizedAction:m}){const u=P(y),{siteURL:f}=u,[p,w]=_.useState(!1),[b,z]=_.useState({dataCenter:"",clientId:"",clientSecret:""}),g=j=>{const v=k({},e),I=k({},b);I[j.target.name]="",v[j.target.name]=j.target.value,z(I),o(v)};return _.useEffect(()=>{p&&m()},[p]),s.jsxs(s.Fragment,{children:[s.jsx(Z,{title:N.zohoSheet.title,youTubeLink:N.zohoSheet.link}),s.jsxs("div",{className:"btcd-stp-page",style:{width:900,height:"100%"},children:[s.jsx("div",{className:"mt-3",children:s.jsx("b",{children:d("Integration Name:")})}),s.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:g,name:"name",value:e.name,type:"text",placeholder:d("Integration Name..."),disabled:n}),s.jsx("div",{className:"mt-3",children:s.jsx("b",{children:d("Data Center:")})}),s.jsxs("select",{onChange:g,name:"dataCenter",value:e.dataCenter,className:"btcd-paper-inp w-6 mt-1",disabled:n,children:[s.jsx("option",{value:"",children:d("--Select a data center--")}),s.jsx("option",{value:"com",children:"zoho.com"}),s.jsx("option",{value:"eu",children:"zoho.eu"}),s.jsx("option",{value:"com.cn",children:"zoho.com.cn"}),s.jsx("option",{value:"in",children:"zoho.in"}),s.jsx("option",{value:"com.au",children:"zoho.com.au"})]}),s.jsx("div",{style:{color:"red"},children:b.dataCenter}),s.jsx("div",{className:"mt-3",children:s.jsx("b",{children:d("Homepage URL:")})}),s.jsx(A,{value:f,className:"field-key-cpy w-6 ml-0",readOnly:n}),s.jsx("div",{className:"mt-3",children:s.jsx("b",{children:d("Authorized Redirect URIs:")})}),s.jsx(A,{value:i||`${u.zohoRedirectURL}`,className:"field-key-cpy w-6 ml-0",readOnly:n}),s.jsxs("small",{className:"d-blk mt-5",children:[d("To get Client ID and SECRET , Please Visit")," ",s.jsx("a",{className:"btcd-link",href:`https://api-console.zoho.${(e==null?void 0:e.dataCenter)||"com"}/`,target:"_blank",rel:"noreferrer",children:d("Zoho API Console")})]}),s.jsx("div",{className:"mt-3",children:s.jsx("b",{children:d("Client id:")})}),s.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:g,name:"clientId",value:e.clientId,type:"text",placeholder:d("Client id..."),disabled:n}),s.jsx("div",{style:{color:"red"},children:b.clientId}),s.jsx("div",{className:"mt-3",children:s.jsx("b",{children:d("Client secret:")})}),s.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:g,name:"clientSecret",value:e.clientSecret,type:"text",placeholder:d("Client secret..."),disabled:n}),s.jsx("div",{style:{color:"red"},children:b.clientSecret}),!n&&s.jsxs(s.Fragment,{children:[s.jsx(H,{isAuthorized:p,isloading:t,handleAuthorize:()=>B(e,o,z,w,r,l)}),s.jsx("br",{})]})]})]})}var T=Object.freeze({__proto__:null,default:M});export{M as Z,V as a,$ as b,T as c,X as h,Y as r};
