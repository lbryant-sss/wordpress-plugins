var H=Object.defineProperty;var O=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var q=(t,a,d)=>a in t?H(t,a,{enumerable:!0,configurable:!0,writable:!0,value:d}):t[a]=d,m=(t,a)=>{for(var d in a||(a={}))V.call(a,d)&&q(t,d,a[d]);if(O)for(var d of O(a))W.call(a,d)&&q(t,d,a[d]);return t};import{_ as u,aa as E,$ as D,c as R,b_ as L,u as B,r as v,j as h,C as M}from"./main-381.js";import{t as S}from"./bf-35-88.js";import{a4 as J,a5 as G,a6 as K}from"./bf-433-81.js";const le=(t,a,d,n,o,l,e,i,s,r)=>{let c=m({},d);if(a===0){if(i){const f=m({},s);f[t.target.name]="",r(m({},f))}c[t.target.name]=t.target.value}else c.relatedlists||(c.relatedlists=[]),c.relatedlists[a-1][t.target.name]=t.target.value;switch(t.target.name){case"module":c=Q(a,o,c,n,l,e);break;case"layout":c=P(a,o,c,n,l,e);break}n(m({},c))},ie=(t,a,d,n,o,l,e)=>{var i,s;t&&!((s=(i=n.default)==null?void 0:i.relatedlists)!=null&&s[n.module])&&Y(d,n,o,l,e),a(t)},Q=(t,a,d,n,o,l)=>{var s,r;let e=m({},d);const i=t===0?e.module:e.relatedlists[t-1].module;if(e.relatedlists[t-1]||(e.relatedlists[t-1]={}),t===0?(e.layout="",e.actions={},e.field_map=[{formField:"",zohoFormField:""}],e.upload_field_map=[{formField:"",zohoFormField:""}],e.relatedlists=[]):(e.relatedlists[t-1].layout="",e.relatedlists[t-1].actions={},e.relatedlists[t-1].field_map=[{formField:"",zohoFormField:""}],e.relatedlists[t-1].upload_field_map=[{formField:"",zohoFormField:""}]),!((s=e.default.layouts)!=null&&s[i]))X(t,a,e,n,o,l);else{const c=Object.keys((r=e.default.layouts)==null?void 0:r[i]);c.length===1&&(t===0?[e.layout]=c:[e.relatedlists[t-1].layout]=c,e=P(t,a,e,n,o,l))}return e},P=(t,a,d,n,o,l)=>{var r,c,f,p,g,y,_,j,z,x,w,k,I,$,A,U,N;const e=m({},d),i=t===0?e.module:e.relatedlists[t-1].module,s=t===0?e.layout:e.relatedlists[t-1].layout;return t===0?(e.actions={},e.field_map=(p=(f=(c=(r=e==null?void 0:e.default)==null?void 0:r.layouts)==null?void 0:c[i])==null?void 0:f[s])!=null&&p.required?F(t,e):[{formField:"",zohoFormField:""}],e.upload_field_map=(j=(_=(y=(g=e==null?void 0:e.default)==null?void 0:g.layouts)==null?void 0:y[i])==null?void 0:_[s])!=null&&j.requiredFileUploadFields&&Object.keys(e.default.layouts[i][s].requiredFileUploadFields).length>0?F(t,e,!0):[{formField:"",zohoFormField:""}]):(e.relatedlists[t-1].actions={},e.relatedlists[t-1].field_map=(k=(w=(x=(z=e==null?void 0:e.default)==null?void 0:z.layouts)==null?void 0:x[i])==null?void 0:w[s])!=null&&k.required?F(t,e):[{formField:"",zohoFormField:""}],e.relatedlists[t-1].upload_field_map=(U=(A=($=(I=e==null?void 0:e.default)==null?void 0:I.layouts)==null?void 0:$[i])==null?void 0:A[s])!=null&&U.requiredFileUploadFields&&Object.keys(e.default.layouts[i][s].requiredFileUploadFields).length>0?F(t,e,!0):[{formField:"",zohoFormField:""}]),!((N=e.default.tags)!=null&&N[i])&&Z(t,a,e,n,o,l),e},de=(t,a,d,n,o)=>{n(!0);const l={formID:t,id:a.id,dataCenter:a.dataCenter,clientId:a.clientId,clientSecret:a.clientSecret,tokenDetails:a.tokenDetails};R(l,"bitforms_zcrm_refresh_modules").then(e=>{if(e&&e.success){const i=m({},a);i.default||(i.default={}),e.data.modules&&(i.default.modules=e.data.modules),e.data.tokenDetails&&(i.tokenDetails=e.data.tokenDetails),d(m({},i)),o({show:!0,msg:u("Modules refreshed")})}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?o({show:!0,msg:L(u("Modules refresh failed Cause: %s. please try again"),e.data.data||e.data)}):o({show:!0,msg:u("Modules refresh failed. please try again")});n(!1)}).catch(()=>n(!1))},X=(t,a,d,n,o,l)=>{const e=m({},d),i=t===0?e.module:e.relatedlists[t-1].module;if(!i)return;o(!0);const s={formID:a,module:i,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails};R(s,"bitforms_zcrm_refresh_layouts").then(r=>{var c,f;if(r&&r.success){if(r.data.layouts){e.default.layouts||(e.default.layouts={}),e.default.layouts[i]=r.data.layouts;const p=[...Object.keys(r.data.layouts)];p.length===1&&(t===0?([e.layout]=p,e.field_map=F(t,e),Object.keys(r.data.layouts[p].fileUploadFields).length>0&&(e.upload_field_map=F(t,e,!0))):([e.relatedlists[t-1].layout]=p,e.relatedlists[t-1].field_map=F(t,e),Object.keys(r.data.layouts[p].fileUploadFields).length>0&&(e.relatedlists[t-1].upload_field_map=F(t,e,!0))),(c=e.default.tags)!=null&&c[i]||Z(t,a,e,n,o,l))}r.data.tokenDetails&&(e.tokenDetails=r.data.tokenDetails),n(m({},e)),l({show:!0,msg:u("Layouts refreshed")})}else(f=r==null?void 0:r.data)!=null&&f.data||!r.success&&typeof r.data=="string"?l({show:!0,msg:L(u("Layouts refresh failed Cause: %s. please try again"),r.data.data||r.data)}):l({show:!0,msg:u("Layouts refresh failed. please try again")});o(!1)}).catch(()=>o(!1))},Y=(t,a,d,n,o)=>{if(!a.module)return;n(!0);const l={formID:t,module:a.module,dataCenter:a.dataCenter,clientId:a.clientId,clientSecret:a.clientSecret,tokenDetails:a.tokenDetails};R(l,"bitforms_zcrm_get_related_lists").then(e=>{var i;if(e&&e.success){const s=m({},a);e.data.relatedLists&&(s.default.relatedlists||(s.default.relatedlists={}),s.default.relatedlists[s.module]=m({},e.data.relatedLists)),e.data.tokenDetails&&(s.tokenDetails=e.data.tokenDetails),d(m({},s)),o({show:!0,msg:u("RelatedLists refreshed")})}else(i=e==null?void 0:e.data)!=null&&i.data||!e.success&&typeof e.data=="string"?o({show:!0,msg:`${u("RelatedLists refresh failed Cause:")}${e.data.data||e.data}. ${u("please try again")}`}):o({show:!0,msg:u("RelatedLists refresh failed. please try again")});n(!1)}).catch(()=>n(!1))},Z=(t,a,d,n,o,l)=>{const e=t===0?d.module:d.relatedlists[t-1].module;if(!e)return;o(!0);const i={formID:a,module:e,dataCenter:d.dataCenter,clientId:d.clientId,clientSecret:d.clientSecret,tokenDetails:d.tokenDetails};R(i,"bitforms_zcrm_get_tags").then(s=>{var r;if(s!=null&&s.success){const c=m({},d);s.data.tags&&(c.default.tags||(c.default.tags={}),c.default.tags[e]=m({},s.data.tags)),s.data.tokenDetails&&(c.tokenDetails=s.data.tokenDetails),n(m({},c)),l({show:!0,msg:u("Tags refreshed")})}else(r=s==null?void 0:s.data)!=null&&r.data||!s.success&&typeof s.data=="string"?l({show:!0,msg:`${u("Tags refresh failed Cause:")}${s.data.data||s.data}. ${u("please try again")}`}):l({show:!0,msg:u("Tags refresh failed. please try again")});o(!1)}).catch(()=>o(!1))},oe=(t,a,d,n,o)=>{n(!0);const l={formID:t,dataCenter:a.dataCenter,clientId:a.clientId,clientSecret:a.clientSecret,tokenDetails:a.tokenDetails};R(l,"bitforms_zcrm_get_users").then(e=>{if(e!=null&&e.success){const i=m({},a);i.default.crmOwner=e.data.users,e.data.tokenDetails&&(i.tokenDetails=e.data.tokenDetails),d(m({},i)),o({show:!0,msg:u("Owners refreshed")})}else o({show:!0,msg:u("Owners refresh failed. please try again")});n(!1)}).catch(()=>n(!1))},ne=(t,a,d,n,o)=>{const l=t===0?a.module:a.relatedlists[t-1].module;if(!l)return;n(!0);const e={module:l,dataCenter:a.dataCenter,clientId:a.clientId,clientSecret:a.clientSecret,tokenDetails:a.tokenDetails};R(e,"bitforms_zcrm_get_assignment_rules").then(i=>{if(i!=null&&i.success){const s=m({},a);s.default.assignmentRules||(s.default.assignmentRules={}),i.data.tokenDetails&&(s.tokenDetails=i.data.tokenDetails),s.default.assignmentRules[l]=m({},i.data.assignmentRules),d(m({},s)),o({show:!0,msg:u("Assignment Rules refreshed")})}else o({show:!0,msg:u("Assignment Rules refresh failed. please try again")});n(!1)}).catch(()=>n(!1))},F=(t,a,d)=>{const n=t===0?a.module:a.relatedlists[t-1].module,o=t===0?a.layout:a.relatedlists[t-1].layout;return d?a.default.layouts[n][o].requiredFileUploadFields.length>0?a.default.layouts[n][o].requiredFileUploadFields.map(l=>({formField:"",zohoFormField:l})):[{formField:"",zohoFormField:""}]:a.default.layouts[n][o].required.length>0?a.default.layouts[n][o].required.map(l=>({formField:"",zohoFormField:l})):[{formField:"",zohoFormField:""}]},re=t=>{const a=t!=null&&t.field_map?t.field_map.filter(l=>{var e,i,s,r;return!l.formField&&l.zohoFormField&&((r=(s=(i=(e=t==null?void 0:t.default)==null?void 0:e.layouts)==null?void 0:i[t.module])==null?void 0:s[t.layout])==null?void 0:r.required.indexOf(l.zohoFormField))!==-1}):[],d=t!=null&&t.upload_field_map?t.upload_field_map.filter(l=>!l.formField&&l.zohoFormField&&t.default.layouts[t.module][t.layout].requiredFileUploadFields.indexOf(l.zohoFormField)!==-1):[],n=t.relatedlists.map(l=>l.field_map.filter(e=>!e.formField&&e.zohoFormField)),o=t.relatedlists.map(l=>l.upload_field_map.filter(e=>!e.formField&&e.zohoFormField));return!(a.length>0||d.length>0||n.some(l=>l.length)||o.some(l=>l.length))},b=(t,a,d,n,o,l)=>{if(!t.dataCenter||!t.clientId||!t.clientSecret){d({dataCenter:t.dataCenter?"":u("Data center cann't be empty"),clientId:t.clientId?"":u("Client ID cann't be empty"),clientSecret:t.clientSecret?"":u("Secret key cann't be empty")});return}const e=E(D);o(!0);const i="ZohoCRM.modules.ALL,ZohoCRM.settings.ALL,ZohoCRM.users.Read,zohocrm.files.CREATE",s=`https://accounts.zoho.${t.dataCenter}/oauth/v2/auth?scope=${i}&response_type=code&client_id=${t.clientId}&prompt=Consent&access_type=offline&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(e.zohoRedirectURL)}`,r=window.open(s,"zohoCRM","width=400,height=609,toolbar=off"),c=setInterval(()=>{if(r.closed){clearInterval(c);let f={},p=!1;const g=localStorage.getItem("__bitforms_zohoCRM");if(g&&(p=!0,f=JSON.parse(g),localStorage.removeItem("__bitforms_zohoCRM")),!f.code||f.error||!f||!p){const y=f.error?`Cause: ${f.error}`:"";l({show:!0,msg:`${u("Authorization failed")} ${y}. ${u("please try again")}`}),o(!1)}else{const y=m({},t);y.accountServer=f["accounts-server"],C(f,y,a,n,o,l)}}},500)},C=(t,a,d,n,o,l)=>{const e=E(D),i=m({},t);i.dataCenter=a.dataCenter,i.clientId=a.clientId,i.clientSecret=a.clientSecret,i.redirectURI=encodeURIComponent(e.zohoRedirectURL),R(i,"bitforms_zcrm_generate_token").then(s=>s).then(s=>{if(s&&s.success){const r=m({},a);r.tokenDetails=s.data,d(r),J(r),n(!0),l({show:!0,msg:u("Authorized Successfully")})}else s&&s.data&&s.data.data||!s.success&&typeof s.data=="string"?l({show:!0,msg:`${u("Authorization failed Cause:")}${s.data.data||s.data}. ${u("please try again")}`}):l({show:!0,msg:u("Authorization failed. please try again")});o(!1)})};function T({formID:t,crmConf:a,setCrmConf:d,step:n,setstep:o,isLoading:l,setisLoading:e,setSnackbar:i,redirectLocation:s,isInfo:r,authorizedAction:c}){const f=B(D),{siteURL:p}=f,[g,y]=v.useState(!1),[_,j]=v.useState({dataCenter:"",clientId:"",clientSecret:""}),z=x=>{const w=m({},a),k=m({},_);k[x.target.name]="",w[x.target.name]=x.target.value,j(k),d(w)};return v.useEffect(()=>{g&&c()},[g]),h.jsxs(h.Fragment,{children:[h.jsx(G,{title:S.zohoCrm.title,youTubeLink:S.zohoCrm.link}),h.jsxs("div",{className:"btcd-stp-page",style:{width:900,height:"100%"},children:[h.jsx("div",{className:"mt-3",children:h.jsx("b",{children:u("Integration Name:")})}),h.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:z,name:"name",value:a.name,type:"text",placeholder:u("Integration Name..."),disabled:r}),h.jsx("div",{className:"mt-3",children:h.jsx("b",{children:u("Data Center:")})}),h.jsxs("select",{onChange:z,name:"dataCenter",value:a.dataCenter,className:"btcd-paper-inp w-6 mt-1",disabled:r,children:[h.jsx("option",{value:"",children:u("--Select a data center--")}),h.jsx("option",{value:"com",children:"zoho.com"}),h.jsx("option",{value:"eu",children:"zoho.eu"}),h.jsx("option",{value:"com.cn",children:"zoho.com.cn"}),h.jsx("option",{value:"in",children:"zoho.in"}),h.jsx("option",{value:"com.au",children:"zoho.com.au"})]}),h.jsx("div",{style:{color:"red"},children:_.dataCenter}),h.jsx("div",{className:"mt-3",children:h.jsx("b",{children:u("Homepage URL:")})}),h.jsx(M,{value:p,className:"field-key-cpy w-6 ml-0",readOnly:r}),h.jsx("div",{className:"mt-3",children:h.jsx("b",{children:u("Authorized Redirect URIs:")})}),h.jsx(M,{value:s||`${f.zohoRedirectURL}`,className:"field-key-cpy w-6 ml-0",readOnly:r}),h.jsxs("small",{className:"d-blk mt-5",children:[u("To get Client ID and SECRET , Please Visit")," ",h.jsx("a",{className:"btcd-link",href:`https://api-console.zoho.${(a==null?void 0:a.dataCenter)||"com"}/`,target:"_blank",rel:"noreferrer",children:u("Zoho API Console")})]}),h.jsx("div",{className:"mt-3",children:h.jsx("b",{children:u("Client id:")})}),h.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:z,name:"clientId",value:a.clientId,type:"text",placeholder:u("Client id..."),disabled:r}),h.jsx("div",{style:{color:"red"},children:_.clientId}),h.jsx("div",{className:"mt-3",children:h.jsx("b",{children:u("Client secret:")})}),h.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:z,name:"clientSecret",value:a.clientSecret,type:"text",placeholder:u("Client secret..."),disabled:r}),h.jsx("div",{style:{color:"red"},children:_.clientSecret}),!r&&h.jsxs(h.Fragment,{children:[h.jsx(K,{isAuthorized:g,isLoading:l,handleAuthorize:()=>b(a,d,j,y,e,i)}),h.jsx("br",{})]})]})]})}var ue=Object.freeze({__proto__:null,default:T});export{T as Z,Z as a,oe as b,re as c,ie as d,X as e,Y as f,de as g,le as h,ue as i,ne as r};
