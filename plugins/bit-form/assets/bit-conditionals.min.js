var bit_conditionals=function(){"use strict";const e=(e,t,n)=>{switch(e){case"and":return t&&n;case"or":return t||n;default:return!1}},t=["date","advanced-datetime","datetime-local","time","month","week"],n=(e,n,h,b,g,y,v)=>{let $;if(t.includes(h[n.field].type)&&"undefined"!=typeof bfDateFieldsLogicCheck&&($=bfDateFieldsLogicCheck(n,h,b,g,y,v)),void 0!==$)return $;switch(n.logic){case"change":case"on_click":return e===n.field;case"equal":return i(n,h,b,g);case"not_equal":return r(n,h,b,g);case"null":return!b&&0===b.length;case"not_null":return b&&b.length>0;case"contain":return l(n,h,b,g,y);case"contain_all":return a(n,h,b,g);case"not_contain":return s(n,h,b,g);case"greater":return c(n,h,b,g);case"less":return o(n,h,b,g);case"greater_or_equal":return d(n,h,b,g);case"less_or_equal":return f(n,h,b,g);case"start_with":return u(n,h,b,g);case"end_with":return p(n,h,b,g);case"between":return m(n,h,b,g);default:return!1}},i=(e,t,n,i)=>{if(!t[e.field].value)return!1;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===n||Array.isArray(n)){const e=Array.isArray(n)?n:JSON.parse(n),t=bfSplit(i);let r=0;return e.forEach(n=>{e.length>0&&-1!==t.indexOf(n)&&(r+=1)}),r===t.length&&t.length===e.length}return n===i},r=(e,t,n,i)=>{if(!n)return!1;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===n||Array.isArray(n)){const e=Array.isArray(n)?n:JSON.parse(n),t=bfSplit(i);if(e.length!==t.length)return!0;let r=0;return t.forEach(t=>{e.length>0&&-1===e.indexOf(t)&&(r+=1)}),t.length===r}return n!==i},l=(e,t,n,i,r)=>{if(!n)return!1;const l=bfSplit(i,r);let a=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===n||Array.isArray(n)){const e=Array.isArray(n)?n:JSON.parse(n);return l.forEach(t=>{e.length>0&&-1!==e.indexOf(t)&&(a+=1)}),a>0}return l.forEach(e=>{n.length>0&&-1!==n.indexOf(e)&&(a+=1)}),a>0},a=(e,t,n,i)=>{if(!n)return!1;const r=bfSplit(i);let l=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===n||Array.isArray(n)){const e=Array.isArray(n)?n:JSON.parse(n);return r.forEach(t=>{e.length>0&&-1!==e.indexOf(t)&&(l+=1)}),l>=r.length}return!1},s=(e,t,n,i)=>{if(!n)return!1;const r=bfSplit(i);let l=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===n||Array.isArray(n)){const e=Array.isArray(n)?n:JSON.parse(n);return r.forEach(t=>{e.length>0&&-1===e.indexOf(t)&&(l+=1)}),l===r.length}return r.forEach(e=>{n.length>0&&-1===n.indexOf(e)&&(l+=1)}),l===r.length},c=(e,t,n,i)=>!!n&&("number"===t[e.field].type?""!==n&&Number(n)>Number(i):""!==n&&n>i),o=(e,t,n,i)=>!!n&&("number"===t[e.field].type?""!==n&&Number(n)<Number(i):""!==n&&n<i),d=(e,t,n,i)=>!!n&&("number"===t[e.field].type?""!==n&&Number(n)>=Number(i):""!==n&&n>=i),f=(e,t,n,i)=>!!n&&("number"===t[e.field].type?""!==n&&Number(n)<=Number(i):""!==n&&n<=i),u=(e,t,n,i)=>!!n&&""!==n&&0===n.indexOf(i),p=(e,t,n,i)=>!!n&&i===n.substr(n.length-i.length,n.length),m=(e,t,n,i)=>{if(!n)return!1;let r=i;"string"==typeof i&&(r=JSON.parse(i));let l=n,a=r.min,s=r.max;return"number"===t[e.field].type&&(l=Number(n),a=Number(r.min),s=Number(r.max)),l>=a&&l<=s},h=e=>e.match(/\(([^)]*)\)/g),b=(e,t,n,i,r)=>{switch(e){case"_bf_length":return t.length;case"_bf_count":return r.match(/check|radio|select/)?bfSplit(t.trim(),i).length:t.split(/\b\W+\b/g).length;case"_bf_calc":return $(t);case"_bf_math":{const e=bfSplit(t,i),r=e[0].substring(2,e[0].length-1);if(_(r,i)){const t=checkRepeatedField(r,i),l=getRepeatedIndexes(t,i);let a=0;return void 0===e[1]||"sum"===e[1]?l.forEach(e=>{a+=Number(n[`${r}[${e}]`].value)}):"avg"===e[1]?(l.forEach(e=>{a+=Number(n[`${r}[${e}]`].value)}),a/=l.length):"min"===e[1]?l.forEach(e=>{(0===a||Number(n[`${r}[${e}]`].value)<a)&&(a=Number(n[`${r}[${e}]`].value))}):"max"===e[1]?l.forEach(e=>{Number(n[`${r}[${e}]`].value)>a&&(a=Number(n[`${r}[${e}]`].value))}):"count"===e[1]?a=l.length:"mul"===e[1]&&(a=1,l.forEach(e=>{a*=Number(n[`${r}[${e}]`].value)})),a}return n[r].value||""}case"_bf_format_datetime":return"undefined"!=typeof bfFormatDateTime?bfFormatDateTime(t,i):t;case"_bf_datetime_difference":return"undefined"!=typeof bfCalculateDateTimeDifference?bfCalculateDateTimeDifference(t,i):t;case"_bf_add_subtract_datetime":return"undefined"!=typeof bfAddOrSubtractDateTime?bfAddOrSubtractDateTime(t,i):t;case"_bf_concat":{const e=bfSplit(t,i),r=e[0].substring(2,e[0].length-1),l=e[1]||", ";if(_(r,i)){const e=checkRepeatedField(r,i),t=getRepeatedIndexes(e,i);let a="";return t.forEach(e=>{e>1&&(a+=l),a+=n[`${r}[${e}]`].value}),a}return n[r].value||""}case"_bf_number":{const e=/[\d,.]*\d(?:\.\d+)?/,n=t.match(e);if(n){const e=n[0].replace(/,/g,"");return parseFloat(e)}return 0}default:return t}},g=(t,i,r,l,a)=>{if(Array.isArray(i)){let n=!1;for(let s=0;s<i.length;s+=1){const c=i[s];if("string"!=typeof c){const o=g(t,c,r,l,a);if(0===s&&(n=o),s-1>=0&&"string"==typeof i[s-1]){const t=i[s-1].toLowerCase();n=e(t,n,o)}}}return n}const s=v(i.val,r,l,a),c=Object.entries(l.smartTags)?.reduce((e,[t,n])=>({...e,[`\${${t}${"string"==typeof n?"":"()"}}`]:{value:"string"==typeof n?n:n?.[i?.smartKey]||"",type:"text",multiple:!1}}),{}),o={...r,...c},d=_(i.field,l)?`${i.field}[${a}]`:i.field,f={...i,field:d};if(void 0!==o[d]){const e=o[d].value;return n(t,f,o,e,s,l,a)}if(h(i.field)){const e=i.field.substring(2,i.field.length-1).replace(/\([A-Za-z\s0-9+-\\*]*\)/g,""),r=b(e,o[i.smartKey].value,o,l,o[i.smartKey].type);return isNaN(r)?o[i.field]={type:"text"}:o[i.field]={type:"number"},n(t,i,o,r,s,l,a)}return!("undefined"==typeof isRepeaterField||!isRepeaterField(i.field,l))&&n(t,f,o,"",s,l,a)},y=(e,t,n,i)=>{let r=e;return(e.match(/\${_(?:bf_math|bf_concat)\([^)]+\)}/g)||[]).map(e=>{const i=e.substring(e.indexOf("(")+1,e.length-2),l=e.substring(2,e.indexOf("(")),a=b(l,i,t,n);r=r.replace(e,a)}),(r.match(/\${\w[^${}]*}/g)||[]).map(e=>{let l=e;t[l]||(l=e.substring(2,e.length-1)),l=_(l,n)?`${l}[${i}]`:l;let a="";if(t[l])a=t[l].value,Array.isArray(t[l].value)&&!isNaN(t[l].value[0])&&(a=0,t[l].value.map(e=>{a+=Number(e)}));else if(h(l)){const e=l.replace(/\(([^)]*)\)/g,""),i=l.substring(l.indexOf("(")+1,l.length-1);a=b(e,i,t,n,"")}r=r.replace(e,a)}),r},v=(e,t,n,i)=>{if(!e)return e;let r;if(r="object"==typeof e?JSON.stringify(e):JSON.parse(JSON.stringify(e)),"string"!=typeof r)return e;for(;r.match(/\${\w[^${}]*}/g);)r=y(r,t,n,i);return $(r)},$=e=>{if(!e)return e;let t=e;const n=e.match(/[\\+\-\\*\\/\\%]/g);if(n&&n.length>0){const n=e.match(/\w+/g);if(!n)return e;const i=n.filter(e=>Number.isNaN(e));if(i&&i.length>0)return t;t=t.replace(/\{|\[/g,"("),t=t.replace(/\}|\]/g,")");try{t=Function(`"use strict"; return (${t})`)()}catch(t){return e}}return t},_=(e,t)=>"undefined"!=typeof checkRepeatedField&&checkRepeatedField(e,t);let x="",k="";const N=(e,t)=>document.querySelector(`#form-${e} ${x} ${t}`),A=(e,t)=>document.querySelectorAll(`#form-${e} ${x} ${t}`),I=(e,t)=>{const n=_(e,t)?`${e}[${k}]`:e;return t.inits&&!t.inits[n]?e:n},O=function(e){let t;return function(...n){clearTimeout(t),t=setTimeout(()=>{e.apply(this,n)},2500)}}(e=>"undefined"!=typeof saveFormProgress&&saveFormProgress(e)),w=(e,t,n)=>{const i=t.fields[e],{fieldName:r,typ:l}=i,a=I(e,t),s=i.inpType||"";if(t.inits&&t.inits[a])t.inits[a].disabled=n;else{if("check"===l||"checkbox"===s)return void A(t.contentId,`input[name^="${r}"][name$="[]"]`).forEach(e=>{e.disabled=n});if("radio"===l||"radio"===s)return void A(t.contentId,`input[name^="${r}"]`).forEach(e=>{e.disabled=n});if(["decision-box","gdpr"].includes(l)){const e=N(t.contentId,`input[name="${r}"]`);return void(e&&(e.disabled=n))}if("button"===l)return void(N(t.contentId,`.${e}-btn`).disabled=n);N(t.contentId,`.${e}-fld`).disabled=n}},S=(e,t,n)=>{const i=I(e,t);if(t.inits&&t.inits[i])t.inits[i].readonly=n;else{const i=N(t.contentId,`.${e}-fld`);if(!i)return;i.readOnly=n,n?i.classList.add("readonly"):i.classList.remove("readonly")}},E=e=>{if(null===e)return 0;const t=window.getComputedStyle(e);let n=0;return n="border-box"===t.boxSizing?e.scrollHeight:parseInt(t.paddingTop)+parseInt(t.paddingBottom)+e.scrollHeight+parseInt(t.marginTop)+parseInt(t.marginBottom)+parseInt(t.borderTopWidth)+parseInt(t.borderBottomWidth),n},T=(e,t,n)=>{if(t.fields[e.field]){t.fields[e.field].valid.hide=n;const i=e.field,r=t.fields[i].typ;if(["section","repeater"].includes(r)){const n="repeater"===r&&"undefined"!=typeof getRepeatedIndexes?getRepeatedIndexes(i,t):[""],l=t.nestedLayout[i]?.lg?.map(e=>e.i);l?.forEach(i=>{const r={...e,field:i};n.forEach(e=>{F(r,i,t,{},e)})}),k="",x=""}const l=N(t.contentId,`.btcd-fld-itm.${i}`);let a=E(l);setStyleProperty(l,"height",`${a}px`),n?(setStyleProperty(l,"height","0px"),l.classList.add("fld-hide")):(l.classList.remove("fld-hide"),a=E(l),setStyleProperty(l,"height",`${a}px`)),setTimeout(()=>{l.style.removeProperty("height")},300)}},F=(e,t,n,i,r)=>{if(k=r,x=r&&_(e.field,n)?`.rpt-index-${r}`:"",void 0!==e.action&&void 0!==e.field)switch(e.field in n.fields&&!n.fields[e.field].valid&&(n.fields[e.field].valid={}),e.action){case"value":return((e,t,n)=>{const i=e.val?v(e.val,n,t,k):"";void 0!==e.val&&t.fields[e.field]?((e,t,n)=>{const{contentId:i}=e,r=e.fields[t],{fieldName:l,typ:a}=r,s=r.inpType||"";if("radio"===a||"radio"===s)N(i,`input[name^="${l}"][value="${n}"]`).checked=!0;else if("check"===a||"checkbox"===s){const t=new RegExp(`,|${e.configs.bf_separator}`,"g"),r=n.split(t);A(i,`input[name^="${l}"][name$="[]"]`).forEach(e=>{e.checked=r.includes(e.value)})}else if(["decision-box","gdpr"].includes(a)){const e=N(i,`input[name="${l}"]`);e&&(e.checked=n===r.msg.checked)}else if("rating"===a){const i=I(t,e);return void(e.inits&&e.inits[i]&&(e.inits[i].value=n))}if(["radio","check","decision-box","gdpr"].includes(a)||["radio","checkbox"].includes(s))return void(e=>{const t=new Event("input");e?.dispatchEvent(t)})(N(i,`input[name="${l}"]`)||N(i,`input[name^="${l}"][name$="[]"]`));const c=N(i,`[name^='${l}']`);c.value!==n&&(c.value=n,c.setAttribute("value",n))})(t,e.field,i):void 0!==e.val&&"_bf_step_no"===e.field&&t?.inits?.multi_step_form&&(t.inits.multi_step_form.step=i)})(e,n,i);case"hide":return T(e,n,!0);case"disable":n.fields[e.field]&&w(e.field,n,!0);break;case"readonly":n.fields[e.field]&&S(e.field,n,!0);break;case"writeable":n.fields[e.field]&&S(e.field,n,!1);break;case"enable":n.fields[e.field]&&w(e.field,n,!1);break;case"show":if(n.fields[e.field])return T(e,n,!1);break;case"activelist":n.fields[e.field]&&((e,t,n)=>{const i=I(e.field,t);if(t.inits&&t.inits[i]){const r=e.val?v(e.val,n,t,k):"";t.inits[i].activelist=r}})(e,n,i);break;case"save_draft":"_bf_form"===e.field&&((e,t)=>{O(t.contentId)})(0,n);break;case"lbl":case"ct":case"sub-titl":case"hlp-txt":case"title":n.fields[e.field]&&((e,t,n)=>{if(void 0!==e.val&&t.fields[e.field]){const i=e.val?v(e.val,n,t,k):"",r=e.field,l=N(t.contentId,`.${r}-${e.action}`);if(null===l)return;l.childNodes.forEach(e=>{3!==e.nodeType||""===e.textContent.trim()&&e.length||(e.textContent=i)}),"ct"===e.action&&(l.textContent=i)}})(e,n,i);break;case"placeholder":return((e,t,n)=>{const i=e.val?v(e.val,n,t,k):"",r=e.field,l=t.fields[r],{typ:a}=l;if("select"===a){const e=N(t.contentId,`.${r}-selected-opt-lbl`);0===e.childElementCount&&(e.textContent=i)}else if("html-select"===a){const e=N(t.contentId,`.${r}-slct-optn:first-child`);e&&(e.textContent=i)}else if("currency"===a){const e=N(t.contentId,`.${r}-currency-amount-input`);e&&(e.placeholder=i)}else if("phone-number"===a){const e=N(t.contentId,`.${r}-phone-number-input`);e&&(e.placeholder=i)}else if(void 0!==e.val&&t.fields[e.field]){const e=N(t.contentId,`.${r}-fld`);e&&(e.placeholder=i)}})(e,n,i);case"config-option":((e,t,n)=>{if("undefined"!=typeof bfSetDateTimeConfigOption){const i=e.val?v(e.val,n,t,k):"";bfSetDateTimeConfigOption(e,i,t,n,k)}})(e,n,i)}},C=(e,t)=>Object.keys(t).find(n=>t[n].fieldName===e),R=e=>e.replace(/\[\d*\]/g,"");function D(e,t){return Array.isArray(e)?e.some(e=>D(e,t)):"object"==typeof e&&e.field===t}return function(e){if(!e?.target?.form)return;const t=e.target,{form:n}=e.target,i=n.id.replace("form-",""),r=window.bf_globals?.[i];if(!r)return;const l=t.name.match(/\[(\d+)\]/)?.[1],a=R(t.name||t.dataset.parentFieldName),s=C(a,r.fields);if(!s)return;const c=((e,t)=>{const n=new FormData(e),{fields:i}=t,r={};return Array.from(n.entries()).forEach(([e,t])=>{const n=C(R(e),i),l=e.match(/\[(\d+)\]/)?.[1],a=l?`${n}[${l}]`:n;n in i&&(r[a]?(Array.isArray(r[a])||(r[a]=[r[a]]),r[a].push(t)):r[a]=t)}),Object.keys(i).filter(e=>"button"===i[e].typ).forEach(e=>{r[e]=""}),Object.entries(r).reduce((e,[t,n])=>({...e,[t]:{value:n,type:i[t.replace(/\[\d*\]/g,"")].typ,multiple:Array.isArray(n)}}),{})})(n,r),o=[],{onfieldCondition:d}=r;if(!d)return;const f=d.filter(e=>"on_input"===e.event_type).filter(e=>e.conditions.some(e=>D(e?.logics,s)));if(!f.length)return;f.forEach((e,t)=>{const{conditions:n}=e,{length:i}=n;let a=!1,d=!!l&&[l];l||"undefined"==typeof getIndexesBaseOnConditions||(d=getIndexesBaseOnConditions(n,r));let f=!!d&&d.pop();do{let e=0;for(e=0;e<i;e+=1){const t=n[e];if(["if","else-if"].includes(t.cond_type)){const{logics:n}=t;if(a=g(s,n,c,r,f),"undefined"!=typeof bf_modify_workflow_logic_status&&(a=bf_modify_workflow_logic_status(a,n,c,f,e,r)),a)break}}o.push({workflowIndx:t,condIndx:e,logicStatus:a,rowIndex:f}),f=!!d&&d.pop()}while(f)});const u={};return o.reverse(),o.forEach(({workflowIndx:e,condIndx:t,logicStatus:n,rowIndex:i})=>{const{conditions:l}=f[e],a=l.find(e=>"else"===e.cond_type)||{},o=n?l[t].actions:a.actions;o?.fields?.forEach(e=>{let t=[i];i||(t=function(e,t){if("undefined"!=typeof checkRepeatedField){const n=checkRepeatedField(e,t);if(n)return getRepeatedIndexes(n,t)}return!1}(e.field,r)),t||(t=[""]),t.forEach(t=>{const n=`${e.field}[${t}]`;if(u[n]||(u[n]=[]),!u[n].includes(e.action)){u[n].push(e.action);const i=Object.entries(r.smartTags).reduce((e,[t,n])=>({...e,[`\${${t}}`]:{value:n,type:"text",multiple:!1}}),{});F(e,s,r,{...c,...i},t)}})})}),Object.keys(u).length}}();
