var bit_conditionals=function(){"use strict";const e=(e,t,n)=>{switch(e){case"and":return t&&n;case"or":return t||n;default:return!1}},t=(e,t,h,m)=>{switch(e.logic){case"change":case"on_click":return!0;case"equal":return n(e,t,h,m);case"not_equal":return r(e,t,h,m);case"null":return!h&&0===h.length;case"not_null":return h&&h.length>0;case"contain":return i(e,t,h,m);case"contain_all":return l(e,t,h,m);case"not_contain":return s(e,t,h,m);case"greater":return a(e,t,h,m);case"less":return c(e,t,h,m);case"greater_or_equal":return o(e,t,h,m);case"less_or_equal":return d(e,t,h,m);case"start_with":return f(e,t,h,m);case"end_with":return u(e,t,h,m);case"between":return p(e,t,h,m);default:return!1}},n=(e,t,n,r)=>{if(!t[e.field].value)return!1;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===n||Array.isArray(n)){const e=Array.isArray(n)?n:JSON.parse(n),t=r.split(",");let i=0;return e.forEach((n=>{e.length>0&&-1!==t.indexOf(n)&&(i+=1)})),i===t.length&&t.length===e.length}return n===r},r=(e,t,n,r)=>{if(!n)return!1;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===n||Array.isArray(n)){const e=Array.isArray(n)?n:JSON.parse(n),t=r.split(",");if(e.length!==t.length)return!0;let i=0;return t.forEach((t=>{e.length>0&&-1===e.indexOf(t)&&(i+=1)})),t.length===i}return n!==r},i=(e,t,n,r)=>{if(!n)return!1;const i=r.split(",");let l=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===n||Array.isArray(n)){const e=Array.isArray(n)?n:JSON.parse(n);return i.forEach((t=>{e.length>0&&-1!==e.indexOf(t)&&(l+=1)})),l>0}return i.forEach((e=>{n.length>0&&-1!==n.indexOf(e)&&(l+=1)})),l>0},l=(e,t,n,r)=>{if(!n)return!1;const i=r.split(",");let l=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===n||Array.isArray(n)){const e=Array.isArray(n)?n:JSON.parse(n);return i.forEach((t=>{e.length>0&&-1!==e.indexOf(t)&&(l+=1)})),l>=i.length}return!1},s=(e,t,n,r)=>{if(!n)return!1;const i=r.split(",");let l=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===n||Array.isArray(n)){const e=Array.isArray(n)?n:JSON.parse(n);return i.forEach((t=>{e.length>0&&-1===e.indexOf(t)&&(l+=1)})),l===i.length}return i.forEach((e=>{n.length>0&&-1===n.indexOf(e)&&(l+=1)})),l===i.length},a=(e,t,n,r)=>!!n&&("number"===t[e.field].type?""!==n&&Number(n)>Number(r):""!==n&&n>r),c=(e,t,n,r)=>!!n&&("number"===t[e.field].type?""!==n&&Number(n)<Number(r):""!==n&&n<r),o=(e,t,n,r)=>!!n&&("number"===t[e.field].type?""!==n&&Number(n)>=Number(r):""!==n&&n>=r),d=(e,t,n,r)=>!!n&&("number"===t[e.field].type?""!==n&&Number(n)<=Number(r):""!==n&&n<=r),f=(e,t,n,r)=>!!n&&""!==n&&0===n.indexOf(r),u=(e,t,n,r)=>!!n&&r===n.substr(n.length-r.length,n.length),p=(e,t,n,r)=>{if(!n)return!1;let i=r;"string"==typeof r&&(i=JSON.parse(r));let l=n,s=i.min,a=i.max;return"number"===t[e.field].type&&(l=Number(n),s=Number(i.min),a=Number(i.max)),l>=s&&l<=a},h=e=>e.match(/\(([^)]*)\)/g),m=(e,t,n,r,i)=>{switch(e){case"_bf_length":return t.length;case"_bf_count":return i.match(/check|radio|select/)?t.trim().split(",").length:t.split(/\b\W+\b/g).length;case"_bf_calc":return v(t);case"_bf_math":{const e=t.split(","),i=e[0].substring(2,e[0].length-1);if($(i,r)){const t=checkRepeatedField(i,r),l=getRepeatedIndexes(t,r);let s=0;return void 0===e[1]||"sum"===e[1]?l.forEach((e=>{s+=Number(n[`${i}[${e}]`].value)})):"avg"===e[1]?(l.forEach((e=>{s+=Number(n[`${i}[${e}]`].value)})),s/=l.length):"min"===e[1]?l.forEach((e=>{(0===s||Number(n[`${i}[${e}]`].value)<s)&&(s=Number(n[`${i}[${e}]`].value))})):"max"===e[1]?l.forEach((e=>{Number(n[`${i}[${e}]`].value)>s&&(s=Number(n[`${i}[${e}]`].value))})):"count"===e[1]?s=l.length:"mul"===e[1]&&(s=1,l.forEach((e=>{s*=Number(n[`${i}[${e}]`].value)}))),s}return n[i].value||""}case"_bf_concat":{const e=t.split(","),i=e[0].substring(2,e[0].length-1),l=e[1]||", ";if($(i,r)){const e=checkRepeatedField(i,r),t=getRepeatedIndexes(e,r);let s="";return t.forEach((e=>{e>1&&(s+=l),s+=n[`${i}[${e}]`].value})),s}return n[i].value||""}case"_bf_number":{const e=/[\d,.]*\d(?:\.\d+)?/,n=t.match(e);if(n){const e=n[0].replace(/,/g,"");return parseFloat(e)}return 0}default:return t}},g=(n,r,i,l)=>{if(Array.isArray(n)){let t=!1;for(let s=0;s<n.length;s+=1){const a=n[s];if("string"!=typeof a){const c=g(a,r,i,l);if(0===s&&(t=c),s-1>=0&&"string"==typeof n[s-1]){const r=n[s-1].toLowerCase();t=e(r,t,c)}}}return t}const s=y(n.val,r,i,l),a=Object.entries(i.smartTags).reduce(((e,[t,r])=>({...e,[`\${${t}${"string"==typeof r?"":"()"}}`]:{value:"string"==typeof r?r:r?.[n?.smartKey]||"",type:"text",multiple:!1}})),{}),c={...r,...a},o=$(n.field,i)?`${n.field}[${l}]`:n.field,d={...n,field:o};if(void 0!==c[o]){const e=c[o].value;return t(d,c,e,s)}if(h(n.field)){const e=n.field.substring(2,n.field.length-1).replace(/\([A-Za-z\s0-9+-\\*]*\)/g,""),r=m(e,c[n.smartKey].value,c,i,c[n.smartKey].type);return isNaN(r)?c[n.field]={type:"text"}:c[n.field]={type:"number"},t(n,c,r,s)}return!("undefined"==typeof isRepeaterField||!isRepeaterField(n.field,i))&&t(d,c,"",s)},b=(e,t,n,r)=>{let i=e;return(e.match(/\${_(?:bf_math|bf_concat)\([^)]+\)}/g)||[]).map((e=>{const r=e.substring(e.indexOf("(")+1,e.length-2),l=e.substring(2,e.indexOf("(")),s=m(l,r,t,n);i=i.replace(e,s)})),(i.match(/\${\w[^${}]*}/g)||[]).map((e=>{let l=e;t[l]||(l=e.substring(2,e.length-1)),l=$(l,n)?`${l}[${r}]`:l;let s="";if(t[l])s=t[l].value,Array.isArray(t[l].value)&&!isNaN(t[l].value[0])&&(s=0,t[l].value.map((e=>{s+=Number(e)})));else if(h(l)){const e=l.replace(/\(([^)]*)\)/g,""),r=l.substring(l.indexOf("(")+1,l.length-1);s=m(e,r,t,n,"")}i=i.replace(e,s)})),i},y=(e,t,n,r)=>{if(!e)return e;let i;if(i="object"==typeof e?JSON.stringify(e):JSON.parse(JSON.stringify(e)),"string"!=typeof i)return e;for(;i.match(/\${\w[^${}]*}/g);)i=b(i,t,n,r);return v(i)},v=e=>{if(!e)return e;let t=e;const n=e.match(/[\\+\-\\*\\/\\%]/g);if(n&&n.length>0){const n=e.match(/\w+/g);if(!n)return e;const r=n.filter((e=>Number.isNaN(e)));if(r&&r.length>0)return t;t=t.replace(/\{|\[/g,"("),t=t.replace(/\}|\]/g,")");try{t=Function(`"use strict"; return (${t})`)()}catch(t){return e}}return t},$=(e,t)=>"undefined"!=typeof checkRepeatedField&&checkRepeatedField(e,t);let _="",x="";const k=(e,t)=>document.querySelector(`#form-${e} ${_} ${t}`),N=(e,t)=>document.querySelectorAll(`#form-${e} ${_} ${t}`),A=(e,t)=>{const n=$(e,t)?`${e}[${x}]`:e;return t.inits&&!t.inits[n]?e:n},I=function(e){let t;return function(...n){clearTimeout(t),t=setTimeout((()=>{e.apply(this,n)}),2500)}}((e=>"undefined"!=typeof saveFormProgress&&saveFormProgress(e))),w=(e,t,n)=>{const r=t.fields[e],{fieldName:i,typ:l}=r,s=A(e,t),a=r.inpType||"";if(t.inits&&t.inits[s])t.inits[s].disabled=n;else{if("check"===l||"checkbox"===a)return void N(t.contentId,`input[name^="${i}"][name$="[]"]`).forEach((e=>{e.disabled=n}));if("radio"===l||"radio"===a)return void N(t.contentId,`input[name^="${i}"]`).forEach((e=>{e.disabled=n}));if(["decision-box","gdpr"].includes(l)){const e=k(t.contentId,`input[name="${i}"]`);return void(e&&(e.disabled=n))}if("button"===l)return void(k(t.contentId,`.${e}-btn`).disabled=n);k(t.contentId,`.${e}-fld`).disabled=n}},E=(e,t,n)=>{const r=A(e,t);if(t.inits&&t.inits[r])t.inits[r].readonly=n;else{const r=k(t.contentId,`.${e}-fld`);if(!r)return;r.readOnly=n,n?r.classList.add("readonly"):r.classList.remove("readonly")}},O=e=>{if(null===e)return 0;const t=window.getComputedStyle(e);let n=0;return n="border-box"===t.boxSizing?e.scrollHeight:parseInt(t.paddingTop)+parseInt(t.paddingBottom)+e.scrollHeight+parseInt(t.marginTop)+parseInt(t.marginBottom)+parseInt(t.borderTopWidth)+parseInt(t.borderBottomWidth),n},S=(e,t,n)=>{if(t.fields[e.field]){t.fields[e.field].valid.hide=n;const r=e.field,i=t.fields[r].typ;if(["section","repeater"].includes(i)){const n="repeater"===i&&"undefined"!=typeof getRepeatedIndexes?getRepeatedIndexes(r,t):[""],l=t.nestedLayout[r]?.lg?.map((e=>e.i));l?.forEach((r=>{const i={...e,field:r};n.forEach((e=>{F(i,r,t,{},e)}))})),x="",_=""}const l=k(t.contentId,`.btcd-fld-itm.${r}`);let s=O(l);setStyleProperty(l,"height",`${s}px`),n?(setStyleProperty(l,"height","0px"),l.classList.add("fld-hide")):(l.classList.remove("fld-hide"),s=O(l),setStyleProperty(l,"height",`${s}px`)),setTimeout((()=>{l.style.removeProperty("height")}),300)}},F=(e,t,n,r,i)=>{if(x=i,_=i&&$(e.field,n)?`.rpt-index-${i}`:"",void 0!==e.action&&void 0!==e.field)switch(e.field in n.fields&&!n.fields[e.field].valid&&(n.fields[e.field].valid={}),e.action){case"value":return((e,t,n)=>{const r=e.val?y(e.val,n,t,x):"";void 0!==e.val&&t.fields[e.field]?((e,t,n)=>{const{contentId:r}=e,i=e.fields[t],{fieldName:l,typ:s}=i,a=i.inpType||"";if("radio"===s||"radio"===a)k(r,`input[name^="${l}"][value="${n}"]`).checked=!0;else if("check"===s||"checkbox"===a){const t=new RegExp(`,|${e.configs.bf_separator}`,"g"),i=n.split(t);N(r,`input[name^="${l}"][name$="[]"]`).forEach((e=>{e.checked=i.includes(e.value)}))}else if(["decision-box","gdpr"].includes(s)){const e=k(r,`input[name="${l}"]`);e&&(e.checked=n===i.msg.checked)}else if("rating"===s){const r=A(t,e);return void(e.inits&&e.inits[r]&&(e.inits[r].value=n))}if(["radio","check","decision-box","gdpr"].includes(s)||["radio","checkbox"].includes(a))return void(e=>{const t=new Event("input");e?.dispatchEvent(t)})(k(r,`input[name="${l}"]`)||k(r,`input[name^="${l}"][name$="[]"]`));const c=k(r,`[name^='${l}']`);c.value!==n&&(c.value=n,c.setAttribute("value",n))})(t,e.field,r):void 0!==e.val&&"_bf_step_no"===e.field&&t?.inits?.multi_step_form&&(t.inits.multi_step_form.step=r)})(e,n,r);case"hide":return S(e,n,!0);case"disable":n.fields[e.field]&&w(e.field,n,!0);break;case"readonly":n.fields[e.field]&&E(e.field,n,!0);break;case"writeable":n.fields[e.field]&&E(e.field,n,!1);break;case"enable":n.fields[e.field]&&w(e.field,n,!1);break;case"show":if(n.fields[e.field])return S(e,n,!1);break;case"activelist":n.fields[e.field]&&((e,t,n)=>{const r=A(e.field,t);if(t.inits&&t.inits[r]){const i=e.val?y(e.val,n,t,x):"";t.inits[r].activelist=i}})(e,n,r);break;case"save_draft":"_bf_form"===e.field&&((e,t)=>{I(t.contentId)})(0,n);break;case"lbl":case"ct":case"sub-titl":case"hlp-txt":case"title":n.fields[e.field]&&((e,t,n)=>{if(void 0!==e.val&&t.fields[e.field]){const r=e.val?y(e.val,n,t,x):"",i=e.field,l=k(t.contentId,`.${i}-${e.action}`);if(null===l)return;l.childNodes.forEach((e=>{3!==e.nodeType||""===e.textContent.trim()&&e.length||(e.textContent=r)})),"ct"===e.action&&(l.textContent=r)}})(e,n,r);break;case"placeholder":return((e,t,n)=>{const r=e.val?y(e.val,n,t,x):"",i=e.field,l=t.fields[i],{typ:s}=l;if("select"===s){const e=k(t.contentId,`.${i}-selected-opt-lbl`);0===e.childElementCount&&(e.textContent=r)}else if("html-select"===s){const e=k(t.contentId,`.${i}-slct-optn:first-child`);e&&(e.textContent=r)}else if("currency"===s){const e=k(t.contentId,`.${i}-currency-amount-input`);e&&(e.placeholder=r)}else if("phone-number"===s){const e=k(t.contentId,`.${i}-phone-number-input`);e&&(e.placeholder=r)}else if(void 0!==e.val&&t.fields[e.field]){const e=k(t.contentId,`.${i}-fld`);e&&(e.placeholder=r)}})(e,n,r)}},R=(e,t)=>Object.keys(t).find((n=>t[n].fieldName===e)),C=e=>e.replace(/\[\d*\]/g,"");function T(e,t){return Array.isArray(e)?e.some((e=>T(e,t))):"object"==typeof e&&e.field===t}return function(e){if(!e?.target?.form)return;const t=e.target,{form:n}=e.target,r=n.id.replace("form-",""),i=window.bf_globals?.[r];if(!i)return;const l=t.name.match(/\[(\d+)\]/)?.[1],s=C(t.name||t.dataset.parentFieldName),a=R(s,i.fields);if(!a)return;const c=((e,t)=>{const n=new FormData(e),{fields:r}=t,i={};return Array.from(n.entries()).forEach((([e,t])=>{const n=R(C(e),r),l=e.match(/\[(\d+)\]/)?.[1],s=l?`${n}[${l}]`:n;n in r&&(i[s]?(Array.isArray(i[s])||(i[s]=[i[s]]),i[s].push(t)):i[s]=t)})),Object.keys(r).filter((e=>"button"===r[e].typ)).forEach((e=>{i[e]=""})),Object.entries(i).reduce(((e,[t,n])=>({...e,[t]:{value:n,type:r[t.replace(/\[\d*\]/g,"")].typ,multiple:Array.isArray(n)}})),{})})(n,i),o=[],{onfieldCondition:d}=i;if(!d)return;const f=d.filter((e=>"on_input"===e.event_type)).filter((e=>e.conditions.some((e=>T(e?.logics,a)))));if(!f.length)return;f.forEach(((e,t)=>{const{conditions:n}=e,{length:r}=n;let s=!1,d=!!l&&[l];l||"undefined"==typeof getIndexesBaseOnConditions||(d=getIndexesBaseOnConditions(n,i));let f=!!d&&d.pop();do{let e=0;for(e=0;e<r;e+=1){const t=n[e];if(["if","else-if"].includes(t.cond_type)){const{logics:n}=t,r=n.filter((e=>"on_click"===e.logic));if(r.length&&a!==r[0].field)return!1;if(s=g(n,c,i,f),"undefined"!=typeof bf_modify_workflow_logic_status&&(s=bf_modify_workflow_logic_status(s,n,c,f,e,i)),s)break}}o.push({workflowIndx:t,condIndx:e,logicStatus:s,rowIndex:f}),f=!!d&&d.pop()}while(f)}));const u={};return o.reverse(),o.forEach((({workflowIndx:e,condIndx:t,logicStatus:n,rowIndex:r})=>{const{conditions:l}=f[e],s=l.find((e=>"else"===e.cond_type))||{},o=n?l[t].actions:s.actions;o?.fields?.forEach((e=>{let t=[r];r||(t=function(e,t){if("undefined"!=typeof checkRepeatedField){const n=checkRepeatedField(e,t);if(n)return getRepeatedIndexes(n,t)}return!1}(e.field,i)),t||(t=[""]),t.forEach((t=>{const n=`${e.field}[${t}]`;if(u[n]||(u[n]=[]),!u[n].includes(e.action)){u[n].push(e.action);const r=Object.entries(i.smartTags).reduce(((e,[t,n])=>({...e,[`\${${t}}`]:{value:n,type:"text",multiple:!1}})),{});F(e,a,i,{...c,...r},t)}}))}))})),Object.keys(u).length}}();
