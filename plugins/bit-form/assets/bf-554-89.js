var N=Object.defineProperty;var v=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var C=(i,e,t)=>e in i?N(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,h=(i,e)=>{for(var t in e||(e={}))S.call(e,t)&&C(i,t,e[t]);if(v)for(var t of v(e))D.call(e,t)&&C(i,t,e[t]);return i};import{_ as n,c as _,q,b_ as $,u as E,v as M,r as j,j as r,C as F,$ as P}from"./main-381.js";import{t as R}from"./bf-35-88.js";import{a4 as U,a5 as T,a6 as O}from"./bf-433-81.js";const Y=(i,e,t,d,o,l,a,s,c)=>{let m=h({},e);if(a){const f=h({},s);f[i.target.name]="",c(h({},f))}switch(m[i.target.name]=i.target.value,i.target.name){case"listId":m=V(m,d,t,o,l);break}t(h({},m))},Z=i=>!((i!=null&&i.address_field?i.address_field.filter(t=>!t.formField&&t.mailChimpAddressField&&t.required):[]).length>0),V=(i,e,t,d,o)=>{var a,s;const l=q(i);return l.field_map=[{formField:"",mailChimpField:""}],(s=(a=l==null?void 0:l.default)==null?void 0:a.fields)!=null&&s[i.listId]||(W(e,l,t,d,o),H(e,l,t,d,o)),l},ee=(i,e,t,d,o)=>{d(!0);const l={formID:i,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails};_(l,"bitforms_mChimp_refresh_audience").then(a=>{if(a&&a.success){const s=h({},e);s.default||(s.default={}),a.data.audiencelist&&(s.default.audiencelist=a.data.audiencelist),a.data.tokenDetails&&(s.tokenDetails=a.data.tokenDetails),o({show:!0,msg:n("Audience list refreshed")}),t(h({},s))}else a&&a.data&&a.data.data||!a.success&&typeof a.data=="string"?o({show:!0,msg:$(n("Audience list refresh failed Cause: %s. please try again"),a.data.data||a.data)}):o({show:!0,msg:n("Audience list failed. please try again")});d(!1)}).catch(()=>d(!1))},W=(i,e,t,d,o)=>{d(!0);const l={formID:i,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails,listId:e.listId};_(l,"bitforms_mChimp_refresh_tags").then(a=>{if(a&&a.success){const s=h({},e);a.data.audienceTags&&(s.default.audienceTags=a.data.audienceTags),o({show:!0,msg:n("Audience tags refreshed")}),t(h({},s))}else a&&a.data&&a.data.data||!a.success&&typeof a.data=="string"?o({show:!0,msg:$(n("Audience tags refresh failed Cause: %s. please try again"),a.data.data||a.data)}):o({show:!0,msg:n("Audience tags failed. please try again")});d(!1)}).catch(()=>d(!1))},H=(i,e,t,d,o)=>{const{listId:l}=e;if(!l)return;d(!0);const a={formID:i,listId:l,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails};_(a,"bitforms_mChimp_refresh_fields").then(s=>{if(s&&s.success){const c=h({},e);s.data.audienceField&&(c.default.fields||(c.default.fields={}),c.default.fields[l]=s.data.audienceField),s.data.tokenDetails&&(c.tokenDetails=s.data.tokenDetails),o({show:!0,msg:n("Fields refreshed")}),t(h({},c))}else o({show:!0,msg:n("Fields refresh failed. please try again")});d(!1)}).catch(()=>d(!1))},te=i=>{const e={},d=window.location.href.replace(`${window.opener.location.href}`,"").split("&");d&&d.forEach(o=>{const l=o.split("=");l[1]&&(e[l[0]]=l[1])}),localStorage.setItem(`__bitforms_${i}`,JSON.stringify(e)),window.close()},J=(i,e,t,d,o,l,a,s)=>{if(!t.clientId||!t.clientSecret){o({clientId:t.clientId?"":n("Client ID cann't be empty"),clientSecret:t.clientSecret?"":n("Secret key cann't be empty")});return}a(!0);const c=`https://login.mailchimp.com/oauth2/authorize?client_id=${t.clientId}&redirect_uri=${encodeURIComponent(window.location.href)}&response_type=code`,m=window.open(c,i,"width=400,height=609,toolbar=off"),f=setInterval(()=>{if(m.closed){clearInterval(f);let p={},g=!1;const w=localStorage.getItem(`__bitforms_${i}`);if(w&&(g=!0,p=JSON.parse(w),localStorage.removeItem(`__bitforms_${i}`),p.code.search("#"))){const[u]=p.code.split("#");p.code=u}if(!p.code||p.error||!p||!g){const u=p.error?`Cause: ${p.error}`:"";s({show:!0,msg:`${n("Authorization failed")} ${u}. ${n("please try again")}`}),a(!1)}else{const u=h({},t);u.accountServer=p["accounts-server"],B(e,p,u,d,l,a,s)}}},500)},B=(i,e,t,d,o,l,a)=>{const s=h({},e);s.clientId=t.clientId,s.clientSecret=t.clientSecret,s.redirectURI=window.location.href,_(s,`bitforms_${i}_generate_token`).then(c=>c).then(c=>{if(c&&c.success){const m=h({},t);m.tokenDetails=c.data,d(m),U(m),o(!0),a({show:!0,msg:n("Authorized Successfully")})}else c&&c.data&&c.data.data||!c.success&&typeof c.data=="string"?a({show:!0,msg:`${n("Authorization failed Cause:")}${c.data.data||c.data}. ${n("please try again")}`}):a({show:!0,msg:n("Authorization failed. please try again")});l(!1)})},ae=i=>!((i.field_map?i.field_map.filter(t=>!t.formField&&!t.mailChimpField):[]).length>0);function G({formID:i,sheetConf:e,setSheetConf:t,step:d,setstep:o,isLoading:l,setisLoading:a,setSnackbar:s,redirectLocation:c,isInfo:m,allIntegURL:f,authorizedAction:p}){const g=E(P);M();const{siteURL:w}=g,[u,z]=j.useState(!1),[x,A]=j.useState({dataCenter:"",clientId:"",clientSecret:""}),y=I=>{const b=h({},e),k=h({},x);k[I.target.name]="",b[I.target.name]=I.target.value,A(k),t(b)};return j.useEffect(()=>{u&&p()},[u]),r.jsxs(r.Fragment,{children:[r.jsx(T,{title:R.mailChimp.title,youTubeLink:R.mailChimp.link}),r.jsxs("div",{className:"btcd-stp-page",style:{width:900,height:"100%"},children:[r.jsx("div",{className:"mt-3",children:r.jsx("b",{children:n("Authorize App Name:")})}),r.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:y,name:"name",value:e.name,type:"text",placeholder:n("Authorize App Name..."),disabled:m}),r.jsx("div",{className:"mt-3",children:r.jsx("b",{children:n("Homepage URL:")})}),r.jsx(F,{value:w,className:"field-key-cpy w-6 ml-0",readOnly:m}),r.jsx("div",{className:"mt-3",children:r.jsx("b",{children:n("Authorized Redirect URIs:")})}),r.jsx(F,{value:c||`${window.location.href}`,className:"field-key-cpy w-6 ml-0",readOnly:m}),r.jsxs("small",{className:"d-blk mt-5",children:[n("To get Client ID and SECRET , Please Visit")," ",r.jsx("a",{className:"btcd-link",href:"https://us7.admin.mailchimp.com/account/oauth2/",target:"_blank",rel:"noreferrer",children:n("Mail Chimp API Console")})]}),r.jsx("div",{className:"mt-3",children:r.jsx("b",{children:n("Client id:")})}),r.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:y,name:"clientId",value:e.clientId,type:"text",placeholder:n("Client id..."),disabled:m}),r.jsx("div",{style:{color:"red",fontSize:"15px"},children:x.clientId}),r.jsx("div",{className:"mt-3",children:r.jsx("b",{children:n("Client secret:")})}),r.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:y,name:"clientSecret",value:e.clientSecret,type:"text",placeholder:n("Client secret..."),disabled:m}),r.jsx("div",{style:{color:"red",fontSize:"15px"},children:x.clientSecret}),!m&&r.jsxs(r.Fragment,{children:[r.jsx(O,{isAuthorized:u,isLoading:l,handleAuthorize:()=>J("mailChimp","mChimp",e,t,A,z,a,s)}),r.jsx("br",{})]})]})]})}var ie=Object.freeze({__proto__:null,default:G});export{G as M,W as a,ae as b,Z as c,ie as d,Y as h,ee as r,te as s};
