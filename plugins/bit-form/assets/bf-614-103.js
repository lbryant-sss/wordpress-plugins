var W=Object.defineProperty,w=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var C=(s,e,l)=>e in s?W(s,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[e]=l,m=(s,e)=>{for(var l in e||(e={}))k.call(e,l)&&C(s,l,e[l]);if(S)for(var l of S(e))M.call(e,l)&&C(s,l,e[l]);return s},$=(s,e)=>w(s,T(e));import{_ as n,aa as v,$ as I,c as x,b_ as R,D as P,u as O,r as z,j as d,C as E}from"./main-381.js";import{t as U}from"./bf-35-88.js";import{a4 as q,a5 as Z,a6 as D}from"./bf-433-81.js";const te=(s,e,l,c,o,a,t,r,i,h)=>{let p=m({},e);if(r){const f=m({},i);f[s.target.name]="",h(m({},f))}switch(p[s.target.name]=s.target.value,s.target.name){case"team":p=H(p,c,l,o,a);break;case"folder":p.folderMap=p.folderMap.slice(0,t),p=V(p,c,l,o,a);break}l(m({},p))},H=(s,e,l,c,o)=>{var t,r;const a=m({},s);return a.folder="",a.team&&!((r=(t=a==null?void 0:a.default)==null?void 0:t.teamFolders)!=null&&r[a.team])&&B(e,a,l,c,o),a},V=(s,e,l,c,o)=>{var t,r,i,h,p,f;const a=m({},s);return delete a.teamType,a.folder&&!((r=(t=a.default)==null?void 0:t.folders)!=null&&r[a.folder])?(((f=(p=(h=(i=a.default)==null?void 0:i.teamFolders)==null?void 0:h[a.team])==null?void 0:p[a.folder])==null?void 0:f.type)==="private"&&(a.teamType="private"),J(e,a,l,c,o)):a.folder&&a.folder!==a.folderMap[a.folderMap.length-1]&&a.folderMap.push(a.folder),a},ae=(s,e,l,c,o)=>{c(!0);const a={formID:s,id:e.id,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails};x(a,"bitforms_zworkdrive_refresh_teams").then(t=>{if(t&&t.success){const r=m({},e);t.data.teams&&(r.default=$(m({},r.default),{teams:t.data.teams})),t.data.tokenDetails&&(r.tokenDetails=t.data.tokenDetails),o({show:!0,msg:n("Teams refreshed")}),l(m({},r))}else t&&t.data&&t.data.data||!t.success&&typeof t.data=="string"?o({show:!0,msg:R(n("Teams refresh failed Cause: %s. please try again"),t.data.data||t.data)}):o({show:!0,msg:n("Teams refresh failed. please try again")});c(!1)}).catch(()=>c(!1))},B=(s,e,l,c,o)=>{c(!0);const a={formID:s,id:e.id,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails,team:e.team};x(a,"bitforms_zworkdrive_refresh_team_folders").then(t=>{if(t&&t.success){const r=m({},e);r.default.teamFolders||(r.default.teamFolders={}),t.data.teamFolders&&(r.default.teamFolders[r.team]=t.data.teamFolders),t.data.tokenDetails&&(r.tokenDetails=t.data.tokenDetails),o({show:!0,msg:n("Folders refreshed")}),l(m({},r))}else t&&t.data&&t.data.data||!t.success&&typeof t.data=="string"?o({show:!0,msg:R(n("Folders refresh failed Cause: %s. please try again"),t.data.data||t.data)}):o({show:!0,msg:n("Folders refresh failed. please try again")});c(!1)}).catch(()=>c(!1))},J=(s,e,l,c,o,a)=>{const t=a?e.folderMap[a]:e.folder;c(!0);const r={formID:s,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails,team:e.team,folder:t,teamType:"teamType"in e?"private":"team"};x(r,"bitforms_zworkdrive_refresh_sub_folders").then(i=>{if(i&&i.success){const h=m({},e);i.data.folders?(h.default.folders||(h.default.folders={}),h.default.folders[t]=P(i.data.folders,"folderName"),h.folderMap.includes(t)||h.folderMap.push(t),o({show:!0,msg:n("Sub Folders refreshed")})):o({show:!0,msg:n("No Sub Folder Found")}),i.data.tokenDetails&&(h.tokenDetails=i.data.tokenDetails),l(m({},h))}else o({show:!0,msg:n("Sub Folders refresh failed. please try again")});c(!1)}).catch(()=>c(!1))},se=(s,e,l,c,o)=>{c(!0);const a={formID:s,id:e.id,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails,team:e.team};x(a,"bitforms_zworkdrive_refresh_users").then(t=>{if(t&&t.success){const r=m({},e);r.default.users||(r.default.users={}),t.data.users&&(r.default.users[e.team]=t.data.users),t.data.tokenDetails&&(r.tokenDetails=t.data.tokenDetails),o({show:!0,msg:n("Users refreshed")}),l(m({},r))}else t&&t.data&&t.data.data||!t.success&&typeof t.data=="string"?o({show:!0,msg:R(n("Users refresh failed Cause: %s. please try again"),t.data.data||t.data)}):o({show:!0,msg:n("Users refresh failed. please try again")});c(!1)}).catch(()=>c(!1))},G=(s,e,l,c,o,a)=>{if(!s.dataCenter||!s.clientId||!s.clientSecret){l({dataCenter:s.dataCenter?"":n("Data center cann't be empty"),clientId:s.clientId?"":n("Client ID cann't be empty"),clientSecret:s.clientSecret?"":n("Secret key cann't be empty")});return}const t=v(I);o(!0);const r="WorkDrive.team.READ,WorkDrive.workspace.READ,WorkDrive.workspace.CREATE,WorkDrive.workspace.UPDATE,WorkDrive.files.READ,WorkDrive.files.CREATE",i=`https://accounts.zoho.${s.dataCenter}/oauth/v2/auth?scope=${r}&response_type=code&client_id=${s.clientId}&prompt=Consent&access_type=offline&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(t.zohoRedirectURL)}`,h=window.open(i,"zohoWorkDrive","width=400,height=609,toolbar=off"),p=setInterval(()=>{if(h.closed){clearInterval(p);let f={},y=!1;const u=localStorage.getItem("__bitforms_zohoWorkDrive");if(u&&(y=!0,f=JSON.parse(u),localStorage.removeItem("__bitforms_zohoWorkDrive")),!f.code||f.error||!f||!y){const g=f.error?`Cause: ${f.error}`:"";a({show:!0,msg:`${n("Authorization failed")} ${g}. ${n("please try again")}`}),o(!1)}else{const g=m({},s);g.accountServer=f["accounts-server"],K(f,g,e,c,o,a)}}},500)},K=(s,e,l,c,o,a)=>{const t=v(I),r=m({},s);r.dataCenter=e.dataCenter,r.clientId=e.clientId,r.clientSecret=e.clientSecret,r.redirectURI=encodeURIComponent(t.zohoRedirectURL),x(r,"bitforms_zworkdrive_generate_token").then(i=>i).then(i=>{if(i&&i.success){const h=m({},e);h.tokenDetails=i.data,l(h),q(h),c(!0),a({show:!0,msg:n("Authorized Successfully")})}else i&&i.data&&i.data.data||!i.success&&typeof i.data=="string"?a({show:!0,msg:`${n("Authorization failed Cause:")}${i.data.data||i.data}. ${n("please try again")}`}):a({show:!0,msg:n("Authorization failed. please try again")});o(!1)})};function Q({formID:s,workDriveConf:e,setWorkDriveConf:l,step:c,setstep:o,isLoading:a,setisLoading:t,setSnackbar:r,redirectLocation:i,isInfo:h,authorizedAction:p}){const f=O(I),{siteURL:y}=f,[u,g]=z.useState(!1),[j,A]=z.useState({dataCenter:"",clientId:"",clientSecret:""}),b=_=>{const F=m({},e),N=m({},j);N[_.target.name]="",F[_.target.name]=_.target.value,A(N),l(F)};return z.useEffect(()=>{u&&p()},[u]),d.jsxs(d.Fragment,{children:[d.jsx(Z,{title:U.zohoWorkDrive.title,youTubeLink:U.zohoWorkDrive.link}),d.jsxs("div",{className:"btcd-stp-page",style:{width:900,height:"100%"},children:[d.jsx("div",{className:"mt-3",children:d.jsx("b",{children:n("Integration Name:")})}),d.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:b,name:"name",value:e.name,type:"text",placeholder:n("Integration Name..."),disabled:h}),d.jsx("div",{className:"mt-3",children:d.jsx("b",{children:n("Data Center:")})}),d.jsxs("select",{onChange:b,name:"dataCenter",value:e.dataCenter,className:"btcd-paper-inp w-6 mt-1",disabled:h,children:[d.jsx("option",{value:"",children:n("--Select a data center--")}),d.jsx("option",{value:"com",children:"zoho.com"}),d.jsx("option",{value:"eu",children:"zoho.eu"}),d.jsx("option",{value:"com.cn",children:"zoho.com.cn"}),d.jsx("option",{value:"in",children:"zoho.in"}),d.jsx("option",{value:"com.au",children:"zoho.com.au"})]}),d.jsx("div",{style:{color:"red"},children:j.dataCenter}),d.jsx("div",{className:"mt-3",children:d.jsx("b",{children:n("Homepage URL:")})}),d.jsx(E,{value:y,className:"field-key-cpy w-6 ml-0",readOnly:h}),d.jsx("div",{className:"mt-3",children:d.jsx("b",{children:n("Authorized Redirect URIs:")})}),d.jsx(E,{value:i||`${f.zohoRedirectURL}`,className:"field-key-cpy w-6 ml-0",readOnly:h}),d.jsxs("small",{className:"d-blk mt-5",children:[n("To get Client ID and SECRET , Please Visit")," ",d.jsx("a",{className:"btcd-link",href:`https://api-console.zoho.${(e==null?void 0:e.dataCenter)||"com"}/`,target:"_blank",rel:"noreferrer",children:n("Zoho API Console")})]}),d.jsx("div",{className:"mt-3",children:d.jsx("b",{children:n("Client id:")})}),d.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:b,name:"clientId",value:e.clientId,type:"text",placeholder:n("Client id..."),disabled:h}),d.jsx("div",{style:{color:"red"},children:j.clientId}),d.jsx("div",{className:"mt-3",children:d.jsx("b",{children:n("Client secret:")})}),d.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:b,name:"clientSecret",value:e.clientSecret,type:"text",placeholder:n("Client secret..."),disabled:h}),d.jsx("div",{style:{color:"red"},children:j.clientSecret}),!h&&d.jsxs(d.Fragment,{children:[d.jsx(D,{isAuthorized:u,isloading:a,handleAuthorize:()=>G(e,l,A,g,t,r)}),d.jsx("br",{})]})]})]})}var re=Object.freeze({__proto__:null,default:Q});export{Q as Z,ae as a,B as b,J as c,re as d,te as h,se as r};
