var U=Object.defineProperty,S=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var $=(e,t,d)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:d}):e[t]=d,m=(e,t)=>{for(var d in t||(t={}))Z.call(t,d)&&$(e,d,t[d]);if(A)for(var d of A(t))q.call(t,d)&&$(e,d,t[d]);return e},k=(e,t)=>S(e,O(t));import{_ as r,af as E,$ as y,c as I,u as C,r as w,j as i,C as D}from"./main-917.js";import{t as N}from"./bf-925-82.js";import{a4 as P,a5 as H,a6 as M}from"./bf-111-81.js";const V=(e,t,d,o,n,a)=>{if(!e.dataCenter||!e.clientId||!e.clientSecret){d({dataCenter:e.dataCenter?"":r("Data center cann't be empty"),clientId:e.clientId?"":r("Client ID cann't be empty"),clientSecret:e.clientSecret?"":r("Secret key cann't be empty")});return}const s=E(y);n(!0);const h="ZohoCreator.dashboard.READ,ZohoCreator.meta.application.READ,ZohoCreator.meta.form.READ,ZohoCreator.form.CREATE,ZohoCreator.report.CREATE,ZohoCreator.report.UPDATE",c=`https://accounts.zoho.${e.dataCenter}/oauth/v2/auth?scope=${h}&response_type=code&client_id=${e.clientId}&prompt=Consent&access_type=offline&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(s.zohoRedirectURL)}`,l=window.open(c,"zohoCreator","width=400,height=609,toolbar=off"),p=setInterval(()=>{if(l.closed){clearInterval(p);let u={},j=!1;const f=localStorage.getItem("__bitforms_zohoCreator");if(f&&(j=!0,u=JSON.parse(f),localStorage.removeItem("__bitforms_zohoCreator")),!u.code||u.error||!u||!j){const g=u.error?`Cause: ${u.error}`:"";a({show:!0,msg:`${r("Authorization failed")} ${g}. ${r("please try again")}`}),n(!1)}else{const g=m({},e);g.accountServer=u["accounts-server"],Y(u,g,t,o,n,a)}}},500)},Y=(e,t,d,o,n,a)=>{const s=E(y),h=m({},e);h.dataCenter=t.dataCenter,h.clientId=t.clientId,h.clientSecret=t.clientSecret,h.redirectURI=encodeURIComponent(s.zohoRedirectURL),I(h,"bitforms_zcreator_generate_token").then(c=>c).then(c=>{if(c&&c.success){const l=m({},t);l.tokenDetails=c.data,d(l),P(l),o(!0),a({show:!0,msg:r("Authorized Successfully")})}else c&&c.data&&c.data.data||!c.success&&typeof c.data=="string"?a({show:!0,msg:`${r("Authorization failed Cause:")}${c.data.data||c.data}. ${r("please try again")}`}):a({show:!0,msg:r("Authorization failed. please try again")});n(!1)})},ee=(e,t,d,o,n,a,s,h,c)=>{let l=m({},t);if(s){const p=m({},h);p[e.target.name]="",c(m({},p))}switch(l[e.target.name]=e.target.value,e.target.name){case"applicationId":l=B(l,o,d,n,a);break;case"formId":l=J(l,o,d,n,a);break}d(m({},l))},B=(e,t,d,o,n)=>{var s,h;const a=m({},e);return a.department="",a.field_map=[{formField:"",zohoFormField:""}],a.actions={},(h=(s=a==null?void 0:a.default)==null?void 0:s.forms)!=null&&h[a.applicationId]||L(t,a,d,o,n),a},J=(e,t,d,o,n)=>{var s,h;const a=m({},e);return a.field_map=[{formField:"",zohoFormField:""}],a.upload_field_map=[{formField:"",zohoFormField:""}],a.actions={},(h=(s=a==null?void 0:a.default)==null?void 0:s.fields)!=null&&h[a.orgId]?(a.field_map=z(a),Object.keys(a.default.fields[a.applicationId][a.formId].fileUploadFields).length>0&&(a.upload_field_map=z(a,!0))):W(t,a,d,o,n),a},te=(e,t,d,o,n)=>{o(!0);const a={formID:e,id:t.id,dataCenter:t.dataCenter,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails};I(a,"bitforms_zcreator_refresh_applications").then(s=>{if(s&&s.success){const h=m({},t);s.data.applications&&(h.default=k(m({},h.default),{applications:s.data.applications})),n({show:!0,msg:r("Applications refreshed")}),d(m({},h))}else s&&s.data&&s.data.data||!s.success&&typeof s.data=="string"?n({show:!0,msg:`${r("Applications refresh failed Cause:")}${s.data.data||s.data}. ${r("please try again")}`}):n({show:!0,msg:r("Applications refresh failed. please try again")});o(!1)}).catch(()=>o(!1))},L=(e,t,d,o,n)=>{const{accountOwner:a,applicationId:s}=t;o(!0);const h={formID:e,id:t.id,dataCenter:t.dataCenter,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails,accountOwner:a,applicationId:s};I(h,"bitforms_zcreator_refresh_forms").then(c=>{if(c&&c.success){const l=m({},t);l.default.forms||(l.default.forms={}),c.data.forms&&(l.default.forms[s]=c.data.forms),c.data.tokenDetails&&(l.tokenDetails=c.data.tokenDetails),n({show:!0,msg:r("Forms refreshed")}),d(m({},l))}else c&&c.data&&c.data.data||!c.success&&typeof c.data=="string"?n({show:!0,msg:`${r("Forms refresh failed Cause:")}${c.data.data||c.data}. ${r("please try again")}`}):n({show:!0,msg:r("Forms refresh failed. please try again")});o(!1)}).catch(()=>o(!1))},W=(e,t,d,o,n)=>{const{accountOwner:a,applicationId:s,formId:h}=t;o(!0);const c={formID:e,dataCenter:t.dataCenter,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails,accountOwner:a,applicationId:s,formId:h};I(c,"bitforms_zcreator_refresh_fields").then(l=>{if(l&&l.success){const p=m({},t);l.data.fields?(p.default.fields||(p.default.fields={}),p.default.fields[s]||(p.default.fields[s]={}),p.default.fields[s][h]=m({},l.data),p.field_map=z(p),Object.keys(l.data.fileUploadFields).length>0&&(p.upload_field_map=z(p,!0)),l.data.tokenDetails&&(p.tokenDetails=l.data.tokenDetails),n({show:!0,msg:r("Fields refreshed")})):n({show:!0,msg:`${r("Fields refresh failed Cause:")}${l.data.data||l.data}. ${r("please try again")}`}),l.data.tokenDetails&&(p.tokenDetails=l.data.tokenDetails),d(m({},p))}else n({show:!0,msg:r("Fields refresh failed. please try again")});o(!1)}).catch(()=>o(!1))},z=(e,t)=>{const{applicationId:d,formId:o}=e;return t?e.default.fields[d][o].requiredFileUploadFields.length>0?e.default.fields[d][o].requiredFileUploadFields.map(n=>({formField:"",zohoFormField:n})):[{formField:"",zohoFormField:""}]:e.default.fields[d][o].required.length>0?e.default.fields[d][o].required.map(n=>({formField:"",zohoFormField:n})):[{formField:"",zohoFormField:""}]},ae=e=>{const t=e!=null&&e.field_map?e.field_map.filter(o=>{var n,a,s,h;return!o.formField&&o.zohoFormField&&((h=(s=(a=(n=e==null?void 0:e.default)==null?void 0:n.fields)==null?void 0:a[e.applicationId])==null?void 0:s[e.formId])==null?void 0:h.required.indexOf(o.zohoFormField))!==-1}):[],d=e!=null&&e.upload_field_map?e.upload_field_map.filter(o=>{var n,a,s,h;return!o.formField&&o.zohoFormField&&((h=(s=(a=(n=e==null?void 0:e.default)==null?void 0:n.fields)==null?void 0:a[e.applicationId])==null?void 0:s[e.formId])==null?void 0:h.requiredFileUploadFields.indexOf(o.zohoFormField))!==-1}):[];return!(t.length>0||d.length>0)};function G({formID:e,creatorConf:t,setCreatorConf:d,step:o,setStep:n,isLoading:a,setisLoading:s,setSnackbar:h,redirectLocation:c,isInfo:l,authorizedAction:p}){const u=C(y),{siteURL:j}=u,[f,g]=w.useState(!1),[F,b]=w.useState({dataCenter:"",clientId:"",clientSecret:"",ownerEmail:""}),x=_=>{const v=m({},t),R=m({},F);R[_.target.name]="",v[_.target.name]=_.target.value,b(R),d(v)};return w.useEffect(()=>{f&&p()},[f]),i.jsxs(i.Fragment,{children:[i.jsx(H,{title:N.zohoCreator.title,youTubeLink:N.zohoCreator.link}),i.jsxs("div",{className:"btcd-stp-page",style:{width:900,height:"100%"},children:[i.jsx("div",{className:"mt-3",children:i.jsx("b",{children:r("Integration Name:")})}),i.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:x,name:"name",value:t.name,type:"text",placeholder:r("Integration Name..."),disabled:l}),i.jsx("div",{className:"mt-3",children:i.jsx("b",{children:r("Data Center:")})}),i.jsxs("select",{onChange:x,name:"dataCenter",value:t.dataCenter,className:"btcd-paper-inp w-6 mt-1",disabled:l,children:[i.jsx("option",{value:"",children:r("--Select a data center--")}),i.jsx("option",{value:"com",children:"zoho.com"}),i.jsx("option",{value:"eu",children:"zoho.eu"}),i.jsx("option",{value:"com.cn",children:"zoho.com.cn"}),i.jsx("option",{value:"in",children:"zoho.in"}),i.jsx("option",{value:"com.au",children:"zoho.com.au"})]}),i.jsx("div",{style:{color:"red"},children:F.dataCenter}),i.jsx("div",{className:"mt-3",children:i.jsx("b",{children:r("Homepage URL:")})}),i.jsx(D,{value:j,className:"field-key-cpy w-6 ml-0",readOnly:l}),i.jsx("div",{className:"mt-3",children:i.jsx("b",{children:r("Authorized Redirect URIs:")})}),i.jsx(D,{value:c||`${u.zohoRedirectURL}`,className:"field-key-cpy w-6 ml-0",readOnly:l}),i.jsxs("small",{className:"d-blk mt-5",children:[r("To get Client ID and SECRET , Please Visit")," ",i.jsx("a",{className:"btcd-link",href:`https://api-console.zoho.${(t==null?void 0:t.dataCenter)||"com"}/`,target:"_blank",rel:"noreferrer",children:r("Zoho API Console")})]}),i.jsx("div",{className:"mt-3",children:i.jsx("b",{children:r("Client id:")})}),i.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:x,name:"clientId",value:t.clientId,type:"text",placeholder:r("Client id..."),disabled:l}),i.jsx("div",{style:{color:"red"},children:F.clientId}),i.jsx("div",{className:"mt-3",children:i.jsx("b",{children:r("Client secret:")})}),i.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:x,name:"clientSecret",value:t.clientSecret,type:"text",placeholder:r("Client secret..."),disabled:l}),i.jsx("div",{style:{color:"red"},children:F.clientSecret}),i.jsx("div",{className:"mt-3",children:i.jsx("b",{children:r("Owner Name (Your Zoho Creator screen name):")})}),i.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:_=>x(_),name:"accountOwner",value:t.accountOwner,type:"text",placeholder:r("Your Zoho Creator screen name..."),disabled:l}),i.jsx("div",{style:{color:"red"},children:F.accountOwner}),!l&&i.jsxs(i.Fragment,{children:[i.jsx(M,{isAuthorized:f,isLoading:a,handleAuthorize:()=>V(t,d,b,g,s,h)}),i.jsx("br",{})]})]})]})}var ie=Object.freeze({__proto__:null,default:G});export{G as Z,L as a,W as b,ae as c,ie as d,ee as h,te as r};
