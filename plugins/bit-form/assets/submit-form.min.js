var submit_form=function(){"use strict";function e(e,t){const n=new URL(e?.ajaxURL),o=e?.entryId?"bitforms_update_form_entry":"bitforms_submit_form";return n.searchParams.append("action",o),e?.entryId&&(n.searchParams.append("_ajax_nonce",e.nonce||""),n.searchParams.append("entryID",e.entryId),n.searchParams.append("formID",e.formId),n.searchParams.append("entryToken",e.entryToken||"")),fetch(n,{method:"POST",body:t})}function t(e,t,o){e.then(e=>new Promise((n,o)=>{if(e.staus>400){const n=new CustomEvent("bf-form-submit-error",{detail:{formId:t,errors:e.data}});bfSelect(`#form-${t}`).dispatchEvent(n),500===e.staus?o(new Error("Mayebe Internal Server Error")):o(e.json())}else n(e.json())})).then(e=>{const a=new CustomEvent("bf-form-submit-success",{detail:{formId:t,entryId:e.data.entry_id,formData:o}});bfSelect(`#form-${t}`).dispatchEvent(a);let r=null,s=null,d="",c=1e3;const i=window.bf_globals[t];if(void 0!==e&&e.success){const n=bfSelect(`#form-${t}`);bfReset(t),"object"==typeof e.data?(n&&e?.data?.hidden_fields?.map(e=>{setHiddenFld(e,n)}),r=e.data.redirectPage,e.data.cron&&(s=e.data.cron),e.data.cronNotOk&&(s=e.data.cronNotOk),e.data.new_nonce&&(d=e.data.new_nonce,i.nonce=d),setBFMsg({contentId:t,msgId:e.data.msg_id,msg:e.data.message,duration:e.data.msg_duration,show:!0,type:"success",error:!1}),c=Number(e.data.msg_duration||1e3)):setBFMsg({contentId:t,msg:e.data,type:"success",show:!0,error:!1}),localStorage.removeItem(`bitform-partial-form-${i.formId}`);const o=bfSelect('input[name="entryID"]',n);o&&o.remove(),delete i.entryId}else{const n=new CustomEvent("bf-form-submit-error",{detail:{formId:t,errors:e.data}});bfSelect(`#form-${t}`).dispatchEvent(n),bfValidationErrMsg(e,t)}if(function(e,t,n){const o=window.bf_globals[n];if(e)if("string"==typeof e){const t=new URL(e);t.protocol!==window.location.protocol&&(t.protocol=window.location.protocol),fetch(t)}else{const n=new URL(o.ajaxURL);n.searchParams.append("action","bitforms_trigger_workflow");const a={cronNotOk:e,token:t||o.nonce,id:o.appID};fetch(n,{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then(e=>e.json())}}(s,d,t),r){const e=setTimeout(()=>{window.location=decodeURI(r),e&&clearTimeout(e)},c)}n(t,!1)}).catch(e=>{const o=e?.message?e.message:"Unknown Error";setBFMsg({contentId:t,msg:o,show:!0,type:"error",error:!0}),n(t,!1)})}function n(e,t){const n=bfSelect('button[type="submit"]',bfSelect(`#form-${e}`));n&&(n.disabled=t);const o=bfSelect('button[type="submit"] span',bfSelect(`#form-${e}`));o&&o.classList.toggle("d-none")}return function(o=null){(o?[o]:Object.keys(window.bf_globals)).forEach(o=>{const a=bfSelect(`#form-${o}`);a&&(a.addEventListener("submit",o=>{!function(o){o.preventDefault();const a=o.target.id.slice(o.target.id.indexOf("-")+1);if("undefined"!=typeof validateForm&&!validateForm({form:a})){const e=new CustomEvent("bf-form-validation-error",{detail:{formId:a,fieldId:"",error:""}});return void o.target.dispatchEvent(e)}n(a,!0);let r=new FormData(o.target);const s=window.bf_globals[a];"undefined"!=typeof advancedFileHandle&&(r=advancedFileHandle(s,r)),"undefined"!=typeof decisionFldHandle&&(r=decisionFldHandle(s,r)),"undefined"!=typeof hideChildFldHandle&&(r=hideChildFldHandle(s,r)),s.GCLID&&r.set("GCLID",s.GCLID);const d=[];Object.entries(s?.fields||{}).forEach(e=>{e[1]?.valid?.hide&&d.push(e[0])}),d.length&&r.append("hidden_fields",d),"v3"===s?.gRecaptchaVersion&&s?.gRecaptchaSiteKey?grecaptcha.ready(()=>{grecaptcha.execute(s.gRecaptchaSiteKey,{action:"submit"}).then(n=>{r.append("g-recaptcha-response",n),t(e(s,r),a,r)})}):t(e(s,r),a,r)}(o)}),bfSelect('button[type="reset"]',a)?.addEventListener("click",()=>bfReset(a.id.replace("form-",""),!0)))}),document.querySelectorAll(".msg-backdrop,.bf-msg-close").forEach(e=>{e.addEventListener("click",t=>{t.target===e&&(t.stopPropagation(),bfSelect(`#${e.dataset.contentid} .msg-container-${e.dataset.msgid}`).classList.replace("active","deactive"))})}),localStorage.setItem("bf-entry-id","")}}();
