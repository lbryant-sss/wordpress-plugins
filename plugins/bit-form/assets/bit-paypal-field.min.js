var bit_paypal_field=function(){"use strict";return class{#t="";#e="";#n={namespace:"paypal",payType:"payment",currency:"USD",amount:1,shipping:0,tax:0,style:{label:"paypal",color:"gold",shape:"rect",layout:"vertical"}};#i=null;constructor(t,e){Object.assign(this.#n,e),this.#t="string"==typeof t?document.querySelector(t):t,this.#e=`#form-${this.#s()}`,this.init()}init(){const{namespace:t}=this.#n,e=window[t],n={style:this.#r()};this.#o()&&(n.fundingSource=e.FUNDING[this.#n.style.payBtn]),this.#a()?n.createSubscription=(t,e)=>this.#c(t,e):n.createOrder=(t,e)=>this.#l(t,e),n.onClick=(t,e)=>this.#d(e),n.onApprove=(t,e)=>this.#u(t,e),this.#n.onInit&&(n.onInit=this.#n.onInit),e&&e.Buttons(n).render(this.#t)}#a(){return"subscription"===this.#n.payType}#o(){return"standalone"===this.#n.style.layout}#s(){return this.#n.contentId}#c(t,e){if("undefined"!=typeof validateForm&&!validateForm({form:this.#s()}))throw new Error("form validation is failed!");return e.subscription.create({plan_id:this.#n.planId})}async#d(t){const e=this.#s();try{await isFormValidatedWithoutError(e)}catch(e){return t.reject()}const n=await saveFormProgress(e),i=n?.[e];return i?.success?(i.entry_id&&(this.#i=i.entry_id),t.resolve()):t.reject()}#u(t,e){const n=document.getElementById(`${this.#s()}`);n.classList.add("pos-rel","form-loading"),(this.#a()?e.subscription.get():e.order.capture()).then((t=>{const e=this.#p(t);e&&this.#h(e,t)})).catch((t=>{n.classList.remove("pos-rel","form-loading")})).finally((()=>{n.classList.remove("pos-rel","form-loading")}))}#h(t,e){const n=bf_globals[this.#s()],i=document.getElementById(`form-${this.#s()}`),s=this.#s()?.split("_")[1];if(null!=i){this.#i&&(n.entryId=this.#i);const r=bfSelect(`input[name="${this.#n.fieldKey}"]`,i);r?r.value=t:setHiddenFld({name:this.#n.fieldKey,value:t,type:"text"},i);let o=bfSelect('button[type="submit"]',i);o||(o=document.createElement("button"),o.setAttribute("type","submit"),o.style.display="none",i.append(o)),o.click();const a={formID:s,transactionID:t,payment_name:"paypal",payment_type:this.#a()?"subscription":"order",payment_response:e,entry_id:this.#i,fieldKey:this.#n.fieldKey},c=new URL(n?.ajaxURL);c.searchParams.append("_ajax_nonce",n?.nonce),c.searchParams.append("action","bitforms_payment_insert"),fetch(c,{method:"POST",body:JSON.stringify(a)}).then((()=>{this.#i=null;const t=bfSelect(`input[name="${this.#n.fieldKey}"]`,i);t&&(t.value="",t.setAttribute("value",""))}))}}#p(t){let e=null;if(this.#a()&&t.id)e=t.id;else if(t.purchase_units&&t.purchase_units[0]&&t.purchase_units[0].payments){const{payments:n}=t.purchase_units[0];n.captures&&n.captures[0]&&(e=n.captures[0].id)}return e}#y(t,e){return document.querySelector(e)?.querySelector(t)}#f(t){if(t){const e=window.bf_globals[this.#s()].fields[t].fieldName;let n=this.#y(`[name="${e}"]`,this.#e);if(n&&"radio"===n.type&&(n=this.#y(`[name="${e}"]:checked`,this.#e)),n&&n.value)return n.value}return""}#l(t,e){const{currency:n,amount:i,shipping:s,tax:r}=this.#n,o=this.#f(this.#n.amountFld)||i,a=this.#f(this.#n.shippingVal)||s,c=this.#f(this.#n.taxVal)||r,l=1*this.#m(o).toFixed(2),d=1*this.#m(a).toFixed(2),u=1*(this.#m(c)*l/100).toFixed(2),p=1*(l+d+u).toFixed(2),h=this.#s()?.split("_")[1];return e.order.create({purchase_units:[{description:`form-id:${h};entry-id:${this.#i};field-key:${this.#n.fieldKey}`,amount:{currency_code:n,value:p,breakdown:{item_total:{currency_code:n,value:l},shipping:{currency_code:n,value:d},tax_total:{currency_code:n,value:u}}}}]})}#r(){const{label:t,color:e,shape:n,layout:i,height:s}=this.#n.style,r={label:this.#a()?"subscribe":t,color:e,shape:n};return this.#o()||(r.layout=i),void 0!==s&&(r.height=Number(s)),r}#m(t){const e=t?.match(/[\d,.]*\d(?:\.\d+)?/);if(e){const t=e[0].replace(/,/g,"");return parseFloat(t)}return parseFloat(0)}destroy(){this.#t.innerHTML=""}reset(){this.destroy(),this.init()}}}();
