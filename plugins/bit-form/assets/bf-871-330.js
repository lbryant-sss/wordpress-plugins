var z=Object.defineProperty;var k=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var _=(s,e,d)=>e in s?z(s,e,{enumerable:!0,configurable:!0,writable:!0,value:d}):s[e]=d,h=(s,e)=>{for(var d in e||(e={}))R.call(e,d)&&_(s,d,e[d]);if(k)for(var d of k(e))E.call(e,d)&&_(s,d,e[d]);return s};import{_ as c,eg as g,a0 as I,$ as D,c as w}from"./main-143.js";const H=(s,e,d,l,i,a)=>{if(!s.dataCenter||!s.clientId||!s.clientSecret){d({dataCenter:s.dataCenter?"":c("Data center cann't be empty"),clientId:s.clientId?"":c("Client ID cann't be empty"),clientSecret:s.clientSecret?"":c("Secret key cann't be empty")});return}if(!g(s.ownerEmail)){d({ownerEmail:g(s.ownerEmail)?"":c("Email is invalid")});return}const t=I(D);i(!0);const r="ZohoAnalytics.metadata.read,ZohoAnalytics.data.read,ZohoAnalytics.data.create,ZohoAnalytics.data.update,ZohoAnalytics.usermanagement.read,ZohoAnalytics.share.create",o=`https://accounts.zoho.${s.dataCenter}/oauth/v2/auth?scope=${r}&response_type=code&client_id=${s.clientId}&prompt=Consent&access_type=offline&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(t.zohoRedirectURL)}`,n=window.open(o,"zohoAnalytics","width=400,height=609,toolbar=off"),b=setInterval(()=>{if(n.closed){clearInterval(b);let f={},u=!1;const p=localStorage.getItem("__bitforms_zohoAnalytics");if(p&&(u=!0,f=JSON.parse(p),localStorage.removeItem("__bitforms_zohoAnalytics")),!f.code||f.error||!f||!u){const m=f.error?`Cause: ${f.error}`:"";a({show:!0,msg:`${c("Authorization failed")} ${m}. ${c("please try again")}`}),i(!1)}else{const m=h({},s);m.accountServer=f["accounts-server"],U(f,m,e,l,i,a)}}},500)},U=(s,e,d,l,i,a)=>{const t=I(D),r=h({},s);r.dataCenter=e.dataCenter,r.clientId=e.clientId,r.clientSecret=e.clientSecret,r.redirectURI=encodeURIComponent(t.zohoRedirectURL),w(r,"bitforms_zanalytics_generate_token").then(o=>o).then(o=>{if(o&&o.success){const n=h({},e);n.tokenDetails=o.data,d(n),l(!0),a({show:!0,msg:c("Authorized Successfully")})}else o&&o.data&&o.data.data||!o.success&&typeof o.data=="string"?a({show:!0,msg:`${c("Authorization failed Cause:")}${o.data.data||o.data}. ${c("please try again")}`}):a({show:!0,msg:c("Authorization failed. please try again")});i(!1)})},P=(s,e,d,l,i,a)=>{let t=h({},e);const{name:r,value:o}=s.target;switch(t[r]=o,r){case"workspace":t=A(t,l,d,i,a);break;case"table":t=v(t,l,d,i,a);break}d(h({},t))},A=(s,e,d,l,i)=>{var t,r,o,n,b,f,u,p,m;const a=h({},s);return a.table="",a.field_map=[{formField:"",zohoFormField:""}],(r=(t=a==null?void 0:a.default)==null?void 0:t.tables)!=null&&r[s.workspace]?Object.keys((n=(o=a==null?void 0:a.default)==null?void 0:o.tables)==null?void 0:n[s.workspace]).length===1&&(a.table=(f=(b=a==null?void 0:a.default)==null?void 0:b.tables)==null?void 0:f[s.workspace][0].viewName,(m=(p=(u=a==null?void 0:a.default)==null?void 0:u.tables)==null?void 0:p.headers)!=null&&m[a.table]||$(e,a,d,l,i)):F(e,a,d,l,i),s.default.users||Z(e,s,d,l,i),a},v=(s,e,d,l,i)=>{var t,r,o;const a=h({},s);return a.field_map=[{formField:"",zohoFormField:""}],(o=(r=(t=a==null?void 0:a.default)==null?void 0:t.tables)==null?void 0:r.headers)!=null&&o[s.table]||$(e,a,d,l,i),a},W=(s,e,d,l,i)=>{l(!0);const a={formID:s,id:e.id,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails,ownerEmail:e.ownerEmail};w(a,"bitforms_zanalytics_refresh_workspaces").then(t=>{if(t&&t.success){const r=h({},e);r.default||(r.default={}),t.data.workspaces&&(r.default.workspaces=t.data.workspaces),t.data.tokenDetails&&(r.tokenDetails=t.data.tokenDetails),i({show:!0,msg:c("Workspaces refreshed")}),d(h({},r))}else t&&t.data&&t.data.data||!t.success&&typeof t.data=="string"?i({show:!0,msg:`${c("Workspaces refresh failed Cause:")}${t.data.data||t.data}. ${c("please try again")}`}):i({show:!0,msg:c("Workspaces refresh failed. please try again")});l(!1)}).catch(()=>l(!1))},Z=(s,e,d,l,i)=>{l(!0);const a={formID:s,id:e.id,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails,ownerEmail:e.ownerEmail};w(a,"bitforms_zanalytics_refresh_users").then(t=>{if(t&&t.success){const r=h({},e);r.default||(r.default={}),t.data.users&&(r.default.users=t.data.users),t.data.tokenDetails&&(r.tokenDetails=t.data.tokenDetails),i({show:!0,msg:c("Users refreshed")}),d(h({},r))}else t&&t.data&&t.data.data||!t.success&&typeof t.data=="string"?i({show:!0,msg:`${c("Users refresh failed Cause:")}${t.data.data||t.data}. ${c("please try again")}`}):i({show:!0,msg:c("Users refresh failed. please try again")});l(!1)}).catch(()=>l(!1))},F=(s,e,d,l,i)=>{const{workspace:a}=e;if(!a)return;l(!0);const t={formID:s,workspace:a,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails,ownerEmail:e.ownerEmail};w(t,"bitforms_zanalytics_refresh_tables").then(r=>{if(r&&r.success){const o=h({},e);r.data.tables&&(o.default.tables||(o.default.tables={}),o.default.tables[a]=r.data.tables),r.data.tokenDetails&&(o.tokenDetails=r.data.tokenDetails),i({show:!0,msg:c("Tables refreshed")}),d(h({},o))}else i({show:!0,msg:c("Tables refresh failed. please try again")});l(!1)}).catch(()=>l(!1))},$=(s,e,d,l,i)=>{const{workspace:a,table:t}=e;if(!t)return;l(!0);const r={formID:s,workspace:a,table:t,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails,ownerEmail:e.ownerEmail};w(r,"bitforms_zanalytics_refresh_table_headers").then(o=>{if(o&&o.success){const n=h({},e);o.data.table_headers?(n.default.tables.headers||(n.default.tables.headers={}),n.default.tables.headers[t]=o.data.table_headers,i({show:!0,msg:c("Table Headers refreshed")})):i({show:!0,msg:c("Zoho didn't provide column names for this table")}),o.data.tokenDetails&&(n.tokenDetails=o.data.tokenDetails),d(h({},n))}else i({show:!0,msg:c("Table Headers refresh failed. please try again")});l(!1)}).catch(()=>l(!1))};export{F as a,$ as b,H as c,P as h,W as r};
