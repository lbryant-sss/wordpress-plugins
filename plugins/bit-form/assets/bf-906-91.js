var Z=Object.defineProperty;var A=Object.getOwnPropertySymbols;var y=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var $=(s,e,o)=>e in s?Z(s,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[e]=o,m=(s,e)=>{for(var o in e||(e={}))y.call(e,o)&&$(s,o,e[o]);if(A)for(var o of A(e))F.call(e,o)&&$(s,o,e[o]);return s};import{_ as d,b$ as R,aa as U,$ as _,c as j,u as O,r as v,j as r,C as D}from"./main-381.js";import{t as N}from"./bf-35-88.js";import{a4 as P,a5 as H,a6 as q}from"./bf-433-81.js";const W=(s,e,o,n,c,a)=>{if(!s.dataCenter||!s.clientId||!s.clientSecret){o({dataCenter:s.dataCenter?"":d("Data center cann't be empty"),clientId:s.clientId?"":d("Client ID cann't be empty"),clientSecret:s.clientSecret?"":d("Secret key cann't be empty")});return}if(!R(s.ownerEmail)){o({ownerEmail:R(s.ownerEmail)?"":d("Email is invalid")});return}const t=U(_);c(!0);const l="ZohoAnalytics.metadata.read,ZohoAnalytics.data.read,ZohoAnalytics.data.create,ZohoAnalytics.data.update,ZohoAnalytics.usermanagement.read,ZohoAnalytics.share.create",i=`https://accounts.zoho.${s.dataCenter}/oauth/v2/auth?scope=${l}&response_type=code&client_id=${s.clientId}&prompt=Consent&access_type=offline&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(t.zohoRedirectURL)}`,h=window.open(i,"zohoAnalytics","width=400,height=609,toolbar=off"),w=setInterval(()=>{if(h.closed){clearInterval(w);let p={},f=!1;const u=localStorage.getItem("__bitforms_zohoAnalytics");if(u&&(f=!0,p=JSON.parse(u),localStorage.removeItem("__bitforms_zohoAnalytics")),!p.code||p.error||!p||!f){const b=p.error?`Cause: ${p.error}`:"";a({show:!0,msg:`${d("Authorization failed")} ${b}. ${d("please try again")}`}),c(!1)}else{const b=m({},s);b.accountServer=p["accounts-server"],V(p,b,e,n,c,a)}}},500)},V=(s,e,o,n,c,a)=>{const t=U(_),l=m({},s);l.dataCenter=e.dataCenter,l.clientId=e.clientId,l.clientSecret=e.clientSecret,l.redirectURI=encodeURIComponent(t.zohoRedirectURL),j(l,"bitforms_zanalytics_generate_token").then(i=>i).then(i=>{if(i&&i.success){const h=m({},e);h.tokenDetails=i.data,o(h),P(h),n(!0),a({show:!0,msg:d("Authorized Successfully")})}else i&&i.data&&i.data.data||!i.success&&typeof i.data=="string"?a({show:!0,msg:`${d("Authorization failed Cause:")}${i.data.data||i.data}. ${d("please try again")}`}):a({show:!0,msg:d("Authorization failed. please try again")});c(!1)})},Y=(s,e,o,n,c,a)=>{let t=m({},e);const{name:l,value:i}=s.target;switch(t[l]=i,l){case"workspace":t=C(t,n,o,c,a);break;case"table":t=T(t,n,o,c,a);break}o(m({},t))},C=(s,e,o,n,c)=>{var t,l,i,h,w,p,f,u,b;const a=m({},s);return a.table="",a.field_map=[{formField:"",zohoFormField:""}],(l=(t=a==null?void 0:a.default)==null?void 0:t.tables)!=null&&l[s.workspace]?Object.keys((h=(i=a==null?void 0:a.default)==null?void 0:i.tables)==null?void 0:h[s.workspace]).length===1&&(a.table=(p=(w=a==null?void 0:a.default)==null?void 0:w.tables)==null?void 0:p[s.workspace][0].viewName,(b=(u=(f=a==null?void 0:a.default)==null?void 0:f.tables)==null?void 0:u.headers)!=null&&b[a.table]||S(e,a,o,n,c)):J(e,a,o,n,c),s.default.users||B(e,s,o,n,c),a},T=(s,e,o,n,c)=>{var t,l,i;const a=m({},s);return a.field_map=[{formField:"",zohoFormField:""}],(i=(l=(t=a==null?void 0:a.default)==null?void 0:t.tables)==null?void 0:l.headers)!=null&&i[s.table]||S(e,a,o,n,c),a},L=(s,e,o,n,c)=>{n(!0);const a={formID:s,id:e.id,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails,ownerEmail:e.ownerEmail};j(a,"bitforms_zanalytics_refresh_workspaces").then(t=>{if(t&&t.success){const l=m({},e);l.default||(l.default={}),t.data.workspaces&&(l.default.workspaces=t.data.workspaces),t.data.tokenDetails&&(l.tokenDetails=t.data.tokenDetails),c({show:!0,msg:d("Workspaces refreshed")}),o(m({},l))}else t&&t.data&&t.data.data||!t.success&&typeof t.data=="string"?c({show:!0,msg:`${d("Workspaces refresh failed Cause:")}${t.data.data||t.data}. ${d("please try again")}`}):c({show:!0,msg:d("Workspaces refresh failed. please try again")});n(!1)}).catch(()=>n(!1))},B=(s,e,o,n,c)=>{n(!0);const a={formID:s,id:e.id,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails,ownerEmail:e.ownerEmail};j(a,"bitforms_zanalytics_refresh_users").then(t=>{if(t&&t.success){const l=m({},e);l.default||(l.default={}),t.data.users&&(l.default.users=t.data.users),t.data.tokenDetails&&(l.tokenDetails=t.data.tokenDetails),c({show:!0,msg:d("Users refreshed")}),o(m({},l))}else t&&t.data&&t.data.data||!t.success&&typeof t.data=="string"?c({show:!0,msg:`${d("Users refresh failed Cause:")}${t.data.data||t.data}. ${d("please try again")}`}):c({show:!0,msg:d("Users refresh failed. please try again")});n(!1)}).catch(()=>n(!1))},J=(s,e,o,n,c)=>{const{workspace:a}=e;if(!a)return;n(!0);const t={formID:s,workspace:a,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails,ownerEmail:e.ownerEmail};j(t,"bitforms_zanalytics_refresh_tables").then(l=>{if(l&&l.success){const i=m({},e);l.data.tables&&(i.default.tables||(i.default.tables={}),i.default.tables[a]=l.data.tables),l.data.tokenDetails&&(i.tokenDetails=l.data.tokenDetails),c({show:!0,msg:d("Tables refreshed")}),o(m({},i))}else c({show:!0,msg:d("Tables refresh failed. please try again")});n(!1)}).catch(()=>n(!1))},S=(s,e,o,n,c)=>{const{workspace:a,table:t}=e;if(!t)return;n(!0);const l={formID:s,workspace:a,table:t,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails,ownerEmail:e.ownerEmail};j(l,"bitforms_zanalytics_refresh_table_headers").then(i=>{if(i&&i.success){const h=m({},e);i.data.table_headers?(h.default.tables.headers||(h.default.tables.headers={}),h.default.tables.headers[t]=i.data.table_headers,c({show:!0,msg:d("Table Headers refreshed")})):c({show:!0,msg:d("Zoho didn't provide column names for this table")}),i.data.tokenDetails&&(h.tokenDetails=i.data.tokenDetails),o(m({},h))}else c({show:!0,msg:d("Table Headers refresh failed. please try again")});n(!1)}).catch(()=>n(!1))};function M({formID:s,analyticsConf:e,setAnalyticsConf:o,step:n,setStep:c,isLoading:a,setisLoading:t,setSnackbar:l,redirectLocation:i,isInfo:h,authorizedAction:w}){const p=O(_),{siteURL:f}=p,[u,b]=v.useState(!1),[x,z]=v.useState({dataCenter:"",clientId:"",clientSecret:"",ownerEmail:""}),g=k=>{const E=m({},e),I=m({},x);I[k.target.name]="",E[k.target.name]=k.target.value,z(I),o(E)};return v.useEffect(()=>{u&&w()},[u]),r.jsxs(r.Fragment,{children:[r.jsx(H,{title:N.zohoAnalytics.title,youTubeLink:N.zohoAnalytics.link}),r.jsxs("div",{className:"btcd-stp-page",style:{width:900,height:"100%"},children:[r.jsx("div",{className:"mt-3",children:r.jsx("b",{children:d("Integration Name:")})}),r.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:g,name:"name",value:e.name,type:"text",placeholder:d("Integration Name..."),disabled:h}),r.jsx("div",{className:"mt-3",children:r.jsx("b",{children:d("Data Center:")})}),r.jsxs("select",{onChange:g,name:"dataCenter",value:e.dataCenter,className:"btcd-paper-inp w-6 mt-1",disabled:h,children:[r.jsx("option",{value:"",children:d("--Select a data center--")}),r.jsx("option",{value:"com",children:"zoho.com"}),r.jsx("option",{value:"eu",children:"zoho.eu"}),r.jsx("option",{value:"com.cn",children:"zoho.com.cn"}),r.jsx("option",{value:"in",children:"zoho.in"}),r.jsx("option",{value:"com.au",children:"zoho.com.au"})]}),r.jsx("div",{style:{color:"red"},children:x.dataCenter}),r.jsx("div",{className:"mt-3",children:r.jsx("b",{children:d("Homepage URL:")})}),r.jsx(D,{value:f,className:"field-key-cpy w-6 ml-0",readOnly:h}),r.jsx("div",{className:"mt-3",children:r.jsx("b",{children:d("Authorized Redirect URIs:")})}),r.jsx(D,{value:i||`${p.zohoRedirectURL}`,className:"field-key-cpy w-6 ml-0",readOnly:h}),r.jsxs("small",{className:"d-blk mt-5",children:[d("To get Client ID and SECRET , Please Visit")," ",r.jsx("a",{className:"btcd-link",href:`https://api-console.zoho.${(e==null?void 0:e.dataCenter)||"com"}/`,target:"_blank",rel:"noreferrer",children:d("Zoho API Console")})]}),r.jsx("div",{className:"mt-3",children:r.jsx("b",{children:d("Client id:")})}),r.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:g,name:"clientId",value:e.clientId,type:"text",placeholder:d("Client id..."),disabled:h}),r.jsx("div",{style:{color:"red"},children:x.clientId}),r.jsx("div",{className:"mt-3",children:r.jsx("b",{children:d("Client secret:")})}),r.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:g,name:"clientSecret",value:e.clientSecret,type:"text",placeholder:d("Client secret..."),disabled:h}),r.jsx("div",{style:{color:"red"},children:x.clientSecret}),r.jsx("div",{className:"mt-3",children:r.jsx("b",{children:d("Zoho Analytics Owner Email:")})}),r.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:g,name:"ownerEmail",value:e.ownerEmail,type:"email",placeholder:d("Owner Email"),disabled:h}),r.jsx("div",{style:{color:"red"},children:x.ownerEmail}),!h&&r.jsxs(r.Fragment,{children:[r.jsx(q,{isAuthorized:u,isLoading:a,handleAuthorize:()=>W(e,o,z,b,t,l)}),r.jsx("br",{})]})]})]})}var ee=Object.freeze({__proto__:null,default:M});export{M as Z,J as a,S as b,ee as c,Y as h,L as r};
