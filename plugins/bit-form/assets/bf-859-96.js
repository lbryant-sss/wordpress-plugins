var U=Object.defineProperty,O=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var F=(a,t,i)=>t in a?U(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i,m=(a,t)=>{for(var i in t||(t={}))Z.call(t,i)&&F(a,i,t[i]);if(b)for(var i of b(t))C.call(t,i)&&F(a,i,t[i]);return a},A=(a,t)=>O(a,q(t));import{_ as n,aa as P,$ as y,c as D,b_ as H,u as M,r as _,j as o,C as E}from"./main-381.js";import{t as N}from"./bf-35-88.js";import{a4 as V,a5 as B,a6 as J}from"./bf-433-81.js";const te=(a,t,i,c,d,r,e,s,h)=>{let l=m({},t);if(e){const f=m({},s);f[a.target.name]="",h(m({},f))}switch(l[a.target.name]=a.target.value,a.target.name){case"orgId":l=W(l,c,i,d,r);break;case"department":l=G(l,c,i,d,r);break}i(m({},l))},W=(a,t,i,c,d)=>{var e,s,h,l;const r=m({},a);return r.department="",r.field_map=[{formField:"",zohoFormField:""}],r.actions={},(s=(e=r==null?void 0:r.default)==null?void 0:e.departments)!=null&&s[r.orgId]?((l=(h=r==null?void 0:r.default)==null?void 0:h.departments)==null?void 0:l[r.orgId].length)===1&&(r.field_map=j(r)):K(t,r,i,c,d),r},G=(a,t,i,c,d)=>{var e,s;const r=m({},a);return r.field_map=[{formField:"",zohoFormField:""}],r.actions={},(s=(e=r==null?void 0:r.default)==null?void 0:e.fields)!=null&&s[r.orgId]?r.field_map=j(r):S(t,r,i,c,d),r},ae=(a,t,i,c,d)=>{c(!0);const r={formID:a,id:t.id,dataCenter:t.dataCenter,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails};D(r,"bitforms_zdesk_refresh_organizations").then(e=>{if(e&&e.success){const s=m({},t);e.data.organizations&&(s.default=A(m({},s.default),{organizations:e.data.organizations})),e.data.tokenDetails&&(s.tokenDetails=e.data.tokenDetails),d({show:!0,msg:n("Portals refreshed")}),i(m({},s))}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?d({show:!0,msg:`${n("Portals refresh failed Cause:")}${e.data.data||e.data}. ${n("please try again")}`}):d({show:!0,msg:n("Portals refresh failed. please try again")});c(!1)}).catch(()=>c(!1))},K=(a,t,i,c,d)=>{c(!0);const r={formID:a,id:t.id,dataCenter:t.dataCenter,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails,orgId:t.orgId};D(r,"bitforms_zdesk_refresh_departments").then(e=>{var s,h;if(e&&e.success){const l=m({},t);l.default.departments||(l.default.departments={}),e.data.departments&&(l.default.departments[l.orgId]=e.data.departments),e.data.departments.length===1&&(l.department=e.data.departments[l.orgId][0].departmentName,!((h=(s=l.default)==null?void 0:s.fields)!=null&&h[l.orgId])&&S(a,l,i,c,d)),e.data.tokenDetails&&(l.tokenDetails=e.data.tokenDetails),d({show:!0,msg:n("Departments refreshed")}),i(m({},l))}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?d({show:!0,msg:H(n("Departments refresh failed Cause: %s. please try again"),e.data.data||e.data)}):d({show:!0,msg:n("Departments refresh failed. please try again")});c(!1)}).catch(()=>c(!1))},S=(a,t,i,c,d)=>{c(!0);const r={formID:a,dataCenter:t.dataCenter,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails,orgId:t.orgId};D(r,"bitforms_zdesk_refresh_fields").then(e=>{if(e&&e.success){const s=m({},t);e.data.fields?(s.default.fields||(s.default.fields={}),s.default.fields[s.orgId]=m({},e.data),s.field_map=j(s),e.data.tokenDetails&&(s.tokenDetails=e.data.tokenDetails),d({show:!0,msg:n("Fields refreshed")})):d({show:!0,msg:`${n("Fields refresh failed Cause:")}${e.data.data||e.data}. ${n("please try again")}`}),e.data.tokenDetails&&(s.tokenDetails=e.data.tokenDetails),i(m({},s))}else d({show:!0,msg:n("Fields refresh failed. please try again")});c(!1)}).catch(()=>c(!1))},re=(a,t,i,c,d)=>{c(!0);const r={formID:a,id:t.id,dataCenter:t.dataCenter,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails,orgId:t.orgId};D(r,"bitforms_zdesk_refresh_owners").then(e=>{if(e&&e.success){const s=m({},t);s.default.owners||(s.default.owners={}),e.data.owners&&(s.default.owners[s.orgId]=e.data.owners),e.data.tokenDetails&&(s.tokenDetails=e.data.tokenDetails),d({show:!0,msg:n("Owners refreshed")}),i(m({},s))}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?d({show:!0,msg:`${n("Owners refresh failed Cause:")}${e.data.data||e.data}. ${n("please try again")}`}):d({show:!0,msg:n("Owners refresh failed. please try again")});c(!1)}).catch(()=>c(!1))},se=(a,t,i,c,d)=>{c(!0);const r={formID:a,id:t.id,dataCenter:t.dataCenter,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails,orgId:t.orgId,departmentId:t.department};D(r,"bitforms_zdesk_refresh_products").then(e=>{if(e&&e.success){const s=m({},t);s.default.products||(s.default.products={}),e.data.products&&(s.default.products[s.department]=e.data.products),e.data.tokenDetails&&(s.tokenDetails=e.data.tokenDetails),d({show:!0,msg:n("Products refreshed")}),i(m({},s))}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?d({show:!0,msg:`${n("Products refresh failed Cause:")}${e.data.data||e.data}. ${n("please try again")}`}):d({show:!0,msg:n("Products refresh failed. please try again")});c(!1)}).catch(()=>c(!1))},j=a=>{var t;return a.default.fields[a.orgId].required.length>0?(t=a.default.fields[a.orgId].required)==null?void 0:t.map(i=>({formField:"",zohoFormField:i})):[{formField:"",zohoFormField:""}]},ie=a=>!((a!=null&&a.field_map?a.field_map.filter(i=>{var c,d,r;return!i.formField&&i.zohoFormField&&((r=(d=(c=a==null?void 0:a.default)==null?void 0:c.fields)==null?void 0:d[a.orgId])==null?void 0:r.required.indexOf(i.zohoFormField))!==-1}):[]).length>0),Q=(a,t,i,c,d,r)=>{if(!a.dataCenter||!a.clientId||!a.clientSecret){i({dataCenter:a.dataCenter?"":n("Data center cann't be empty"),clientId:a.clientId?"":n("Client ID cann't be empty"),clientSecret:a.clientSecret?"":n("Secret key cann't be empty")});return}const e=P(y);d(!0);const s="Desk.settings.READ,Desk.basic.READ,Desk.search.READ,Desk.contacts.READ,Desk.contacts.CREATE,Desk.contacts.UPDATE,Desk.tickets.CREATE,Desk.tickets.UPDATE",h=`https://accounts.zoho.${a.dataCenter}/oauth/v2/auth?scope=${s}&response_type=code&client_id=${a.clientId}&prompt=Consent&access_type=offline&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(e.zohoRedirectURL)}`,l=window.open(h,"zohoDesk","width=400,height=609,toolbar=off"),f=setInterval(()=>{if(l.closed){clearInterval(f);let p={},I=!1;const u=localStorage.getItem("__bitforms_zohoDesk");if(u&&(I=!0,p=JSON.parse(u),localStorage.removeItem("__bitforms_zohoDesk")),!p.code||p.error||!p||!I){const g=p.error?`Cause: ${p.error}`:"";r({show:!0,msg:`${n("Authorization failed")} ${g}. ${n("please try again")}`}),d(!1)}else{const g=m({},a);g.accountServer=p["accounts-server"],T(p,g,t,c,d,r)}}},500)},T=(a,t,i,c,d,r)=>{const e=P(y),s=m({},a);s.dataCenter=t.dataCenter,s.clientId=t.clientId,s.clientSecret=t.clientSecret,s.redirectURI=encodeURIComponent(e.zohoRedirectURL),D(s,"bitforms_zdesk_generate_token").then(h=>h).then(h=>{if(h&&h.success){const l=m({},t);l.tokenDetails=h.data,i(l),V(l),c(!0),r({show:!0,msg:n("Authorized Successfully")})}else h&&h.data&&h.data.data||!h.success&&typeof h.data=="string"?r({show:!0,msg:`${n("Authorization failed Cause:")}${h.data.data||h.data}. ${n("please try again")}`}):r({show:!0,msg:n("Authorization failed. please try again")});d(!1)})};function X({formID:a,deskConf:t,setDeskConf:i,step:c,setstep:d,isLoading:r,setisLoading:e,setSnackbar:s,redirectLocation:h,isInfo:l,authorizedAction:f}){const p=M(y),{siteURL:I}=p,[u,g]=_.useState(!1),[w,v]=_.useState({dataCenter:"",clientId:"",clientSecret:""}),z=x=>{const R=m({},t),$=m({},w);$[x.target.name]="",R[x.target.name]=x.target.value,v($),i(R)};return _.useEffect(()=>{u&&f()},[u]),o.jsxs(o.Fragment,{children:[o.jsx(B,{title:N.zohoDesk.title,youTubeLink:N.zohoDesk.link}),o.jsxs("div",{className:"btcd-stp-page",style:{width:900,height:"100%"},children:[o.jsx("div",{className:"mt-3",children:o.jsx("b",{children:n("Integration Name:")})}),o.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:z,name:"name",value:t.name,type:"text",placeholder:n("Integration Name..."),disabled:l}),o.jsx("div",{className:"mt-3",children:o.jsx("b",{children:n("Data Center:")})}),o.jsxs("select",{onChange:z,name:"dataCenter",value:t.dataCenter,className:"btcd-paper-inp w-6 mt-1",disabled:l,children:[o.jsx("option",{value:"",children:n("--Select a data center--")}),o.jsx("option",{value:"com",children:"zoho.com"}),o.jsx("option",{value:"eu",children:"zoho.eu"}),o.jsx("option",{value:"com.cn",children:"zoho.com.cn"}),o.jsx("option",{value:"in",children:"zoho.in"}),o.jsx("option",{value:"com.au",children:"zoho.com.au"})]}),o.jsx("div",{style:{color:"red"},children:w.dataCenter}),o.jsx("div",{className:"mt-3",children:o.jsx("b",{children:n("Homepage URL:")})}),o.jsx(E,{value:I,className:"field-key-cpy w-6 ml-0",readOnly:l}),o.jsx("div",{className:"mt-3",children:o.jsx("b",{children:n("Authorized Redirect URIs:")})}),o.jsx(E,{value:h||`${p.zohoRedirectURL}`,className:"field-key-cpy w-6 ml-0",readOnly:l}),o.jsxs("small",{className:"d-blk mt-5",children:[n("To get Client ID and SECRET , Please Visit")," ",o.jsx("a",{className:"btcd-link",href:`https://api-console.zoho.${(t==null?void 0:t.dataCenter)||"com"}/`,target:"_blank",rel:"noreferrer",children:n("Zoho API Console")})]}),o.jsx("div",{className:"mt-3",children:o.jsx("b",{children:n("Client id:")})}),o.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:z,name:"clientId",value:t.clientId,type:"text",placeholder:n("Client id..."),disabled:l}),o.jsx("div",{style:{color:"red"},children:w.clientId}),o.jsx("div",{className:"mt-3",children:o.jsx("b",{children:n("Client secret:")})}),o.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:z,name:"clientSecret",value:t.clientSecret,type:"text",placeholder:n("Client secret..."),disabled:l}),o.jsx("div",{style:{color:"red"},children:w.clientSecret}),!l&&o.jsxs(o.Fragment,{children:[o.jsx(J,{isAuthorized:u,isLoading:r,handleAuthorize:()=>Q(t,i,v,g,e,s)}),o.jsx("br",{})]})]})]})}var ne=Object.freeze({__proto__:null,default:X});export{X as Z,se as a,ae as b,ie as c,K as d,S as e,ne as f,te as h,re as r};
