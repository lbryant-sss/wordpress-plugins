var O=Object.defineProperty;var I=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var k=(a,e,s)=>e in a?O(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s,f=(a,e)=>{for(var s in e||(e={}))$.call(e,s)&&k(a,s,e[s]);if(I)for(var s of I(e))D.call(e,s)&&k(a,s,e[s]);return a};import{_ as n,aa as z,$ as y,V as g,c as S,D as C,r as x,u as U,j as l,C as N}from"./main-381.js";import{a4 as M,a6 as E}from"./bf-433-81.js";const J=(a,e,s,c,p,r,i=0)=>{let t=f({},e);const{name:o}=a.target;switch(a.target.value!==""?t[o]=a.target.value:delete t[o],t[a.target.name]=a.target.value,a.target.name){case"folder":t.folderMap=t.folderMap.slice(0,i),t=L(t,c,s,p,r);break}s(f({},t))},L=(a,e,s,c,p)=>{var i,t;const r=f({},a);return delete r.teamType,r.folder&&!((t=(i=r.default)==null?void 0:i.folders)!=null&&t[r.folder])?P(e,r,s,c,p):r.folder&&r.folder!==r.folderMap[r.folderMap.length-1]&&r.folderMap.push(r.folder),r},T=(a,e,s,c)=>{c(!0);const p={flowID:a!=null?a:null,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails},r=S(p,"bitforms_oneDrive_get_all_folders").then(i=>{if(i&&i.success){const t=f({},e);return t.default||(t.default={}),i.data.oneDriveFoldersList&&(t.default.rootFolders=i.data.oneDriveFoldersList,t.tokenDetails=i.data.tokenDetails),s(t),c(!1),"OneDrive Folders List refreshed successfully"}else return c(!1),"OneDrive Folders List refresh failed. please try again"}).catch(()=>c(!1));g.promise(r,{success:i=>i,error:n("Error Occurred"),loading:n("Loading OneDrive Folders List...")})},P=(a,e,s,c,p,r)=>{const i=r?e.folderMap[r]:e.folder;c(!0);const t={formID:a,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails,team:e.team,folder:i,teamType:"teamType"in e?"private":"team"};S(t,"bitforms_oneDrive_get_single_folder").then(o=>{if(o&&o.success){const d=f({},e);o.data.folders?(d.default.folders||(d.default.folders={}),d.default.folders[i]=C(o.data.folders,"folderName"),d.folderMap.includes(i)||d.folderMap.push(i),p({show:!0,msg:n("Sub Folders refreshed")})):p({show:!0,msg:n("No Sub Folder Found")}),o.data.tokenDetails&&(d.tokenDetails=o.data.tokenDetails),s(f({},d))}else p({show:!0,msg:n("Sub Folders refresh failed. please try again")});c(!1)}).catch(()=>c(!1))},V=(a,e,s,c,p)=>{if(!a.clientId||!a.clientSecret){p({clientId:a.clientId?"":n("Client Id can't be empty"),clientSecret:a.clientSecret?"":n("Client Secret can't be empty")});return}c(!0);const r="onedrive.readwrite offline_access Files.ReadWrite.All",i=z(y),t=`https://login.live.com/oauth20_authorize.srf?client_id=${a.clientId}&scope=${r}&access_type=offline&prompt=consent&response_type=code&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(i.oneDriveRedirectURL)}`,o=window.open(t,"oneDrive","width=400,height=609,toolbar=off"),d=setInterval(()=>{if(o.closed){clearInterval(d);let u={},m=!1;const b=localStorage.getItem("__bitforms_oneDrive");if(b&&(m=!0,u=JSON.parse(b),localStorage.removeItem("__bitforms_oneDrive")),!u.code||u.error||!u||!m){const h=u.error?`Cause: ${u.error}`:"";g.error(`${n("Authorization failed")} ${h}. ${n("please try again")}`),c(!1)}else{const h=f({},a);h.accountServer=u["accounts-server"],q(u,h,e,s,c)}}},500)},q=(a,e,s,c,p)=>{const r=f({},a);r.clientId=e.clientId,r.clientSecret=e.clientSecret;const i=z(y);r.redirectURI=i.oneDriveRedirectURL,S(r,"bitforms_oneDrive_authorization").then(t=>{if(t&&t.success){const o=f({},e);o.tokenDetails=t.data,s(o),M(o),c(!0),g.success(n("Authorized Successfully"))}else t&&t.data&&t.data.data||!t.success&&typeof t.data=="string"?g.error(`${n("Authorization failed Cause:")}${t.data.data||t.data}. ${n("please try again")}`):g.error(n("Authorization failed. please try again"));p(!1)})};function B({flowID:a,oneDriveConf:e,setOneDriveConf:s,step:c,setStep:p,isLoading:r,setIsLoading:i,setSnackbar:t,redirectLocation:o,isInfo:d,authorizedAction:u}){const[m,b]=x.useState(!1),[h,j]=x.useState({clientId:"",clientSecret:""}),A=U(y),{siteURL:F}=A,_=v=>{const w=f({},e),R=f({},h);R[v.target.name]="",w[v.target.name]=v.target.value,j(R),s(w)};return x.useEffect(()=>{m&&u()},[m]),l.jsxs("div",{className:"btcd-stp-page",style:{width:900,height:"100%"},children:[l.jsx("div",{className:"mt-3",children:l.jsx("b",{children:n("Integration Name:")})}),l.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:_,name:"name",value:e.name,type:"text",placeholder:n("Integration Name..."),disabled:d}),l.jsx("div",{className:"mt-3",children:l.jsx("b",{children:n("Homepage URL:")})}),l.jsx(N,{value:F,className:"field-key-cpy w-6 ml-0",readOnly:d,setSnackbar:t}),l.jsx("div",{className:"mt-3",children:l.jsx("b",{children:n("Authorized Redirect URIs:")})}),l.jsx(N,{value:o||`${A.oneDriveRedirectURL}`,className:"field-key-cpy w-6 ml-0",readOnly:d}),l.jsxs("small",{className:"d-blk mt-3",children:[n("To Get Client Id & Secret, Please Visit"),"Â ",l.jsx("a",{className:"btcd-link",href:"https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade",target:"_blank",rel:"noreferrer",children:n("Azure Portal")})]}),l.jsx("div",{className:"mt-3",children:l.jsx("b",{children:n("OneDrive Client Id:")})}),l.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:_,name:"clientId",value:e.clientId,type:"text",placeholder:n("Client Id..."),disabled:d}),l.jsx("div",{style:{color:"red"},children:h.clientId}),l.jsx("div",{className:"mt-3",children:l.jsx("b",{children:n("OneDrive Client Secret:")})}),l.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:_,name:"clientSecret",value:e.clientSecret,type:"text",placeholder:n("Client Secret..."),disabled:d}),l.jsx("div",{style:{color:"red"},children:h.clientSecret}),!d&&l.jsxs(l.Fragment,{children:[l.jsx(E,{isAuthorized:m,isLoading:r,handleAuthorize:()=>V(e,s,b,i,j)}),l.jsx("br",{})]})]})}var K=Object.freeze({__proto__:null,default:B});export{B as O,P as a,K as b,T as g,J as h};
