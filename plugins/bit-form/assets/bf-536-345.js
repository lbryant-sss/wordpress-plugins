import{v as T,w as E,r,a as b,f as A,j as t,M as B,_ as I,S as C,G as F,ai as P}from"./main-33.js";import{B as z}from"./bf-955-79.js";import{S as O}from"./bf-668-262.js";import{C as $}from"./bf-824-87.js";import{ac as J}from"./bf-807-81.js";import{c as L,s as R}from"./bf-992-202.js";import{I as W}from"./bf-615-187.js";import k from"./bf-578-116.js";import{r as q,a as H,d as K}from"./bf-945-173.js";import{G as Q}from"./bf-941-203.js";import"./bf-855-88.js";import"./bf-315-172.js";import"./bf-831-114.js";import"./bf-614-174.js";function pe({formFields:j,setIntegration:N,integrations:y,allIntegURL:p}){const w=T(),{formID:d}=E(),[G,m]=r.useState(!1),[u,l]=r.useState(!1),[s,h]=r.useState(1),{css:v}=b(),[_,a]=r.useState({show:!1}),[e,o]=r.useState({name:"Google Sheet API",type:"Google Sheet",clientId:"",clientSecret:"",spreadsheetId:"",worksheetName:"",field_map:[{formField:"",googleSheetField:""}],header:"ROWS",headerRow:"A1",actions:{}}),S=J([e.type]),x=()=>{setTimeout(()=>{w(`${p}/new/${e.type}`)},1e3),m(!1)},D=(i,f)=>{if(i.integration_type===e.type){const c=JSON.parse(i.integration_details);o(n=>A(n,g=>{g.parentAppId=i.id,g.clientId=c.clientId,g.clientSecret=c.clientSecret,g.tokenDetails=c.tokenDetails})),h(2)}};r.useEffect(()=>{o(i=>A(i,f=>{const c=S.find(n=>n.id===e.parentAppId);if(c){const n=JSON.parse(c.integration_details);f.clientId=n.clientId,f.clientSecret=n.clientSecret,f.tokenDetails=n.tokenDetails}})),e!=null&&e.parentAppId&&q(d,e,o,l,a)},[e.parentAppId]),r.useEffect(()=>{window.opener&&L("googleSheet")},[]);const M=()=>{if(setTimeout(()=>{document.getElementById("btcd-settings-wrp").scrollTop=0},300),!K(e)){a({show:!0,msg:"Please map fields to continue."});return}e.spreadsheetId!==""&&e.worksheetName!==""&&e.field_map.length>0&&h(3)};return t.jsxs("div",{children:[t.jsx(B,{title:I("Authorize New Google App"),show:G,setModal:()=>m(!1),children:t.jsx(k,{formID:d,sheetConf:e,setSheetConf:o,step:s,setstep:h,setSnackbar:a,isLoading:u,setisLoading:l,allIntegURL:p,authorizedAction:x})}),t.jsx(C,{snack:_,setSnackbar:a}),t.jsx("div",{className:"txt-center w-9 mt-2 cal-width",children:t.jsx(O,{step:3,active:s})}),S.length>0&&s===1&&t.jsx($,{allIntegURL:p,specificTypes:[e.type],onClickAction:D,allowAddNew:!0,addNewAction:()=>m(!0)}),s===1&&S.length===0&&t.jsx(k,{formID:d,sheetConf:e,setSheetConf:o,step:s,setstep:h,setSnackbar:a,isLoading:u,setisLoading:l,allIntegURL:p,authorizedAction:x}),t.jsxs("div",{className:"btcd-stp-page",style:{width:s===2&&900,height:s===2&&"100%"},children:[t.jsx(Q,{formID:d,formFields:j,handleInput:i=>H(i,e,o,d,l,a),sheetConf:e,setSheetConf:o,isLoading:u,setisLoading:l,setSnackbar:a,setShowMdl:m}),t.jsxs(F,{onClick:()=>M(),disabled:!e.spreadsheetId||!e.worksheetName||e.field_map.length<1,className:v(P.ftRight),children:[I("Next"),t.jsx(z,{className:"ml-1 rev-icn"})]})]}),t.jsx(W,{step:s,saveConfig:()=>R(y,N,p,e,w)})]})}export{pe as default};
