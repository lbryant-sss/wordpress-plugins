import{v as D,w as _,r as c,f as g,j as t,M,S as P,_ as z}from"./main-878.js";import"./bf-85-79.js";import{S as T}from"./bf-760-262.js";import{C as b}from"./bf-310-87.js";import{ac as C,s as L,a7 as $}from"./bf-249-81.js";import{I as J}from"./bf-744-187.js";import{N as O}from"./bf-332-108.js";import{f as q,Z as I,h as B,c as G}from"./bf-293-99.js";import{Z as H}from"./bf-322-197.js";import"./bf-63-88.js";import"./bf-441-104.js";import"./bf-939-172.js";import"./bf-171-114.js";function ie({formFields:j,setIntegration:k,integrations:y,allIntegURL:u}){const S=D(),{formID:p}=_(),[f,h]=c.useState(!1),[v,w]=c.useState(!1),[i,m]=c.useState(1),[N,o]=c.useState({show:!1}),[e,r]=c.useState({name:"Zoho Projects API",type:"Zoho Projects",clientId:"",clientSecret:"",portalId:"",event:"",field_map:{},actions:{}}),x=C([e.type]),A=()=>{setTimeout(()=>{S(`${u}/new/${e.type}`)},1e3),w(!1)},E=(s,d)=>{if(s.integration_type===e.type){const n=JSON.parse(s.integration_details);r(a=>g(a,l=>{l.parentAppId=s.id,l.clientId=n.clientId,l.clientSecret=n.clientSecret,l.tokenDetails=n.tokenDetails,l.dataCenter=n.dataCenter,l.ownerEmail=n.ownerEmail})),m(2)}};c.useEffect(()=>{r(s=>g(s,d=>{const n=x.find(a=>a.id===e.parentAppId);if(n){const a=JSON.parse(n.integration_details);d.clientId=a.clientId,d.clientSecret=a.clientSecret,d.tokenDetails=a.tokenDetails,d.dataCenter=a.dataCenter,d.ownerEmail=a.ownerEmail}})),e!=null&&e.parentAppId&&q(p,e,r,h,o)},[e.parentAppId]),c.useEffect(()=>{window.opener&&L("zohoProjects")},[]);const Z=s=>{if(s===3){if(!G(e,o)){o({show:!0,msg:z("Please map mandatory fields")});return}m(3)}};return t.jsxs("div",{children:[t.jsx(M,{title:"Authorize New Zoho Projects App",show:v,setModal:()=>w(!1),children:t.jsx(I,{formID:p,projectsConf:e,setProjectsConf:r,step:i,setStep:m,isLoading:f,setisLoading:h,setSnackbar:o,authorizedAction:A})}),t.jsx(P,{snack:N,setSnackbar:o}),t.jsx("div",{className:"txt-center w-9 mt-2 cal-width",children:t.jsx(T,{step:3,active:i})}),x.length>0&&i===1&&t.jsx(b,{allIntegURL:u,specificTypes:[e.type],onClickAction:E,allowAddNew:!0,addNewAction:()=>w(!0)}),i===1&&x.length===0&&t.jsx(I,{formID:p,projectsConf:e,setProjectsConf:r,step:i,setStep:m,isLoading:f,setisLoading:h,setSnackbar:o,authorizedAction:A}),t.jsxs("div",{className:"btcd-stp-page",style:{width:i===2&&900,height:i===2&&"100%"},children:[t.jsx(H,{formID:p,formFields:j,handleInput:s=>B(s,e,r,p,h,o),projectsConf:e,setProjectsConf:r,isLoading:f,setisLoading:h,setSnackbar:o}),t.jsx(O,{nextPageHandler:()=>Z(3),disabled:e.portalId===""||e.event===""})]}),t.jsx(J,{step:i,saveConfig:()=>$(y,k,u,e,S)})]})}export{ie as default};
