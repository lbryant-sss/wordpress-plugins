var bit_razorpay_field=function(){"use strict";return class{#e=null;#t="";#n={clientId:"",options:{currency:"INR",amount:1,amountType:"fixed",theme:{},modal:{},prefill:{},notes:{}}};#i=[];#r=null;#s=null;#o=null;#a=null;constructor(e,t){Object.assign(this.#n,t),this.#s=t.document||document,this.#o=t.window||window,this.#t=`#form-${this.#c()}`,this.#e="string"==typeof e?this.#s.querySelector(e):e,this.#a=this.#n?.formID,this.init()}init(){this.#d(this.#l(`.${this.#n.fieldKey}-razorpay-btn`),"click",()=>{this.#y()})}#l(e,t){return t?this.#s.querySelector(t).querySelector(e):this.#e.querySelector(e)}#d(e,t,n){e.addEventListener(t,n),this.#i.push({selector:e,eventType:t,cb:n})}#m(){this.#i.forEach(({selector:e,eventType:t,cb:n})=>{e.removeEventListener(t,n)})}#f(e){if(e){const t=window.bf_globals[this.#c()].fields[e].fieldName;let n=this.#l(`[name="${t}"]`,this.#t);if(n&&"radio"===n.type&&(n=this.#l(`[name="${t}"]:checked`,this.#t)),n&&n.value)return n.value}return""}#h=e=>{const t=document.getElementById(`${this.#c()}`);t.classList.add("pos-rel","form-loading");const n=document.getElementById(`form-${this.#c()}`),i=this.#c()?.split("_")[1];if(null!=n){const r=bf_globals[this.#c()];this.#r&&(r.entryId=this.#r);let s=bfSelect(`input[name="${this.#n.fieldKey}"]`,n);s?s.value=e.razorpay_payment_id:setHiddenFld({name:this.#n.fieldKey,value:e.razorpay_payment_id,type:"text"},n);let o=bfSelect('button[type="submit"]',n);o||(o=document.createElement("button"),this.#p(o,"type","submit"),o.style.display="none",n.append(o)),o.click();const a={formID:i,fieldKey:this.#n.fieldKey,transactionID:e.razorpay_payment_id,payment_type:"subscription"===this.#n.payType?"subscription":"order",entry_id:this.#r},c=new URL(r?.ajaxURL);c.searchParams.append("_ajax_nonce",r?.nonce),c.searchParams.append("action","bitforms_save_razorpay_details"),fetch(c,{method:"POST",body:JSON.stringify(a)}).then(()=>{t.classList.remove("pos-rel","form-loading"),this.#r=null,s=bfSelect(`input[name="${this.#n.fieldKey}"]`,n),s&&(this.#p(s,"value",""),s.value="")})}};async#u(e){const t=bf_globals[this.#c()],n=document.getElementById(`${this.#c()}`);n.classList.add("pos-rel","form-loading");const i=new URL(t?.ajaxURL);i.searchParams.append("_ajax_nonce",t?.nonce),i.searchParams.append("action","bitforms_create_razorpay_order");const r=await fetch(i,{method:"POST",body:JSON.stringify(e)}),s=await r.json();return n.classList.remove("pos-rel","form-loading"),s.data?.error||!s.success?"":s.data.id}async#y(){const{currency:e,amount:t,amountType:n,amountFld:i,name:r,description:s,theme:o,prefill:a,modal:c,notes:d}=this.#n.options,{confirm_close:l}=c,{contentId:y}=this.#n;let m=d;"undefined"!=typeof replaceFieldAndSmartValues&&m&&(m=JSON.parse(replaceFieldAndSmartValues(JSON.stringify(m),y)));const f=100*this.#g("dynamic"===n?this.#f(i):t);try{await isFormValidatedWithoutError(y)}catch(e){return!1}const h=await saveFormProgress(y),p=h?.[y];if(!p?.success)return;p.data.entry_id&&(this.#r=p.data.entry_id);let u="";if(m={...m,formID:this.#a,entryID:this.#r,fieldKey:this.#n.fieldKey},"undefined"!=typeof bf_modify_razorpay_notes&&(m=bf_modify_razorpay_notes(m)),this.#n.includeOrderId)if(this.#n.newOrderId||""===this.#n.orderIdFld){const t={payIntegID:this.#n.payIntegID,currency:e,amount:f,notes:m};u=await this.#u(t)}else u=this.#f(this.#n.orderIdFld);const g={key:this.#n.clientId,currency:e,amount:f,name:r,description:s,theme:o,order_id:u,prefill:{name:this.#f(a.prefillNameFld),email:this.#f(a.prefillEmailFld),contact:this.#f(a.prefillContactFld)},notes:m,modal:{backdropclose:!1,escape:!1,confirm_close:l},handler:async e=>this.#h(e)};new this.#o.Razorpay(g).open()}#c(){return this.#n.contentId}#p(e,t,n){e?.setAttribute?.(t,n)}#g(e){const t=e?.match(/[\d,.]*\d(?:\.\d+)?/);if(t){const e=t[0].replace(/,/g,"");return parseFloat(e)}return parseFloat(0)}destroy(){this.#m()}reset(){this.destroy(),this.init()}}}();
