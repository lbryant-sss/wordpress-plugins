var bit_razorpay_field=function(){"use strict";return class{#e=null;#t="";#n={clientId:"",options:{currency:"INR",amount:1,amountType:"fixed",theme:{},modal:{},prefill:{},notes:{}}};#i=[];#r=null;#s=null;#a=null;constructor(e,t){Object.assign(this.#n,t),this.#s=t.document||document,this.#a=t.window||window,this.#t=`#form-${this.#o()}`,this.#e="string"==typeof e?this.#s.querySelector(e):e,this.init()}init(){this.#c(this.#d(`.${this.#n.fieldKey}-razorpay-btn`),"click",()=>{this.#l()})}#d(e,t){return t?this.#s.querySelector(t).querySelector(e):this.#e.querySelector(e)}#c(e,t,n){e.addEventListener(t,n),this.#i.push({selector:e,eventType:t,cb:n})}#y(){this.#i.forEach(({selector:e,eventType:t,cb:n})=>{e.removeEventListener(t,n)})}#m(e){if(e){const t=window.bf_globals[this.#o()].fields[e].fieldName;let n=this.#d(`[name="${t}"]`,this.#t);if(n&&"radio"===n.type&&(n=this.#d(`[name="${t}"]:checked`,this.#t)),n&&n.value)return n.value}return""}#p=e=>{const t=document.getElementById(`${this.#o()}`);t.classList.add("pos-rel","form-loading");const n=document.getElementById(`form-${this.#o()}`),i=this.#o()?.split("_")[1];if(null!=n){const r=bf_globals[this.#o()];this.#r&&(r.entryId=this.#r);let s=bfSelect(`input[name="${this.#n.fieldKey}"]`,n);s?s.value=e.razorpay_payment_id:setHiddenFld({name:this.#n.fieldKey,value:e.razorpay_payment_id,type:"text"},n);let a=bfSelect('button[type="submit"]',n);a||(a=document.createElement("button"),this.#h(a,"type","submit"),a.style.display="none",n.append(a)),a.click();const o={formID:i,fieldKey:this.#n.fieldKey,transactionID:e.razorpay_payment_id,payment_type:"subscription"===this.#n.payType?"subscription":"order",entry_id:this.#r},c=new URL(r?.ajaxURL);c.searchParams.append("_ajax_nonce",r?.nonce),c.searchParams.append("action","bitforms_save_razorpay_details"),fetch(c,{method:"POST",body:JSON.stringify(o)}).then(()=>{t.classList.remove("pos-rel","form-loading"),this.#r=null,s=bfSelect(`input[name="${this.#n.fieldKey}"]`,n),s&&(this.#h(s,"value",""),s.value="")})}};async#u(e){const t=bf_globals[this.#o()],n=document.getElementById(`${this.#o()}`);n.classList.add("pos-rel","form-loading");const i=new URL(t?.ajaxURL);i.searchParams.append("_ajax_nonce",t?.nonce),i.searchParams.append("action","bitforms_create_razorpay_order");const r=await fetch(i,{method:"POST",body:JSON.stringify(e)}),s=await r.json();return n.classList.remove("pos-rel","form-loading"),s.data?.error||!s.success?"":s.data.id}async#l(){const{currency:e,amount:t,amountType:n,amountFld:i,name:r,description:s,theme:a,prefill:o,modal:c,notes:d}=this.#n.options,{confirm_close:l}=c,{contentId:y}=this.#n;let m=d;"undefined"!=typeof replaceFieldAndSmartValues&&m&&(m=JSON.parse(replaceFieldAndSmartValues(JSON.stringify(m),y))),"undefined"!=typeof bf_modify_razorpay_notes&&(m=bf_modify_razorpay_notes(m));const p=100*this.#f("dynamic"===n?this.#m(i):t);try{await isFormValidatedWithoutError(y)}catch(e){return!1}const h=await saveFormProgress(y),u=h?.[y];if(!u?.success)return;u.entry_id&&(this.#r=u.entry_id);let f="";if(this.#n.includeOrderId)if(this.#n.newOrderId||""===this.#n.orderIdFld){const t={payIntegID:this.#n.payIntegID,currency:e,amount:p,notes:m};f=await this.#u(t)}else f=this.#m(this.#n.orderIdFld);const g={key:this.#n.clientId,currency:e,amount:p,name:r,description:s,theme:a,order_id:f,prefill:{name:this.#m(o.prefillNameFld),email:this.#m(o.prefillEmailFld),contact:this.#m(o.prefillContactFld)},notes:m,modal:{backdropclose:!1,escape:!1,confirm_close:l},handler:async e=>this.#p(e)};new this.#a.Razorpay(g).open()}#o(){return this.#n.contentId}#h(e,t,n){e?.setAttribute?.(t,n)}#f(e){const t=e?.match(/[\d,.]*\d(?:\.\d+)?/);if(t){const e=t[0].replace(/,/g,"");return parseFloat(e)}return parseFloat(0)}destroy(){this.#y()}reset(){this.destroy(),this.init()}}}();
