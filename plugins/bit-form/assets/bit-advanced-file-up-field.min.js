var bit_advanced_file_up_field=function(){"use strict";return class{#e=null;#t=null;#i=null;#s=null;#l={};#n=null;#o=null;#a=null;#d=null;#r=null;#h=null;#p=[];#f=null;#c={document:{},formID:null,configSetting:{},ajaxURL:null,nonce:null,uploadFileToServer:null};constructor(e,t){Object.assign(this.#c,t),this.#n=t.fieldKey,this.#s=t.window?t.window:window,this.#i=t.document?t.document:document,this.#f=t.contentId,this.#e="string"==typeof e?this.#i.querySelector(e):e,this.#o=this.#c.formID,this.#l=this.#c.configSetting,this.#a=this.#c.ajaxURL,this.#d=this.#s?.bf_globals?.[this.#f]?.nonce||this.#c?.nonce,this.#r=this.#c.uploadFileToServer,this.uploaded_files=[],this.on_select_upload=!1,this.init()}init(){this.files=[];const e=[];this.#l.allowFileSizeValidation&&e.push(this.#s.bit_filepond_plugin_file_validate_size),this.#l.allowFileTypeValidation&&e.push(this.#s.bit_filepond_plugin_file_validate_type),this.#l.allowImageCrop&&e.push(this.#s.bit_filepond_plugin_image_crop),this.#l.allowImagePreview&&e.push(this.#s.bit_filepond_plugin_image_preview),this.#l.allowImageResize&&e.push(this.#s.bit_filepond_plugin_image_resize),this.#l.allowImageTransform&&e.push(this.#s.bit_filepond_plugin_image_transform),this.#l.allowImageValidateSize&&e.push(this.#s.bit_filepond_plugin_image_validate_size),this.#l.allowPreview&&e.push(this.#s.bit_filepond_plugin_media_preview);const{create:t,registerPlugin:i}=this.#s.bit_filepond;if(i(...e),this.#t=t(this.#l),this.#e.appendChild(this.#t.element),setTimeout(()=>{this.#e&&this.#e.parentNode.parentNode.querySelector(`.${this.#n}-lbl`).setAttribute("for",this.#u('input[name="filepond"]')?.id)},1e3),this.#c.onFileUpdate&&this.#t.on("updatefiles",this.#c.onFileUpdate),this.#r){const e=new URL(this.#a);this.on_select_upload=this.#l.instantUpload,e.searchParams.append("_ajax_nonce",this.#d);let t=null;this.#t.setOptions({server:{process:(i,s,l,n,o,a,d)=>{const r=new FormData;e.searchParams.has("action")&&e.searchParams.delete("action"),e.searchParams.append("action","bitforms_file_upload"),r.append(this.#n,s,s.name),r.append("fieldKey",this.#n),r.append("formID",this.#o);const h=new XMLHttpRequest;return h.open("POST",e.href),h.upload.onprogress=e=>{a(e.lengthComputable,e.loaded,e.total)},h.onload=()=>{t=JSON.parse(h.responseText),h.status>=200&&h.status<300?(this.uploaded_files.push(t?.data?.file_name),n(t?.data?.file_name)):o()},h.send(r),{abort:()=>{h.abort(),d()}}},revert:(t,i,s)=>{if(this.uploaded_files.find(e=>e===t)){const l=this.uploaded_files.indexOf(t);this.uploaded_files.splice(l,1),e.searchParams.has("action")&&e.searchParams.delete("action"),e.searchParams.append("action","bitforms_file_delete"),e.searchParams.append("file_name",t),e.searchParams.append("formID",this.#o);const n=new XMLHttpRequest;return n.open("DELETE",e.href),n.onload=()=>{n.status>=200&&n.status<300?i():s()},n.send(),{abort:()=>{n.abort()}}}}},labelFileProcessingError:()=>t?.data}),this.#t.on("updatefiles",()=>{this.files=[],this.files=this.#t.getFiles()})}this.#c.oldFiles&&this.#g(this.#c.oldFiles)}#m(e){if("string"==typeof e)try{return JSON.parse(e)}catch(e){console.error("Invalid JSON string",e)}return Array.isArray(e)?e:[]}#g(e){const t=this.#m(e);this.#p=t,this.#h=this.#_("div"),this.#w(this.#h,"old-file-list"),t.forEach(e=>{this.#b(e)});const i=this.#_("input");i.type="hidden",i.name=`${this.#n}_old`,i.value=this.#p.toString(),this.#e.appendChild(this.#h),this.#e.appendChild(i)}#b(e){const t=this.#_("div"),i=e.replace(/( |\.|\(|\))/g,"");t.id=`file-wrp-${i}`,this.#w(t,"file-wrpr");const s=this.#_("div");this.#w(s,"file-details");const l=this.#_("a");this.#w(l,"file-title"),this.#F(l,"target","_blank"),this.#F(l,"href",`${this.#c.baseDLURL}&fileID=${e}`),this.#v(l,e),s.append(l),t.append(s);const n=this.#_("button");this.#w(n,"cross-btn"),this.#F(n,"data-file-id",i),this.#F(n,"data-file-name",e),this.#F(n,"type","button"),this.#v(n,"Ã—"),this.#S(n,"click",e=>this.#P(e)),t.append(n),this.#h.appendChild(t)}#P(e){const t=e.target.getAttribute("data-file-id"),i=e.target.getAttribute("data-file-name");this.#y(`#file-wrp-${t}`),this.#p=this.#p.filter(e=>e!==i),this.#u(`input[name="${this.#n}_old"]`).value=this.#p.toString()}#y(e){this.#u(e)?.remove()}#_(e){return this.#i.createElement(e)}#S(e,t,i){e.addEventListener(t,i)}#w(e,t){e.classList.add(t)}#v(e,t){e.textContent=t}#F(e,t,i){e?.setAttribute?.(t,i)}#u(e){return this.#e.querySelector(e)||console.error("selector not found",e)}checkValidate(){return 0===this.#p.length&&0===this.files?.length?"req":""}set value(e){this.#g(e)}get value(){return this.#t.getFiles()}reset(){this.#t.destroy(this.#t.element),this.#e.innerHTML="",this.init()}}}();
