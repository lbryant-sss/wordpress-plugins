import{w as T,x as E,r,a as b,f as A,j as t,M as B,_ as I,S as C,H as F,aj as P}from"./main-461.js";import{B as z}from"./bf-908-79.js";import{S as O}from"./bf-90-262.js";import{C as $}from"./bf-981-87.js";import{ac as J}from"./bf-648-81.js";import{c as H,s as L}from"./bf-925-202.js";import{I as R}from"./bf-870-187.js";import j from"./bf-535-116.js";import{r as W,a as q,d as K}from"./bf-403-173.js";import{G as Q}from"./bf-590-203.js";import"./bf-824-88.js";import"./bf-440-172.js";import"./bf-912-114.js";import"./bf-338-174.js";function pe({formFields:k,setIntegration:N,integrations:y,allIntegURL:p}){const w=T(),{formID:d}=E(),[G,m]=r.useState(!1),[u,l]=r.useState(!1),[s,h]=r.useState(1),{css:_}=b(),[v,a]=r.useState({show:!1}),[e,o]=r.useState({name:"Google Sheet API",type:"Google Sheet",clientId:"",clientSecret:"",spreadsheetId:"",worksheetName:"",field_map:[{formField:"",googleSheetField:""}],header:"ROWS",headerRow:"A1",actions:{}}),S=J([e.type]),x=()=>{setTimeout(()=>{w(`${p}/new/${e.type}`)},1e3),m(!1)},D=(i,f)=>{if(i.integration_type===e.type){const c=JSON.parse(i.integration_details);o(n=>A(n,g=>{g.parentAppId=i.id,g.clientId=c.clientId,g.clientSecret=c.clientSecret,g.tokenDetails=c.tokenDetails})),h(2)}};r.useEffect(()=>{o(i=>A(i,f=>{const c=S.find(n=>n.id===e.parentAppId);if(c){const n=JSON.parse(c.integration_details);f.clientId=n.clientId,f.clientSecret=n.clientSecret,f.tokenDetails=n.tokenDetails}})),e!=null&&e.parentAppId&&W(d,e,o,l,a)},[e.parentAppId]),r.useEffect(()=>{window.opener&&H("googleSheet")},[]);const M=()=>{if(setTimeout(()=>{document.getElementById("btcd-settings-wrp").scrollTop=0},300),!K(e)){a({show:!0,msg:"Please map fields to continue."});return}e.spreadsheetId!==""&&e.worksheetName!==""&&e.field_map.length>0&&h(3)};return t.jsxs("div",{children:[t.jsx(B,{title:I("Authorize New Google App"),show:G,setModal:()=>m(!1),children:t.jsx(j,{formID:d,sheetConf:e,setSheetConf:o,step:s,setstep:h,setSnackbar:a,isLoading:u,setisLoading:l,allIntegURL:p,authorizedAction:x})}),t.jsx(C,{snack:v,setSnackbar:a}),t.jsx("div",{className:"txt-center w-9 mt-2 cal-width",children:t.jsx(O,{step:3,active:s})}),S.length>0&&s===1&&t.jsx($,{allIntegURL:p,specificTypes:[e.type],onClickAction:D,allowAddNew:!0,addNewAction:()=>m(!0)}),s===1&&S.length===0&&t.jsx(j,{formID:d,sheetConf:e,setSheetConf:o,step:s,setstep:h,setSnackbar:a,isLoading:u,setisLoading:l,allIntegURL:p,authorizedAction:x}),t.jsxs("div",{className:"btcd-stp-page",style:{width:s===2&&900,height:s===2&&"100%"},children:[t.jsx(Q,{formID:d,formFields:k,handleInput:i=>q(i,e,o,d,l,a),sheetConf:e,setSheetConf:o,isLoading:u,setisLoading:l,setSnackbar:a,setShowMdl:m}),t.jsxs(F,{onClick:()=>M(),disabled:!e.spreadsheetId||!e.worksheetName||e.field_map.length<1,className:_(P.ftRight),children:[I("Next"),t.jsx(z,{className:"ml-1 rev-icn"})]})]}),t.jsx(R,{step:s,saveConfig:()=>L(y,N,p,e,w)})]})}export{pe as default};
