var N=Object.defineProperty;var g=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var A=(t,a,s)=>a in t?N(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,h=(t,a)=>{for(var s in a||(a={}))E.call(a,s)&&A(t,s,a[s]);if(g)for(var s of g(a))q.call(a,s)&&A(t,s,a[s]);return t};import{_ as n,ae as S,$ as k,c as F,c8 as B,u as Z,r as y,j as c,C as U}from"./main-509.js";import{t as $}from"./bf-890-82.js";import{a4 as O,a5 as P,a6 as M}from"./bf-445-81.js";const C=(t,a,s,d,o,m,e,i,l,r)=>{let f=h({},s);if(a===0){if(i){const u=h({},l);u[t.target.name]="",r(h({},u))}f[t.target.name]=t.target.value}else f.relatedlists[a-1][t.target.name]=t.target.value;switch(t.target.name){case"module":f=L(a,f,o,d,m,e);break}d(h({},f))},T=(t,a,s,d,o,m,e)=>{var i,l;t&&!((l=(i=s==null?void 0:s.default)==null?void 0:i.relatedlists)!=null&&l[s.module])&&H(o,s,d,m,e),a(t)},L=(t,a,s,d,o,m)=>{var l,r;const e=h({},a),i=t===0?e.module:e.relatedlists[t-1].module;return t===0?(e.actions={},e.field_map=[{formField:"",zohoFormField:""}],e.upload_field_map=[{formField:"",zohoFormField:""}],t&&(e.relatedlists[t-1]={})):(e.relatedlists[t-1].field_map=[{formField:"",zohoFormField:""}],e.relatedlists[t-1].upload_field_map=[{formField:"",zohoFormField:""}],e.relatedlists[t-1].actions={}),(r=(l=e.default)==null?void 0:l.moduleData)!=null&&r[i]?t===0?(e.field_map=p(t,e),Object.keys(e.default.moduleData[i].fileUploadFields).length>0&&(e.upload_field_map=p(t,e,!0))):(e.relatedlists[t-1].field_map=p(t,e),Object.keys(e.default.moduleData[i].fileUploadFields).length>0&&(e.relatedlists[t-1].upload_field_map=p(t,e,!0))):V(t,s,e,d,o,m),e},b=(t,a,s,d,o)=>{d(!0);const m={formID:t,id:a.id,dataCenter:a.dataCenter,clientId:a.clientId,clientSecret:a.clientSecret,tokenDetails:a.tokenDetails};F(m,"bitforms_zbigin_refresh_modules").then(e=>{if(e&&e.success){const i=h({},a);i.default||(i.default={}),e.data.modules&&(i.default.modules=e.data.modules),e.data.tokenDetails&&(i.tokenDetails=e.data.tokenDetails),s(h({},i)),o({show:!0,msg:n("Modules refreshed")})}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?o({show:!0,msg:B(n("Modules refresh failed Cause: %s. please try again"),e.data.data||e.data)}):o({show:!0,msg:n("Modules refresh failed. please try again")});d(!1)}).catch(()=>d(!1))},H=(t,a,s,d,o)=>{if(!a.module)return;d(!0);const m={formID:t,module:a.module,dataCenter:a.dataCenter,clientId:a.clientId,clientSecret:a.clientSecret,tokenDetails:a.tokenDetails};F(m,"bitforms_zbigin_refresh_related_lists").then(e=>{var i;if(e&&e.success){const l=h({},a);e.data.related_modules&&(l.default.relatedlists||(l.default.relatedlists={}),l.default.relatedlists[l.module]=e.data.related_modules),e.data.tokenDetails&&(l.tokenDetails=e.data.tokenDetails),s(h({},l)),o({show:!0,msg:n("RelatedLists refreshed")})}else(i=e==null?void 0:e.data)!=null&&i.data||!e.success&&typeof e.data=="string"?o({show:!0,msg:`${n("RelatedLists refresh failed Cause:")}${e.data.data||e.data}. ${n("please try again")}`}):o({show:!0,msg:n("RelatedLists refresh failed. please try again")});d(!1)}).catch(()=>d(!1))},V=(t,a,s,d,o,m)=>{const e=t===0?s.module:s.relatedlists[t-1].module;if(!e)return;o(!0);const i={formID:a,module:e,dataCenter:s.dataCenter,clientId:s.clientId,clientSecret:s.clientSecret,tokenDetails:s.tokenDetails};F(i,"bitforms_zbigin_refresh_fields").then(l=>{if(l&&l.success){const r=h({},s);l.data.fieldDetails&&(r.default.moduleData||(r.default.moduleData={}),r.default.moduleData[e]=l.data.fieldDetails,t===0?(r.field_map=p(t,r),Object.keys(r.default.moduleData[e].fileUploadFields).length>0&&(r.upload_field_map=p(t,r,!0))):(r.relatedlists[t-1].field_map=p(t,r),Object.keys(r.default.moduleData[e].fileUploadFields).length>0&&(r.relatedlists[t-1].upload_field_map=p(t,r,!0)))),l.data.tokenDetails&&(r.tokenDetails=l.data.tokenDetails),d(h({},r))}else m({show:!0,msg:n("Fields refresh failed. please try again")});o(!1)}).catch(()=>o(!1))},ee=(t,a,s,d,o,m)=>{const e=t===0?s.module:s.relatedlists[t-1].module;if(!e)return;o(!0);const i={formID:a,module:e,dataCenter:s.dataCenter,clientId:s.clientId,clientSecret:s.clientSecret,tokenDetails:s.tokenDetails};F(i,"bitforms_zbigin_refresh_tags").then(l=>{if(l&&l.success){const r=h({},s);l.data.tags&&(r.default.moduleData||(r.default.moduleData={}),r.default.moduleData[e].tags=l.data.tags,m({show:!0,msg:n("Tags Refreshed")})),l.data.tokenDetails&&(r.tokenDetails=l.data.tokenDetails),d(h({},r))}else m({show:!0,msg:n("Tags refresh failed. please try again")});o(!1)}).catch(()=>o(!1))},te=(t,a,s,d,o)=>{d(!0);const m={formID:t,dataCenter:a.dataCenter,clientId:a.clientId,clientSecret:a.clientSecret,tokenDetails:a.tokenDetails};F(m,"bitforms_zbigin_refresh_users").then(e=>{if(e&&e.success){const i=h({},a);e.data.users&&(i.default||(i.default={}),i.default.users=e.data.users,o({show:!0,msg:n("Users Refreshed")})),e.data.tokenDetails&&(i.tokenDetails=e.data.tokenDetails),s(h({},i))}else o({show:!0,msg:n("Users refresh failed. please try again")});d(!1)}).catch(()=>d(!1))},p=(t,a,s)=>{var o,m;const d=t===0?a.module:a.relatedlists[t-1].module;return s?a.default.moduleData[d].requiredFileUploadFields.length>0?(o=a.default.moduleData[d].requiredFileUploadFields)==null?void 0:o.map(e=>({formField:"",zohoFormField:e})):[{formField:"",zohoFormField:""}]:a.default.moduleData[d].required.length>0?(m=a.default.moduleData[d].required)==null?void 0:m.map(e=>({formField:"",zohoFormField:e})):[{formField:"",zohoFormField:""}]},ae=t=>{const a=t!=null&&t.field_map?t.field_map.filter(d=>{var o,m,e;return!d.formField&&d.zohoFormField&&((e=(m=(o=t==null?void 0:t.default)==null?void 0:o.moduleData)==null?void 0:m[t.module])==null?void 0:e.required.indexOf(d.zohoFormField))!==-1}):[],s=t.relatedlists.map(d=>d.field_map.filter(o=>!o.formField&&o.zohoFormField));return!(a.length>0||s.find(d=>d.length))},J=(t,a,s,d,o,m)=>{if(!t.dataCenter||!t.clientId||!t.clientSecret){s({dataCenter:t.dataCenter?"":n("Data center cann't be empty"),clientId:t.clientId?"":n("Client ID cann't be empty"),clientSecret:t.clientSecret?"":n("Secret key cann't be empty")});return}const e=S(k);o(!0);const i="ZohoBigin.settings.modules.READ,ZohoBigin.settings.fields.READ,ZohoBigin.settings.tags.READ,ZohoBigin.users.READ,ZohoBigin.modules.ALL",l=`https://accounts.zoho.${t.dataCenter}/oauth/v2/auth?scope=${i}&response_type=code&client_id=${t.clientId}&prompt=Consent&access_type=offline&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(e.zohoRedirectURL)}`,r=window.open(l,"zohoBigin","width=400,height=609,toolbar=off"),f=setInterval(()=>{if(r.closed){clearInterval(f);let u={},z=!1;const _=localStorage.getItem("__bitforms_zohoBigin");if(_&&(z=!0,u=JSON.parse(_),localStorage.removeItem("__bitforms_zohoBigin")),!u.code||u.error||!u||!z){const D=u.error?`Cause: ${u.error}`:"";m({show:!0,msg:`${n("Authorization failed")} ${D}. ${n("please try again")}`}),o(!1)}else{const D=h({},t);D.accountServer=u["accounts-server"],W(u,D,a,d,o,m)}}},500)},W=(t,a,s,d,o,m)=>{const e=S(k),i=h({},t);i.dataCenter=a.dataCenter,i.clientId=a.clientId,i.clientSecret=a.clientSecret,i.redirectURI=encodeURIComponent(e.zohoRedirectURL),F(i,"bitforms_zbigin_generate_token").then(l=>l).then(l=>{if(l&&l.success){const r=h({},a);r.tokenDetails=l.data,s(r),O(r),d(!0),m({show:!0,msg:n("Authorized Successfully")})}else l&&l.data&&l.data.data||!l.success&&typeof l.data=="string"?m({show:!0,msg:`${n("Authorization failed Cause:")}${l.data.data||l.data}. ${n("please try again")}`}):m({show:!0,msg:n("Authorization failed. please try again")});o(!1)})};function G({formID:t,biginConf:a,setBiginConf:s,step:d,setstep:o,isLoading:m,setisLoading:e,setSnackbar:i,redirectLocation:l,isInfo:r,authorizedAction:f}){const u=Z(k),{siteURL:z}=u,[_,D]=y.useState(!1),[x,R]=y.useState({dataCenter:"",clientId:"",clientSecret:""}),j=w=>{const v=h({},a),I=h({},x);I[w.target.name]="",v[w.target.name]=w.target.value,R(I),s(v)};return y.useEffect(()=>{_&&f()},[_]),c.jsxs(c.Fragment,{children:[c.jsx(P,{title:$.zohoBigin.title,youTubeLink:$.zohoBigin.link}),c.jsxs("div",{className:"btcd-stp-page",style:{width:d===1&&900,height:d===1&&"100%"},children:[c.jsx("div",{className:"mt-3",children:c.jsx("b",{children:n("Integration Name:")})}),c.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:j,name:"name",value:a.name,type:"text",placeholder:n("Integration Name..."),disabled:r}),c.jsx("div",{className:"mt-3",children:c.jsx("b",{children:n("Data Center:")})}),c.jsxs("select",{onChange:j,name:"dataCenter",value:a.dataCenter,className:"btcd-paper-inp w-6 mt-1",disabled:r,children:[c.jsx("option",{value:"",children:n("--Select a data center--")}),c.jsx("option",{value:"com",children:"zoho.com"}),c.jsx("option",{value:"eu",children:"zoho.eu"}),c.jsx("option",{value:"com.cn",children:"zoho.com.cn"}),c.jsx("option",{value:"in",children:"zoho.in"}),c.jsx("option",{value:"com.au",children:"zoho.com.au"})]}),c.jsx("div",{style:{color:"red"},children:x.dataCenter}),c.jsx("div",{className:"mt-3",children:c.jsx("b",{children:n("Homepage URL:")})}),c.jsx(U,{value:z,className:"field-key-cpy w-6 ml-0",readOnly:r}),c.jsx("div",{className:"mt-3",children:c.jsx("b",{children:n("Authorized Redirect URIs:")})}),c.jsx(U,{value:l||`${u.zohoRedirectURL}`,className:"field-key-cpy w-6 ml-0",readOnly:r}),c.jsxs("small",{className:"d-blk mt-5",children:[n("To get Client ID and SECRET , Please Visit")," ",c.jsx("a",{className:"btcd-link",href:`https://api-console.zoho.${(a==null?void 0:a.dataCenter)||"com"}/`,target:"_blank",rel:"noreferrer",children:n("Zoho API Console")})]}),c.jsx("div",{className:"mt-3",children:c.jsx("b",{children:n("Client id:")})}),c.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:j,name:"clientId",value:a.clientId,type:"text",placeholder:n("Client id..."),disabled:r}),c.jsx("div",{style:{color:"red"},children:x.clientId}),c.jsx("div",{className:"mt-3",children:c.jsx("b",{children:n("Client secret:")})}),c.jsx("input",{className:"btcd-paper-inp w-6 mt-1",onChange:j,name:"clientSecret",value:a.clientSecret,type:"text",placeholder:n("Client secret..."),disabled:r}),c.jsx("div",{style:{color:"red"},children:x.clientSecret}),!r&&c.jsxs(c.Fragment,{children:[c.jsx(M,{isAuthorized:_,isLoading:m,handleAuthorize:()=>J(a,s,R,D,e,i)}),c.jsx("br",{})]})]})]})}var se=Object.freeze({__proto__:null,default:G});export{G as Z,ee as a,T as b,ae as c,b as d,se as e,C as h,te as r};
